function TextManager(){throw new Error("This is a static class")}$dataActors=null,$dataClasses=null,$dataSkills=null,$dataItems=null,$dataWeapons=null,$dataArmors=null,$dataEnemies=null,$dataTroops=null,$dataStates=null,$dataAnimations=null,$dataTilesets=null,$dataCommonEvents=null,$dataSystem=null,$dataMapInfos=null,$dataMap=null,$dataEventReadInfos=null,$gameTemp=null,$gameSystem=null,$gameScreen=null,$gameTimer=null,$gameMessage=null,$gameSwitches=null,$gameVariables=null,$gameSelfSwitches=null,$gameActors=null,$gameParty=null,$gameTroop=null,$gameMap=null,$gamePlayer=null,$testEvent=null,$gameDefine=null,$gameColor=null,$gameBGM=null,$gameElement=null,$gameSe=null,$gameStateInfo=null,$dataText=null,$dataStage=null,$gameKeyMap=null,$gameSkillExp=null,$gameHelp=null,$gameTips=null,$gameBackGround=null,$gameTutorial=null,$gameChallenge=null,$gameEventBattle=null,$gameAchievement=null,$dataOption=null,$gameText=null,$gameCommand=null,$gameAlchemy=null,$gameSearch=null,$gamePause=!1,DataManager._errors=[],DataManager._databaseFiles=[{name:"$dataActors",src:"Actors.json"},{name:"$dataClasses",src:"Classes.json"},{name:"$dataItems",src:"Items.json"},{name:"$dataSkills",src:"Skills.json"},{name:"$dataWeapons",src:"Weapons.json"},{name:"$dataArmors",src:"Armors.json"},{name:"$dataEnemies",src:"Enemies.json"},{name:"$dataTroops",src:"Troops.json"},{name:"$dataStates",src:"States.json"},{name:"$dataAnimations",src:"Animations.json"},{name:"$dataTilesets",src:"Tilesets.json"},{name:"$dataCommonEvents",src:"CommonEvents.json"},{name:"$dataSystem",src:"System.json"},{name:"$dataMapInfos",src:"MapInfos.json"},{name:"$dataEventReadInfos",src:"EventReadInfos.json"}],DataManager.loadDatabase=async function(){$dataText={};const test=this.isBattleTest()||this.isEventTest(),prefix=test?"Test_":"";for(const databaseFile of this._databaseFiles)"$dataBgms"==databaseFile.name?this.loadDataFile(databaseFile.name,databaseFile.src):"$dataEventReadInfos"==databaseFile.name?this.loadDataFile(databaseFile.name,databaseFile.src):this.loadDataFile(databaseFile.name,prefix+databaseFile.src);this.isEventTest()&&this.loadDataFile("$testEvent",prefix+"Event.json"),this.loadOptionData()},DataManager.isDatabaseLoaded=function(){this.checkError();for(const databaseFile of this._databaseFiles)if(!window[databaseFile.name])return!1;return null!=$dataOption},DataManager.loadDatabasePlus=function(object){object==$dataActors&&this.createActorDataPlus(),object==$dataSkills&&this.createSkillDataPlus(),object==$dataEnemies&&this.createEnemyDataPlus(),object==$dataClasses&&this.createClassDataPlus()},DataManager.createActorDataPlus=function(){$dataActors.forEach(element=>{if(element&&""!=element.note){const json=JSON.parse(element.note);json&&(element.x=json.x?Number(json.x):0,element.y=json.y?Number(json.y):0,element.elementId=json.elementId?json.elementId.split(",").map(num=>Number(num)):[],element.scale=json.scale?Number(json.scale):1)}})},DataManager.createSkillDataPlus=function(){$dataSkills.forEach(element=>{if(element&&""!=element.note){const json=JSON.parse(element.note);json&&(element.maxLevel=json.maxLevel?Number(json.maxLevel):0,element.stateTurns=json.stateTurns?Number(json.stateTurns):0,element.stateEffect=json.stateEffect?Number(json.stateEffect):0,element.selfSkill=json.selfSkill?Number(json.selfSkill):0,element.nextLevel=json.nextLevel?json.nextLevel.split(",").map(num=>Number(num)):[],element.nextExp=json.nextExp?Number(json.nextExp):0,element.passiveType=json.passiveType?json.passiveType:"",element.effect=json.effect?Number(json.effect):0,element.animation=json.animation?Number(json.animation):0,element.features=json.features?json.features:[],element.repeatPlus=json.repeatPlus?Number(json.repeatPlus):0,element.helpTextId=json.helpTextId?Number(json.helpTextId):0,element.repeatPlus&&(element.repeats+=element.repeatPlus),element.chargeTurn=json.chargeTurn?Number(json.chargeTurn):0,element.range=json.range?Number(json.range):0)}})},DataManager.createEnemyDataPlus=function(){$dataEnemies.forEach(element=>{if(element&&""!=element.note){const json=JSON.parse(element.note);json&&(element.scale=json.scale?Number(json.scale):1,element.attackId=json.attackId?Number(json.attackId):301,element.elementId=json.elementId?Number(json.elementId):1)}})},DataManager.createClassDataPlus=function(){$dataClasses.forEach(classData=>{classData&&classData.learnings.forEach(learning=>{const skillId=learning.skillId;let awake;if(""!=learning.note){const data=JSON.parse(learning.note);awake={timing:Number(data.timing),type:Number(data.type),skillId:skillId,level:learning.level,skill:data.skill,value:data.value}}else awake={type:0,skillId:skillId,level:learning.level};learning.awake=awake})})},DataManager.loadOptionData=function(){$dataOption||($dataOption=new Game_Option)},DataManager.getFacePositionData=function(faceName){return _.find($dataActors,d=>d&&d.faceName==faceName)},DataManager.getStageInfos=function(stageId){return _.find($dataStage,d=>d&&d.id==stageId)},DataManager.loadMapData=function(mapId,resolve){if(mapId>0){const filename="Map%1.json".format(mapId.padZero(3));this.loadDataFile("$dataMap",filename,resolve)}else if(this.makeEmptyMap(),resolve)return resolve()},DataManager.loadDataFile=function(name,src,resolve){const xhr=new XMLHttpRequest,url="data/"+src;window[name]=null,xhr.open("GET",url),xhr.overrideMimeType("application/json"),xhr.onload=()=>this.onXhrLoad(xhr,name,src,url,resolve),xhr.onerror=()=>this.onXhrError(name,src,url),xhr.send()},DataManager.onXhrLoad=function(xhr,name,src,url,resolve){if(xhr.status<400){if(window[name]=JSON.parse(xhr.responseText),this.onLoad(window[name]),resolve)return resolve(window[name])}else this.onXhrError(name,src,url)},DataManager.loadEventFile=function(src,resolve){let xhr=new XMLHttpRequest;const lang=$dataOption.getUserData("language");let dirPath="";lang==LanguageType.Japanese&&(dirPath="jp"),lang==LanguageType.English&&(dirPath="en");const url="event/"+dirPath+"/"+src;xhr.open("GET",url),xhr.overrideMimeType("application/json"),xhr.onload=function(){if(xhr.status<400)return resolve(JSON.parse(xhr.responseText))},xhr.onerror=this._mapLoader||function(){DataManager._errorUrl=DataManager._errorUrl||url},window[name]=null,xhr.send()},DataManager.loadParticleFile=function(src,resolve){let xhr=new XMLHttpRequest;const url="img/particles/"+src+".json";xhr.open("GET",url),xhr.overrideMimeType("application/json"),xhr.onload=function(){xhr.status<400&&resolve(JSON.parse(xhr.responseText))},xhr.onerror=this._mapLoader||function(){DataManager._errorUrl=DataManager._errorUrl||url},xhr.send()},DataManager.loadStageSequenceData=function(resolve){let xhr=new XMLHttpRequest;const url="data/Map001.json";xhr.open("GET",url),xhr.overrideMimeType("application/json"),xhr.onload=function(){xhr.status<400&&resolve(JSON.parse(xhr.responseText))},xhr.onerror=this._mapLoader||function(){DataManager._errorUrl=DataManager._errorUrl||url},xhr.send()},DataManager.loadTextData=function(src,resolve){let xhr=new XMLHttpRequest;const url="text/"+src+".json";xhr.open("GET",url),xhr.overrideMimeType("application/json"),xhr.onload=function(){xhr.status<400&&resolve(JSON.parse(xhr.responseText))},xhr.onerror=this._mapLoader||function(){DataManager._errorUrl=DataManager._errorUrl||url},xhr.send()},DataManager.onLoad=function(object){this.isMapObject(object)?(this.extractMetadata(object),this.extractArrayMetadata(object.events)):this.extractArrayMetadata(object),this.createTextData(object),this.loadDatabasePlus(object)},DataManager.createTextData=function(data){switch(data){case $dataActors:$dataText.actorsName=data.map(d=>null!=d?d.name:null),$dataText.actorsNickName=data.map(d=>null!=d?d.nickname:null),$dataText.actorsProfile=data.map(d=>null!=d?d.profile:null);break;case $dataClasses:$dataText.classesName=data.map(d=>null!=d?d.name:null);break;case $dataSkills:$dataText.skillsName=data.map(d=>null!=d?d.name:null),$dataText.skillsDescription=data.map(d=>null!=d?d.description:null),$dataText.skillsMessage1=data.map(d=>null!=d?d.message1:null),$dataText.skillsMessage2=data.map(d=>null!=d?d.message2:null);break;case $dataItems:$dataText.itemsName=data.map(d=>null!=d?d.name:null),$dataText.itemsDescription=data.map(d=>null!=d?d.description:null),$dataText.itemsNote=data.map(d=>null!=d?d.note:null);break;case $dataWeapons:$dataText.weaponsName=data.map(d=>null!=d?d.name:null),$dataText.weaponsDescription=data.map(d=>null!=d?d.description:null);break;case $dataArmors:$dataText.armorsName=data.map(d=>null!=d?d.name:null),$dataText.armorsDescription=data.map(d=>null!=d?d.description:null);break;case $dataEnemies:$dataText.enemiesName=data.map(d=>null!=d?d.name:null);break;case $dataTroops:$dataText.troopsName=data.map(d=>null!=d?d.name:null);break;case $dataStates:$dataText.statesName=data.map(d=>null!=d?d.name:null),$dataText.statesMessage1=data.map(d=>null!=d?d.message1:null),$dataText.statesMessage2=data.map(d=>null!=d?d.message2:null),$dataText.statesMessage3=data.map(d=>null!=d?d.message3:null),$dataText.statesMessage4=data.map(d=>null!=d?d.message4:null);break;case $dataSystem:$dataText.systemElements=data.elements.map(d=>null!=d?d:null),$dataText.systemGameTitle=data.gameTitle,$dataText.systemSkillTypes=data.skillTypes.map(d=>null!=d?d:null),$dataText.systemTerms=data.terms,$dataText.systemArmorTypes=data.armorTypes.map(d=>null!=d?d:null),$dataText.systemEquipTypes=data.equipTypes.map(d=>null!=d?d:null),$dataText.systemWeaponTypes=data.weaponTypes.map(d=>null!=d?d:null);break;case $dataMapInfos:$dataText.mapinfosName=data.map(d=>null!=d?d.name:null)}},DataManager.createGameObjects=function(){$gameTemp=new Game_Temp,$gameSystem=new Game_System,$gameScreen=new Game_Screen,$gameTimer=new Game_Timer,$gameMessage=new Game_Message,$gameSwitches=new Game_Switches,$gameVariables=new Game_Variables,$gameSelfSwitches=new Game_SelfSwitches,$gameActors=new Game_Actors,$gameParty=new Game_Party,$gameTroop=new Game_Troop,$gameMap=new Game_Map,$gamePlayer=new Game_Player,$gameDefine=new Game_Define,$gameColor=new Game_Color,$gameElement=new Game_Element,$gameBGM=new Game_BGM,$gameSE=new Game_SE,$gameStateInfo=new Game_StateInfo,$gameKeyMap=new Game_KeyMap,$gameAlchemy=new Game_Alchemy,$gameSearch=new Game_Search,$gameHelp=new Game_Help,$gameTips=new Game_Tips,$gameBackGround=new Game_BackGround,$gameTutorial=new Game_Tutorial,$gameChallenge=new Game_Challenge,$gameAchievement=new Game_Achievement,$gameText=new Game_Text,$gameCommand=new Game_Command,$gameTacticsActorPosition=new Game_TacticsActorPosition},DataManager.setupBattleTest=function(){this.createGameObjects(),$gameParty.setupBattleTest(),$gameVariables.setValue(1,+$dataTroops[$dataSystem.testTroopId].name),$gameDefine.limitBreakValue=1},DataManager.setupEventTest=function(){this.createGameObjects(),this.selectSavefileForNewGame(),$gameParty.setupStartingMembers(),$gamePlayer.reserveTransfer(-1,8,6),$gamePlayer.setTransparent(!1)},DataManager.maxSavefiles=function(){if($gameDefine){const platForm=$gameDefine.platForm();if(platForm==PlatForm.Android||platForm==PlatForm.iOS)return 49}return 99},DataManager.makeSaveContents=function(){const contents={};return contents.system=$gameSystem,contents.screen=$gameScreen,contents.timer=$gameTimer,contents.switches=$gameSwitches,contents.variables=$gameVariables,contents.selfSwitches=$gameSelfSwitches,contents.actors=$gameActors,contents.party=$gameParty,contents.map=$gameMap,contents.player=$gamePlayer,contents.saveImage=CriateSpriteManager._saveImage,contents},DataManager.checkUpdate=async function(){},ConfigManager.save=function(){StorageManager.saveObject("config",$dataOption.makeData())},ConfigManager.applyData=function(config){this.alwaysDash=this.readFlag(config,"alwaysDash",!1),this.commandRemember=this.readFlag(config,"commandRemember",!1),this.touchUI=this.readFlag(config,"touchUI",!0),this.bgmVolume=this.readVolume(config,"bgmVolume"),this.bgsVolume=this.readVolume(config,"bgsVolume"),this.meVolume=this.readVolume(config,"meVolume"),this.seVolume=this.readVolume(config,"seVolume"),$dataOption.applyData(config)},ConfigManager.load=function(){StorageManager.loadObject("config").then(config=>this.applyData(config||{})).catch(()=>(ConfigManager.save(),ConfigManager.load(),0)).then(()=>(this._isLoaded=!0,0)).catch(()=>0)},SceneManager.updateMain=function(){1==$gamePause||(this.updateFrameCount(),this.updateEffekseer()),this.updateInputData(),this.changeScene(),this.updateScene(),this.updateManagers()},SceneManager.onBeforeSceneStart=function(){this._previousScene&&(this._previousScene=null),Graphics.effekseer&&Graphics.effekseer.stopAll()},SceneManager.changeScene=function(){this.isSceneChanging()&&!this.isCurrentSceneBusy()&&(this._scene&&(this._scene.terminate(),this.onSceneTerminate()),this._scene=this._nextScene,this._nextScene=null,this._scene&&(this._scene.create(),this.onSceneCreate()),this._exiting&&this.terminate())},SceneManager.updateScene=async function(){this._scene&&(this._scene.isStarted()?this._scene.update():this._scene.isReady()&&(this.onBeforeSceneStart(),this.onSceneStart(),await this._scene.start()))},SceneManager.updateManagers=function(){BackGroundManager.update(),EventManager.update(),FilterMzUtility.update(),PopupInputManager.update(),Scene_Option.update()},SceneManager.determineRepeatNumber=function(deltaTime){if($gameTemp&&$gameTemp.isPlaytest()&&TouchInput.wheelY>0){let tempSpeed=24*this._smoothDeltaTime;return gsap.globalTimeline.timeScale(tempSpeed),24}if(this._smoothDeltaTime*=.8,this._smoothDeltaTime+=.2*Math.min(deltaTime,2),this._smoothDeltaTime>=.9){if(Utils.isMobileSafari()&&(this._smoothDeltaTime=1),this._elapsedTime=0,$gameTemp&&$gameTemp.fastSpeed){let tempSpeed=this._smoothDeltaTime*$gameTemp.fastSpeed;return gsap.globalTimeline.timeScale(tempSpeed),Math.round(tempSpeed)}return gsap.globalTimeline.timeScale(Math.round(this._smoothDeltaTime)),Math.round(this._smoothDeltaTime)}return this._elapsedTime+=deltaTime,this._elapsedTime>=1?(this._elapsedTime-=1,gsap.globalTimeline.timeScale(1),1):(gsap.globalTimeline.timeScale(0),0)},SceneManager.catchException=function(e){e instanceof Error?this.catchNormalError(e):e instanceof Array&&"LoadError"===e[0]?this.catchLoadError(e):this.catchUnknownError(e)},ImageManager.loadIcon=function(filename,hue,resolve){return this.loadBitmap("img/icon/",filename,hue,!1,resolve)},ImageManager.loadBackground=function(filename,hue,resolve){return this.loadBitmap("img/backgrounds/",filename,hue,!1,resolve)},ImageManager.loadParticle=function(filename,hue,resolve){return this.loadBitmap("img/particles/",filename,hue,!1,resolve)},ImageManager.loadHelp=function(filename,hue,resolve){return $dataOption&&$dataOption.getUserData("language")==LanguageType.English?this.loadBitmap("img/helps_eng/",filename,hue,!1,resolve):this.loadBitmap("img/helps/",filename,hue,!1,resolve)},ImageManager.loadedAnimationResource=function(animation){let flag=!0;return animation.forEach(name=>{_.find(this._cache,c=>"img/animations/"+name+".png"==c._url)||(flag=!1)}),flag},ImageManager.loadedBattleBack1Resource=function(resourceData){let flag=!0;return resourceData.forEach(resource=>{_.find(this._cache,c=>"img/battlebacks1/"+resource+".png"==c._url)||(flag=!1)}),flag},ImageManager.clearImageAnimation=function(name){const key="img/animations/"+name+".png",cache=this._cache;delete cache[key]},ImageManager.clearImageEnemy=function(name){const key="img/enemies/"+name+".png",cache=this._cache;delete cache[key]},ImageManager.clearImageBattleBack1=function(name){const key="img/battlebacks1/"+name+".png",cache=this._cache;delete cache[key]},ImageManager.clearImageList=function(keys){keys.forEach(key=>{})},AudioManager._bgmVolume=80,AudioManager._bgsVolume=80,AudioManager._meVolume=80,AudioManager._seVolume=80,AudioManager._lastVolumeRate=1,AudioManager._battleVolume=1,AudioManager._readBattleVolume=.7,AudioManager.getBufferData=function(folder,name){let url;if("bgm"==folder)url=$gameBGM.getBgmUrl(name);else{const ext=this.audioFileExt();url=this._path+folder+"/"+Utils.encodeURI(name)+ext}return url},AudioManager.loadBgm=function(bgm){Utils._shouldUseDecoder()||bgm.name&&this.createBuffer("bgm/",bgm.name)},AudioManager.loadBgs=function(bgs){Utils._shouldUseDecoder()||bgs.name&&this.createBuffer("bgs/",bgs.name)},AudioManager.loadSe=function(se){Utils._shouldUseDecoder()||se.name&&(DataManager.isCached("audio/se/"+se.name+".ogg")||this.createBuffer("se/",se.name))},AudioManager.fadeOutBgm=function(duration){this._bgmBuffer&&this._currentBgm&&(this._bgmBuffer.fadeOut(duration),this._currentBgm=null)},AudioManager.fadeOutBgs=function(duration){this._bgsBuffer&&this._currentBgs&&(this._bgsBuffer.fadeOut(duration),this._currentBgs=null)},AudioManager.loadedBgmResource=function(resourceData){if(!resourceData)return!0;let flag=!0;return resourceData.forEach(bgm=>{if(bgm){let data=this.getBufferData("bgm",bgm.name);DataManager.isCached(data)||(flag=!1)}}),flag},AudioManager.loadedBgsResource=function(resourceData){if(!resourceData)return!0;let flag=!0;return resourceData.forEach(bgs=>{if(bgs){const data=this.getBufferData("bgs",bgs.name);DataManager.isCached(data)||(flag=!1)}}),flag},AudioManager.loadedSeResource=function(resourceData){let flag=!0;return resourceData.forEach(name=>{const data=this.getBufferData("se",name.name);DataManager.isCached(data)||(flag=!1)}),flag},AudioManager.updateVolume=function(){this._currentBgm&&this.updateBufferParameters(this._bgmBuffer,this._bgmVolume,this._currentBgm),this._currentBgs&&this.updateBufferParameters(this._bgsBuffer,this._bgsVolume,this._currentBgs)},AudioManager.updateVolumeOption=function(){if(this._currentBgm){let volume=this._bgmVolume*this._lastVolumeRate;Debug.log("volume ="+volume),volume>=100&&(volume=100),this.updateBufferParameters(this._bgmBuffer,volume,this._currentBgm)}this._currentBgs&&this.updateBufferParameters(this._bgsBuffer,this._bgsVolume,this._currentBgs)},AudioManager.playBgm=async function(bgm,pos,volumeRate){if(volumeRate||(volumeRate=1),await EventManager.loadBgm(bgm),this.isCurrentBgm(bgm))this.updateBgmParameters(bgm,volumeRate);else if(this.stopBgm(bgm),bgm.name){let url=$gameBGM.getBgmUrl(bgm.name);const cacheBgm=this.findCache(url);cacheBgm&&cacheBgm._buffer&&cacheBgm._buffer._isLoaded?(this._bgmBuffer=cacheBgm._buffer,Debug.error("cacheBgm"+bgm.name)):this._bgmBuffer=this.createBuffer("bgm/",bgm.name),this.updateBgmParameters(bgm,volumeRate),this._meBuffer||this._bgmBuffer.play(!0,pos||0)}this.updateCurrentBgm(bgm,pos)},AudioManager.playBgmOnce=async function(bgm,pos,volumeRate){if(volumeRate||(volumeRate=1),this.isCurrentBgm(bgm))this.updateBgmParameters(bgm,volumeRate);else if(this.stopBgm(bgm),bgm.name){let url=$gameBGM.getBgmUrl(bgm.name);const cacheBgm=this.findCache(url);cacheBgm&&cacheBgm._buffer&&cacheBgm._buffer._isLoaded?(this._bgmBuffer=cacheBgm._buffer,Debug.error("cacheBgm"+bgm.name)):this._bgmBuffer=this.createBuffer("bgm/",bgm.name),this.updateBgmParameters(bgm,volumeRate),this._meBuffer||this._bgmBuffer.play(!1,pos||0)}this.updateCurrentBgm(bgm,pos)},AudioManager.playSe=function(se){if(console.error(se),se.name){const latestBuffers=this._seBuffers.filter(buffer=>buffer.frameCount===Graphics.frameCount);latestBuffers.find(buffer=>buffer.name===se.name);const url="audio/se/"+se.name+this.audioFileExt(),cacheBgm=this.findCache(url);let buffer;buffer=cacheBgm&&cacheBgm._buffer&&cacheBgm._buffer._isLoaded?cacheBgm._buffer:this.createBuffer("se/",se.name),this.updateSeParameters(buffer,se),buffer.play(!1),-1==this._seBuffers.indexOf(buffer)&&this._seBuffers.push(buffer)}},AudioManager.cleanupSe=function(){for(const buffer of this._seBuffers)buffer.isPlaying()||(WebAudioCache._cache[buffer.url]=void 0,delete WebAudioCache._cache[buffer.url],Debug.log("delete se"+buffer.url),buffer.destroy());this._seBuffers=this._seBuffers.filter(buffer=>buffer.isPlaying())},AudioManager.playBgs=function(bgs,pos,volumeRate){if(volumeRate||(volumeRate=1),this.isCurrentBgs(bgs))this.updateBgsParameters(bgs,volumeRate);else if(this.stopBgs(),bgs.name){const url="audio/bgs/"+bgs.name+this.audioFileExt(),cacheBgm=this.findCache(url);let buffer;cacheBgm&&cacheBgm._buffer&&cacheBgm._buffer._isLoaded?this._bgsBuffer=cacheBgm._buffer:this._bgsBuffer=this.createBuffer("bgs/",bgs.name),this.updateBgsParameters(bgs,volumeRate),this._bgsBuffer.play(!0,pos||0)}this.updateCurrentBgs(bgs,pos)},AudioManager.findCache=function(url){return cacheBgm=_.find(WebAudioCache._cache,webAudio=>url==webAudio.url)},AudioManager.stopBgm=function(bgm){if(void 0===bgm&&(bgm=null),this._bgmBuffer){if(bgm&&this._bgmBuffer.name==bgm.name)return void(this._currentBgm=null);WebAudioCache._cache[this._bgmBuffer.url]=void 0,delete WebAudioCache._cache[this._bgmBuffer.url],this._bgmBuffer.destroy(),this._bgmBuffer=null,this._currentBgm=null}},AudioManager.stopBgs=function(){this._bgsBuffer&&(WebAudioCache._cache[this._bgsBuffer.url]=void 0,delete WebAudioCache._cache[this._bgsBuffer.url],this._bgsBuffer.destroy(),this._bgsBuffer=null,this._currentBgs=null)},AudioManager.purgeBgm=function(bgmData){if(!bgmData)return;let bgmArray=[];bgmData instanceof Array?bgmData.forEach(bgm=>{bgmArray.push(bgm)}):bgmArray=[bgmData],bgmArray.forEach(data=>{const url="audio/bgm/"+data.name+this.audioFileExt();let cacheBgm=this.findCache(url);cacheBgm&&(Debug.error("delete bgm"+cacheBgm.url),WebAudioCache._cache[cacheBgm.url]._buffer.destroy(),WebAudioCache._cache[cacheBgm.url]=void 0,delete WebAudioCache._cache[cacheBgm.url])})},AudioManager._purgeSe=AudioManager.purgeSe,AudioManager.purgeSe=function(seData){if(!seData)return;const url="audio/se/"+seData.name+AudioManager.audioFileExt();WebAudioCache._cache[url]&&(WebAudioCache._cache[url]=void 0,delete WebAudioCache._cache[url])},AudioManager.createBuffer=function(folder,name){const ext=this.audioFileExt();let url;url="bgm/"!=folder?this._path+folder+Utils.encodeURI(name)+ext:$gameBGM.getBgmUrl(name);const buffer=new WebAudio(url);return buffer.name=name,buffer.frameCount=Graphics.frameCount,buffer},AudioManager.updateBgmParameters=function(bgm,volumeRate){this._lastVolumeRate=volumeRate;let volume=this._bgmVolume*volumeRate;Debug.log("volume ="+volume),volume>=100&&(volume=100),this.updateBufferParameters(this._bgmBuffer,volume,bgm)},AudioManager.updateBgsParameters=function(bgs,volumeRate){let volume=this._bgsVolume*volumeRate;Debug.log("volume ="+volume),volume>=100&&(volume=100),this.updateBufferParameters(this._bgsBuffer,volume,bgs)},AudioManager.updateSeParameters=function(buffer,se){this.updateBufferParameters(buffer,this._seVolume,se)},AudioManager.fadeToBgm=function(duration,volume,rate){if(this._bgmBuffer&&this._currentBgm){this._lastVolumeRate=rate;let volumeRate=.01*this._bgmVolume*volume*.01*rate;Debug.error("volumeRate ="+volumeRate),volumeRate>=1&&(volumeRate=1),this._bgmBuffer.fadeTo(duration,volumeRate)}},AudioManager.fadeToBgs=function(duration,volume,rate){if(this._bgsBuffer&&this._currentBgs){let volumeRate=.01*this._bgsVolume*volume*.01*rate;Debug.log("volumeRate ="+volumeRate),volumeRate>=1&&(volumeRate=1),this._bgsBuffer.fadeTo(duration,volumeRate)}},SoundManager.getSe=function(key){const seFile=_.find($gameSE._data,data=>data.key==key);return $gameSE.convertSeData(seFile.se,seFile.option)},SoundManager.playGuard=function(){$dataSystem&&AudioManager.playSe(this.getSe($gameSE.guard))},SoundManager.playJustGuard=function(){$dataSystem&&AudioManager.playStaticSe(this.getSe($gameSE.justGuard))},SoundManager.playMessageType1=function(){if($dataSystem){let type=this.getSe($gameSE.messageType1);this._typeKey1&&(type.pitch=this._typeKey1),AudioManager.playStaticSe(type)}},SoundManager.playMessageType2=function(){if($dataSystem){let type=this.getSe($gameSE.messageType2);this._typeKey2&&(type.pitch=this._typeKey2),AudioManager.playStaticSe(type)}},SoundManager.changeKeyMessageType1=function(){},SoundManager.changeKeyMessageType2=function(){},SoundManager.playActorCommand=function(){$dataSystem&&AudioManager.playStaticSe(this.getSe($gameSE.actorCommand))},SoundManager.playLevelUp=function(){$dataSystem&&AudioManager.playStaticSe(this.getSe($gameSE.levelUp))},SoundManager.playCutIn=function(){$dataSystem&&AudioManager.playStaticSe(this.getSe($gameSE.cutIn))},SoundManager.playLanding=function(){$dataSystem&&AudioManager.playStaticSe(this.getSe($gameSE.landing))},SoundManager.playCounter=function(){$dataSystem&&AudioManager.playStaticSe(this.getSe($gameSE.counter))},SoundManager.playChain=function(){$dataSystem&&AudioManager.playStaticSe(this.getSe($gameSE.chain))},SoundManager.playEyeCatch=function(){$dataSystem&&AudioManager.playStaticSe(this.getSe($gameSE.eyecatch))},SoundManager.playAnswerQuiz=function(){$dataSystem&&AudioManager.playStaticSe(this.getSe($gameSE.answerquiz))},SoundManager.footSound1=function(pan,pitch){if(void 0===pan&&(pan=0),void 0===pitch&&(pitch=0),$dataSystem){let sound=this.getSe($gameSE.footSound1);sound.pan=Number(sound.pan)+pan,sound.pitch=150-Number(Math.randomInt(50)),AudioManager.playStaticSe(sound)}},SoundManager.footSound2=function(pan,pitch){if(void 0===pan&&(pan=0),void 0===pitch&&(pitch=0),$dataSystem){let sound=this.getSe($gameSE.footSound2);sound.pan=Number(sound.pan)+pan,sound.pitch=125-Number(Math.randomInt(50)),AudioManager.playStaticSe(sound)}},SoundManager.footSound3=function(pan,pitch){if(void 0===pan&&(pan=0),void 0===pitch&&(pitch=0),$dataSystem){let sound=this.getSe($gameSE.footSound3);sound.pan=Number(sound.pan)+pan,sound.pitch=125-Number(Math.randomInt(50)),AudioManager.playStaticSe(sound)}},SoundManager.playUnlock=function(){$dataSystem&&AudioManager.playStaticSe(this.getSe($gameSE.unlock))},SoundManager.playJingle=function(){$dataSystem&&AudioManager.playStaticSe(this.getSe($gameSE.jingle))},SoundManager.playEndrollSound=async function(volume){this._anim&&this._anim.kill(),this._anim=new TimelineMax,this._anim.to(SceneManager._scene,0,{onComplete:function(){AudioManager.playSe({name:"hakusyu2",volume:volume,pitch:100,pan:0})}}).to(SceneManager._scene,.4,{onComplete:function(){AudioManager.playSe({name:"hakusyu3",volume:volume,pitch:100,pan:0})},delay:.5}),this._anim.repeat(-1)},TextManager.basic=function(basicId){return null!=$dataText?$dataText.systemTerms.basic[basicId]||"":$dataSystem.terms.basic[basicId]||""},TextManager.param=function(paramId){return null!=$dataText?$dataText.systemTerms.params[paramId]||"":$dataSystem.terms.params[paramId]||""},TextManager.command=function(commandId){return null!=$dataText?$dataText.systemTerms.commands[commandId]||"":$dataSystem.terms.commands[commandId]||""},TextManager.message=function(messageId){return null!=$dataText?$dataText.systemTerms.messages[messageId]||"":$dataSystem.terms.messages[messageId]||""},TextManager.getter=function(method,param){return{get:function(){return this[method](param)},configurable:!0}},Object.defineProperty(TextManager,"currencyUnit",{get:function(){return $dataSystem.currencyUnit},configurable:!0}),Object.defineProperties(TextManager,{level:TextManager.getter("basic",0),levelA:TextManager.getter("basic",1),hp:TextManager.getter("basic",2),hpA:TextManager.getter("basic",3),mp:TextManager.getter("basic",4),mpA:TextManager.getter("basic",5),tp:TextManager.getter("basic",6),tpA:TextManager.getter("basic",7),exp:TextManager.getter("basic",8),expA:TextManager.getter("basic",9),fight:TextManager.getter("command",0),escape:TextManager.getter("command",1),attack:TextManager.getter("command",2),guard:TextManager.getter("command",3),item:TextManager.getter("command",4),skill:TextManager.getter("command",5),equip:TextManager.getter("command",6),status:TextManager.getter("command",7),formation:TextManager.getter("command",8),save:TextManager.getter("command",9),gameEnd:TextManager.getter("command",10),options:TextManager.getter("command",11),weapon:TextManager.getter("command",12),armor:TextManager.getter("command",13),keyItem:TextManager.getter("command",14),equip2:TextManager.getter("command",15),optimize:TextManager.getter("command",16),clear:TextManager.getter("command",17),newGame:TextManager.getter("command",18),continue_:TextManager.getter("command",19),toTitle:TextManager.getter("command",21),cancel:TextManager.getter("command",22),buy:TextManager.getter("command",24),sell:TextManager.getter("command",25),alwaysDash:TextManager.getter("message","alwaysDash"),commandRemember:TextManager.getter("message","commandRemember"),bgmVolume:TextManager.getter("message","bgmVolume"),bgsVolume:TextManager.getter("message","bgsVolume"),meVolume:TextManager.getter("message","meVolume"),seVolume:TextManager.getter("message","seVolume"),possession:TextManager.getter("message","possession"),expTotal:TextManager.getter("message","expTotal"),expNext:TextManager.getter("message","expNext"),saveMessage:TextManager.getter("message","saveMessage"),loadMessage:TextManager.getter("message","loadMessage"),file:TextManager.getter("message","file"),partyName:TextManager.getter("message","partyName"),emerge:TextManager.getter("message","emerge"),preemptive:TextManager.getter("message","preemptive"),surprise:TextManager.getter("message","surprise"),escapeStart:TextManager.getter("message","escapeStart"),escapeFailure:TextManager.getter("message","escapeFailure"),victory:TextManager.getter("message","victory"),defeat:TextManager.getter("message","defeat"),obtainExp:TextManager.getter("message","obtainExp"),obtainGold:TextManager.getter("message","obtainGold"),obtainItem:TextManager.getter("message","obtainItem"),levelUp:TextManager.getter("message","levelUp"),obtainSkill:TextManager.getter("message","obtainSkill"),useItem:TextManager.getter("message","useItem"),criticalToEnemy:TextManager.getter("message","criticalToEnemy"),criticalToActor:TextManager.getter("message","criticalToActor"),actorDamage:TextManager.getter("message","actorDamage"),actorRecovery:TextManager.getter("message","actorRecovery"),actorGain:TextManager.getter("message","actorGain"),actorLoss:TextManager.getter("message","actorLoss"),actorDrain:TextManager.getter("message","actorDrain"),actorNoDamage:TextManager.getter("message","actorNoDamage"),actorNoHit:TextManager.getter("message","actorNoHit"),enemyDamage:TextManager.getter("message","enemyDamage"),enemyRecovery:TextManager.getter("message","enemyRecovery"),enemyGain:TextManager.getter("message","enemyGain"),enemyLoss:TextManager.getter("message","enemyLoss"),enemyDrain:TextManager.getter("message","enemyDrain"),enemyNoDamage:TextManager.getter("message","enemyNoDamage"),enemyNoHit:TextManager.getter("message","enemyNoHit"),evasion:TextManager.getter("message","evasion"),magicEvasion:TextManager.getter("message","magicEvasion"),magicReflection:TextManager.getter("message","magicReflection"),counterAttack:TextManager.getter("message","counterAttack"),substitute:TextManager.getter("message","substitute"),buffAdd:TextManager.getter("message","buffAdd"),debuffAdd:TextManager.getter("message","debuffAdd"),buffRemove:TextManager.getter("message","buffRemove"),actionFailure:TextManager.getter("message","actionFailure")}),TextManager.getSkillName=function(id){return null!=$dataText?$dataText.skillsName[id]:$dataSkills[id].name},TextManager.getSkillDescription=function(id){return null!=$dataText?$dataText.skillsDescription[id]:$dataSkills[id].description},TextManager.getItemName=function(id){return null!=$dataText?$dataText.itemsName[id]:$dataItems[id].name},TextManager.getItemNote=function(id){return null!=$dataText?$dataText.itemsNote[id]:$dataItems[id].note},TextManager.getItemDescription=function(id){return null!=$dataText?$dataText.itemsDescription[id]:$dataItems[id].description},TextManager.getWeaponName=function(id){return null!=$dataText?$dataText.weaponsName[id]:$dataWeapons[id].name},TextManager.getWeaponDescription=function(id){return null!=$dataText?$dataText.weaponsDescription[id]:$dataWeapons[id].description},TextManager.getStateName=function(id){return null!=$dataText?$dataText.statesName[id]:$dataStates[id].name},TextManager.getStateMessage1=function(id){return null!=$dataText?$dataText.statesMessage1[id]:$dataStates[id].message1},TextManager.getStateMessage2=function(id){return null!=$dataText?$dataText.statesMessage2[id]:$dataStates[id].message2},TextManager.getStateMessage3=function(id){if(null!=$dataText){if($dataOption.getUserData("language")==LanguageType.English){if(208==id)return"Damage";if(229==id)return"+2 SPD"}return $dataText.statesMessage3[id]}return $dataStates[id].message3},TextManager.getStateMessage4=function(id){return null!=$dataText?$dataText.statesMessage4[id]:$dataStates[id].message4},TextManager.getEnemyName=function(id){return null!=$dataText?$dataText.enemiesName[id]:$dataEnemies[id].name},TextManager.getTroopName=function(id){return null!=$dataText?$dataText.troopsName[id]:$dataTroops[id].name},TextManager.getDamageElement=function(id){return null!=$dataText?$dataText.systemElements[id]:$dataSystem.elements[id]},TextManager.getText=function(id){return $gameText.getText(id)},TextManager.getDecideText=function(){return $gameText.getDecideText()},TextManager.getCancelText=function(){return $gameText.getCancelText()},TextManager.getMenuText=function(){return $gameText.getMenuText()},TextManager.getBackText=function(){return $gameText.getBackText()},TextManager.getNewText=function(){return $gameText.getNewText()},TextManager.convertEscapeCharacters=function(text){return text=(text=(text=(text=(text=(text=(text=text.replace(/\\/g,"")).replace(/\x1b\x1b/g,"\\")).replace(/\x1bV\[(\d+)\]/gi,function(){return $gameVariables.value(parseInt(arguments[1]))}.bind(this))).replace(/\x1bV\[(\d+)\]/gi,function(){return $gameVariables.value(parseInt(arguments[1]))}.bind(this))).replace(/\x1bN\[(\d+)\]/gi,function(){return this.actorName(parseInt(arguments[1]))}.bind(this))).replace(/\x1bP\[(\d+)\]/gi,function(){return this.partyMemberName(parseInt(arguments[1]))}.bind(this))).replace(/\x1bG/gi,TextManager.currencyUnit)},TextManager.convertEscapeMessages=function(text){return text},TextManager.convertControlCharacters=function(text){return text=(text=(text=text.replace(/\x1b./g,"")).replace(/\x1b|/g,"")).replace(/\x1b^/g,"")},TextManager.convertLogtext=function(logText,actorName){logText.forEach((text,index)=>{""!=text&&(text=this.convertEscapeCharacters(text),text=this.convertControlCharacters(text),0==index&&(Window_BackLog._lastActorName!=actorName&&Window_BackLog._logData.push({name:!0,logText:actorName}),Window_BackLog._lastActorName=actorName),Window_BackLog._logData.push({name:!1,logText:text}))})},TextManager.actorName=function(n){const actor=n>=1?$gameActors.actor(n):null;return null!=$dataText?$dataText.actorsName[actor.actorId()]:actor?$dataActors[actor.actorId()].name:""},TextManager.mapInfosName=function(n){return null!=$dataText?$dataText.mapinfosName[n]:$dataMapInfos[n].name},TextManager.getMaterialTitle=function(n){return null!=$dataText?$dataText.materialTitle[n]:""},TextManager.getMaterialText=function(n){return null!=$dataText?$dataText.materialText[n]:""},TextManager.getTipsText=function(n){return null!=$dataText?$dataText.tipsText[n]:""},TextManager.getTipsHelpText=function(n){return null!=$dataText?$dataText.tipsHelpText[n]:""},TextManager.getQuizQuestion=function(n){return null!=$dataText?$dataText.quizQuestion[n]:""},TextManager.getQuizChoices=function(n){return null!=$dataText?$dataText.quizChoices[n]:""},TextManager.getHelpText=function(n){return null!=$dataText?$dataText.helpText[n]:""};class PopupManager{constructor(){}static setPopup(mainText,option){if(this._busy)return;this._window&&this._window.parent&&this._window.parent.removeChild(this._window),this._window=new Window_Confirm,SceneManager._scene.addChild(this._window);let useOpt={...popupOption,...option};this._window.initHandlers(),this._window.setTextData(mainText,useOpt.subText),this._window.select(useOpt.select),this._endCall=useOpt.endCall}static open(){this._busy||(this._window.refresh(),this._window.show(),this._window.open(),this._window.activate(),this._busy=!0)}static setSelect(num){this._window.select(num),this._window.refresh()}static setHandler(text,key,action){this._window.setHandler(key,()=>{this.close(action)}),this._window.setCommandText(key,text)}static async close(action){this._window.close(),this._window.deactivate(),await this.setWait(150),this._busy=!1,action&&action()}static setWait(num){return new Promise(resolve=>{const delayTime=num;setTimeout(()=>resolve(),delayTime)})}static busy(){return this._busy}static openBattleLose(okHandler,cancelHandler){const mainText=TextManager.getText(62e4),text1=TextManager.getText(620100),text2=TextManager.getText(620200);this.setPopup(mainText,{select:0}),this.setHandler(text1,"ok",()=>{okHandler&&okHandler()}),this.setHandler(text2,"cancel",()=>{cancelHandler&&cancelHandler()}),this.open()}static openChallengeLose(okHandler){const mainText=TextManager.getText(900800),text1=TextManager.getText(100);this.setPopup(mainText,{select:0}),this.setHandler(text1,"ok",()=>{okHandler&&okHandler()}),this.open()}static openPopupSupport(okHandler,cancelHandler){const mainText=TextManager.getText(210700),text1=TextManager.getDecideText(),text2=TextManager.getCancelText(),subText=TextManager.getText(210701);this.setPopup(mainText,{select:1,subText:subText}),this.setHandler(text1,"ok",()=>{okHandler&&okHandler()}),this.setHandler(text2,"cancel",()=>{cancelHandler&&cancelHandler()}),this.open()}static openPopupSaveActor(okHandler){const mainText=TextManager.getText(900600),subText=TextManager.getText(900601),text1=TextManager.getText(120);this.setPopup(mainText,{subText:subText}),this.setHandler(text1,"ok",()=>{okHandler&&okHandler()}),this.open()}static openPopupLoadActor(okHandler){const mainText=TextManager.getText(900700),text1=TextManager.getText(120);this.setPopup(mainText),this.setHandler(text1,"ok",()=>{okHandler&&okHandler()}),this.open()}static openHelpCheck(okHandler,cancelHandler){const mainText=TextManager.getText(1300010),text1=TextManager.getDecideText(),text2=TextManager.getCancelText();this.setPopup(mainText,{select:1}),this.setHandler(text1,"ok",()=>{okHandler&&okHandler()}),this.setHandler(text2,"cancel",()=>{cancelHandler&&cancelHandler()}),this.open()}static openSaveSuccess(okHandler){const mainText=TextManager.getText(201800),text1=TextManager.getText(120);this.setPopup(mainText,{select:0}),this.setHandler(text1,"ok",()=>{okHandler&&okHandler()}),this.open()}}const popupOption={subText:"",select:0,endcall:null};class PopupCautionManager{constructor(){}static setPopup(mainText,endCall){this._busy||(this._window&&this._window.parent&&this._window.parent.removeChild(this._window),this._window=new Window_Caution(mainText,-60,184,1080,160),SceneManager._scene.addChild(this._window),this._endCall=endCall)}static open(){this._busy||(this._window.show(),this._window.open(),this._window.activate(),this._busy=!0)}static async openClose(action){if(this._busy)return;this._window.show(),this._window.open(),this._window.activate(),this._busy=!0;const self=this;gsap.to(this._window,.4,{alpha:0,delay:.6,onComplete:function(){self._window.destroy(),self._window=null,self._busy=!1,action&&action()}})}static async close(action){null!=this._window&&(this._window.close(),this._window.deactivate(),await this.setWait(150),this._window.destroy(),this._window=null,this._busy=!1,action&&action())}static setWait(num){return new Promise(resolve=>{const delayTime=num;setTimeout(()=>resolve(),delayTime)})}static busy(){return this._busy}}class PopupInputManager{constructor(){}static init(){this._window=new Window_Confirm,this._editBox=new EditBoxImpl(400,270,240,80),this._busy=!1,this._endCall=null}static setInputPopup(mainText,endCall,select,subText,inputNumber){this._busy||(this._window&&this._window.parent&&this._window.parent.removeChild(this._window),SceneManager._scene.addChild(this._window),this._window.initHandlers(),this._window.setMainText(mainText),this._window.setSubText(subText),this._window.select(select),this._editBox.setMaxLength(inputNumber),this._endCall=endCall)}static open(){this._busy||(this._window.refresh(),this._window.show(),this._window.open(),this._window.activate(),this._editBox.activate(),this._busy=!0)}static setSelect(num){this._window.select(num),this._window.refresh()}static setHandler(text,key,action){this._window.setHandler(key,()=>{this.close(action)}),this._window.setCommandText(key,text)}static async close(action){this._window.close(),this._window.deactivate(),this._window&&this._window.parent&&this._window.parent.removeChild(this._window),this._lastInputText=this._editBox._edTxt.value,this._editBox.close(),this._editBox.deactivate(),await this.setWait(100),this._busy=!1,action&&action()}static getInputText(){return this._lastInputText?this._lastInputText:this._editBox._edTxt.value}static setWait(num){return new Promise(resolve=>{const delayTime=num;setTimeout(()=>resolve(),delayTime)})}static busy(){return this._busy}static setFocus(){this._editBox.focus()}static update(){this._editBox&&this._editBox._edTxt&&this._editBox._update()}static inputFileName(okHandler){const mainText=TextManager.getText(210400);PopupInputManager.setInputPopup(mainText,null,0,null,14),PopupInputManager.setHandler(TextManager.getText(840),"ok",()=>{okHandler&&okHandler()}),PopupInputManager.open()}}class EditBoxImpl{constructor(x,y,width,height){this._edTxt=null,this._editing=!1,this._maxLength=0,this.createInput(width,height),this._setPosition(x,y),this._isInit=!0}createInput(width,height){if(this._isInit)return;let tmpEdTxt=this._edTxt=document.createElement("input");tmpEdTxt.type="text",tmpEdTxt.style.fontSize="21px",tmpEdTxt.style.color="#FFFFFF",tmpEdTxt.style.border=0,tmpEdTxt.style.background="transparent",tmpEdTxt.style.width=width+"px",tmpEdTxt.style.height=height+"px",tmpEdTxt.style.active=0,tmpEdTxt.style.outline="medium",tmpEdTxt.style.padding="0",tmpEdTxt.style.textTransform="none",tmpEdTxt.style.display="none",tmpEdTxt.style.position="absolute",tmpEdTxt.style.bottom="0px",tmpEdTxt.style.left="0px",tmpEdTxt.style["-moz-appearance"]="textfield",tmpEdTxt.style.fontFamily=$gameSystem.mainFontFace(),document.body.appendChild(tmpEdTxt),tmpEdTxt.style.zIndex=10,$gameDefine.platForm()==PlatForm.iOS&&tmpEdTxt.addEventListener("touchstart",preventDefaultInput)}activate(){this._beginEditing(),setTimeout(()=>{this._edTxt.focus()},.5)}focus(){this._edTxt.focus()}close(){this._edTxt.blur()}deactivate(){this._edTxt.value="",this._endEditing()}_setPosition(x,y){let edTxt=this._edTxt;if(edTxt){const left=Graphics._canvas.offsetLeft,top=Graphics._canvas.offsetTop,h=Graphics._stretchWidth()/Graphics._width,v=Graphics._stretchHeight()/Graphics._height;edTxt.style.left=x*h+left/10+"px",edTxt.style.top=y*v-top/7+"px"}}_setSize(width,height){let edTxt=this._edTxt;if(edTxt){const h=Graphics._stretchWidth()/Graphics._width,v=Graphics._stretchHeight()/Graphics._height;edTxt.style.width=width*h+"px",edTxt.style.height=height*v+"px",edTxt.style.fontSize=21*Graphics._realScale+"px"}}_beginEditing(){this._edTxt&&(this._edTxt.style.display=""),this._editing=!0}_endEditing(){this._edTxt&&(this._edTxt.style.display="none"),this._editing=!1}setMaxLength(maxLength){isNaN(maxLength)||(maxLength<0&&(maxLength=65535),this._maxLength=maxLength,this._edTxt&&(this._edTxt.maxLength=maxLength)),this._update()}_update(){if(this._maxLength){let width=22*this._maxLength,left=Graphics.width/2-width/5.5;this._setPosition(left,Graphics.height/2-48),this._setSize(width,80)}}}const preventDefaultInput=event=>event.stopPropagation();class TipsManager{constructor(){}static setTips(selectTips){let tips=$gameTips.findTips();null!=selectTips&&(tips=selectTips),tips&&($gameParty.checkReadTips(tips.id)&&tips.id<999||(this.open(tips),$gameParty.gainReadTips(tips.id),SceneManager._scene.addChild(this._tips)))}static open(tips){this._tips||(this._tips=new Window_Base(new Rectangle(540,40,540,400)),this._tips.y=0,this._tips.scale.x=.75,this._tips.scale.y=.75,this._tips.opacity=0,this._tips.lineHeight=function(){return 32});let textData=$gameTips.getTipsText(tips.id),helpTextData=$gameTips.getTipsHelpText(tips.id),text="\\{"+TextManager.getText(360)+textData+"\n\\}"+helpTextData;this._tips.contents.clear();let lines=helpTextData.split("\n"),linesNum=lines.length;lines.forEach(lineText=>{""==lineText&&(linesNum-=1)});let height=48+32*linesNum;this._tips.contents.fillRect(0,0,480,height,"rgba(0, 0, 0, 0.5)"),this._tips.drawTextEx(text,8,4),this._tips.alpha=0,this._tips.x=760;let posY=40;this._tips.y=40,gsap.to(this._tips,.25,{alpha:1,x:640}),gsap.to(this._tips,.25,{alpha:0,x:680,delay:5})}static close(){if(this._tips){let self=this;gsap.to(this._tips,.25,{alpha:0,x:680,onComplete:function(){self.remove()}})}}static setWait(num){return new Promise(resolve=>{const delayTime=num;setTimeout(()=>resolve(),delayTime)})}static remove(){this._tips&&(Debug.log("tips remove"),gsap.killTweensOf(this._tips),this._tips.destroy(),this._tips.parent&&this._tips.parent.removeChild(this._tips),gsap.killTweensOf(this)),this._tips=null}}function CriateSpriteManager(){throw new Error("This is a static class")}CriateSpriteManager.createData=function(data,name){let d=data._canvas.toDataURL("save/.png",.9);d=d.replace(/^.*,/,"");const fs=require("fs"),dirPath="output/",filePath=dirPath+name+".png";fs.existsSync(dirPath)||fs.mkdirSync(dirPath),fs.writeFileSync(filePath,new Buffer(d,"base64"))},CriateSpriteManager.createSaveImage=function(){const data=SceneManager.backgroundBitmap();let canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");const dstWidth=160,dstHeight=90;canvas.width=160,canvas.height=90,ctx.drawImage(data._canvas,0,0,960,540,0,0,160,90),ctx.imageSmoothingQuality="high";const d=canvas.toDataURL("save/.png",.9);this._saveImage=d},CriateSpriteManager.loadSaveImage=function(){this._imageSrc={};const length=DataManager.savefiles().length;for(let i=0;i<length;i++){let json=StorageManager.load(i+1);if(json){let data=JsonEx.parse(json),image=new Image;image.src=data.saveImage,this._imageSrc["save"+(i+1)]=image}}},CriateSpriteManager.loadSaveImageByIndex=function(index){const length=DataManager.savefiles().length;for(let i=0;i<length;i++)if(index==i){let json=StorageManager.load(i+1);if(json){let data=JsonEx.parse(json),image=new Image;image.src=data.saveImage,this._imageSrc["save"+(i+1)]=image}}},CriateSpriteManager.addSaveImage=function(idx){let image=new Image;return new Promise(resolve=>{if(idx==DataManager.autoSaveGameId()){let json=StorageManager.load(100);if(json){let data=JsonEx.parse(json);image.src=data.saveImage,this._imageSrc.save100=image,resolve()}}else{let json=StorageManager.load(idx);if(json){let data=JsonEx.parse(json);image.src=data.saveImage,this._imageSrc["save"+idx]=image,resolve()}}})},CriateSpriteManager.imageSrc=function(){return this._imageSrc||this.loadSaveImage(),this._imageSrc},CriateSpriteManager.createResultImage=function(){SceneManager.snapForBackground();const data=SceneManager.backgroundBitmap();let canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");const dstWidth=640,dstHeight=360;canvas.width=640,canvas.height=360,ctx.drawImage(data._canvas,0,0,960,540,0,0,640,360),ctx.imageSmoothingQuality="high";const d=canvas.toDataURL("save/.png",.9);return d};class ResourceLoadManager{constructor(){}static getBattleResource(){let animations=[],sounds=[],enemies=[],animation=$dataAnimationsMv[3];this.gainMvAnimationSound(animation,animations,sounds),$gameTroop.members().forEach(enemy=>{const enemyData=$dataEnemies[enemy.enemyId()];enemies.push(enemyData),enemyData.actions.forEach(action=>{let animId=$dataSkills[action.skillId].animationId;if(-1==animId&&(animId=enemyData.attackId),!animId)return;let animation=$dataAnimationsMv[animId];this.gainMvAnimationSound(animation,animations,sounds)})});const stageId=$gameParty.stageNo(),stage=DataManager.getStageInfos(stageId),needBgm=[stage.bgm];return animations=_.uniq(animations),enemies=_.uniq(enemies),sounds=_.uniq(sounds,s=>s.name),{animation:animations,sound:sounds,bgm:needBgm,enemy:enemies}}static getStageResource(stageId){let stage=DataManager.getStageInfos(stageId);if(!stage)return null;let animations=[],sounds=[],enemies=[],enemyIds=[];if(stage.troop&&stage.troop.forEach(troops=>{enemyIds.push(troops.enemy)}),stage.bossId){let troop;$dataTroops[stage.bossId].members.forEach(member=>{enemyIds.push(member.enemyId)})}enemyIds.forEach(enemyId=>{let enemy=$dataEnemies[enemyId];enemy&&(enemies.push(enemy.battlerName),enemy.actions.forEach(action=>{let animId=$dataSkills[action.skillId].animationId;if(-1==animId&&(animId=enemy.attackId),!animId)return;let animation=$dataAnimationsMv[animId];this.gainMvAnimationSound(animation,animations,sounds)}))}),animations=_.uniq(animations),enemies=_.uniq(enemies),sounds=_.uniq(sounds,s=>s.name);const needBgm=[stage.bgm];return{animation:animations,sound:sounds,bgm:needBgm,enemy:enemies}}static getSkillResource(skillId){let animations=[],sounds=[],animId=$dataSkills[skillId].animationId;if(!animId)return{animation:animations,sound:sounds};let animation=$dataAnimationsMv[animId];return this.gainMvAnimationSound(animation,animations,sounds),{animation:animations,sound:sounds}}static getBossResource(){let animations=[],sounds=[],enemies=[],animation=$dataAnimationsMv[3];this.gainMvAnimationSound(animation,animations,sounds);const troopId=DataManager.getStageInfos($gameParty.stageNo()).bossId;let testTroop=new Game_Troop;testTroop.setup(troopId),Debug.log(testTroop),testTroop.members().forEach(enemy=>{const enemyData=$dataEnemies[enemy.enemyId()];enemies.push(enemyData),enemyData.actions.forEach(action=>{let animationId=$dataSkills[action.skillId].animation;if(-1==animationId&&(animationId=enemyData.attackId),!animationId)return;let animation=$dataAnimationsMv[animationId];this.gainMvAnimationSound(animation,animations,sounds)})});const stageId=$gameParty.stageNo(),stage=DataManager.getStageInfos(stageId),needBgm=[stage.bgm];return animations=_.uniq(animations),enemies=_.uniq(enemies),sounds=_.uniq(sounds,s=>s.name),{animation:animations,sound:sounds,bgm:needBgm,enemy:enemies}}static gainMvAnimationSound(mvAnimation,animations,sounds){mvAnimation.timings.forEach(timing=>{timing.se&&sounds.push(timing.se)}),mvAnimation.animation1Name&&animations.push(mvAnimation.animation1Name),mvAnimation.animation2Name&&animations.push(mvAnimation.animation2Name)}static releaseBattleResource(stageId){const resources=this.getStageResource(stageId);resources&&(resources.animation.forEach(anim=>{ImageManager.clearImageAnimation(anim)}),resources.enemy.forEach(en=>{ImageManager.clearImageEnemy(en.battlerName)}),resources.sound.forEach(se=>{AudioManager.purgeSe(se)}),resources.bgm.forEach(bgm=>{AudioManager.purgeBgm(bgm)})),AudioManager.purgeBgm($gameBGM.getBgm("stagemenu")),$dataMap&&AudioManager.purgeBgm($dataMap.bgm),AudioManager.purgeBgm($gameBGM.getBgm("boss"))}}class TutorialManager{constructor(){}static openGuide(key,addindex,endCall){this._busy=!0;const data=$gameTutorial.getData(key);if(!data)return;if($gameParty.checkReadTutorial(key))return;this.createTextData(data.textData),this.drawTextData(addindex);let self=this;gsap.to(this._textSprites[0],.5,{delay:8,onComplete:function(){self._textSprites.forEach(sprite=>{sprite&&sprite.parent&&(sprite.parent.removeChild(sprite),sprite.destroy())}),endCall&&endCall(),self._busy=!1,self._textSprites=[]}}),$gameParty.gainReadTutorial(key)}static createTextData(textData){this._textSprites=[],textData.forEach(data=>{let window=new Window_Base(new Rectangle(0,0,960,80)),x=data.x,y=data.y,text=TextManager.getText(data.textId);window.x=Number(x),window.y=Number(y),window.activate(),window.show(),window.opacity=0;var func=function(text,x,y,width,height,size){this.contents.fontSize=Number(size);const textState=this.createTextState(text,x,y,width);return this.processAllText(textState),textState.outputWidth};window.drawTextEx=func;var fontSize=data.fontSize;let width=window.drawTextEx(text,0,0,960,80,fontSize);"center"==data.align&&(width=window.x+(960-width)/2,window.x=width),this._textSprites.push(window)})}static drawTextData(addindex){this._textSprites.forEach(sprite=>{sprite.alpha=0,gsap.to(sprite,.5,{alpha:1}),null!=addindex?SceneManager._scene.addChildAt(sprite,addindex):SceneManager._scene.addChildAt(sprite,2),gsap.to(sprite,.5,{alpha:0,delay:8})})}static busy(){return this._busy}static clear(endCall){this._textSprites.forEach(sprite=>{gsap.killTweensOf(sprite),sprite&&sprite.parent&&(sprite.parent.removeChild(sprite),sprite.destroy())}),this._textSprites=[],endCall&&endCall(),this._busy=!1}static openText(key,addindex,endCall){this._busy=!0;const data=$gameTutorial.getData(key);if(!data)return;let textData=JSON.parse(data.text).split("\n");this._textSprites=[],textData.forEach((data,index)=>{let window=new Window_Base(new Rectangle(0,0,960,540)),x=0,y=32*index-16,text=data;window.x=Number(0),window.y=Number(y),window.activate(),window.show(),window.opacity=0;var func=function(text,x,y,width,height,size){this.contents.fontSize=Number(size),this.contents.textColor="black",$gameColor.getColor("flat");const textState=this.createTextState(text,x,y,width);return this.processAllText(textState),textState.outputWidth};window.drawTextEx=func;var fontSize=22;let width=window.drawTextEx(text,0,0,960,80,22);"center"==data.align&&(width=window.x+(960-width)/2,window.x=width),this._textSprites.push(window)}),this.drawTextData(addindex);let self=this;gsap.to(this._textSprites[0],.5,{delay:8,onComplete:function(){self._textSprites.forEach(sprite=>{sprite&&sprite.parent&&(sprite.parent.removeChild(sprite),sprite.destroy())}),endCall&&endCall(),self._busy=!1,self._textSprites=[]}})}}TutorialManager._textSprites=[];class WebViewManager{constructor(){}static createWebView(){this._margin=120,this._webView=document.createElement("div"),this._iframe=document.createElement("iframe"),this._webView.appendChild(this._iframe),this._iframe.style.width="100%",this._iframe.style.height="100%",this._iframe.style.border="none",this._webView.style.width="960px",this._webView.style.height="540px",this._webView.style.overflow="hidden",this._webView.style.position="absolute",this._webView.style.visibility="hidden",document.body.appendChild(this._webView)}static showWebView(src,loadedEvent,margin){this._webView||this.createWebView(),this._webView.style.visibility="visible",this._margin=margin||120,this._updateWebView();let iframe=this._iframe;if(iframe){iframe.src=src;let self=this,cb=function(){loadedEvent&&loadedEvent(iframe),iframe.removeEventListener("load",cb)};iframe.addEventListener("load",cb)}}static hideWebView(){this._webView.style.visibility="hidden";let iframe=this._iframe;iframe&&(iframe.src="")}static _updateWebView(){this._webView.style.width=this._width-this._margin+"px",this._webView.style.height=this._height-this._margin+"px",this._webView.style.zIndex=7}}function Game_Map(){this.initialize.apply(this,arguments)}function Game_Screen(){this.initialize.apply(this,arguments)}function Game_Action(){this.initialize(...arguments)}Object.defineProperties(Game_System.prototype,{backLog:{get:function(){return this._backLog},configurable:!0}}),function(){const _initialize=Game_System.prototype.initialize;Game_System.prototype.initialize=function(){_initialize.call(this),this._mapBgm=null,this._mapBgs=null,this._backLog=[],this._minimapMode=!0}}(),Game_System.prototype.onBeforeSave=function(){this._saveCount++,this._versionId=$dataSystem.versionId,this._framesOnSave=Graphics.frameCount},Game_System.prototype.onAfterLoad=function(){Graphics.frameCount=this._framesOnSave},Game_System.prototype.windowPadding=function(){return 12},Game_Map.prototype.initialize=function(){this._interpreter=new Game_Interpreter,this._mapId=0,this._tilesetId=0,this._events=[],this._commonEvents=[],this._displayX=0,this._displayY=0,this._nameDisplay=!0,this._battleback1Name=null,this._battleback2Name=null,this._regionList=[]},Game_Map.prototype.setup=function(mapId){if(!$dataMap)throw new Error("The map data is not available");if(this._mapId=mapId,this._tilesetId=$dataMap.tilesetId,this._displayX=0,this._displayY=0,this.setupEvents(),this.setupBattleback(),this._needsRefresh=!1,$dataMap&&$dataMap.note&&""!=$dataMap.note){var data=JSON.parse($dataMap.note);data.regionId&&(this._regionList=data.regionId.split(","),Debug.log(this._regionList))}},Game_Map.prototype.regionList=function(){return this._regionList},Game_Map.prototype.isEventRunning=function(){return this._interpreter.isRunning()||this.isAnyEventStarting()},Game_Map.prototype.tileWidth=function(){return 48},Game_Map.prototype.tileHeight=function(){return 48},Game_Map.prototype.mapId=function(){return this._mapId},Game_Map.prototype.tilesetId=function(){return this._tilesetId},Game_Map.prototype.displayX=function(){return this._displayX},Game_Map.prototype.displayY=function(){return this._displayY},Game_Map.prototype.battleback1Name=function(){return this._battleback1Name},Game_Map.prototype.battleback2Name=function(){return this._battleback2Name},Game_Map.prototype.requestRefresh=function(){this._needsRefresh=!0},Game_Map.prototype.isNameDisplayEnabled=function(){return this._nameDisplay},Game_Map.prototype.disableNameDisplay=function(){this._nameDisplay=!1},Game_Map.prototype.enableNameDisplay=function(){this._nameDisplay=!0},Game_Map.prototype.setupEvents=function(){this._events=[],this._commonEvents=[];for(const event of $dataMap.events.filter(event=>!!event))this._events[event.id]=new Game_Event(this._mapId,event.id),this._events[event.id].setupEvent(event);for(const commonEvent of this.parallelCommonEvents())this._commonEvents.push(new Game_CommonEvent(commonEvent.id));this.refreshTileEvents()},Game_Map.prototype.events=function(){return this._events.filter((function(event){return!!event}))},Game_Map.prototype.event=function(eventId){return this._events[eventId]},Game_Map.prototype.eraseEvent=function(eventId){this._events[eventId].erase()},Game_Map.prototype.autorunCommonEvents=function(){return $dataCommonEvents.filter(commonEvent=>commonEvent&&1===commonEvent.trigger)},Game_Map.prototype.parallelCommonEvents=function(){return $dataCommonEvents.filter(commonEvent=>commonEvent&&2===commonEvent.trigger)},Game_Map.prototype.setupBattleback=function(){$dataMap.specifyBattleback?(this._battleback1Name=$dataMap.battleback1Name,this._battleback2Name=$dataMap.battleback2Name):(this._battleback1Name=null,this._battleback2Name=null)},Game_Map.prototype.setDisplayPos=function(x,y){if(this.isLoopHorizontal())this._displayX=x.mod(this.width()),this._parallaxX=x;else{const endX=this.width()-this.screenTileX();this._displayX=endX<0?endX/2:x.clamp(0,endX),this._parallaxX=this._displayX}if(this.isLoopVertical())this._displayY=y.mod(this.height()),this._parallaxY=y;else{const endY=this.height()-this.screenTileY();this._displayY=endY<0?endY/2:y.clamp(0,endY),this._parallaxY=this._displayY}},Game_Map.prototype.tileset=function(){return $dataTilesets[this._tilesetId]},Game_Map.prototype.tilesetFlags=function(){const tileset=this.tileset();return tileset?tileset.flags:[]},Game_Map.prototype.displayName=function(){return $dataMap.displayName},Game_Map.prototype.width=function(){return $dataMap.width},Game_Map.prototype.height=function(){return $dataMap.height},Game_Map.prototype.data=function(){return $dataMap.data},Game_Map.prototype.isLoopHorizontal=function(){return $dataMap||Debug.error($dataMap),2===$dataMap.scrollType||3===$dataMap.scrollType},Game_Map.prototype.isLoopVertical=function(){return 1===$dataMap.scrollType||3===$dataMap.scrollType},Game_Map.prototype.isDashDisabled=function(){return $dataMap.disableDashing},Game_Map.prototype.encounterList=function(){return $dataMap.encounterList},Game_Map.prototype.encounterStep=function(){return $dataMap.encounterStep},Game_Map.prototype.isOverworld=function(){return this.tileset()&&0===this.tileset().mode},Game_Map.prototype.screenTileX=function(){return Graphics.width/this.tileWidth()},Game_Map.prototype.screenTileY=function(){return Graphics.height/this.tileHeight()},Game_Map.prototype.adjustX=function(x){return this.isLoopHorizontal()&&x<this._displayX-(this.width()-this.screenTileX())/2?x-this._displayX+$dataMap.width:x-this._displayX},Game_Map.prototype.adjustY=function(y){return this.isLoopVertical()&&y<this._displayY-(this.height()-this.screenTileY())/2?y-this._displayY+$dataMap.height:y-this._displayY},Game_Map.prototype.roundX=function(x){return this.isLoopHorizontal()?x.mod(this.width()):x},Game_Map.prototype.roundY=function(y){return this.isLoopVertical()?y.mod(this.height()):y},Game_Map.prototype.xWithDirection=function(x,d){return x+(6===d?1:4===d?-1:0)},Game_Map.prototype.yWithDirection=function(y,d){return y+(2===d?1:8===d?-1:0)},Game_Map.prototype.roundXWithDirection=function(x,d){return this.roundX(x+(6===d?1:4===d?-1:0))},Game_Map.prototype.roundYWithDirection=function(y,d){return this.roundY(y+(2===d?1:8===d?-1:0))},Game_Map.prototype.deltaX=function(x1,x2){let result=x1-x2;return this.isLoopHorizontal()&&Math.abs(result)>this.width()/2&&(result<0?result+=this.width():result-=this.width()),result},Game_Map.prototype.deltaY=function(y1,y2){let result=y1-y2;return this.isLoopVertical()&&Math.abs(result)>this.height()/2&&(result<0?result+=this.height():result-=this.height()),result},Game_Map.prototype.distance=function(x1,y1,x2,y2){return Math.abs(this.deltaX(x1,x2))+Math.abs(this.deltaY(y1,y2))},Game_Map.prototype.canvasToMapX=function(x){const tileWidth=this.tileWidth(),originX=this._displayX*tileWidth,mapX=Math.floor((originX+x)/tileWidth);return this.roundX(mapX)},Game_Map.prototype.canvasToMapY=function(y){const tileHeight=this.tileHeight(),originY=this._displayY*tileHeight,mapY=Math.floor((originY+y)/tileHeight);return this.roundY(mapY)},Game_Map.prototype.refreshIfNeeded=function(){this._needsRefresh&&this.refresh()},Game_Map.prototype.refresh=function(){this.events().forEach((function(event){event.refresh()})),this._commonEvents.forEach((function(event){event.refresh()})),this.refreshTileEvents(),this._needsRefresh=!1},Game_Map.prototype.refreshTileEvents=function(){this.tileEvents=this.events().filter((function(event){return event.isTile()}))},Game_Map.prototype.eventsXy=function(x,y){return this.events().filter((function(event){return event.pos(x,y)}))},Game_Map.prototype.eventsXyNt=function(x,y){return this.events().filter((function(event){return event.posNt(x,y)}))},Game_Map.prototype.tileEventsXy=function(x,y){return this.tileEvents.filter((function(event){return event.posNt(x,y)}))},Game_Map.prototype.eventIdXy=function(x,y){const list=this.eventsXy(x,y);return 0===list.length?0:list[0].eventId()},Game_Map.prototype.scrollDown=function(distance){if(this.isLoopVertical())this._displayY+=distance,this._displayY%=$dataMap.height,this._parallaxLoopY&&(this._parallaxY+=distance);else if(this.height()>=this.screenTileY()){const lastY=this._displayY;this._displayY=Math.min(this._displayY+distance,this.height()-this.screenTileY()),this._parallaxY+=this._displayY-lastY}},Game_Map.prototype.scrollLeft=function(distance){if(this.isLoopHorizontal())this._displayX+=$dataMap.width-distance,this._displayX%=$dataMap.width,this._parallaxLoopX&&(this._parallaxX-=distance);else if(this.width()>=this.screenTileX()){const lastX=this._displayX;this._displayX=Math.max(this._displayX-distance,0),this._parallaxX+=this._displayX-lastX}},Game_Map.prototype.scrollRight=function(distance){if(this.isLoopHorizontal())this._displayX+=distance,this._displayX%=$dataMap.width,this._parallaxLoopX&&(this._parallaxX+=distance);else if(this.width()>=this.screenTileX()){const lastX=this._displayX;this._displayX=Math.min(this._displayX+distance,this.width()-this.screenTileX()),this._parallaxX+=this._displayX-lastX}},Game_Map.prototype.scrollUp=function(distance){if(this.isLoopVertical())this._displayY+=$dataMap.height-distance,this._displayY%=$dataMap.height,this._parallaxLoopY&&(this._parallaxY-=distance);else if(this.height()>=this.screenTileY()){const lastY=this._displayY;this._displayY=Math.max(this._displayY-distance,0),this._parallaxY+=this._displayY-lastY}},Game_Map.prototype.isValid=function(x,y){return x>=0&&x<this.width()&&y>=0&&y<this.height()},Game_Map.prototype.checkPassage=function(x,y,bit){for(var flags=this.tilesetFlags(),tiles=this.allTiles(x,y),i=0;i<tiles.length;i++){var flag=flags[tiles[i]];if(0==(16&flag)){if(0==(flag&bit))return!0;if((flag&bit)===bit)return!1}}return!1},Game_Map.prototype.tileId=function(x,y,z){var width=$dataMap.width,height=$dataMap.height;return $dataMap.data[(z*height+y)*width+x]||0},Game_Map.prototype.layeredTiles=function(x,y){for(var tiles=[],i=0;i<4;i++)tiles.push(this.tileId(x,y,3-i));return tiles},Game_Map.prototype.allTiles=function(x,y){var tiles;return this.tileEventsXy(x,y).map((function(event){return event.tileId()})).concat(this.layeredTiles(x,y))},Game_Map.prototype.autotileType=function(x,y,z){var tileId=this.tileId(x,y,z);return tileId>=2048?Math.floor((tileId-2048)/48):-1},Game_Map.prototype.isPassable=function(x,y,d){return this.checkPassage(x,y,1<<d/2-1&15)},Game_Map.prototype.checkLayeredTilesFlags=function(x,y,bit){var flags=this.tilesetFlags();return this.layeredTiles(x,y).some((function(tileId){return 0!=(flags[tileId]&bit)}))},Game_Map.prototype.isLadder=function(x,y){return this.isValid(x,y)&&this.checkLayeredTilesFlags(x,y,32)},Game_Map.prototype.isCounter=function(x,y){return this.isValid(x,y)&&this.checkLayeredTilesFlags(x,y,128)},Game_Map.prototype.isDamageFloor=function(x,y){return this.isValid(x,y)&&this.checkLayeredTilesFlags(x,y,256)},Game_Map.prototype.terrainTag=function(x,y){if(this.isValid(x,y))for(var flags=this.tilesetFlags(),tiles=this.layeredTiles(x,y),i=0;i<tiles.length;i++){var tag=flags[tiles[i]]>>12;if(tag>0)return tag}return 0},Game_Map.prototype.regionId=function(x,y){return this.isValid(x,y)?this.tileId(x,y,5):0},Game_Map.prototype.update=function(sceneActive){this.refreshIfNeeded(),sceneActive&&this.updateInterpreter(),this.updateEvents()},Game_Map.prototype.scrollDistance=function(){return Math.pow(2,this._scrollSpeed)/256},Game_Map.prototype.doScroll=function(direction,distance){switch(direction){case 2:this.scrollDown(distance);break;case 4:this.scrollLeft(distance);break;case 6:this.scrollRight(distance);break;case 8:this.scrollUp(distance)}},Game_Map.prototype.updateEvents=function(){for(const event of this.events())event.update();for(const commonEvent of this._commonEvents)commonEvent.update()},Game_Map.prototype.changeTileset=function(tilesetId){this._tilesetId=tilesetId,this.refresh()},Game_Map.prototype.changeBattleback=function(battleback1Name,battleback2Name){this._battleback1Name=battleback1Name,this._battleback2Name=battleback2Name},Game_Map.prototype.updateInterpreter=function(){for(;;){if(this._interpreter.update(),this._interpreter.isRunning())return;if(this._interpreter.eventId()>0&&(this.unlockEvent(this._interpreter.eventId()),this._interpreter.clear()),!this.setupStartingEvent())return}},Game_Map.prototype.unlockEvent=function(eventId){this._events[eventId]&&this._events[eventId].unlock()},Game_Map.prototype.setupStartingEvent=function(){return this.refreshIfNeeded(),!!this._interpreter.setupReservedCommonEvent()||(!!this.setupTestEvent()||(!!this.setupStartingMapEvent()||!!this.setupAutorunCommonEvent()))},Game_Map.prototype.setupTestEvent=function(){return!!$testEvent&&(EventManager.setupTest($testEvent),$testEvent=null,!0)},Game_Map.prototype.setupStartingMapEvent=function(){for(const event of this.events())if(event.isStarting())return event.clearStartingFlag(),this._interpreter.setup(event.list(),event.eventId()),!0;return!1},Game_Map.prototype.setupAutorunCommonEvent=function(){for(const commonEvent of this.autorunCommonEvents())if($gameSwitches.value(commonEvent.switchId))return this._interpreter.setup(commonEvent.list),!0;return!1},Game_Map.prototype.isAnyEventStarting=function(){return this.events().some(event=>event.isStarting())},Game_Map.prototype.moveStraightPlayer=function(){let battleState=!1;this.events().forEach((function(event){event.plusStopCount(),event.updateStop();let state=event.checkMoveType();0==battleState&&(battleState=2==state),event.updateStop(),state=event.checkMoveType(),0==battleState&&(battleState=2==state)}));const _enemyEvents=this.getAllEnemyEvents();_enemyEvents.forEach(enemyEvent=>{enemyEvent._enemy.isAlive()&&!enemyEvent._enemy.canMove()&&enemyEvent.changeState(State.Stun),enemyEvent._enemy.onTurnEnd()})},Game_Map.prototype.autoplay=function(){$dataMap.autoplayBgm&&($gamePlayer.isInVehicle()?$gameSystem.saveWalkingBgm2():AudioManager.playBgm($dataMap.bgm)),$dataMap.autoplayBgs&&AudioManager.playBgs($dataMap.bgs)},Game_Map.prototype.getEnemyEvent=function(battler){const _event=this._events.find(a=>a&&a._enemy&&a._enemy==battler);return _event},Game_Map.prototype.findEnemyByPosition=function(x,y){const _event=this._events.find(a=>a&&a._enemy&&a.x==x&&a.y==y);return _event&&_event._enemy?_event._enemy:null},Game_Map.prototype.getAllEnemyEvents=function(){const _events=this._events.filter(a=>a&&a._enemy);return _events},Game_Map.prototype.initMapCharactersCache=function(){$gameTemp.setupMapCharactersCache(this.width()+1,this.height()+1);for(const character of this.allCharacters())character.updateMapCharactersCache()},Game_Screen.prototype.initialize=function(){this.clear(),this._screenVisible=!0,this._filters=[]},Game_Screen.prototype.filters=function(){return null==this._filters&&(this._filters=[]),this._filters},Game_Screen.prototype.setFilters=function(filters){this._filters=[];for(let filter in filters)_.contains(this._filters,filter)||this._filters.push(Number(filter))},Game_Screen.prototype.clear=function(){this.clearTone(),this.clearShake(),this.clearWeather(),this.clearBackGround()},Game_Screen.prototype.tone=function(){return this._tone},Game_Screen.prototype.shake=function(){return this._shake},Game_Screen.prototype.backGroundWeather=function(){return this._backGroundWeather},Game_Screen.prototype.eventWeather=function(){return this._eventWeather},Game_Screen.prototype.backGroundPosition=function(){return this._backGroundPosition},Game_Screen.prototype.backGroundSize=function(){return this._backGroundSize},Game_Screen.prototype.screenVisible=function(){return null==this._screenVisible&&(this._screenVisible=!0),this._screenVisible},Game_Screen.prototype.clearTone=function(){this._tone=[0,0,0,0]},Game_Screen.prototype.clearShake=function(){this._shakePower=0,this._shakeSpeed=0,this._shakeDuration=0,this._shakeDirection=1,this._shake=0},Game_Screen.prototype.clearWeather=function(){this._backGroundWeather=null,this._eventWeather=null},Game_Screen.prototype.clearBackGroundWeather=function(){this._backGroundWeather=null},Game_Screen.prototype.clearEventWeather=function(){this._eventWeather=null},Game_Screen.prototype.clearBackGround=function(){this._backGroundPosition=[0,0],this._backGroundSize=[Graphics.width,Graphics.height]},Game_Screen.prototype.startTint=function(tone,duration){this._tone=tone.clone()},Game_Screen.prototype.startShake=function(power,speed,duration){this._shakePower=power,this._shakeSpeed=speed,this._shakeDuration=duration},Game_Screen.prototype.changeBackGroundWeather=function(type){this._backGroundWeather=type},Game_Screen.prototype.changeEventWeather=function(type){this._eventWeather=type},Game_Screen.prototype.setBackGroundPosition=function(x,y){this._backGroundPosition=[x,y]},Game_Screen.prototype.setBackGroundSize=function(x,y){},Game_Screen.prototype.setScreenVisible=function(isVisible){this._screenVisible=isVisible},Game_Screen.prototype.update=function(){this.updateShake()},Game_Screen.prototype.updateShake=function(){if(this._shakeDuration>0||0!==this._shake){var delta=this._shakePower*this._shakeSpeed*this._shakeDirection/10;this._shakeDuration<=1?this._shake=0:this._shake+=delta,this._shake>2*this._shakePower&&(this._shakeDirection=.25*this._shakeDuration*-1),this._shake<2*-this._shakePower&&(this._shakeDirection=.25*this._shakeDuration*1),this._shakeDuration--}},function(){const _clear=Game_Message.prototype.clear;Game_Message.prototype.clear=function(){_clear.call(this),this._eventMessageBusy=!1}}(),Game_Message.prototype.isBusy=function(){return this.hasText()||this.isChoice()||this.isNumberInput()||this.isItemChoice()||this._eventMessageBusy},Game_Message.prototype.setBusy=function(isBusy){this._eventMessageBusy=isBusy},Game_Action.EFFECT_RECOVER_HP=11,Game_Action.EFFECT_RECOVER_MP=12,Game_Action.EFFECT_GAIN_TP=13,Game_Action.EFFECT_ADD_STATE=21,Game_Action.EFFECT_REMOVE_STATE=22,Game_Action.EFFECT_ADD_BUFF=31,Game_Action.EFFECT_ADD_DEBUFF=32,Game_Action.EFFECT_REMOVE_BUFF=33,Game_Action.EFFECT_REMOVE_DEBUFF=34,Game_Action.EFFECT_SPECIAL=41,Game_Action.EFFECT_GROW=42,Game_Action.EFFECT_LEARN_SKILL=43,Game_Action.EFFECT_COMMON_EVENT=44,Game_Action.SPECIAL_EFFECT_ESCAPE=0,Game_Action.HITTYPE_CERTAIN=0,Game_Action.HITTYPE_PHYSICAL=1,Game_Action.HITTYPE_MAGICAL=2,Game_Action.prototype.initialize=function(subject,forcing){this._subject=subject,this._forcing=forcing||!1,this.clear()},Game_Action.prototype.clear=function(){this._item=new Game_Item,this._results=[],this._targetIndex=-1,this._counter=!1},Game_Action.prototype.subject=function(){return this._subject},Game_Action.prototype.friendsUnit=function(){return this.subject().friendsUnit()},Game_Action.prototype.opponentsUnit=function(){return this.subject().opponentsUnit()},Game_Action.prototype.setAttack=function(){this.setSkill(this.subject().attackSkillId())},Game_Action.prototype.setGuard=function(){this.setSkill(this.subject().guardSkillId())},Game_Action.prototype.setSkill=function(skillId){this._item.setObject($dataSkills[skillId])},Game_Action.prototype.setItem=function(itemId){this._item.setObject($dataItems[itemId])},Game_Action.prototype.setItemObject=function(object){this._item.setObject(object)},Game_Action.prototype.setTarget=function(targetIndex){this._targetIndex=targetIndex},Game_Action.prototype.item=function(){return this._item.object()},Game_Action.prototype.isSkill=function(){return this._item.isSkill()},Game_Action.prototype.isItem=function(){return this._item.isItem()},Game_Action.prototype.numRepeats=function(){var repeats=this.item().repeats;return this.isAttack()&&(repeats+=this.subject().attackTimesAdd()),Math.floor(repeats)},Game_Action.prototype.checkItemScope=function(list){return list.contains(this.item().scope)},Game_Action.prototype.isForOpponent=function(){return this.checkItemScope([1,2,3,4,5,6])},Game_Action.prototype.isForFriend=function(){return this.checkItemScope([7,8,9,10,11])},Game_Action.prototype.isForDeadFriend=function(){return this.checkItemScope([9,10])},Game_Action.prototype.isForUser=function(){return this.checkItemScope([11])},Game_Action.prototype.isForOne=function(){return this.checkItemScope([1,3,7,9,11])},Game_Action.prototype.isForRandom=function(){return this.checkItemScope([3,4,5,6])},Game_Action.prototype.isForAll=function(){return this.checkItemScope([2,8,10])},Game_Action.prototype.needsSelection=function(){return this.checkItemScope([1,7,9])},Game_Action.prototype.numTargets=function(){return this.isForRandom()?this.item().scope-2:0},Game_Action.prototype.checkDamageType=function(list){return list.contains(this.item().damage.type)},Game_Action.prototype.isHpEffect=function(){return this.checkDamageType([1,3,5])},Game_Action.prototype.isMpEffect=function(){return this.checkDamageType([2,4,6])},Game_Action.prototype.isDamage=function(){return this.checkDamageType([1,2])},Game_Action.prototype.isRecover=function(){return this.checkDamageType([3,4])},Game_Action.prototype.isDrain=function(){return this.checkDamageType([5,6])},Game_Action.prototype.isHpRecover=function(){return this.checkDamageType([3])},Game_Action.prototype.isMpRecover=function(){return this.checkDamageType([4])},Game_Action.prototype.isCertainHit=function(){return this.item().hitType===Game_Action.HITTYPE_CERTAIN},Game_Action.prototype.isPhysical=function(){return this.item().hitType===Game_Action.HITTYPE_PHYSICAL},Game_Action.prototype.isMagical=function(){return this.item().hitType===Game_Action.HITTYPE_MAGICAL},Game_Action.prototype.isAttack=function(){return this.item()===$dataSkills[this.subject().attackSkillId()]},Game_Action.prototype.isGuard=function(){return this.item()===$dataSkills[this.subject().guardSkillId()]},Game_Action.prototype.isMagicSkill=function(){return!!this.isSkill()&&$dataSystem.magicSkills.contains(this.item().stypeId)},Game_Action.prototype.decideRandomTarget=function(){var target;(target=this.isForDeadFriend()?this.friendsUnit().randomDeadTarget():this.isForFriend()?this.friendsUnit().randomTarget():this.opponentsUnit().randomTarget())?this._targetIndex=target.index():this.clear()},Game_Action.prototype.setConfusion=function(){this.setAttack()},Game_Action.prototype.prepare=function(){this.subject().isConfused()&&!this._forcing&&this.setConfusion()},Game_Action.prototype.isValid=function(){return this._forcing&&this.item()||this.subject().canUse(this.item())},Game_Action.prototype.makeTargets=function(){const targets=[];return!this._forcing&&this.subject().isConfused()?targets.push(this.confusionTarget()):this.isForEveryone()?targets.push(...this.targetsForEveryone()):this.isForOpponent()?targets.push(...this.targetsForOpponents()):this.isForFriend()&&targets.push(...this.targetsForFriends()),this.repeatTargets(targets)},Game_Action.prototype.repeatTargets=function(targets){for(var repeatedTargets=[],repeats=this.numRepeats(),i=0;i<targets.length;i++){var target=targets[i];if(target)for(var j=0;j<repeats;j++)repeatedTargets.push(target)}return repeatedTargets},Game_Action.prototype.confusionTarget=function(){switch(this.subject().confusionLevel()){case 1:return this.opponentsUnit().randomTarget();case 2:return 0===Math.randomInt(2)?this.opponentsUnit().randomTarget():this.friendsUnit().randomTarget();default:return this.friendsUnit().randomTarget()}},Game_Action.prototype.targetsForOpponents=function(){let targets=[],unit=this.opponentsUnit();if(this.subject().isStateAffected($gameStateInfo.getStateId(StateType.ALL_ATTACK)))return targets=this.isForDeadFriend()?unit.deadMembers():unit.aliveMembers(),targets;if(this.isForRandom())for(var i=0;i<this.numTargets();i++)targets.push(unit.randomTarget());else if(this.isForOne())if(this._targetIndex<0){const skill=this.item();let isMpDamageState;for(_.find(skill.effects,a=>a.code==Game_Action.EFFECT_ADD_STATE&&a.dataId==$gameStateInfo.getStateId(StateType.MP_DAMAGE))&&targets.push(unit.randomMpDamageTarget());0==targets.length;){targets.push(unit.randomTarget());var state=_.find(this._item.object().effects,a=>a.code==Game_Action.EFFECT_ADD_STATE);state&&(targets=_.filter(targets,(function(t){return!t.isStateAffected(state.dataId)})))}}else targets.push(unit.smoothTarget(this._targetIndex));else targets=unit.aliveMembers();return targets},Game_Action.prototype.targetsForFriends=function(){let targets=[],unit=this.friendsUnit();if(this.subject().isStateAffected($gameStateInfo.getStateId(StateType.ALL_ATTACK)))return targets=this.isForDeadFriend()?unit.deadMembers():unit.aliveMembers(),targets;if(this.isForUser())return[this.subject()];if(this.isForDeadFriend())this.isForOne()?targets.push(unit.smoothDeadTarget(this._targetIndex)):targets=unit.deadMembers();else if(this.isForOne())if(this._targetIndex<0){const skill=this.item();[3].contains(skill.damage.type)?targets.push(unit.randomHpTarget()):[4].contains(skill.damage.type)?targets.push(unit.randomMpTarget()):targets.push(unit.randomTarget())}else targets.push(unit.smoothTarget(this._targetIndex));else targets=unit.aliveMembers();return targets},Game_Action.prototype.evaluate=function(){var value=0;return this.itemTargetCandidates().forEach((function(target){var targetValue=this.evaluateWithTarget(target);this.isForAll()?value+=targetValue:targetValue>value&&(value=targetValue,this._targetIndex=target.index())}),this),(value*=this.numRepeats())>0&&(value+=Math.random()),value},Game_Action.prototype.itemTargetCandidates=function(){return this.isValid()?this.isForOpponent()?this.opponentsUnit().aliveMembers():this.isForUser()?[this.subject()]:this.isForDeadFriend()?this.friendsUnit().deadMembers():this.friendsUnit().aliveMembers():[]},Game_Action.prototype.evaluateWithTarget=function(target){if(this.isHpEffect()){var value=this.makeDamageValue(target,!1),recovery;return this.isForOpponent()?value/Math.max(target.hp,1):Math.min(-value,target.mhp-target.hp)/target.mhp}},Game_Action.prototype.testApply=function(target){return!0},Game_Action.prototype.hasItemAnyValidEffects=function(target){return this.item().effects.some((function(effect){return this.testItemEffect(target,effect)}),this)},Game_Action.prototype.testItemEffect=function(target,effect){switch(effect.code){case Game_Action.EFFECT_RECOVER_HP:return target.hp<target.mhp||effect.value1<0||effect.value2<0;case Game_Action.EFFECT_RECOVER_MP:return target.mp<target.mmp||effect.value1<0||effect.value2<0;case Game_Action.EFFECT_ADD_STATE:return!target.isStateAffected(effect.dataId);case Game_Action.EFFECT_REMOVE_STATE:return target.isStateAffected(effect.dataId);case Game_Action.EFFECT_LEARN_SKILL:return!target.isLearnedSkill(effect.dataId);default:return!0}},Game_Action.prototype.itemCnt=function(target){return this.isPhysical()&&target.canMove()?target.cnt:0},Game_Action.prototype.itemMrf=function(target){return this.isMagical()?target.mrf:0},Game_Action.prototype.itemHit=function(target){const successRate=this.item().successRate,subject=this.subject(),blindId=$gameStateInfo.getStateId(StateType.BLIND);let hitRate=subject.hit;subject.isStateAffected(blindId)&&(hitRate-=.01*subject.getStateEffect(blindId));const evaId=$gameStateInfo.getStateId(StateType.EVA_BUFF_RATE);let evaRate=subject.eva;return target&&target.isStateAffected(evaId)&&(evaRate+=.01*target.getStateEffect(evaId)),(1+hitRate-evaRate)*successRate*.01},Game_Action.prototype.itemEva=function(target){return this.isPhysical()?target.eva:this.isMagical()?target.mev:0},Game_Action.prototype.itemCri=function(target){var value=0,critcalStateId=$gameStateInfo.getStateId(StateType.CRITICAL_BUFF_ADD);this.subject().isStateAffected(critcalStateId)&&(value+=.01*this.subject().getStateEffect(critcalStateId));let _targetCev=1;return target&&(_targetCev-=target.cev),this.item().damage.critical?(this.subject().cri+value)*_targetCev:0},Game_Action.prototype.results=function(){return this._results},Game_Action.prototype.makeActionResult=function(targets){targets.forEach((target,index)=>{this.makeResult(target,targets.length-1==index)})},Game_Action.prototype.makeResult=function(target,lastTarget){let result=new Game_ActionResult;if(result.used=this.testApply(target),result.missed=result.used&&Math.random()>=this.itemHit(target),this.isCertainHit()&&(result.missed=!1),this.makeResultTarget(result,target),result.isHit()&&this.item().damage.type>0){result.critical=Math.random()<this.itemCri(result.target);let value=this.makeDamageValue(result.target,result.critical);if(this.isHpEffect()){var elementValue;this.makeHpDamage(result,result.target,value,lastTarget),this.calcElementRate(result.target)>1&&result.hpDamage>0&&(result.weakness=!0);const damageBlockId=$gameStateInfo.getStateId(StateType.DAMAGE_BLOCK);target&&target.isStateAffected(damageBlockId)&&value<target.getStateEffect(damageBlockId)&&(result.hpDamage=0,result.damageBlock=!0,result.weakness=!1),this.makeResultHoldOn(result),this.makeResultKishikaisei(result),this.makeResultBanish(result),this.makeResultInvisible(result);let tempHpDamage=0;this._results.forEach(res=>{res.target==result.target&&(tempHpDamage+=res.hpDamage)}),result.target&&(result.target.hp<=result.hpDamage+tempHpDamage&&(result.isDead=!0),result.target.isGuard()&&result.hpDamage>0&&(result.guard=!0))}this.isMpEffect()&&this.makeMpDamage(result,result.target,value)}let number=_.filter(this._results,r=>r.target==target);number.length>=1&&(result.length=number.length+1),this._results.push(result)},Game_Action.prototype.makeResultTarget=function(result,target){var unit;result.target=target,this.opponentsUnit().aliveMembers().forEach(member=>{member!=target&&member.isStateAffected($gameStateInfo.getStateId(StateType.SUBSTITUTE))&&this.isHpEffect()&&this.isForOne()&&this.isDamage()&&(result.target=member,result.substitutedTarget=target)})},Game_Action.prototype.makeResultHoldOn=function(result){let isHoldOn=!1;const holdOnId=$gameStateInfo.getStateId(StateType.HOLD_ON);if(this.subject().isStateAffected(holdOnId)&&(isHoldOn=!0),isHoldOn){var tempHpDamage=0;this._results.forEach(res=>{res.target==result.target&&(tempHpDamage+=res.hpDamage)}),result.target.hp<=result.hpDamage+tempHpDamage&&(result.hpDamage=result.target.hp-tempHpDamage-1,result.holdon=!0)}},Game_Action.prototype.makeResultKishikaisei=function(result){let isKishikaisei=!1;const kishikaiseiId=$gameStateInfo.getStateId(StateType.KISHIKAISEI);if(result.target&&result.target.isStateAffected(kishikaiseiId)&&(isKishikaisei=!0),isKishikaisei){var tempHpDamage=0;this._results.forEach(res=>{res.target==result.target&&(tempHpDamage+=res.hpDamage)}),result.target.hp<=result.hpDamage+tempHpDamage&&(result.hpDamage=result.target.hp-tempHpDamage-1,result.kishikaisei=!0,result.pushRemovedState($gameStateInfo.getStateId(StateType.KISHIKAISEI)))}},Game_Action.prototype.makeResultBanish=function(result){const banishId=$gameStateInfo.getStateId(StateType.BANISH);if(result.target&&result.target.isStateAffected(banishId)){let stateData=result.target.getStateData(banishId),tempHpDamage=0;this._results.forEach(res=>{res.target==result.target&&(tempHpDamage+=res.hpDamage)}),result.target.hp<=result.hpDamage+tempHpDamage&&stateData&&(result.hpDamage=result.target.hp-tempHpDamage-1,result.banish=!0,result.target.removeState(banishId,result.target.battlerId(),-1))}},Game_Action.prototype.makeResultInvisible=function(result){const invisibleId=$gameStateInfo.getStateId(StateType.INVISIBLE);if(result.target&&result.target.isStateAffected(invisibleId)&&result.hpDamage>0&&result.target.getStateEffect(invisibleId)>0){let stateData=result.target.getStateData(invisibleId);stateData&&(stateData._effect-=1),stateData.effect<=0&&result.target.removeState(invisibleId),result.hpDamage=0,result.invisible=!0}},Game_Action.prototype.makeHpDamage=function(result,target,value,lastTarget){const subject=this.subject(),chargeId=$gameStateInfo.getStateId(StateType.CHARGE),isForAll=this.isForAll();value>0&&subject.isStateAffected(chargeId)&&(value+=subject.getStateEffectTotal(chargeId),isForAll?lastTarget&&(subject.removeState(chargeId),result.chargeAttack=!0):(subject.removeState(chargeId),result.chargeAttack=!0)),this.isDrain()&&(value=Math.min(target.hp,value)),result.hpDamage=value;const damageCutId=$gameStateInfo.getStateId(StateType.DAMAGE_CUT);if(value>0&&target&&target.isStateAffected(damageCutId)){result.hpDamage-=target.getStateEffectTotal(damageCutId),result.hpDamage<1&&(result.hpDamage=1,result.damageBlock=!0);const stateDataList=target.getStateDataAll(damageCutId);stateDataList.forEach(stateData=>{stateData.passive||result.pushRemovedState(damageCutId)})}value>0&&target&&target.isStateAffected($gameStateInfo.getStateId(StateType.FROZEN))&&(result.hpDamage=Math.round(result.hpDamage*$gameDefine.frozenDamageRate),result.pushRemovedState($gameStateInfo.getStateId(StateType.FROZEN)))},Game_Action.prototype.makeMpDamage=function(result,target,value){this.isMpRecover()||(value=Math.min(target.mp,value)),result.mpDamage=value,result.mpAffected=!0,target&&target.isStateAffected($gameStateInfo.getStateId(StateType.CURSE))&&(result.mpDamage=0,result.mpAffected=!1)},Game_Action.prototype.apply=function(target){var result;target.result().missed||(this.item().damage.type>0&&this.executeDamage(target),this.item().effects.forEach((function(effect){this.applyItemEffect(target,effect)}),this),this.applyItemUserEffect(target))},Game_Action.prototype.applyResult=function(target,result){result.missed||(this.item().damage.type>0&&this.executeDamage(result),this.item().effects.forEach((function(effect){this.applyItemEffect(result,effect)}),this),this.applyItemUserEffect(target))},Game_Action.prototype.makeDamageValue=function(target,critical,isVariable=!0){const item=this.item(),subject=this.subject();let baseValue=this.evalDamageFormula(target);if(baseValue<0){if(this.isHpRecover()){const phaId=$gameStateInfo.getStateId(StateType.PHARMACOLOGY);let phaEffect=1;subject.isStateAffected(phaId)&&(phaEffect+=subject.getStateEffectTotal(phaId)),baseValue=Math.floor(target.mhp*baseValue*phaEffect*.01),baseValue*=target.rec}return this.isMpRecover(),baseValue}baseValue+=subject.damageRate();let elementValue,value=baseValue*this.calcElementRate(target);return this.isMagical()&&(value*=target.pdr),critical&&(value=this.applyCritical(value)),isVariable&&(value=this.applyVariance(value,item.damage.variance)),value=this.applyGuard(value,target),value=Math.round(value),0==value&&(value=1),value},Game_Action.prototype.evalDamageFormula=function(target){try{const _item=this.item(),_atk=this._subject.getAttackValue(0),_damageRate=Number(eval(_item.damage.formula)),_defRate=100-.12*target.def;let damage=0;if(1==_item.stypeId){damage=Math.floor(_atk*_damageRate*(_defRate/100));const _shieldRate=target.shieldValue();_shieldRate>0&&(damage=Math.floor(_atk*_damageRate*(_defRate/100)*(_shieldRate/100)))}else if(2==_item.stypeId){const _shieldRate=target.magicShieldValue(),_elementRate=target.elementShieldValue(_item.damage.elementId);damage=Math.floor(_damageRate*(1-_shieldRate/100)*(1-_elementRate/100)),console.log(damage)}const sign=[3,4].contains(_item.damage.type)?-1:1;let value=Math.max(damage,0)*sign;return isNaN(value)&&(value=0),value}catch(e){return 0}},Game_Action.prototype.calcElementRate=function(target){return null==target?1:this.item().damage.elementId<0?this.elementsMaxRate(target,this.subject().attackElements()):target.elementRate(this.item().damage.elementId)},Game_Action.prototype.elementsMaxRate=function(target,elements){return elements.length>0?Math.max.apply(null,elements.map((function(elementId){return target.elementRate(elementId)}),this)):1},Game_Action.prototype.applyCritical=function(damage){return 1.5*damage},Game_Action.prototype.applyVariance=function(damage,variance){var amp=Math.floor(Math.max(Math.abs(damage)*variance/100,0)),v=Math.randomInt(amp+1)+Math.randomInt(amp+1)-amp;return damage>=0?damage+v:damage-v},Game_Action.prototype.applyGuard=function(damage,target){const penetrateId=$gameStateInfo.getStateId(StateType.PENETRATE);if(damage>0&&target.isGuard()&&!this.subject().isStateAffected(penetrateId)){const ironwillId=$gameStateInfo.getStateId(StateType.IRON_WILL);return target&&target.isStateAffected(ironwillId)&&(damage-=target.getStateEffectTotal(ironwillId)),Math.max(damage-target.def,1)}return damage},Game_Action.prototype.executeDamage=function(result){this.isHpEffect()?(this.executeHpDamage(result),this.executeRpDamage(this.subject(),result.reDamage)):this.isMpEffect()&&this.executeMpDamage(result.target,result.mpDamage)},Game_Action.prototype.executeHpDamage=function(result){if(null==result.target)return;let target=result.target,value=result.hpDamage;if(this.isDrain()&&(value=Math.min(target.hp,value)),target.gainHp(-value),value>0){let removeStateIds;target.onDamage().forEach(removeStateId=>{result.pushRemovedState(removeStateId)})}this.gainDrainedHp(value)},Game_Action.prototype.executeMpDamage=function(target,value){this.isMpRecover()||(value=Math.min(target.mp,value)),target.gainMp(-value),this.gainDrainedMp(value)},Game_Action.prototype.executeRpDamage=function(target,value){this.isDrain()&&(value=Math.min(target.hp,value)),target.gainHp(-value),this.gainDrainedHp(value)},Game_Action.prototype.gainDrainedHp=function(value){if(this.isDrain()){var value=10*this.item().mpCost;$gameParty.members().forEach(actor=>{actor.isAlive()&&actor.gainHp(Math.floor(.01*value*actor.mhp*(actor.hrg+1)))})}},Game_Action.prototype.gainDrainedMp=function(value){if(this.isDrain()){var gainTarget=this.subject();void 0!==this._reflectionTarget&&(gainTarget=this._reflectionTarget),gainTarget.gainMp(value)}},Game_Action.prototype.applyItemEffect=function(result,effect){switch(effect.code){case Game_Action.EFFECT_RECOVER_HP:this.itemEffectRecoverHp(result.target,effect);break;case Game_Action.EFFECT_RECOVER_MP:this.itemEffectRecoverMp(result,effect);break;case Game_Action.EFFECT_GAIN_TP:this.itemEffectGainTp(result,effect);break;case Game_Action.EFFECT_ADD_STATE:this.itemEffectAddState(result,effect);break;case Game_Action.EFFECT_REMOVE_STATE:this.itemEffectRemoveState(result,effect);break;case Game_Action.EFFECT_SPECIAL:this.itemEffectSpecial(result,effect);break;case Game_Action.EFFECT_GROW:this.itemEffectGrow(result,effect);break;case Game_Action.EFFECT_LEARN_SKILL:this.itemEffectLearnSkill(result,effect);break;case Game_Action.EFFECT_COMMON_EVENT:this.itemEffectCommonEvent(result,effect)}},Game_Action.prototype.itemEffectRecoverHp=function(target,effect){var value=(target.mhp*effect.value1+effect.value2)*target.rec;this.isItem()&&(value*=this.subject().pha),0!==(value=Math.floor(value))&&(target.hp+value<=0&&(value=-1*(target.hp-1)),target.gainHp(value))},Game_Action.prototype.itemEffectRecoverMp=function(result,effect){var value=(result.target.mmp*effect.value1+effect.value2)*result.target.rec;this.isItem()&&(value*=this.subject().pha),0!==(value=Math.floor(value))&&result.target.gainMp(value)},Game_Action.prototype.itemEffectGainTp=function(target,effect){var value=Math.floor(effect.value1);0!==value&&target.gainTp(value)},Game_Action.prototype.itemEffectAddState=function(result,effect){0===effect.dataId?this.itemEffectAddAttackState(result,effect):this.itemEffectAddNormalState(result,effect)},Game_Action.prototype.itemEffectAddAttackState=function(target,effect){this.subject().attackStates().forEach(function(stateId){var chance=effect.value1;chance*=target.stateRate(stateId),chance*=this.subject().attackStatesRate(stateId),Math.random()<chance&&target.addState(stateId)}.bind(this),target)},Game_Action.prototype.itemEffectAddNormalState=function(result,effect){const restrictionId=$gameStateInfo.getStateId(StateType.RESTRICTION);if(result.target&&result.target.isStateAffected(restrictionId)&&(this.subject().isStateResist(effect.dataId)||(this.subject().addState(effect.dataId,this.item().stateTurns,this.item().stateEffect,!1,this.subject().battlerId()),result.pushRestrictedState(effect.dataId))),result.target&&result.target.isStateResist(effect.dataId)){const barrierId=$gameStateInfo.getStateId(StateType.BARRIER);return result.target.isStateAffected(barrierId)&&(result.barriered=!0),void result.pushResistedState(effect.dataId)}if(this.isStateConsciousResist(result,effect))return void result.pushResistedState(effect.dataId);let chance=effect.value1;this.isCertainHit()||(chance*=result.target.stateRate(effect.dataId)),Math.random()<chance?result.pushAddedState(effect.dataId):result.pushResistedState(effect.dataId)},Game_Action.prototype.isStateConsciousResist=function(result,effect){const consciousId=$gameStateInfo.getStateId(StateType.CONSCIOUS);if(consciousId==effect.dataId){if(this.subject().level>result.target.level){const deathId=$gameStateInfo.getStateId(StateType.DEATH);result.pushAddedState(deathId)}return this.subject().level<=result.target.level}return!1},Game_Action.prototype.itemEffectRemoveState=function(result,effect){var chance=effect.value1;Math.random()<chance&&result.target&&result.target.isStateAffected(effect.dataId)&&result.pushRemovedState(effect.dataId)},Game_Action.prototype.itemEffectSpecial=function(target,effect){effect.dataId===Game_Action.SPECIAL_EFFECT_ESCAPE&&target.escape()},Game_Action.prototype.itemEffectGrow=function(result,effect){result.target.addParam(effect.dataId,Math.floor(effect.value1))},Game_Action.prototype.itemEffectLearnSkill=function(result,effect){result.target.isActor()?result.target.learnSkill(effect.dataId):_.find(result.target._actionList,action=>action.skillId==effect.dataId)||result.target._actionList.push({conditionParam1:0,conditionParam2:0,conditionType:0,rating:1,skillId:effect.dataId})},Game_Action.prototype.itemEffectCommonEvent=function(target,effect){},Game_Action.prototype.applyItemUserEffect=function(target){var value=Math.floor(this.item().tpGain*this.subject().tcr);this.subject().gainSilentTp(value)},Game_Action.prototype.applyGlobal=function(){this.item().effects.forEach((function(effect){effect.code===Game_Action.EFFECT_COMMON_EVENT&&$gameTemp.reserveCommonEvent(effect.dataId)}),this)},Game_Action.prototype.isContainsState=function(stateId){const item=this._item.object().effects;return _.find(item,a=>a.code==Game_Action.EFFECT_ADD_STATE&&a.dataId==stateId)},Game_Action.prototype.isContainsEffects=function(effectId){return _.find(this.item().effects,e=>e.code==effectId)},Game_Action.prototype.isAddState=function(stateId){return _.find(this._result.addedStates,s=>s==stateId)},Game_Action.prototype.setCounter=function(){this._counter=!0},Game_Action.prototype.counter=function(){return this._counter},Game_Action.prototype.setCountered=function(){this._countered=!0},Game_Action.prototype.countered=function(){return this._countered},Game_Action.prototype.setMadness=function(){this._madness=!0},Game_Action.prototype.madness=function(){return this._madness},Game_Action.prototype.popupData=function(actor){if(null==this._results)return null;if(0==this._results.length)return null;let popup=[],results=this.results(),data=$dataSkills[this.item().id];results.forEach(result=>{const removeStates=result.removedStateObjects();removeStates&&removeStates.forEach(state=>{state.iconIndex>0&&result.target&&result.target.isStateAffected(state.id)&&popup.push(new PopupTextData(result.target,PopupTextType.RemoveState,TextManager.getStateName(state.id)))});const chargeId=$gameStateInfo.getStateId(StateType.CHARGE);var addStates=result.addedStateObjects();addStates&&addStates.forEach(state=>{state.iconIndex>0&&state.id!=chargeId&&popup.push(new PopupTextData(result.target,PopupTextType.AddState,TextManager.getStateName(state.id))),state.id==chargeId&&popup.push(new PopupTextData(result.target,PopupTextType.Charge,TextManager.getStateName(state.id)+"+"+data.stateEffect))});var resitStates=result.resistStateObjects();resitStates&&resitStates.forEach(state=>{state.iconIndex>0&&state.id!=$gameStateInfo.getStateId(StateType.CHARGE)&&popup.push(new PopupTextData(result.target,PopupTextType.ResistState,TextManager.getStateName(state.id)))});var restrictStates=result.restrictStateObjects();restrictStates&&restrictStates.forEach(state=>{state.iconIndex>0&&state.id!=$gameStateInfo.getStateId(StateType.CHARGE)&&popup.push(new PopupTextData(this.subject(),PopupTextType.AddState,TextManager.getStateName(state.id)))});var mpDamageId=$gameStateInfo.getStateId(StateType.MP_DAMAGE);this.isContainsState(mpDamageId)&&popup.push(new PopupTextData(result.target,PopupTextType.Text,TextManager.getStateName(mpDamageId)+" "+data.stateEffect+TextManager.getStateMessage3(mpDamageId))),result.holdon&&popup.push(new PopupTextData(result.target,PopupTextType.Text,TextManager.getStateName($gameStateInfo.getStateId(StateType.HOLD_ON)))),result.kishikaisei&&popup.push(new PopupTextData(result.target,PopupTextType.Text,TextManager.getStateName($gameStateInfo.getStateId(StateType.KISHIKAISEI)))),result.banish&&popup.push(new PopupTextData(result.target,PopupTextType.RemoveState,TextManager.getStateName($gameStateInfo.getStateId(StateType.BANISH)))),result.penetrate&&popup.push(new PopupTextData(result.target,PopupTextType.Text,TextManager.getStateName($gameStateInfo.getStateId(StateType.PENETRATE)))),result.chargeAttack&&popup.push(new PopupTextData(actor,PopupTextType.RemoveState,TextManager.getStateName($gameStateInfo.getStateId(StateType.CHARGE)))),result.invisible&&(result.target.isStateAffected($gameStateInfo.getStateId(StateType.INVISIBLE))||popup.push(new PopupTextData(result.target,PopupTextType.RemoveState,TextManager.getStateName($gameStateInfo.getStateId(StateType.INVISIBLE))))),result.barriered&&(result.target.removeState($gameStateInfo.getStateId(StateType.BARRIER)),popup.push(new PopupTextData(result.target,PopupTextType.RemoveState,TextManager.getStateName($gameStateInfo.getStateId(StateType.BARRIER)))))}),this.isContainsEffects(Game_Action.EFFECT_LEARN_SKILL);const effectGrow=Game_Action.EFFECT_GROW;return this.isContainsEffects(effectGrow)&&data&&data.effects.forEach(effect=>{effect.code==effectGrow&&popup.push(new PopupTextData(actor,PopupTextType.Grow,TextManager.param(effect.dataId)))}),data&&data.selfSkill&&this.popupSelfSkill(popup,actor,data.selfSkill),popup},Game_Action.prototype.popupSelfSkill=function(popup,actor,skillId){if(0==skillId)return;const selfSkill=$dataSkills[skillId];let animationId=selfSkill.animationId;selfSkill.animation>0&&(animationId=selfSkill.animation);let targets=[actor];selfSkill.scope==ScopeType.ALL_PARTY&&(targets=$gameParty.members()),selfSkill.effects.forEach(effect=>{targets.forEach(target=>{effect.code==Game_Action.EFFECT_ADD_STATE&&popup.push(new PopupTextData(target,PopupTextType.AddState,TextManager.getStateName(effect.dataId),animationId)),effect.code==Game_Action.EFFECT_GROW&&popup.push(new PopupTextData(target,PopupTextType.Grow,TextManager.param(effect.dataId),animationId)),effect.code==Game_Action.EFFECT_RECOVER_HP&&(target.hp+effect.value2<=0&&(effect.value2=-1*(target.hp-1)),popup.push(new PopupTextData(target,PopupTextType.Damage,effect.value2,animationId)))})})},Game_Action.prototype.resultHpDamageValue=function(){var value=0;return this._results.forEach(reselt=>{reselt.hpDamage&&(value+=reselt.hpDamage)}),value},Game_Action.prototype.damageRecordInfo=function(){const result=this.results();let targetInfo={};return result.forEach(res=>{let battlerId=res.target.battlerId();targetInfo[battlerId]||(targetInfo[battlerId]={index:0,damage:0}),res.hpDamage>0&&(targetInfo[battlerId].index+=1,targetInfo[battlerId].damage+=res.hpDamage)}),targetInfo},Game_Action.prototype.resetVantageResult=function(target){const vantageId=$gameStateInfo.getStateId(StateType.VANTAGE);this._results.forEach(result=>{result.target==target&&this.item().mpCost<=target.mp&&(result.missed=!1,result.vantageBlock=!0,result.hpDamage=0,result.weakness=!1,result.pushRemovedState(vantageId))})},Game_Action.prototype.resetDischargeResult=function(){const dischargeId=$gameStateInfo.getStateId(StateType.DISCHARGE);this._results.forEach(result=>{result.target=this.subject(),result.pushRemovedState(dischargeId)});let tempHpDamage=0;this._results.forEach(res=>{tempHpDamage+=res.hpDamage,res.isDead=res.target.hp<=tempHpDamage})},Game_Action.prototype.chargeTurn=function(){return null==this.item()?0:this.isSkill()?$dataSkills[this.item().id].chargeTurn:0},Game_Action.prototype.setAgi=function(agi){this._agi=agi,this.item()&&this.item().speed&&(this._agi+=this.item().speed)},Game_Action.prototype.agi=function(){return this._agi};const WeaponType={None:0,ONE_HANDED:1,TWO_HANDED:2,BOW:3};function Game_ActionResult(){this.initialize(...arguments)}function Game_BattlerBase(){this.initialize(...arguments)}function Game_Battler(){this.initialize.apply(this,arguments)}function Game_Actor(){this.initialize.apply(this,arguments)}function Game_Enemy(){this.initialize.apply(this,arguments)}function Game_Actors(){this.initialize.apply(this,arguments)}Game_ActionResult.prototype.initialize=function(){this.initParam()},Game_ActionResult.prototype.initParam=function(){this.used=!1,this.missed=!1,this.critical=!1,this.weakness=!1,this.hpDamage=0,this.mpDamage=0,this.tpDamage=0,this.addedStates=[],this.removedStates=[],this.resistStates=[],this.restrictStates=[],this.target=null,this.isDead=!1,this.guard=!1,this.holdon=!1,this.kishikaisei=!1,this.invisible=!1,this.damageBlock=!1,this.substitutedTarget=null,this.length=1,this.vantageEffect=0,this.vantageBlock=!1,this.reDamage=0,this.dischargeEffect=0,this.penetrate=!1,this.discharge=!1,this.chargeAttack=!1,this.barriered=!1},Game_ActionResult.prototype.addedStateObjects=function(){return this.addedStates.map((function(id){return $dataStates[id]}))},Game_ActionResult.prototype.removedStateObjects=function(){return this.removedStates.map((function(id){return $dataStates[id]}))},Game_ActionResult.prototype.resistStateObjects=function(){return this.resistStates.map((function(id){return $dataStates[id]}))},Game_ActionResult.prototype.restrictStateObjects=function(){return this.restrictStates.map((function(id){return $dataStates[id]}))},Game_ActionResult.prototype.isHit=function(){return this.used&&!this.missed},Game_ActionResult.prototype.isStateAdded=function(stateId){return this.addedStates.contains(stateId)},Game_ActionResult.prototype.pushAddedState=function(stateId){this.isStateAdded(stateId)||this.addedStates.push(stateId)},Game_ActionResult.prototype.isStateRemoved=function(stateId){return this.removedStates.contains(stateId)},Game_ActionResult.prototype.pushRemovedState=function(stateId){this.isStateRemoved(stateId)||this.removedStates.push(stateId)},Game_ActionResult.prototype.pushResistedState=function(stateId){this.isStateResisted(stateId)||this.resistStates.push(stateId)},Game_ActionResult.prototype.isStateResisted=function(stateId){return this.resistStates.contains(stateId)},Game_ActionResult.prototype.pushRestrictedState=function(stateId){this.isStateResisted(stateId)||this.restrictStates.push(stateId)},Game_ActionResult.prototype.isStateRestricted=function(stateId){return this.restrictStates.contains(stateId)},Game_BattlerBase.TRAIT_ELEMENT_RATE=11,Game_BattlerBase.TRAIT_DEBUFF_RATE=12,Game_BattlerBase.TRAIT_STATE_RATE=13,Game_BattlerBase.TRAIT_STATE_RESIST=14,Game_BattlerBase.TRAIT_PARAM=21,Game_BattlerBase.TRAIT_XPARAM=22,Game_BattlerBase.TRAIT_SPARAM=23,Game_BattlerBase.TRAIT_ATTACK_ELEMENT=31,Game_BattlerBase.TRAIT_ATTACK_STATE=32,Game_BattlerBase.TRAIT_ATTACK_SPEED=33,Game_BattlerBase.TRAIT_ATTACK_TIMES=34,Game_BattlerBase.TRAIT_STYPE_ADD=41,Game_BattlerBase.TRAIT_STYPE_SEAL=42,Game_BattlerBase.TRAIT_SKILL_ADD=43,Game_BattlerBase.TRAIT_SKILL_SEAL=44,Game_BattlerBase.TRAIT_EQUIP_WTYPE=51,Game_BattlerBase.TRAIT_EQUIP_ATYPE=52,Game_BattlerBase.TRAIT_EQUIP_LOCK=53,Game_BattlerBase.TRAIT_EQUIP_SEAL=54,Game_BattlerBase.TRAIT_SLOT_TYPE=55,Game_BattlerBase.TRAIT_ACTION_PLUS=61,Game_BattlerBase.TRAIT_SPECIAL_FLAG=62,Game_BattlerBase.TRAIT_COLLAPSE_TYPE=63,Game_BattlerBase.TRAIT_PARTY_ABILITY=64,Game_BattlerBase.FLAG_ID_AUTO_BATTLE=0,Game_BattlerBase.FLAG_ID_GUARD=1,Game_BattlerBase.FLAG_ID_SUBSTITUTE=2,Game_BattlerBase.FLAG_ID_PRESERVE_TP=3,Game_BattlerBase.ICON_BUFF_START=32,Game_BattlerBase.ICON_DEBUFF_START=48,Game_BattlerBase.SKILL_TYPE_MAGIC=1,Game_BattlerBase.SKILL_TYPE_COMMON=2,Game_BattlerBase.SKILL_TYPE_PASSIVE=4,Game_BattlerBase.SKILL_TYPE_PASSIVE_SELF=5,Game_BattlerBase.SKILL_TYPE_SELF=6,Game_BattlerBase.SKILL_TYPE_SPECIAL=7,Object.defineProperties(Game_BattlerBase.prototype,{hp:{get:function(){return this._hp},configurable:!0},mp:{get:function(){return this._mp},configurable:!0},tp:{get:function(){return this._tp},configurable:!0},mhp:{get:function(){return this.param(0)},configurable:!0},mmp:{get:function(){return this.param(1)},configurable:!0},atk:{get:function(){return this.param(2)},configurable:!0},def:{get:function(){return this.param(3)},configurable:!0},mat:{get:function(){return this.param(4)},configurable:!0},mdf:{get:function(){return this.param(5)},configurable:!0},agi:{get:function(){return this.param(6)},configurable:!0},luk:{get:function(){return this.param(7)},configurable:!0},hit:{get:function(){return this.xparam(0)},configurable:!0},eva:{get:function(){return this.xparam(1)},configurable:!0},cri:{get:function(){return this.xparam(2)},configurable:!0},cev:{get:function(){return this.xparam(3)},configurable:!0},mev:{get:function(){return this.xparam(4)},configurable:!0},mrf:{get:function(){return this.xparam(5)},configurable:!0},cnt:{get:function(){return this.xparam(6)},configurable:!0},hrg:{get:function(){return this.xparam(7)},configurable:!0},mrg:{get:function(){return this.xparam(8)},configurable:!0},trg:{get:function(){return this.xparam(9)},configurable:!0},tgr:{get:function(){return this.sparam(0)},configurable:!0},grd:{get:function(){return this.sparam(1)},configurable:!0},rec:{get:function(){return this.sparam(2)},configurable:!0},pha:{get:function(){return this.sparam(3)},configurable:!0},mcr:{get:function(){return this.sparam(4)},configurable:!0},tcr:{get:function(){return this.sparam(5)},configurable:!0},pdr:{get:function(){return this.sparam(6)},configurable:!0},mdr:{get:function(){return this.sparam(7)},configurable:!0},fdr:{get:function(){return this.sparam(8)},configurable:!0},exr:{get:function(){return this.sparam(9)},configurable:!0}}),Game_BattlerBase.prototype.initialize=function(){this.initMembers()},Game_BattlerBase.prototype.initMembers=function(){this._hp=1,this._mp=0,this._tp=0,this._bindBatllers=[],this._hidden=!1,this.clearParamPlus(),this.clearStates()},Game_BattlerBase.prototype.clearParamPlus=function(){this._paramPlus=[0,0,0,0,0,0,0,0]},Game_BattlerBase.prototype.clearStates=function(){this._stateData=[]},Game_BattlerBase.prototype.eraseState=function(stateId,slotId=0){const stateDataIndex=_.findIndex(this._stateData,data=>data.id==stateId&&data.slotId==slotId);stateDataIndex>=0&&this._stateData.splice(stateDataIndex,1)},Game_BattlerBase.prototype.isStateAffected=function(stateId,battlerId,slotId){return null!=this.getStateData(stateId,battlerId,slotId)},Game_BattlerBase.prototype.getStateData=function(stateId,battlerId=0,slotId=0){let stateData;return stateData=0==battlerId?_.find(this._stateData,data=>data.id==stateId):_.find(this._stateData,data=>data.id==stateId&&data.battlerId==battlerId&&data.slotId==slotId),stateData||null},Game_BattlerBase.prototype.getStateDataAll=function(stateId){let stateDataList=[];return stateDataList=_.filter(this._stateData,data=>data.id==stateId),stateDataList},Game_BattlerBase.prototype.getStateTurns=function(stateId){let stateData=this.getStateData(stateId);return stateData?stateData.turns:0},Game_BattlerBase.prototype.getStateEffect=function(stateId){const total=$gameStateInfo.isTotalStateId(stateId);if(total)return this.getStateEffectTotal(stateId);const stateData=this.getStateData(stateId);return stateData?stateData.effect:0},Game_BattlerBase.prototype.getStateEffectTotal=function(stateId){let stateData=_.filter(this._stateData,state=>state.id==stateId),effect=0;return stateData.length>0?(stateData.forEach(state=>{effect+=state.effect}),effect):effect},Game_BattlerBase.prototype.addNewStateData=function(stateId,turns,effect,passive,battlerId,slotId){let stateData=new Game_States;stateData.setup(stateId,turns,effect,passive,battlerId,slotId),this._stateData.push(stateData),this.sortStates()},Game_BattlerBase.prototype.updateStateData=function(stateId,turns,effect,passive,battlerId,slotId){let stateData=this.getStateData(stateId,battlerId,slotId);stateData&&(stateId==$gameStateInfo.getStateId(StateType.CHARGE)&&(effect+=stateData.effect)>=200&&(effect=200),stateData.setup(stateId,turns,effect,passive,battlerId,slotId),this.sortStates())},Game_BattlerBase.prototype.isDeathStateAffected=function(){return this.isStateAffected(this.deathStateId())},Game_BattlerBase.prototype.deathStateId=function(){return $gameStateInfo.getStateId(StateType.DEATH)},Game_BattlerBase.prototype.resetStateCounts=function(stateId){},Game_BattlerBase.prototype.updateStateTurns=function(){this._stateData.forEach(stateData=>{stateData.updateStateTurns()},this)},Game_BattlerBase.prototype.die=function(){this._hp=0,this.clearStates()},Game_BattlerBase.prototype.revive=function(){0===this._hp&&(this._hp=1)},Game_BattlerBase.prototype.states=function(){return this._stateData.map((function(state){return $dataStates[state.id]}))},Game_BattlerBase.prototype.stateIcons=function(){return this.states().map(state=>state.iconIndex).filter(iconIndex=>iconIndex>0)},Game_BattlerBase.prototype.allIcons=function(){return this.stateIcons()},Game_BattlerBase.prototype.traitObjects=function(){return this.states()},Game_BattlerBase.prototype.allTraits=function(){return this.traitObjects().reduce((function(r,obj){return r.concat(obj.traits)}),[])},Game_BattlerBase.prototype.traits=function(code){return this.allTraits().filter((function(trait){return trait.code===code}))},Game_BattlerBase.prototype.traitsWithId=function(code,id){return this.allTraits().filter((function(trait){return trait.code===code&&trait.dataId===id}))},Game_BattlerBase.prototype.traitsPi=function(code,id){return this.traitsWithId(code,id).reduce((function(r,trait){return r*trait.value}),1)},Game_BattlerBase.prototype.traitsSum=function(code,id){return this.traitsWithId(code,id).reduce((function(r,trait){return r+trait.value}),0)},Game_BattlerBase.prototype.traitsSumAll=function(code){return this.traits(code).reduce((function(r,trait){return r+trait.value}),0)},Game_BattlerBase.prototype.traitsSet=function(code){return this.traits(code).reduce((function(r,trait){return r.concat(trait.dataId)}),[])},Game_BattlerBase.prototype.paramBase=function(paramId){return 0},Game_BattlerBase.prototype.paramPlus=function(paramId){return this._paramPlus[paramId]},Game_BattlerBase.prototype.paramMin=function(paramId){return 1===paramId?0:1},Game_BattlerBase.prototype.paramMax=function(paramId){return 0===paramId?999999:9999},Game_BattlerBase.prototype.paramRate=function(paramId){let value=this.traitsPi(Game_BattlerBase.TRAIT_PARAM,paramId);if(2==paramId){let rate=this.getStateEffect($gameStateInfo.getStateId(StateType.ATK_BUFF_RATE));rate&&(value*=rate)}return value},Game_BattlerBase.prototype.param=function(paramId){let value=this.paramBase(paramId)+this.paramPlus(paramId);value*=this.paramRate(paramId);const maxValue=this.paramMax(paramId),minValue=this.paramMin(paramId);return Math.round(value.clamp(minValue,maxValue))},Game_BattlerBase.prototype.xparam=function(xparamId){return this.traitsSum(Game_BattlerBase.TRAIT_XPARAM,xparamId)},Game_BattlerBase.prototype.sparam=function(sparamId){return this.traitsPi(Game_BattlerBase.TRAIT_SPARAM,sparamId)},Game_BattlerBase.prototype.elementRate=function(elementId){return this.traitsPi(Game_BattlerBase.TRAIT_ELEMENT_RATE,elementId)},Game_BattlerBase.prototype.stateRate=function(stateId){return this.traitsPi(Game_BattlerBase.TRAIT_STATE_RATE,stateId)},Game_BattlerBase.prototype.stateResistSet=function(){return this.traitsSet(Game_BattlerBase.TRAIT_STATE_RESIST)},Game_BattlerBase.prototype.isStateResist=function(stateId){return this.stateResistSet().contains(stateId)},Game_BattlerBase.prototype.attackElements=function(){return this.traitsSet(Game_BattlerBase.TRAIT_ATTACK_ELEMENT)},Game_BattlerBase.prototype.attackStates=function(){return this.traitsSet(Game_BattlerBase.TRAIT_ATTACK_STATE)},Game_BattlerBase.prototype.attackStatesRate=function(stateId){return this.traitsSum(Game_BattlerBase.TRAIT_ATTACK_STATE,stateId)},Game_BattlerBase.prototype.attackSpeed=function(){return this.traitsSumAll(Game_BattlerBase.TRAIT_ATTACK_SPEED)},Game_BattlerBase.prototype.attackTimesAdd=function(){return Math.max(this.traitsSumAll(Game_BattlerBase.TRAIT_ATTACK_TIMES),0)},Game_BattlerBase.prototype.addedSkillTypes=function(){return this.traitsSet(Game_BattlerBase.TRAIT_STYPE_ADD)},Game_BattlerBase.prototype.isSkillTypeSealed=function(stypeId){return this.traitsSet(Game_BattlerBase.TRAIT_STYPE_SEAL).contains(stypeId)},Game_BattlerBase.prototype.addedSkills=function(){return this.traitsSet(Game_BattlerBase.TRAIT_SKILL_ADD)},Game_BattlerBase.prototype.isSkillSealed=function(skillId){const sealskillId=$gameStateInfo.getStateId(StateType.SEAL_SKILL);if(this.isStateAffected(sealskillId)){const stateDataAll=this.getStateDataAll(sealskillId),isSeal=_.find(stateDataAll,stateData=>stateData.effect==skillId);return isSeal}const silentId=$gameStateInfo.getStateId(StateType.SILENT);if(this.isStateAffected(silentId)){const skill=$dataSkills[skillId];if(skill)return this.skillMpCost(skill)>0}return this.traitsSet(Game_BattlerBase.TRAIT_SKILL_SEAL).contains(skillId)},Game_BattlerBase.prototype.isEquipWtypeOk=function(wtypeId){return this.traitsSet(Game_BattlerBase.TRAIT_EQUIP_WTYPE).contains(wtypeId)},Game_BattlerBase.prototype.isEquipAtypeOk=function(atypeId){return this.traitsSet(Game_BattlerBase.TRAIT_EQUIP_ATYPE).contains(atypeId)},Game_BattlerBase.prototype.isEquipTypeLocked=function(etypeId){return this.traitsSet(Game_BattlerBase.TRAIT_EQUIP_LOCK).contains(etypeId)},Game_BattlerBase.prototype.isEquipTypeSealed=function(etypeId){return this.traitsSet(Game_BattlerBase.TRAIT_EQUIP_SEAL).contains(etypeId)},Game_BattlerBase.prototype.slotType=function(){const set=this.traitsSet(Game_BattlerBase.TRAIT_SLOT_TYPE);return set.length>0?Math.max.apply(null,set):0},Game_BattlerBase.prototype.isDualWield=function(){return 1===this.slotType()},Game_BattlerBase.prototype.actionPlusSet=function(){return this.traits(Game_BattlerBase.TRAIT_ACTION_PLUS).map((function(trait){return trait.value}))},Game_BattlerBase.prototype.specialFlag=function(flagId){return this.traits(Game_BattlerBase.TRAIT_SPECIAL_FLAG).some((function(trait){return trait.dataId===flagId}))},Game_BattlerBase.prototype.collapseType=function(){const set=this.traitsSet(Game_BattlerBase.TRAIT_COLLAPSE_TYPE);return set.length>0?Math.max.apply(null,set):0},Game_BattlerBase.prototype.partyAbility=function(abilityId){return this.traits(Game_BattlerBase.TRAIT_PARTY_ABILITY).some((function(trait){return trait.dataId===abilityId}))},Game_BattlerBase.prototype.isAutoBattle=function(){return this.specialFlag(Game_BattlerBase.FLAG_ID_AUTO_BATTLE)},Game_BattlerBase.prototype.isGuard=function(){return this.specialFlag(Game_BattlerBase.FLAG_ID_GUARD)&&this.canMove()},Game_BattlerBase.prototype.isSubstitute=function(){return this.specialFlag(Game_BattlerBase.FLAG_ID_SUBSTITUTE)&&this.canMove()},Game_BattlerBase.prototype.isPreserveTp=function(){return this.specialFlag(Game_BattlerBase.FLAG_ID_PRESERVE_TP)},Game_BattlerBase.prototype.addParam=function(paramId,value){this._paramPlus[paramId]+=value,this.refresh()},Game_BattlerBase.prototype.setHp=function(hp){this._hp=hp,this.refresh()},Game_BattlerBase.prototype.setMp=function(mp){this._mp=mp,this.refresh()},Game_BattlerBase.prototype.setTp=function(tp){this._tp=tp,this.refresh()},Game_BattlerBase.prototype.maxTp=function(){return this.luk},Game_BattlerBase.prototype.refresh=function(){this.stateResistSet().forEach((function(stateId){this.eraseState(stateId)}),this),this._hp=this._hp.clamp(0,this.mhp),this._mp=this._mp.clamp(0,this.mmp),this._tp=this._tp.clamp(0,this.maxTp())},Game_BattlerBase.prototype.recoverAll=function(){this.clearStates(),this._hp=this.mhp,this._mp=this.mmp,this._tp=this.maxTp()},Game_BattlerBase.prototype.hpRate=function(){return this.hp/this.mhp},Game_BattlerBase.prototype.mpRate=function(){return this.mmp>0?this.mp/this.mmp:0},Game_BattlerBase.prototype.tpRate=function(){return this.tp/this.maxTp()},Game_BattlerBase.prototype.hide=function(){this._hidden=!0},Game_BattlerBase.prototype.appear=function(){this._hidden=!1},Game_BattlerBase.prototype.isHidden=function(){return this._hidden},Game_BattlerBase.prototype.isAppeared=function(){return!this.isHidden()},Game_BattlerBase.prototype.isDead=function(){return this.isAppeared()&&this.isDeathStateAffected()},Game_BattlerBase.prototype.isAlive=function(){return this.isAppeared()&&!this.isDeathStateAffected()},Game_BattlerBase.prototype.isUnderHalf=function(current){let hp=this._hp;return current&&(hp=current),this.isAlive()&&hp<this.mhp/2},Game_BattlerBase.prototype.isDying=function(current){let hp=this._hp;return current&&(hp=current),this.isAlive()&&hp<this.mhp/4},Game_BattlerBase.prototype.isRestricted=function(){return this.isAppeared()&&this.restriction()>0},Game_BattlerBase.prototype.canInput=function(){return this.isAppeared()&&!this.isRestricted()&&!this.isAutoBattle()},Game_BattlerBase.prototype.canMove=function(){return this.isAppeared()&&this.restriction()<4},Game_BattlerBase.prototype.isConfused=function(){return this.isAppeared()&&this.restriction()>=1&&this.restriction()<=3},Game_BattlerBase.prototype.confusionLevel=function(){return this.isConfused()?this.restriction():0},Game_BattlerBase.prototype.isActor=function(){return!1},Game_BattlerBase.prototype.isEnemy=function(){return!1},Game_BattlerBase.prototype.sortStates=function(){this._stateData.sort((function(a,b){const p1=$dataStates[a.id].priority,p2=$dataStates[b.id].priority;return p1!==p2?p2-p1:a-b}))},Game_BattlerBase.prototype.restriction=function(){return Math.max.apply(null,this.states().map((function(state){return state.restriction})).concat(0))},Game_BattlerBase.prototype.addNewState=function(stateId){stateId===this.deathStateId()&&this.die();const restricted=this.isRestricted();!restricted&&this.isRestricted()&&this.onRestrict()},Game_BattlerBase.prototype.onRestrict=function(){},Game_BattlerBase.prototype.stateMotionIndex=function(){const states=this.states();return states.length>0?states[0].motion:0},Game_BattlerBase.prototype.stateOverlayIndex=function(){const states=this.states();return states.length>0?states[0].overlay:0},Game_BattlerBase.prototype.stateOverlayIndexList=function(){const states=this.states();let indexList=[];return states.forEach(state=>{0!=state.overlay&&-1==indexList.indexOf(state.overlay)&&indexList.push(state.overlay)}),indexList},Game_BattlerBase.prototype.isSkillWtypeOk=function(skill){return!0},Game_BattlerBase.prototype.skillMpCost=function(skill){return Math.floor(skill.mpCost*this.mcr)},Game_BattlerBase.prototype.skillTpCost=function(skill){return Math.floor(skill.tpCost*this.tcr)},Game_BattlerBase.prototype.canPaySkillCost=function(skill){return(3!=skill.damage.elementId||0!=this.weapons().find(a=>a&&4==a.wtypeId))&&(this._tp>=this.skillTpCost(skill)&&this._mp>=this.skillMpCost(skill))},Game_BattlerBase.prototype.paySkillCost=function(skill){if(3==skill.damage.elementId){const _item=this.weapons().find(a=>a&&4==a.wtypeId);_item&&this.consumeArrow(_item)}this._mp-=this.skillMpCost(skill),this._tp-=this.skillTpCost(skill)},Game_BattlerBase.prototype.isOccasionOk=function(item){return $gameParty.inBattle()?0===item.occasion||1===item.occasion:0===item.occasion||2===item.occasion},Game_BattlerBase.prototype.meetsUsableItemConditions=function(item){return this.canMove()&&this.isOccasionOk(item)},Game_BattlerBase.prototype.meetsSkillConditions=function(skill){return this.meetsUsableItemConditions(skill)&&this.isSkillWtypeOk(skill)&&this.canPaySkillCost(skill)&&!this.isSkillSealed(skill.id)&&!this.isSkillTypeSealed(skill.stypeId)},Game_BattlerBase.prototype.meetsSkillScopeConditions=function(skill){return $gameTroop.aliveMembers().length>0||skill.scope!=ScopeType.ONE_ENEMY&&skill.scope!=ScopeType.ALL_ENEMY},Game_BattlerBase.prototype.meetsItemConditions=function(item){return this.meetsUsableItemConditions(item)&&$gameParty.hasItem(item)},Game_BattlerBase.prototype.canUse=function(item){return!!item&&(DataManager.isSkill(item)?this.meetsSkillConditions(item):!!DataManager.isItem(item)&&this.meetsItemConditions(item))},Game_BattlerBase.prototype.canEquip=function(item){return!!item&&(DataManager.isWeapon(item)?this.canEquipWeapon(item):!!DataManager.isArmor(item)&&this.canEquipArmor(item))},Game_BattlerBase.prototype.canEquipWeapon=function(item){return this.isEquipWtypeOk(item.wtypeId)&&!this.isEquipTypeSealed(item.etypeId)},Game_BattlerBase.prototype.canEquipArmor=function(item){return this.isEquipAtypeOk(item.atypeId)&&!this.isEquipTypeSealed(item.etypeId)},Game_BattlerBase.prototype.attackSkillId=function(){return 1},Game_BattlerBase.prototype.guardSkillId=function(){return 2},Game_BattlerBase.prototype.canAttack=function(){return this.canUse($dataSkills[this.attackSkillId()])},Game_BattlerBase.prototype.canGuard=function(){return this.canUse($dataSkills[this.guardSkillId()])},Game_Battler.prototype=Object.create(Game_BattlerBase.prototype),Game_Battler.prototype.constructor=Game_Battler,Game_Battler.prototype.initialize=function(){Game_BattlerBase.prototype.initialize.call(this)},Game_Battler.prototype.initMembers=function(){Game_BattlerBase.prototype.initMembers.call(this),this._actions=[],this._lastTarget=null,this._animations=[],this._effectType=null,this._selected=!1,this._battleOrder=0,this._turnCount=1,this._elementId=null},Game_Battler.prototype.battlerId=function(){return 1==this.isActor()?this.actorId():-1*this.index()},Game_Battler.prototype.setBattleOrder=function(order){this._battleOrder=order},Game_Battler.prototype.resetBattleOrder=function(){this._battleOrder=0},Game_Battler.prototype.battleOrder=function(){return this._battleOrder},Game_Battler.prototype.stratDashApParam=function(){},Game_Battler.prototype.clearAnimations=function(){this._animations=[]},Game_Battler.prototype.clearWeaponAnimation=function(){},Game_Battler.prototype.clearEffect=function(){this._effectType=null},Game_Battler.prototype.clearMotion=function(){},Game_Battler.prototype.requestEffect=function(effectType){this._effectType=effectType},Game_Battler.prototype.requestMotion=function(){},Game_Battler.prototype.requestMotionRefresh=function(){},Game_Battler.prototype.select=function(){this._selected=!0},Game_Battler.prototype.deselect=function(){this._selected=!1},Game_Battler.prototype.isAnimationRequested=function(){return this._animations.length>0},Game_Battler.prototype.isEffectRequested=function(){return!!this._effectType},Game_Battler.prototype.isMotionRequested=function(){},Game_Battler.prototype.isMotionRefreshRequested=function(){},Game_Battler.prototype.isSelected=function(){return this._selected},Game_Battler.prototype.effectType=function(){return this._effectType},Game_Battler.prototype.motionType=function(){},Game_Battler.prototype.shiftAnimation=function(){return this._animations.shift()},Game_Battler.prototype.startAnimation=function(animationId,mirror,delay,scale){const data={animationId:animationId,mirror:mirror,delay:delay,scale:scale};this._animations.push(data)},Game_Battler.prototype.action=function(index){return this._actions[index]},Game_Battler.prototype.setAction=function(index,action){this._actions[index]=action},Game_Battler.prototype.numActions=function(){return this._actions.length},Game_Battler.prototype.clearActions=function(){this._actions=[]},Game_Battler.prototype.refresh=function(){Game_BattlerBase.prototype.refresh.call(this),0===this.hp?this.addState(this.deathStateId()):this.removeState(this.deathStateId())},Game_Battler.prototype.refreshPassive=function(){const passiveData=this.passiveSkills();if(null==passiveData)return;let popupData=[];return passiveData.forEach(passive=>{let flag=!1;switch(passive.skill.passiveType){case"dying":flag=this.isDying();break;case"hpunderhalf":flag=this.isUnderHalf();break;case"turnCount":flag=1==this._turnCount;break;case"mpover3":flag=this.mp>=3;break;case"losetype1":const loseType=DataManager.getStageInfos($gameParty.stageNo()).loseType;flag=loseType==GameStageLoseType.TROOPMEMBERLOST;break;case"startOnly":if(flag=1==this._turnCount,0==flag)return;break;default:flag=!0}if(flag){const addSkills=this.addPassive(passive.skill,passive.slotId);addSkills.forEach(skill=>{for(const effect of skill.effects)effect.code==Game_Action.EFFECT_ADD_STATE&&popupData.push(new PopupTextData(this,PopupTextType.AddState,TextManager.getStateName(effect.dataId)))})}else{const removeSkills=this.removePassive(passive.skill,passive.slotId);removeSkills.forEach(skill=>{for(const effect of skill.effects)effect.code==Game_Action.EFFECT_ADD_STATE&&popupData.push(new PopupTextData(this,PopupTextType.RemoveState,TextManager.getStateName(effect.dataId)))})}}),popupData},Game_Battler.prototype.clearAllPassiveState=function(){let removeData=[];this._stateData.forEach(state=>{removeData.push({stateId:state.id,slotId:state.slotId})}),removeData.forEach(remove=>{this.removeState(remove.stateId,this.battlerId(),remove.slotId)})},Game_Battler.prototype.addState=function(stateId,turns,effect,passive,battlerId,slotId){this.isStateAddable(stateId)&&(this.isStateAffected(stateId,battlerId,slotId)?(this.updateStateData(stateId,turns,effect,passive,battlerId,slotId),this.refresh()):(this.addNewState(stateId),this.addNewStateData(stateId,turns,effect,passive,battlerId,slotId),this.refresh()),this.resetStateCounts(stateId))},Game_Battler.prototype.isStateAddable=function(stateId){return this.isAlive()&&$dataStates[stateId]&&!this.isStateResist(stateId)&&!this.isStateRestrict(stateId)},Game_Battler.prototype.isStateRestrict=function(stateId){return $dataStates[stateId].removeByRestriction&&this.isRestricted()},Game_Battler.prototype.stateResistSet=function(){let resist=this.traitsSet(Game_BattlerBase.TRAIT_STATE_RESIST);return this.passiveSkills().forEach(passive=>{let resistState,banishState;if(_.find(passive.skill.effects,e=>e.code==Game_Action.EFFECT_ADD_STATE&&e.dataId==$gameStateInfo.getStateId(StateType.RESIST_STATE))){let resists;resist.push(passive.skill.stateEffect),_.filter(passive.skill.effects,e=>e.code==Game_Action.EFFECT_REMOVE_STATE).forEach(r=>{resist.push(r.dataId)})}_.find(passive.skill.effects,e=>e.code==Game_Action.EFFECT_ADD_STATE&&e.dataId==$gameStateInfo.getStateId(StateType.BANISH))&&this.isStateAffected($gameStateInfo.getStateId(StateType.BANISH))&&resist.push(passive.skill.stateEffect)}),resist=_.uniq(resist),resist},Game_Battler.prototype.onRestrict=function(){Game_BattlerBase.prototype.onRestrict.call(this),this.clearActions(),this.states().forEach((function(state){state.removeByRestriction&&this.removeState(state.id)}),this)},Game_Battler.prototype.removeState=function(stateId,battlerId,slotId){this.isStateAffected(stateId,battlerId,slotId)&&(stateId===this.deathStateId()&&this.revive(),stateId==$gameStateInfo.getStateId(StateType.FINITE)&&this.die(),this.eraseState(stateId,slotId),this.refresh())},Game_Battler.prototype.passiveSkills=function(){return[]},Game_Battler.prototype.addPassive=function(skill,slotId){let addStates=[];return skill.effects.forEach(effect=>{if(effect.code==Game_Action.EFFECT_ADD_STATE){this.isStateAffected(effect.dataId,this.battlerId(),slotId)||addStates.push(skill);let effectValue=skill.stateEffect;this._statePlus&&this._statePlus[effect.dataId]&&(effectValue+=this._statePlus[effect.dataId]),this.addState(effect.dataId,skill.stateTurns,effectValue,!0,this.battlerId(),slotId)}}),addStates},Game_Battler.prototype.removePassive=function(skill,slotId){let removeStates=[];return skill.effects.forEach(effect=>{effect.code==Game_Action.EFFECT_ADD_STATE&&(this.isStateAffected(effect.dataId,this.battlerId(),slotId)&&removeStates.push(skill),this.removeState(effect.dataId,this.battlerId(),slotId))}),removeStates},Game_Battler.prototype.escape=function(){$gameParty.inBattle()&&this.hide(),this.clearActions(),this.clearStates(),SoundManager.playEscape()},Game_Battler.prototype.removeBattleStates=function(){this.states().forEach((function(state){state.removeAtBattleEnd&&this.removeState(state.id)}),this)},Game_Battler.prototype.removeStatesAuto=function(timing){let removeState=[];return this._stateData.forEach((function(stateData){const state=$dataStates[stateData.id];stateData.isStateExpired()&&state.autoRemovalTiming===timing&&removeState.push({battler:this,stateId:state.id,battlerId:stateData.battlerId,slotId:stateData.slotId})}),this),removeState.forEach(removeData=>{this.removeState(removeData.stateId,removeData.battlerId,removeData.slotId)}),removeState},Game_Battler.prototype.addStatesAuto=function(removeState){const etherId=$gameStateInfo.getStateId(StateType.ETHER),stunId=$gameStateInfo.getStateId(StateType.STUN);let addState=[];return removeState.forEach(removeData=>{removeData.stateId==etherId&&(this.addState(stunId,2,removeData.battlerId),addState.push({battler:this,stateId:stunId,battlerId:removeData.battlerId,slotId:removeData.slotId}))}),addState},Game_Battler.prototype.removeStatesByDamage=function(){let removeStateIds=[];return this.states().forEach((function(state){state.removeByDamage&&Math.randomInt(100)<state.chanceByDamage&&removeStateIds.push(state.id)}),this),removeStateIds},Game_Battler.prototype.makeActionTimes=function(){return this.actionPlusSet().reduce((function(r,p){return Math.random()<p?r+1:r}),1)},Game_Battler.prototype.makeActions=function(){if(this.clearActions(),this.canMove()){const actionTimes=this.makeActionTimes();this._actions=[];for(let i=0;i<actionTimes;i++)this._actions.push(new Game_Action(this))}else this._actions=[],this._actions.push(new Game_Action(this));return this._actions},Game_Battler.prototype.currentAction=function(){return this._actions[0]},Game_Battler.prototype.removeCurrentAction=function(){this._actions.shift()},Game_Battler.prototype.setLastTarget=function(target){this._lastTarget=target||null},Game_Battler.prototype.forceAction=function(skillId,targetIndex){this.clearActions();let action=new Game_Action(this,!0);return action.setSkill(skillId),-2===targetIndex?action.setTarget(this._lastTarget.index()):-1===targetIndex?action.decideRandomTarget():action.setTarget(targetIndex),action},Game_Battler.prototype.useItem=function(item){DataManager.isSkill(item)?this.paySkillCost(item):DataManager.isItem(item)&&this.consumeItem(item)},Game_Battler.prototype.consumeItem=function(item){$gameParty.consumeItem(item)},Game_Battler.prototype.consumeArrow=function(item){0==$gameParty.numItems(item)&&this.changeEquipById(1,0),$gameParty.consumeArrow(item)},Game_Battler.prototype.gainHp=function(value){this.setHp(this.hp+value)},Game_Battler.prototype.gainMp=function(value){this.setMp(this.mp+value)},Game_Battler.prototype.gainTp=function(value){this.setTp(this.tp+value)},Game_Battler.prototype.gainSilentTp=function(value){this.setTp(this.tp+value)},Game_Battler.prototype.initTp=function(){this.setTp(100)},Game_Battler.prototype.clearTp=function(){this.setTp(0)},Game_Battler.prototype.chargeTpByDamage=function(damageRate){const value=Math.floor(50*damageRate*this.tcr);this.gainSilentTp(value)},Game_Battler.prototype.regenerateHp=function(){},Game_Battler.prototype.maxSlipDamage=function(){return $dataSystem.optSlipDeath?this.hp:Math.max(this.hp-1,0)},Game_Battler.prototype.regenerateMp=function(){const value=Math.floor(this.mmp*this.mrg);0!==value&&this.gainMp(value)},Game_Battler.prototype.regenerateTp=function(){},Game_Battler.prototype.regenerateAll=function(){this.isAlive()&&(this.regenerateHp(),this.regenerateMp(),this.regenerateTp())},Game_Battler.prototype.onAllActionsEnd=function(){this.removeStatesAuto(RemoveStateAutoType.ACT_END)},Game_Battler.prototype.onTurnEnd=function(){this.regenerateAll(),this.updateStateTurns();const removeState=this.removeStatesAuto(RemoveStateAutoType.TURN_END),addState=this.addStatesAuto(removeState);return this._turnCount++,{add:addState,remove:removeState}},Game_Battler.prototype.resetTurnCount=function(){this._turnCount=1},Game_Battler.prototype.onBattleEnd=function(){this.removeBattleStates(),this.clearActions(),this.isPreserveTp()||this.clearTp(),this.appear(),this._battleOrder=-1,this._bindBatllers=[],this.clearParamPlus()},Game_Battler.prototype.onDamage=function(){return this.removeStatesByDamage()},Game_Battler.prototype.setActionState=function(){},Game_Battler.prototype.isUndecided=function(){},Game_Battler.prototype.isInputting=function(){},Game_Battler.prototype.isWaiting=function(){},Game_Battler.prototype.isActing=function(){},Game_Battler.prototype.isChanting=function(){},Game_Battler.prototype.isGuardWaiting=function(){},Game_Battler.prototype.performActionStart=function(action){},Game_Battler.prototype.performAction=function(action){},Game_Battler.prototype.performActionEnd=function(){},Game_Battler.prototype.performDamage=function(){},Game_Battler.prototype.performMiss=function(){SoundManager.playMiss()},Game_Battler.prototype.performRecovery=function(){SoundManager.playRecovery()},Game_Battler.prototype.performEvasion=function(){SoundManager.playEvasion()},Game_Battler.prototype.performMagicEvasion=function(){SoundManager.playMagicEvasion()},Game_Battler.prototype.performCounter=function(){SoundManager.playEvasion()},Game_Battler.prototype.performReflection=function(){SoundManager.playReflection()},Game_Battler.prototype.performSubstitute=function(target){},Game_Battler.prototype.performCollapse=function(){},Game_Battler.prototype.realTgr=function(){let value=this.tgr;const provocation=this.getStateEffect($gameStateInfo.getStateId(StateType.PROVOCATION));0!=provocation&&(value*=provocation);const shadowMethod=this.getStateEffect($gameStateInfo.getStateId(StateType.SHADOW));return 0!=shadowMethod&&(value*=shadowMethod),value},Game_Battler.prototype.initMp=function(){let value=0;return value+=this.getStateEffect($gameStateInfo.getStateId(StateType.BATTLE_MP_BUFF_ADD)),value},Game_Battler.prototype.getSkillLvByCount=function(skillId,count){const nextExp=$gameSkillExp.getData($dataSkills[skillId].nextExp);if(null==nextExp)return 1;let lv=1;if(nextExp)for(let i=1;i<nextExp.length;i++)nextExp[i]<=count&&(lv+=1);return lv},Game_Battler.prototype.getSkillLvTotal=function(skillId){const count=this.getSkillCountTotal(skillId);return this.getSkillLvByCount(skillId,count)},Game_Battler.prototype.getSkillLv=function(skillId){const count=this.getSkillCount(skillId);return this.getSkillLvByCount(skillId,count)},Game_Battler.prototype.getSkillCountTotal=function(id){return this.getSkillCount(id)+this.getSkillSpCount(id)},Game_Battler.prototype.getSkillCount=function(id){let count=0;return 0},Game_Battler.prototype.getSkillSpCount=function(id){let count=0;return 0},Game_Battler.prototype.getSkillExpPercent=function(skillId){return 0},Game_Battler.prototype.getSkillExpPercentTotal=function(skillId){return 0},Game_Battler.prototype.isEnablePasiveSkill=function(skillData){let flag=!1;switch(skillData.skill.passiveType){case"dying":flag=this.isDying();break;case"hpunderhalf":flag=this.isUnderHalf();break;case"turnCount":flag=1==this._turnCount;break;case"mpover3":flag=this.mp>=3;break;case"losetype1":const loseType=DataManager.getStageInfos($gameParty.stageNo()).loseType;flag=loseType==GameStageLoseType.TROOPMEMBERLOST;break;case"startOnly":flag=1==this._turnCount;break;default:flag=!0}return flag},Game_Battler.prototype.isStatusParamUp=function(paramId,current){switch(paramId){case 0:return this.paramPlus(paramId)>0&&current>this.paramBase(paramId)&&this.getStateEffectTotal($gameStateInfo.getStateId(StateType.HP_BUFF_ADD)>0)}},Game_Battler.prototype.isTpMax=function(){return!1},Game_Battler.prototype.isTpMaxed=function(){return null!=this._isTpMaxed&&this._isTpMaxed},Game_Battler.prototype.features=function(){let features=[],resistFlag=!1;const resistId=$gameStateInfo.getStateId(StateType.RESIST_STATE);this._stateData.forEach(stateData=>{if(stateData.turns>0)if(stateData.id==resistId)resistFlag=!0;else if(stateData.id==$gameStateInfo.getStateId(StateType.PHARMACOLOGY)){const phaText=(100*Number(stateData.effect)).toString();features.push(TextManager.getStateMessage1(stateData.id).format(phaText))}else if(stateData.id==$gameStateInfo.getStateId(StateType.ATK_BUFF_RATE)){const buffText=(100*(Number(stateData.effect)-1)).toString();features.push(TextManager.getStateMessage1(stateData.id).format(buffText))}else if(stateData.id==$gameStateInfo.getStateId(StateType.GUARD))features.push(TextManager.getStateMessage1(stateData.id).format(this.def));else if(stateData.id==$gameStateInfo.getStateId(StateType.COUNTER)){const counterText=TextManager.getSkillName(Number(stateData.effect));features.push(TextManager.getStateMessage1(stateData.id).format(counterText))}else stateData.id==$gameStateInfo.getStateId(StateType.DAMAGE_CUT)?1==stateData.passive?features.push(TextManager.getStateMessage2(stateData.id).format(stateData.effect)):features.push(TextManager.getStateMessage1(stateData.id).format(stateData.effect)):stateData.id==$gameStateInfo.getStateId(StateType.IRON_WILL)||(stateData.id==$gameStateInfo.getStateId(StateType.SEAL_SKILL)?features.push(TextManager.getStateMessage1(stateData.id).format(TextManager.getSkillName(stateData.effect))):features.push(TextManager.getStateMessage1(stateData.id).format(stateData.effect)))}),resistFlag&&this.stateResistSet().forEach(resistStateId=>{features.push(TextManager.getStateMessage1(resistId).format(TextManager.getStateName(resistStateId)))});const involvementPlus=$gameParty.involvementPlus(),involemenetId=$gameStateInfo.getStateId(StateType.INVOLVEMENT);this.isActor()&&involvementPlus>0&&!this.isStateAffected(involemenetId)&&features.push(TextManager.getStateMessage1(involemenetId).format(involvementPlus));const ironwillPlus=$gameParty.ironWillPlus(),ironwillId=$gameStateInfo.getStateId(StateType.IRON_WILL);return this.isActor()&&ironwillPlus>0&&features.push(TextManager.getStateMessage1(ironwillId).format(ironwillPlus)),features},Game_Battler.prototype.damageRate=function(){let value=0;const damageRateStateId=$gameStateInfo.getStateId(StateType.DAMAGE_RATE);return this.isStateAffected(damageRateStateId)&&(value+=this.getStateEffect(damageRateStateId)),value},Game_Battler.prototype.getAttackValue=function(weaponSlotId){let value=0,_weapon=null;this.isActor()?(_weapon=this.weapons()[weaponSlotId],_weapon&&(value+=this.weapons()[weaponSlotId].params[2])):value=this.atk;const _roleAtk=this.roleAttackValue(_weapon),_skillAtk=1+.5*_roleAtk/100;return this.atk-value+value*_skillAtk},Game_Battler.prototype.roleAttackValue=function(weapon){if(null==weapon)return 0;switch(weapon.wtypeId){case WeaponType.ONE_HANDED:return this.getStateEffect($gameStateInfo.getStateId(StateType.ONE_HANDED));case WeaponType.BOW:return this.getStateEffect($gameStateInfo.getStateId(StateType.MARKSMAN))}return 0},Game_Battler.prototype.magicShieldValue=function(){return this.getStateEffect($gameStateInfo.getStateId(StateType.MAGIC_RESIST))},Game_Battler.prototype.magicShieldValue=function(){return this.getStateEffect($gameStateInfo.getStateId(StateType.MAGIC_RESIST))},Game_Battler.prototype.elementShieldValue=function(elementId){if(null==elementId)return 0;switch(elementId){case 11:return this.getStateEffect($gameStateInfo.getStateId(StateType.FIRE_RESIST));case 12:return this.getStateEffect($gameStateInfo.getStateId(StateType.ICE_RESIST));case 13:return this.getStateEffect($gameStateInfo.getStateId(StateType.THUNDER_RESIST))}return 0},Game_Actor.prototype=Object.create(Game_Battler.prototype),Game_Actor.prototype.constructor=Game_Actor,Object.defineProperty(Game_Actor.prototype,"level",{get:function(){return this._level},configurable:!0}),Game_Actor.prototype.initialize=function(actorId){Game_Battler.prototype.initialize.call(this),this.setup(actorId)},Game_Actor.prototype.initMembers=function(){Game_Battler.prototype.initMembers.call(this),this._actorId=0,this._name="",this._nickname="",this._classId=0,this._level=0,this._characterName="",this._characterIndex=0,this._faceName="",this._faceIndex=0,this._battlerName="",this._exp={},this._skills=[],this._equips=[],this._actionInputIndex=0,this._lastBattleSkillId=0},Game_Actor.prototype.setup=function(actorId){const actor=$dataActors[actorId];this._actorId=actorId,this._name=actor.name,this._nickname=actor.nickname,this._profile=actor.profile,this._classId=actor.classId,this._level=actor.initialLevel,this.initImages(),this.initExp(),this.initEquips(actor.equips),this.clearParamPlus(),this.recoverAll(),this.initSkills(),this.refreshPassive(),this._statePlus={},this._elementId=actor.elementId,this._positionData=null},Game_Actor.prototype.position=function(){return this._positionData},Game_Actor.prototype.setPosition=function(position){this._positionData=position},Game_Actor.prototype.addStatePlus=function(id,value){null==this._statePlus[id]&&(this._statePlus[id]=0),this._statePlus[id]+=value},Game_Actor.prototype.actorId=function(){return this._actorId},Game_Actor.prototype.actor=function(){return $dataActors[this._actorId]},Game_Actor.prototype.name=function(){return null!=$dataText?TextManager.actorName(this._actorId):this._name},Game_Actor.prototype.setName=function(name){this._name=name},Game_Actor.prototype.nickname=function(){return null!=$dataText?$dataText.actorsNicname[this._actorId]:this._nickname},Game_Actor.prototype.setNickname=function(nickname){this._nickname=nickname},Game_Actor.prototype.profile=function(){return null!=$dataText?$dataText.actorsProfile[this._actorId]:this._profile},Game_Actor.prototype.setProfile=function(profile){this._profile=profile},Game_Actor.prototype.characterName=function(){return this._characterName},Game_Actor.prototype.characterIndex=function(){return this._characterIndex},Game_Actor.prototype.faceName=function(){return this._faceName},Game_Actor.prototype.faceIndex=function(){return this._faceIndex},Game_Actor.prototype.battlerName=function(){return this._battlerName},Game_Actor.prototype.clearStates=function(){Game_Battler.prototype.clearStates.call(this)},Game_Actor.prototype.resetStateCounts=function(stateId){Game_Battler.prototype.resetStateCounts.call(this,stateId)},Game_Actor.prototype.initImages=function(){const actor=this.actor();this._characterName=actor.characterName,this._characterIndex=actor.characterIndex,this._faceName=actor.faceName,this._faceIndex=actor.faceIndex,this._battlerName=actor.battlerName},Game_Actor.prototype.expForLevel=function(level){return 100*(level-1)},Game_Actor.prototype.initExp=function(){this._exp[this._classId]=this.currentLevelExp()},Game_Actor.prototype.currentExp=function(){return this._exp[this._classId]},Game_Actor.prototype.currentLevelExp=function(){return this.expForLevel(this._level)},Game_Actor.prototype.nextLevelExp=function(){return this.expForLevel(this._level+1)},Game_Actor.prototype.nextRequiredExp=function(){return this.nextLevelExp()-this.currentExp()},Game_Actor.prototype.maxLevel=function(){return this.actor().maxLevel},Game_Actor.prototype.isMaxLevel=function(){return this._level>=this.maxLevel()},Game_Actor.prototype.initSkills=function(){Debug.error("init skills"),this._skills=[],this.currentClass().learnings.forEach((function(learning){learning.level<=this._level&&this.learnSkill(learning.skillId,!1)}),this)},Game_Actor.prototype.initEquips=function(equips){const slots=this.equipSlots(),maxSlots=slots.length;this._equips=[];for(let i=0;i<maxSlots;i++)this._equips[i]=new Game_Item;for(let j=0;j<equips.length;j++)j<maxSlots&&this._equips[j].setEquip(1===slots[j],equips[j]);this.releaseUnequippableItems(!0),this.refresh()},Game_Actor.prototype.equipSlots=function(){const slots=[];for(let i=1;i<$dataSystem.equipTypes.length;i++)slots.push(i);slots.length>=2&&this.isDualWield()&&(slots[1]=1);const _bow=this.weapons().find(a=>a&&3==a.wtypeId);return slots.length>=2&&null!=_bow&&(slots[1]=1),slots},Game_Actor.prototype.equips=function(){return this._equips.map((function(item){return item.object()}))},Game_Actor.prototype.weapons=function(){return this.equips().filter((function(item){return item&&DataManager.isWeapon(item)}))},Game_Actor.prototype.armors=function(){return this.equips().filter((function(item){return item&&DataManager.isArmor(item)}))},Game_Actor.prototype.hasWeapon=function(weapon){return this.weapons().contains(weapon)},Game_Actor.prototype.hasArmor=function(armor){return this.armors().contains(armor)},Game_Actor.prototype.isEquipChangeOk=function(slotId){return!this.isEquipTypeLocked(this.equipSlots()[slotId])&&!this.isEquipTypeSealed(this.equipSlots()[slotId])},Game_Actor.prototype.changeEquip=function(slotId,item){!this.tradeItemWithParty(item,this.equips()[slotId])||item&&this.equipSlots()[slotId]!==item.etypeId||(this._equips[slotId].setObject(item),this.refresh())},Game_Actor.prototype.forceChangeEquip=function(slotId,item){this._equips[slotId].setObject(item),this.releaseUnequippableItems(!0),this.refresh()},Game_Actor.prototype.tradeItemWithParty=function(newItem,oldItem){return!(newItem&&!$gameParty.hasItem(newItem))&&($gameParty.gainItem(oldItem,1),$gameParty.loseItem(newItem,1),!0)},Game_Actor.prototype.changeEquipById=function(etypeId,itemId){const slotId=etypeId-1;1===this.equipSlots()[slotId]?this.changeEquip(slotId,$dataWeapons[itemId]):this.changeEquip(slotId,$dataArmors[itemId])},Game_Actor.prototype.isEquipped=function(item){return this.equips().contains(item)},Game_Actor.prototype.discardEquip=function(item){const slotId=this.equips().indexOf(item);slotId>=0&&this._equips[slotId].setObject(null)},Game_Actor.prototype.releaseUnequippableItems=function(forcing){for(;;){const slots=this.equipSlots(),equips=this.equips();let changed=!1;for(let i=0;i<equips.length;i++){const item=equips[i];!item||this.canEquip(item)&&item.etypeId===slots[i]||(forcing||this.tradeItemWithParty(null,item),this._equips[i].setObject(null),changed=!0)}if(!changed)break}},Game_Actor.prototype.clearEquipments=function(){let maxSlots=this.equipSlots().length;for(let i=0;i<maxSlots;i++)this.isEquipChangeOk(i)&&this.changeEquip(i,null)},Game_Actor.prototype.optimizeEquipments=function(){const maxSlots=this.equipSlots().length;this.clearEquipments();for(let i=0;i<maxSlots;i++)this.isEquipChangeOk(i)&&this.changeEquip(i,this.bestEquipItem(i))},Game_Actor.prototype.bestEquipItem=function(slotId){const etypeId=this.equipSlots()[slotId],items=$gameParty.equipItems().filter((function(item){return item.etypeId===etypeId&&this.canEquip(item)}),this);let bestItem=null,bestPerformance=-1e3;for(let i=0;i<items.length;i++){let performance=this.calcEquipItemPerformance(items[i]);performance>bestPerformance&&(bestPerformance=performance,bestItem=items[i])}return bestItem},Game_Actor.prototype.calcEquipItemPerformance=function(item){return item.params.reduce((function(a,b){return a+b}))},Game_Actor.prototype.isSkillWtypeOk=function(skill){const wtypeId1=skill.requiredWtypeId1,wtypeId2=skill.requiredWtypeId2;return!!(0===wtypeId1&&0===wtypeId2||wtypeId1>0&&this.isWtypeEquipped(wtypeId1)||wtypeId2>0&&this.isWtypeEquipped(wtypeId2))},Game_Actor.prototype.isWtypeEquipped=function(wtypeId){return this.weapons().some((function(weapon){return weapon.wtypeId===wtypeId}))},Game_Actor.prototype.refresh=function(){this.releaseUnequippableItems(!1),Game_Battler.prototype.refresh.call(this)},Game_Actor.prototype.isActor=function(){return!0},Game_Actor.prototype.friendsUnit=function(){return $gameParty},Game_Actor.prototype.opponentsUnit=function(){return $gameTroop},Game_Actor.prototype.index=function(){return $gameParty.members().indexOf(this)},Game_Actor.prototype.selectIndex=function(){return $gameParty.allMembers().indexOf(this)},Game_Actor.prototype.isBattleMember=function(){return $gameParty.battleMembers().contains(this)},Game_Actor.prototype.isFormationChangeOk=function(){return!0},Game_Actor.prototype.currentClass=function(){return $dataClasses[this._classId]},Game_Actor.prototype.isClass=function(gameClass){return gameClass&&this._classId===gameClass.id},Game_Actor.prototype.skills=function(){const list=[];for(const id of this._skills.concat(this.addedSkills()))list.includes($dataSkills[id])||list.push($dataSkills[id]);return list},Game_Actor.prototype.usableSkills=function(){return this.skills().filter((function(skill){return this.canUse(skill)}),this)},Game_Actor.prototype.traitObjects=function(){let objects=Game_Battler.prototype.traitObjects.call(this);objects=objects.concat([this.actor(),this.currentClass()]);const equips=this.equips();for(let i=0;i<equips.length;i++){let item=equips[i];item&&objects.push(item)}return objects},Game_Actor.prototype.attackElements=function(){let set=Game_Battler.prototype.attackElements.call(this);return this.hasNoWeapons()&&!set.contains(this.bareHandsElementId())&&set.push(this.bareHandsElementId()),set},Game_Actor.prototype.hasNoWeapons=function(){return 0===this.weapons().length},Game_Actor.prototype.bareHandsElementId=function(){return 1},Game_Actor.prototype.paramMax=function(paramId){return 0===paramId?9999:Game_Battler.prototype.paramMax.call(this,paramId)},Game_Actor.prototype.paramBase=function(paramId){return this.currentClass().params[paramId][this._level]},Game_Actor.prototype.paramPlus=function(paramId){let value=Game_Battler.prototype.paramPlus.call(this,paramId);const equips=this.equips();for(let i=0;i<equips.length;i++){let item=equips[i];item&&(value+=item.params[paramId])}if(0==paramId&&(value+=this.getStateEffectTotal($gameStateInfo.getStateId(StateType.HP_BUFF_ADD)),value-=this.getStateEffectTotal($gameStateInfo.getStateId(StateType.SELFISH))),1==paramId&&(value+=this.getStateEffectTotal($gameStateInfo.getStateId(StateType.MP_BUFF_ADD)),value+=this.getStateEffectTotal($gameStateInfo.getStateId(StateType.MP_BUFF_ADD_SPECIAL))),2==paramId&&(value+=this.getStateEffectTotal($gameStateInfo.getStateId(StateType.ATK_BUFF_ADD)),value+=$gameParty.involvementPlus(),value+=this.getStateEffectTotal($gameStateInfo.getStateId(StateType.SELFISH))),3==paramId&&(value+=this.getStateEffectTotal($gameStateInfo.getStateId(StateType.DEF_BUFF_ADD)),value+=$gameParty.ironWillPlus()),6==paramId){const agiBuffRId=$gameStateInfo.getStateId(StateType.AGI_BUFF_RATE),total=this.getStateEffectTotal(agiBuffRId);total>0&&(value=Math.floor(this.paramBase(paramId)*total),value-=this.paramBase(paramId)),value+=this.getStateEffectTotal($gameStateInfo.getStateId(StateType.AGI_BUFF_ADD));const accelId=$gameStateInfo.getStateId(StateType.ACCEL);if(this.isStateAffected(accelId)){let plusAccel=(this._turnCount-1)*this.getStateEffectTotal(accelId);plusAccel>=10&&(plusAccel=10),value+=plusAccel}}return value},Game_Actor.prototype.attackAnimationId1=function(){if(this.hasNoWeapons())return this.bareHandsAnimationId();{const weapons=this.weapons();return weapons[0]?weapons[0].animationId:0}},Game_Actor.prototype.attackAnimationId2=function(){const weapons=this.weapons();return weapons[1]?weapons[1].animationId:0},Game_Actor.prototype.bareHandsAnimationId=function(){return 1},Game_Actor.prototype.changeExp=function(exp,show){this._exp[this._classId]=Math.max(exp,0);const lastLevel=this._level,lastSkills=this.skills();for(;!this.isMaxLevel()&&this.currentExp()>=this.nextLevelExp();)this.levelUp();for(;this.currentExp()<this.currentLevelExp();)this.levelDown();show&&this._level>lastLevel&&this.displayLevelUp(this.findNewSkills(lastSkills)),this.refresh()},Game_Actor.prototype.levelUp=function(){this._level++},Game_Actor.prototype.levelDown=function(){this._level--},Game_Actor.prototype.findNewSkills=function(lastSkills){const newSkills=this.skills();for(let i=0;i<lastSkills.length;i++){let index=newSkills.indexOf(lastSkills[i]);index>=0&&newSkills.splice(index,1)}return newSkills},Game_Actor.prototype.displayLevelUp=function(newSkills){const text=TextManager.levelUp.format(this._name,TextManager.level,this._level);$gameMessage.newPage(),$gameMessage.add(text),newSkills.forEach((function(skill){$gameMessage.add(TextManager.obtainSkill.format(skill.name))}))},Game_Actor.prototype.gainExp=function(exp){const newExp=this.currentExp()+Math.round(exp*this.finalExpRate());this.changeExp(newExp,this.shouldDisplayLevelUp())},Game_Actor.prototype.finalExpRate=function(){return this.exr*(this.isBattleMember()?1:this.benchMembersExpRate())},Game_Actor.prototype.benchMembersExpRate=function(){return $dataSystem.optExtraExp?1:0},Game_Actor.prototype.shouldDisplayLevelUp=function(){return!1},Game_Actor.prototype.changeLevel=function(level,show){level=level.clamp(1,this.maxLevel()),this.changeExp(this.expForLevel(level),show)},Game_Actor.prototype.learnSkill=function(skillId,isParty=!0){this.isLearnedSkill(skillId)||(isParty&&$gameParty.addLearnSkill(skillId),this._skills.push(skillId),this._skills.sort((function(a,b){return a-b})))},Game_Actor.prototype.forgetSkill=function(skillId){const index=this._skills.indexOf(skillId);index>=0&&this._skills.splice(index,1)},Game_Actor.prototype.isLearnedSkill=function(skillId){return this._skills.contains(skillId)},Game_Actor.prototype.hasSkill=function(skillId){return this.skills().contains($dataSkills[skillId])},Game_Actor.prototype.changeClass=function(classId,keepExp){keepExp&&(this._exp[classId]=this.currentExp()),this._classId=classId,this.changeExp(this._exp[this._classId]||0,!1),this.refresh()},Game_Actor.prototype.setCharacterImage=function(characterName,characterIndex){this._characterName=characterName,this._characterIndex=characterIndex},Game_Actor.prototype.setFaceImage=function(faceName,faceIndex){this._faceName=faceName,this._faceIndex=faceIndex},Game_Actor.prototype.setBattlerImage=function(battlerName){this._battlerName=battlerName},Game_Actor.prototype.isSpriteVisible=function(){return!0},Game_Actor.prototype.startAnimation=function(animationId,mirror,delay,scale){mirror=!mirror,Game_Battler.prototype.startAnimation.call(this,animationId,mirror,delay,scale)},Game_Actor.prototype.performActionStart=function(action){Game_Battler.prototype.performActionStart.call(this,action)},Game_Actor.prototype.performAction=function(action){},Game_Actor.prototype.performActionEnd=function(){Game_Battler.prototype.performActionEnd.call(this)},Game_Actor.prototype.performAttack=function(){},Game_Actor.prototype.performDamage=function(){Game_Battler.prototype.performDamage.call(this),SoundManager.playActorDamage(),$gameScreen.startShake(5,5,10),SoundManager.playActorDamage()},Game_Actor.prototype.performEvasion=function(){Game_Battler.prototype.performEvasion.call(this)},Game_Actor.prototype.performMagicEvasion=function(){Game_Battler.prototype.performMagicEvasion.call(this)},Game_Actor.prototype.performCounter=function(){Game_Battler.prototype.performCounter.call(this),this.performAttack()},Game_Actor.prototype.performCollapse=function(){Game_Battler.prototype.performCollapse.call(this),$gameParty.inBattle()&&SoundManager.playActorCollapse()},Game_Actor.prototype.performVictory=function(){},Game_Actor.prototype.performEscape=function(){},Game_Actor.prototype.makeActionList=function(){let list=[],action=new Game_Action(this);return action.setAttack(),list.push(action),this.usableSkills().forEach((function(skill){action=new Game_Action(this),action.setSkill(skill.id),list.push(action)}),this),list},Game_Actor.prototype.makeAutoBattleActions=function(){for(let i=0;i<this.numActions();i++){let list=this.makeActionList(),maxValue=Number.MIN_VALUE;for(let j=0;j<list.length;j++){let value=list[j].evaluate();value>maxValue&&(maxValue=value,this.setAction(i,list[j]))}}},Game_Actor.prototype.makeConfusionActions=function(){for(let i=0;i<this.numActions();i++)this.action(i).setConfusion()},Game_Actor.prototype.updateStateSteps=function(state){},Game_Actor.prototype.clearActions=function(){Game_Battler.prototype.clearActions.call(this),this._actionInputIndex=0},Game_Actor.prototype.currentAction=function(){return this.action(this._actionInputIndex)},Game_Actor.prototype.selectNextCommand=function(){return this._actionInputIndex<this.numActions()-1&&(this._actionInputIndex++,!0)},Game_Actor.prototype.selectPreviousCommand=function(){return this._actionInputIndex>0&&(this._actionInputIndex--,!0)},Game_Actor.prototype.lastBattleSkillId=function(){return this._lastBattleSkillId},Game_Actor.prototype.setLastBattleSkillId=function(skillId){this._lastBattleSkillId=skillId},Game_Actor.prototype.testEscape=function(item){return item.effects.some((function(effect,index,ar){return effect&&effect.code===Game_Action.EFFECT_SPECIAL}))},Game_Actor.prototype.meetsUsableItemConditions=function(item){return(!$gameParty.inBattle()||!this.testEscape(item))&&Game_BattlerBase.prototype.meetsUsableItemConditions.call(this,item)},Game_Actor.prototype.otherSkillIds=function(){let list=[];return this._skills.forEach(skillId=>{let skill;$dataSkills[skillId].stypeId==Game_BattlerBase.SKILL_TYPE_SPECIAL&&list.push(skillId)}),list.push($gameDefine.waitSkillId),list.push($gameDefine.noActionSkillId),list},Game_Actor.prototype.passiveSkills=function(){let skills=[];return this.skills().forEach(skill=>{skill.stypeId==Game_BattlerBase.SKILL_TYPE_PASSIVE&&skills.push({skill:skill,slotId:-1})}),skills},Game_Actor.prototype.getReserveSkillData=function(elementId){if(6==elementId)return _.filter($gameParty._learnedSkills,s=>0!=s&&$dataSkills[s].damage.elementId==elementId);const list=_.filter($gameParty._learnedSkills,s=>!(0==s||$dataSkills[s].damage.elementId!=elementId||!$gameSwitches.value(elementId+$gameDefine.magicElementSwitchId))&&($dataSkills[s].stypeId!=Game_BattlerBase.SKILL_TYPE_PASSIVE_SELF&&($dataSkills[s].stypeId==Game_BattlerBase.SKILL_TYPE_SELF||$dataSkills[s].stypeId!=Game_BattlerBase.SKILL_TYPE_SPECIAL)));return list},Game_Actor.prototype.animationFiles=function(){let animations=[],sounds=[];return animations=_.uniq(animations),{animations:animations,sounds:sounds}},Game_Actor.prototype.getSkillData=function(skillId,slotLv){const nextLevel=$dataSkills[skillId].nextLevel;if(nextLevel&&nextLevel.length>0){let level=0;return nextLevel.forEach(lv=>{slotLv>lv&&(level+=1)}),$dataSkills[skillId+level]}return skillId>0?$dataSkills[skillId]:null},Game_Actor.prototype.shieldValue=function(){let value=0;const guardValue=this.getStateEffectTotal($gameStateInfo.getStateId(StateType.GUARD));if(guardValue>0){const _shield=this.armors().find(a=>a&&2==a.etypeId);if(_shield){const effectValue=this.getStateEffectTotal($gameStateInfo.getStateId(StateType.SHIELD));value=45+.2*_shield.params[2]*(1+1.5*effectValue/100)}}return value},Game_Enemy.prototype=Object.create(Game_Battler.prototype),Game_Enemy.prototype.constructor=Game_Enemy,Game_Enemy.prototype.initialize=function(enemyId,x,y,enemyLevel){Game_Battler.prototype.initialize.call(this),this.setup(enemyId,x,y,enemyLevel)},Game_Enemy.prototype.initMembers=function(){Game_Battler.prototype.initMembers.call(this),this._enemyId=0,this._letter="",this._plural=!1,this._screenX=0,this._screenY=0,this._actionList=[],this._summonedIndex=0},Game_Enemy.prototype.setup=function(enemyId,x,y,enemylevel){void 0===enemylevel&&(enemylevel=1),this._enemyId=enemyId,this._screenX=x,this._screenY=y,this._enemylevel=enemylevel;const data=$dataEnemies[enemyId];if(this._level=enemylevel,this._madness=!1,this.clearParamPlus(),this._enemyId<100){const hp=data.params[0]-this.applyVariance(data.params[0],10),atk=data.params[2]-this.applyVariance(data.params[2],10),agi=data.params[6]-this.applyVariance(data.params[6],10);this._paramPlus[0]=hp,this._paramPlus[2]=atk,this._paramPlus[6]=agi,this._paramPlus[0]+=Math.floor(.05*(enemylevel-1)*data.params[0]),this._paramPlus[2]+=Math.floor(enemylevel/4),this._paramPlus[6]+=Math.floor(enemylevel/2),enemylevel>=4&&(this._paramPlus[0]+=Math.floor(enemylevel/4),this._paramPlus[2]+=Math.floor(enemylevel/10),this._paramPlus[6]+=Math.floor(enemylevel/5))}this.recoverAll(),this.enemy().actions.forEach(action=>{action.conditionType==ActionConditionType.PartyLv?enemylevel>=action.conditionParam1&&this._actionList.push(action):this._actionList.push(action)})},Game_Enemy.prototype.applyVariance=function(value,variance){const amp=Math.floor(Math.max(Math.abs(value)*variance/100,0)),v=Math.randomInt(amp+1)+Math.randomInt(amp+1)-amp;return value>=0?value+v:value-v},Game_Enemy.prototype.paramPlus=function(paramId){let value=Game_Battler.prototype.paramPlus.call(this,paramId);if(0==paramId&&(value+=this.getStateEffectTotal($gameStateInfo.getStateId(StateType.HP_BUFF_ADD)),value-=this.getStateEffectTotal($gameStateInfo.getStateId(StateType.SELFISH))),1==paramId&&(value+=this.getStateEffectTotal($gameStateInfo.getStateId(StateType.MP_BUFF_ADD))),2==paramId&&(value+=this.getStateEffectTotal($gameStateInfo.getStateId(StateType.ATK_BUFF_ADD)),value+=this.getStateEffectTotal($gameStateInfo.getStateId(StateType.SELFISH))),3==paramId&&(value+=this.getStateEffectTotal($gameStateInfo.getStateId(StateType.DEF_BUFF_ADD))),6==paramId){const agiBuffRId=$gameStateInfo.getStateId(StateType.AGI_BUFF_RATE),total=this.getStateEffectTotal(agiBuffRId);total>0&&(value=Math.floor(this.paramBase(paramId)*total),value-=this.paramBase(paramId)),value+=this.getStateEffectTotal($gameStateInfo.getStateId(StateType.AGI_BUFF_ADD))}return value},Game_Enemy.prototype.level=function(){return this._level},Game_Enemy.prototype.isEnemy=function(){return!0},Game_Enemy.prototype.friendsUnit=function(){return $gameTroop},Game_Enemy.prototype.opponentsUnit=function(){return $gameParty},Game_Enemy.prototype.index=function(){return $gameTroop.members().indexOf(this)},Game_Enemy.prototype.isBattleMember=function(){return this.index()>=0},Game_Enemy.prototype.enemyId=function(){return this._enemyId},Game_Enemy.prototype.enemy=function(){return $dataEnemies[this._enemyId]},Game_Enemy.prototype.traitObjects=function(){return Game_Battler.prototype.traitObjects.call(this).concat(this.enemy())},Game_Enemy.prototype.paramBase=function(paramId){return this.enemy().params[paramId]},Game_Enemy.prototype.passiveSkills=function(){let list=[];return this._actionList.forEach((action,index)=>{let skill=$dataSkills[action.skillId];skill&&(skill.stypeId!=Game_BattlerBase.SKILL_TYPE_PASSIVE_SELF&&skill.stypeId!=Game_BattlerBase.SKILL_TYPE_PASSIVE||list.push({skill:skill,slotId:index}))}),list},Game_Enemy.prototype.exp=function(){return this.enemy().exp},Game_Enemy.prototype.gold=function(){return this.enemy().gold},Game_Enemy.prototype.makeDropItems=function(){return this.enemy().dropItems.reduce(function(r,di){return di.kind>0&&Math.random()*di.denominator<this.dropItemRate()?r.concat(this.itemObject(di.kind,di.dataId)):r}.bind(this),[])},Game_Enemy.prototype.dropItemRate=function(){return $gameParty.hasDropItemDouble()?2:1},Game_Enemy.prototype.itemObject=function(kind,dataId){return 1===kind?$dataItems[dataId]:2===kind?$dataWeapons[dataId]:3===kind?$dataArmors[dataId]:null},Game_Enemy.prototype.isSpriteVisible=function(){return!0},Game_Enemy.prototype.screenX=function(){return this._screenX},Game_Enemy.prototype.screenY=function(){return this._screenY},Game_Enemy.prototype.battlerName=function(){return this.enemy().battlerName},Game_Enemy.prototype.battlerHue=function(){return this.enemy().battlerHue},Game_Enemy.prototype.originalName=function(){return this.enemy().name},Game_Enemy.prototype.name=function(){return null!=$dataText?TextManager.getEnemyName(this._enemyId)+(this._plural?this._letter:""):this.originalName()+(this._plural?this._letter:"")},Game_Enemy.prototype.isLetterEmpty=function(){return""===this._letter},Game_Enemy.prototype.setLetter=function(letter){this._letter=letter},Game_Enemy.prototype.setPlural=function(plural){this._plural=plural},Game_Enemy.prototype.performActionStart=function(action){Game_Battler.prototype.performActionStart.call(this,action),this.requestEffect("whiten")},Game_Enemy.prototype.performAction=function(action){Game_Battler.prototype.performAction.call(this,action)},Game_Enemy.prototype.performActionEnd=function(){Game_Battler.prototype.performActionEnd.call(this)},Game_Enemy.prototype.performDamage=function(){Game_Battler.prototype.performDamage.call(this),SoundManager.playEnemyDamage(),this.requestEffect("blink")},Game_Enemy.prototype.performCollapse=function(){switch(Game_Battler.prototype.performCollapse.call(this),this.collapseType()){case 0:$gameTroop.troopId()>$gameDefine.bossTroopId&&0==$gameTroop.aliveMembers().length?this.requestEffect("bossCollapse"):(this.requestEffect("collapse"),SoundManager.playEnemyCollapse());break;case 1:this.requestEffect("bossCollapse");break;case 2:this.requestEffect("instantCollapse")}},Game_Enemy.prototype.transform=function(enemyId){const name=this.originalName();this._enemyId=enemyId,this.originalName()!==name&&(this._letter="",this._plural=!1),this.refresh(),this.numActions()>0&&this.makeActions()},Game_Enemy.prototype.meetsCondition=function(action){const param1=action.conditionParam1,param2=action.conditionParam2;switch(action.conditionType){case 1:return this.meetsTurnCondition(param1,param2);case 2:return this.meetsHpCondition(param1,param2,action);case 3:return this.meetsMpCondition(param1,param2);case 4:return this.meetsStateCondition(param1);case 5:return this.meetsPartyLevelCondition(param1);case 6:return this.meetsSwitchCondition(param1,action);default:return!0}},Game_Enemy.prototype.meetsTurnCondition=function(param1,param2){let n=this._turnCount;return 0===param2?n===param1:n>0&&n>=param1&&n%param2==param1%param2},Game_Enemy.prototype.meetsHpCondition=function(param1,param2,action){const skill=$dataSkills[action.skillId],isHeal=[3,4].contains(skill.damage.type);return isHeal?_.find($gameTroop.aliveMembers(),enemy=>enemy.hpRate()>=param1&&enemy.hpRate()<=param2):this.hpRate()>=param1&&this.hpRate()<=param2},Game_Enemy.prototype.meetsMpCondition=function(param1,param2){return this.mpRate()>=param1&&this.mpRate()<=param2},Game_Enemy.prototype.meetsStateCondition=function(param){return this.isStateAffected(param)},Game_Enemy.prototype.meetsPartyLevelCondition=function(param){return $gameParty.highestLevel()>=param},Game_Enemy.prototype.meetsSwitchCondition=function(param,action){if(param==$gameDefine.onlyOneConditionSwitchId)return 1==$gameTroop.aliveMembers().length;if(param==$gameDefine.notOnlyOneConditionSwitchId)return 1!=$gameTroop.aliveMembers().length;if(param==$gameDefine.containsDieBattlerConditionSwitchId)return $gameTroop.deadMembers().length>1;if(param==$gameDefine.summonSwitchId)return $gameTroop.aliveMembers().length<5;if(param==$gameDefine.eventBattleSwitchId1)return 1==$gameEventBattle.eventIndex();if(param==$gameDefine.eventBattleSwitchId2)return 2==$gameEventBattle.eventIndex();if(param==$gameDefine.eventBattleSwitchId3)return 3==$gameEventBattle.eventIndex();if(param==$gameDefine.eventBattleSwitchId4)return 4==$gameEventBattle.eventIndex();if(param==$gameDefine.anyOneSameStateIdSwitchId){let isSame=!0;const filterStates=_.filter($dataSkills[action.skillId].effects,e=>e.code==Game_Action.EFFECT_ADD_STATE);return filterStates.forEach(condition=>{this.opponentsUnit().aliveMembers().forEach(battler=>{battler.isStateAffected(condition.dataId)&&(isSame=!1)})}),isSame}if(param==$gameDefine.flozenStateIdSwitchId){let flozen=!1;const flozenStateId=$gameStateInfo.getStateId(StateType.FROZEN);return this.opponentsUnit().aliveMembers().forEach(battler=>{battler.isStateAffected(flozenStateId)&&(flozen=!0)}),flozen}return $gameSwitches.value(param)},Game_Enemy.prototype.isActionValid=function(action){return this.meetsCondition(action)&&this.canUse($dataSkills[action.skillId])&&this.meetsConditionPlus($dataSkills[action.skillId])&&this.meetsConditionMix(action)},Game_Enemy.prototype.selectAction=function(actionList,ratingZero){let sum=actionList.reduce((function(r,a){return r+a.rating-ratingZero}),0);if(!(sum>0))return null;{let value=Math.randomInt(sum);for(let i=0;i<actionList.length;i++){let action=actionList[i];if(value-=action.rating-ratingZero,value<0)return action}}},Game_Enemy.prototype.selectAllActions=function(actionList){const ratingMax=Math.max.apply(null,actionList.map((function(a){return a.rating}))),ratingZero=ratingMax-3;actionList=actionList.filter((function(a){return a.rating>ratingZero}));for(let i=0;i<this.numActions();i++)this.action(i).setEnemyAction(this.selectAction(actionList,ratingZero))},Game_Enemy.prototype.setAction=function(action){let actionList=this._actionList.filter((function(a){return this.isActionValid(a)}),this);if(action){const ratingMax=Math.max.apply(null,actionList.map((function(a){return a.rating}))),ratingZero=ratingMax-3;actionList=actionList.filter((function(a){return a.rating>ratingZero}));let select=this.selectAction(actionList,ratingZero);this.setBattleAction($dataSkills[select.skillId])}},Game_Enemy.prototype.changeActions=function(id){let actionData;this.clearActions(),this._actionList=[],$dataEnemies[id].actions.forEach(element=>{this._actionList.push(element)})},Game_Enemy.prototype.attackId=function(){return this.enemy().attackId},Game_Enemy.prototype.attackElements=function(){let set;return Game_Battler.prototype.attackElements.call(this)},Game_Enemy.prototype.setSummonedIndex=function(index){this._summonedIndex=index},Game_Enemy.prototype.battlerId=function(){return 0!=this._summonedIndex?this._summonedIndex:-1*this.index()},Game_Enemy.prototype.shieldValue=function(){let value=0;const guardValue=this.getStateEffectTotal($gameStateInfo.getStateId(StateType.GUARD));if(guardValue>0){const _shield=this.armors().find(a=>a&&2==a.etypeId);if(_shield){const effectValue=this.getStateEffectTotal($gameStateInfo.getStateId(StateType.SHIELD));value=45+.2*this.def*(1+1.5*effectValue/100)}}return value},Game_Actors.prototype.initialize=function(){this._data=[]},Game_Actors.prototype.actor=function(actorId){return $dataActors[actorId]?(this._data[actorId]||(this._data[actorId]=new Game_Actor(actorId)),this._data[actorId]):null},Game_Enemy.prototype.meetsConditionPlus=function(skill){if(4==skill.damage.type){let isFull;if(_.every($gameTroop.aliveMembers(),(function(enemy){return enemy.mp==enemy.mmp})))return!1}const item=skill.effects,state=_.find(item,a=>a.code==Game_Action.EFFECT_ADD_STATE);let isStateFull;if(state&&skill.scope==ScopeType.ONE_ENEMY&&(isStateFull=_.every(this.opponentsUnit().aliveMembers(),(function(enemy){return enemy.isStateAffected(state.dataId)})),isStateFull))return!1;if(state&&skill.scope==ScopeType.ALL_ENEMY&&(isStateFull=_.every(this.opponentsUnit().aliveMembers(),(function(enemy){return enemy.isStateAffected(state.dataId)})),isStateFull))return!1;if(state&&skill.scope==ScopeType.ONE_PARTY&&(isStateFull=_.every(this.friendsUnit().aliveMembers(),(function(enemy){return enemy.isStateAffected(state.dataId)})),isStateFull))return!1;if(state&&skill.scope==ScopeType.ALL_PARTY&&(isStateFull=_.every(this.friendsUnit().aliveMembers(),(function(enemy){return enemy.isStateAffected(state.dataId)})),isStateFull))return!1;if(state&&skill.scope==ScopeType.SELF){const total=$gameStateInfo.isTotalStateId(state.dataId);if(this.isStateAffected(state.dataId)&&!total)return!1}const remove=_.filter(item,a=>a.code==Game_Action.EFFECT_REMOVE_STATE);if(remove.length>0){let isRemoval=!1;return remove.forEach(rem=>{let unit;unit=skill.scope==ScopeType.ONE_DEADPARTY||skill.scope==ScopeType.ALL_DEADPARTY?this.friendsUnit().deadMembers():this.opponentsUnit().aliveMembers(),unit.forEach(enemy=>{if(enemy.isStateAffected(rem.dataId)){let stateList=enemy.getStateDataAll(rem.dataId),isAllPassive=!0;stateList.forEach(state=>{state.passive||(isAllPassive=!1)}),0==isAllPassive&&(isRemoval=!0)}})}),isRemoval}let isMpDamageState;return!_.find(item,a=>a.code==Game_Action.EFFECT_ADD_STATE&&a.dataId==$gameStateInfo.getStateId(StateType.MP_DAMAGE))||_.find(this.opponentsUnit().aliveMembers(),enemy=>enemy.mp>0)},Game_Enemy.prototype.meetsConditionMix=function(action){let sameActions=_.filter(this._actionList,a=>a.skillId==action.skillId);if(sameActions.length<=1)return!0;let meet=!0;return sameActions.forEach(a=>{this.meetsCondition(a)||(meet=!1)}),meet},Game_Enemy.prototype.isBoss=function(){return 1==this.collapseType()},Game_Enemy.prototype.animationFiles=function(){let animations=[],sounds=[];return this.enemy().actions.forEach(action=>{let animId=$dataSkills[action.skillId].animationId;if(-1==animId&&(animId=this.enemy().params[4]),0==animId)return;let animation=$dataAnimations[animId];animation.timings.forEach(timing=>{sounds.push(timing.se)}),animation.animation1Name&&animations.push(animation.animation1Name),animation.animation2Name&&animations.push(animation.animation2Name)}),animations=_.uniq(animations),{animations:animations,sounds:sounds}},Game_Enemy.prototype.setMadness=function(isMadness){this._madness=isMadness},Game_Enemy.prototype.madness=function(){return this._madness};const ActionConditionType={Always:0,TurnCount:1,HPRate:2,MPRate:3,State:4,PartyLv:5,Switch:6};function Game_Unit(){this.initialize(...arguments)}function Game_Party(){this.initialize(...arguments)}function Game_Troop(){this.initialize(...arguments)}function Game_States(){this.initialize.apply(this,arguments)}function Game_Interpreter(){this.initialize(...arguments)}Game_Unit.prototype.initialize=function(){this._inBattle=!1},Game_Unit.prototype.inBattle=function(){return this._inBattle},Game_Unit.prototype.members=function(){return[]},Game_Unit.prototype.aliveMembers=function(){return this.members().filter((function(member){return member.isAlive()}))},Game_Unit.prototype.deadMembers=function(){return this.members().filter((function(member){return member.isDead()}))},Game_Unit.prototype.movableMembers=function(){return this.members().filter((function(member){return member.canMove()}))},Game_Unit.prototype.clearActions=function(){return this.members().forEach((function(member){return member.clearActions()}))},Game_Unit.prototype.agility=function(){var members=this.members(),sum;return 0===members.length?1:members.reduce((function(r,member){return r+member.agi}),0)/members.length},Game_Unit.prototype.tgrSum=function(){return this.aliveMembers().reduce((function(r,member){return r+member.realTgr()}),0)},Game_Unit.prototype.randomTarget=function(){var tgrRand=Math.random()*this.tgrSum(),target=null;return this.aliveMembers().forEach((function(member){(tgrRand-=member.realTgr())<=0&&!target&&(target=member)})),target},Game_Unit.prototype.randomHpTarget=function(){let target;return _.sortBy(this.aliveMembers(),member=>member.hp)[0]},Game_Unit.prototype.randomMpTarget=function(){let target;return _.sortBy(this.aliveMembers(),member=>member.mp/member.mmp)[0]},Game_Unit.prototype.randomMpDamageTarget=function(){let target;return _.sortBy(this.aliveMembers(),member=>-member.mp)[0]},Game_Unit.prototype.randomDeadTarget=function(){var members=this.deadMembers();return 0===members.length?null:members[Math.floor(Math.random()*members.length)]},Game_Unit.prototype.smoothTarget=function(index){index<0&&(index=0);var member=this.members()[index];return member&&member.isAlive()?member:this.aliveMembers()[0]},Game_Unit.prototype.smoothDeadTarget=function(index){index<0&&(index=0);var member=this.members()[index];return member&&member.isDead()?member:this.deadMembers()[0]},Game_Unit.prototype.onBattleStart=function(){this.members().forEach((function(member){member.onBattleStart()})),this._inBattle=!0},Game_Unit.prototype.onBattleEnd=function(){this._inBattle=!1,this.members().forEach((function(member){member.onBattleEnd()}))},Game_Unit.prototype.makeActions=function(){this.members().forEach((function(member){member.makeActions()}))},Game_Unit.prototype.select=function(activeMember){this.members().forEach((function(member){member===activeMember?member.select():member.deselect()}))},Game_Unit.prototype.isAllDead=function(){return 0===this.aliveMembers().length},Game_Unit.prototype.getAutoTargetIndex=function(){return _.sortBy(this.aliveMembers(),target=>target.hp)[0].index()},Game_Party.prototype=Object.create(Game_Unit.prototype),Game_Party.prototype.constructor=Game_Party,Game_Party.ABILITY_ENCOUNTER_HALF=0,Game_Party.ABILITY_ENCOUNTER_NONE=1,Game_Party.ABILITY_CANCEL_SURPRISE=2,Game_Party.ABILITY_RAISE_PREEMPTIVE=3,Game_Party.ABILITY_GOLD_DOUBLE=4,Game_Party.ABILITY_DROP_ITEM_DOUBLE=5,Game_Party.prototype.initialize=function(){Game_Unit.prototype.initialize.call(this),this._gold=0,this._steps=0,this._menuActorId=0,this._actors=[],this.initAllItems(),this._learnedSkills=[],this._newSkillIdList=[],this._enemyInfoData=[],this._readTipsId=[],this._readTutorialKey=[],this._newStageIdList=[],this._helpKeyData=[],this._stageData=new Game_Stage,this.getHelpKeyData()},Game_Party.prototype.getHelpKeyData=function(){return null==this._helpKeyData&&(this._helpKeyData=[],$gameHelp.refresh()),this._helpKeyData},Game_Party.prototype.openHelpKeyData=function(key){let helpkeyData;this.getHelpKeyData().push({key:key,isOpen:!0,isRead:!1})},Game_Party.prototype.readHelpKeyData=function(key){let helpkeyData=this.getHelpKeyData(),helpData=_.find(helpkeyData,help=>help.key==key);helpData&&(helpData.isRead=!0)},Game_Party.prototype.clearReadTips=function(){this._readTipsId=[]},Game_Party.prototype.gainReadTips=function(tipsId){this._readTipsId.push(tipsId)},Game_Party.prototype.checkReadTips=function(tipsId){return this._readTipsId||(this._readTipsId=[]),_.contains(this._readTipsId,tipsId)},Game_Party.prototype.gainReadTutorial=function(key){this._readTutorialKey||(this._readTutorialKey=[]),this._readTutorialKey.push(key)},Game_Party.prototype.checkReadTutorial=function(key){return this._readTutorialKey||(this._readTutorialKey=[]),_.contains(this._readTutorialKey,key)},Game_Party.prototype.enemyInfoData=function(){return this._enemyInfoData},Game_Party.prototype.addEnemyInfoData=function(enemyId){_.find(this._enemyInfoData,eId=>eId==enemyId)||this._enemyInfoData.push(enemyId)},Game_Party.prototype.initAllItems=function(){this._items={},this._weapons={},this._armors={}},Game_Party.prototype.exists=function(){return this._actors.length>0},Game_Party.prototype.size=function(){return this.members().length},Game_Party.prototype.isEmpty=function(){return 0===this.size()},Game_Party.prototype.members=function(){return this.inBattle()?this.battleMembers():this.allMembers()},Game_Party.prototype.allMembers=function(){return this._actors.map((function(id){return $gameActors.actor(id)}))},Game_Party.prototype.battleMembers=function(){return this.allMembers().slice(0,this.maxBattleMembers()).filter((function(actor){return actor.isAppeared()}))},Game_Party.prototype.maxBattleMembers=function(){return 3},Game_Party.prototype.leader=function(){return this.battleMembers()[0]},Game_Party.prototype.reviveBattleMembers=function(){this.battleMembers().forEach((function(actor){actor.isDead()&&actor.setHp(1)}))},Game_Party.prototype.items=function(){var list=[];for(var id in this._items)list.push($dataItems[id]);return list},Game_Party.prototype.weapons=function(){return Object.keys(this._weapons).map(id=>$dataWeapons[id])},Game_Party.prototype.armors=function(){var list=[];for(var id in this._armors)list.push($dataArmors[id]);return list},Game_Party.prototype.equipItems=function(){return this.weapons().concat(this.armors())},Game_Party.prototype.allItems=function(){return this.items().concat(this.equipItems())},Game_Party.prototype.itemContainer=function(item){return item?DataManager.isItem(item)?this._items:DataManager.isWeapon(item)?this._weapons:DataManager.isArmor(item)?this._armors:null:null},Game_Party.prototype.setupStartingMembers=function(){this._actors=[],$dataSystem.partyMembers.forEach((function(actorId){$gameActors.actor(actorId)&&this._actors.push(actorId)}),this)},Game_Party.prototype.name=function(){var numBattleMembers=this.battleMembers().length;return 0===numBattleMembers?"":1===numBattleMembers?this.leader().name():TextManager.partyName.format(this.leader().name())},Game_Party.prototype.setupBattleTest=function(){this.setupBattleTestMembers(),this.setupBattleTestItems(),this.setupBattleTestStage()},Game_Party.prototype.setupBattleTestMembers=function(){$dataSystem.testBattlers.forEach((function(battler){var actor=$gameActors.actor(battler.actorId);actor&&(actor.changeLevel(battler.level,!1),actor.initEquips(battler.equips),actor.recoverAll(),this.addActor(battler.actorId))}),this)},Game_Party.prototype.setupBattleTestItems=function(){$dataItems.forEach((function(item){this.gainItem(item,this.maxItems(item))}),this),$dataSkills.forEach((function(skill){skill&&skill.name.length}),this)},Game_Party.prototype.highestLevel=function(){return Math.max.apply(null,this.members().map((function(actor){return actor.level})))},Game_Party.prototype.addActor=function(actorId){this._actors.contains(actorId)||($gameActors.actor(actorId).skills().forEach(skill=>{$gameParty.addLearnSkill(skill.id)}),this._actors.push(actorId),$gamePlayer.refresh(),$gameMap.requestRefresh(),$gameActors.actor(actorId).exChangeslotData())},Game_Party.prototype.removeActor=function(actorId){this._actors.contains(actorId)&&(this._actors.splice(this._actors.indexOf(actorId),1),$gamePlayer.refresh(),$gameMap.requestRefresh())},Game_Party.prototype.gold=function(){return this._gold},Game_Party.prototype.gainGold=function(amount){this._gold=(this._gold+amount).clamp(0,this.maxGold())},Game_Party.prototype.loseGold=function(amount){this.gainGold(-amount)},Game_Party.prototype.maxGold=function(){return 99999999},Game_Party.prototype.steps=function(){return this._steps},Game_Party.prototype.increaseSteps=function(){this._steps++},Game_Party.prototype.numItems=function(item){var container=this.itemContainer(item);return container&&container[item.id]||0},Game_Party.prototype.maxItems=function(item){return 99},Game_Party.prototype.hasMaxItems=function(item){return this.numItems(item)>=this.maxItems(item)},Game_Party.prototype.hasItem=function(item,includeEquip){return void 0===includeEquip&&(includeEquip=!1),this.numItems(item)>0||!(!includeEquip||!this.isAnyMemberEquipped(item))},Game_Party.prototype.isAnyMemberEquipped=function(item){return this.members().some((function(actor){return actor.equips().contains(item)}))},Game_Party.prototype.gainItem=function(item,amount,includeEquip){var container=this.itemContainer(item);if(container){var lastNumber,newNumber=this.numItems(item)+amount;container[item.id]=newNumber.clamp(0,this.maxItems(item)),0===container[item.id]&&delete container[item.id],includeEquip&&newNumber<0&&this.discardMembersEquip(item,-newNumber)}},Game_Party.prototype.discardMembersEquip=function(item,amount){var n=amount;this.members().forEach((function(actor){for(;n>0&&actor.isEquipped(item);)actor.discardEquip(item),n--}))},Game_Party.prototype.loseItem=function(item,amount,includeEquip){this.gainItem(item,-amount,includeEquip)},Game_Party.prototype.consumeItem=function(item){DataManager.isItem(item)&&item.consumable&&this.loseItem(item,1)},Game_Party.prototype.consumeArrow=function(item){this.loseItem(item,1)},Game_Party.prototype.canUse=function(item){return this.members().some((function(actor){return actor.canUse(item)}))},Game_Party.prototype.canInput=function(){return this.members().some((function(actor){return actor.canInput()}))},Game_Party.prototype.isAllDead=function(){return!!Game_Unit.prototype.isAllDead.call(this)&&(this.inBattle()||!this.isEmpty())},Game_Party.prototype.menuActor=function(){var actor=$gameActors.actor(this._menuActorId);return this.allMembers().contains(actor)||(actor=this.allMembers()[0]),actor},Game_Party.prototype.setMenuActor=function(actor){this._menuActorId=actor.actorId()},Game_Party.prototype.makeMenuActorNext=function(){var index=this.allMembers().indexOf(this.menuActor());index>=0?(index=(index+1)%this.allMembers().length,this.setMenuActor(this.allMembers()[index])):this.setMenuActor(this.allMembers()[0])},Game_Party.prototype.makeMenuActorPrevious=function(){var index=this.allMembers().indexOf(this.menuActor());index>=0?(index=(index+this.allMembers().length-1)%this.allMembers().length,this.setMenuActor(this.allMembers()[index])):this.setMenuActor(this.allMembers()[0])},Game_Party.prototype.swapOrder=function(index1,index2){var temp=this._actors[index1];this._actors[index1]=this._actors[index2],this._actors[index2]=temp,$gamePlayer.refresh()},Game_Party.prototype.partyAbility=function(abilityId){return this.battleMembers().some((function(actor){return actor.partyAbility(abilityId)}))},Game_Party.prototype.hasEncounterHalf=function(){return this.partyAbility(Game_Party.ABILITY_ENCOUNTER_HALF)},Game_Party.prototype.hasEncounterNone=function(){return this.partyAbility(Game_Party.ABILITY_ENCOUNTER_NONE)},Game_Party.prototype.hasCancelSurprise=function(){return this.partyAbility(Game_Party.ABILITY_CANCEL_SURPRISE)},Game_Party.prototype.hasRaisePreemptive=function(){return this.partyAbility(Game_Party.ABILITY_RAISE_PREEMPTIVE)},Game_Party.prototype.hasGoldDouble=function(){return this.partyAbility(Game_Party.ABILITY_GOLD_DOUBLE)},Game_Party.prototype.hasDropItemDouble=function(){return this.partyAbility(Game_Party.ABILITY_DROP_ITEM_DOUBLE)},Game_Party.prototype.performVictory=function(){this.members().forEach((function(actor){actor.performVictory()}))},Game_Party.prototype.performEscape=function(){this.members().forEach((function(actor){actor.performEscape()}))},Game_Party.prototype.removeBattleStates=function(){this.members().forEach((function(actor){actor.removeBattleStates()}))},Game_Party.prototype.requestMotionRefresh=function(){},Game_Party.prototype.addLearnSkill=function(skillId){skillId<$gameDefine.defaultSlotId||this._learnedSkills.includes(skillId)||this._learnedSkills.push(skillId)},Game_Party.prototype.resetBattleParameter=function(){this.allMembers().forEach(actor=>{actor.refreshPassive(),actor.gainHp(999),actor.gainMp(-999),actor.setLastTarget(null),actor.resetTurnCount()})},Game_Party.prototype.involvementPlus=function(){let plus=0;const involemenetId=$gameStateInfo.getStateId(StateType.INVOLVEMENT);return this.battleMembers().forEach(member=>{member.isStateAffected(involemenetId)&&(plus+=member.getStateEffect(involemenetId))}),plus},Game_Party.prototype.ironWillPlus=function(){let plus=0;const ironWillId=$gameStateInfo.getStateId(StateType.IRON_WILL);return this.battleMembers().forEach(member=>{member.isStateAffected(ironWillId)&&(plus+=member.getStateEffect(ironWillId))}),plus},Game_Party.prototype.totalMp=function(){return this.battleMembers().reduce((function(r,actor){return r+actor.mp}),0)},Game_Party.prototype.avarageLevel=function(){return this.aliveMembers().reduce((function(r,member){return r+member.level}),0)/this.aliveMembers().length},Game_Party.prototype.charactersForSavefile=function(){return this.battleMembers().map(actor=>[actor.characterName(),actor.characterIndex()])},Game_Party.prototype.facesForSavefile=function(){return this.battleMembers().map(actor=>[actor.faceName(),actor.faceIndex()])},Game_Party.prototype.removeInvalidMembers=function(){for(const actorId of this._actors)$dataActors[actorId]||this._actors.remove(actorId)},Game_Troop.prototype=Object.create(Game_Unit.prototype),Game_Troop.prototype.constructor=Game_Troop,Game_Troop.LETTER_TABLE_HALF=[" A"," B"," C"," D"," E"," F"," G"," H"," I"," J"," K"," L"," M"," N"," O"," P"," Q"," R"," S"," T"," U"," V"," W"," X"," Y"," Z"],Game_Troop.LETTER_TABLE_FULL=["Ａ","Ｂ","Ｃ","Ｄ","Ｅ","Ｆ","Ｇ","Ｈ","Ｉ","Ｊ","Ｋ","Ｌ","Ｍ","Ｎ","Ｏ","Ｐ","Ｑ","Ｒ","Ｓ","Ｔ","Ｕ","Ｖ","Ｗ","Ｘ","Ｙ","Ｚ"],Game_Troop.prototype.initialize=function(){Game_Unit.prototype.initialize.call(this),this._interpreter=new Game_Interpreter,this.clear()},Game_Troop.prototype.isEventRunning=function(){return this._interpreter.isRunning()},Game_Troop.prototype.updateInterpreter=function(){this._interpreter.update()},Game_Troop.prototype.turnCount=function(){return this._turnCount},Game_Troop.prototype.members=function(){return this._enemies},Game_Troop.prototype.clear=function(){this._interpreter.clear(),this._troopId=0,this._eventFlags={},this._enemies=[],this._turnCount=0,this._namesCount={}},Game_Troop.prototype.troop=function(){return $dataTroops[this._troopId]},Game_Troop.prototype.troopId=function(){return this._troopId},Game_Troop.prototype.setup=function(troopId,enemyLevel){this.clear(),this._troopId=troopId,this._enemies=[],this.troop().members.forEach((function(member){if($dataEnemies[member.enemyId]){var enemyId,x,y,enemy=new Game_Enemy(member.enemyId,member.x,member.y,enemyLevel);member.hidden&&enemy.hide(),this._enemies.push(enemy)}}),this),this.makeUniqueNames()},Game_Troop.prototype.makeUniqueNames=function(){var table=this.letterTable();this.members().forEach((function(enemy){if(enemy.isAlive()&&enemy.isLetterEmpty()){var name=enemy.originalName(),n=this._namesCount[name]||0;enemy.setLetter(table[n%table.length]),this._namesCount[name]=n+1}}),this),this.members().forEach((function(enemy){var name=enemy.originalName();this._namesCount[name]>=2&&enemy.setPlural(!0)}),this)},Game_Troop.prototype.letterTable=function(){return $gameSystem.isCJK()?Game_Troop.LETTER_TABLE_FULL:Game_Troop.LETTER_TABLE_HALF},Game_Troop.prototype.troopName=function(){var enemy=this.members()[0];if(1==this.members().length)return enemy.originalName();var boss=_.find(this.members(),m=>1==m.collapseType());return boss&&(enemy=boss),TextManager.partyName.format(enemy.originalName())},Game_Troop.prototype.meetsConditions=function(page){var c=page.conditions;if(!(c.turnEnding||c.turnValid||c.enemyValid||c.actorValid||c.switchValid))return!1;if(c.turnEnding)return!1;if(c.turnValid){var n=this._turnCount,a=c.turnA,b=c.turnB;if(0===b&&n!==a)return!1;if(b>0&&(n<1||n<a||n%b!=a%b))return!1}if(c.enemyValid){var enemy=$gameTroop.members()[c.enemyIndex];if(!enemy||100*enemy.hpRate()>c.enemyHp)return!1}if(c.actorValid){var actor=$gameActors.actor(c.actorId);if(!actor||100*actor.hpRate()>c.actorHp)return!1}return!(c.switchValid&&!$gameSwitches.value(c.switchId))},Game_Troop.prototype.setupBattleEvent=function(){if(!this._interpreter.isRunning()){if(this._interpreter.setupReservedCommonEvent())return;for(var pages=this.troop().pages,i=0;i<pages.length;i++){var page=pages[i];if(this.meetsConditions(page)&&!this._eventFlags[i]){this._interpreter.setup(page.list),page.span<=1&&(this._eventFlags[i]=!0);break}}}},Game_Troop.prototype.increaseTurn=function(){for(var pages=this.troop().pages,i=0;i<pages.length;i++){var page;1===pages[i].span&&(this._eventFlags[i]=!1)}this._turnCount++},Game_Troop.prototype.expTotal=function(){return this.deadMembers().reduce((function(r,enemy){return r+enemy.exp()}),0)},Game_Troop.prototype.goldTotal=function(){return this.deadMembers().reduce((function(r,enemy){return r+enemy.gold()}),0)*this.goldRate()},Game_Troop.prototype.goldRate=function(){return $gameParty.hasGoldDouble()?2:1},Game_Troop.prototype.makeDropItems=function(){return this.deadMembers().reduce((function(r,enemy){return r.concat(enemy.makeDropItems())}),[])},Game_Troop.prototype.isBoss=function(){return!!_.find(this._enemies,e=>e.enemyId()>$gameDefine.bossTroopId)},Game_Troop.prototype.bossEnemy=function(){return _.find(this._enemies,e=>e.isBoss())},Game_Troop.prototype.isBossDead=function(){return!(!this.isBoss()||null==this.bossEnemy()||this.bossEnemy().isAlive())},Game_Troop.prototype.enemiesNames=function(){let texts=[];const lang=$dataOption.getUserData("language");let checkEnemyData=[];return this._enemies.forEach(enemyData=>{if(-1!=checkEnemyData.indexOf(enemyData.enemyId()))return;let enemyName=TextManager.getEnemyName(enemyData.enemyId()),name="　"+enemyName,margin,number=(lang==LanguageType.English?18:9)-enemyName.length,enemyNumber;for(let i=0;i<number;i++)lang==LanguageType.English?name+=" ":name+="　";name+=_.filter(this._enemies,enemy=>enemy.enemyId()==enemyData.enemyId()).length,texts.push(name),checkEnemyData.push(enemyData.enemyId())}),texts},Game_Troop.prototype.avarageLevel=function(){return this.aliveMembers().reduce((function(r,member){return r+member.level()}),0)/this.aliveMembers().length},Object.defineProperties(Game_States.prototype,{id:{get:function(){return this._stateId},configurable:!0},turns:{get:function(){return this._turns},configurable:!0},effect:{get:function(){return this._effect},configurable:!0},passive:{get:function(){return this._passive},configurable:!0},battlerId:{get:function(){return this._battlerId},configurable:!0},slotId:{get:function(){return this._slotId},configurable:!0}}),Game_States.prototype.initialize=function(){this._stateId=0,this._turns=0,this._effect=0,this._passive=!1,this._battlerId=0,this._slotId=0},Game_States.prototype.setup=function(stateId,turns,effect,passive,battlerId,slotId){void 0===battlerId&&(battlerId=0),void 0===slotId&&(slotId=0),this._stateId=stateId,this._turns=turns,this._effect=effect,this._passive=passive,this._battlerId=battlerId,this._slotId=slotId},Game_States.prototype.clear=function(){this._stateId=0,this._turns=0,this._effect=0,this._passive=!1,this._battlerId=0,this._slotId=0},Game_States.prototype.updateStateTurns=function(){this._turns<0||(this._turns-=1)},Game_States.prototype.isStateExpired=function(){return this._turns<=0},Game_Interpreter.prototype.initialize=function(depth){this._depth=depth||0,this.checkOverflow(),this.clear(),this._branch={},this._params=[],this._indent=0,this._frameCount=0,this._freezeChecker=0},Game_Interpreter.prototype.checkOverflow=function(){if(this._depth>=100)throw new Error("Common event calls exceeded the limit")},Game_Interpreter.prototype.clear=function(){this._mapId=0,this._eventId=0,this._list=null,this._index=0,this._waitCount=0,this._waitMode="",this._comments="",this._character=null,this._childInterpreter=null},Game_Interpreter.prototype.setup=async function(list,eventId){this.clear(),this._mapId=$gameMap.mapId(),this._eventId=eventId||0,this._list=list,Game_Interpreter.requestImages(list)},Game_Interpreter.prototype.eventId=function(){return this._eventId},Game_Interpreter.prototype.isOnCurrentMap=function(){return this._mapId===$gameMap.mapId()},Game_Interpreter.prototype.setupReservedCommonEvent=function(){return!!$gameTemp.isCommonEventReserved()&&(this.setup($gameTemp.reservedCommonEvent().list),$gameTemp.clearCommonEvent(),!0)},Game_Interpreter.prototype.isRunning=function(){return!!this._list},Game_Interpreter.prototype.update=function(){for(;this.isRunning()&&!this.updateChild()&&!this.updateWait()&&!SceneManager.isSceneChanging()&&this.executeCommand()&&!this.checkFreeze(););},Game_Interpreter.prototype.updateChild=function(){if(this._childInterpreter){if(this._childInterpreter.update(),this._childInterpreter.isRunning())return!0;this._childInterpreter=null}return!1},Game_Interpreter.prototype.updateWait=function(){return this.updateWaitCount()||this.updateWaitMode()},Game_Interpreter.prototype.updateWaitCount=function(){return this._waitCount>0&&(this._waitCount--,!0)},Game_Interpreter.prototype.updateWaitMode=function(){var waiting=!1;switch(this._waitMode){case"message":waiting=$gameMessage.isBusy();break;case"transfer":waiting=$gamePlayer.isTransferring();break;case"scroll":waiting=!1;break;case"route":waiting=this._character.isMoveRouteForcing();break;case"animation":waiting=this._character.isAnimationPlaying();break;case"balloon":case"gather":waiting=!1;break;case"action":break;case"video":waiting=Graphics.isVideoPlaying();break;case"image":waiting=!ImageManager.isReady()}return waiting||(this._waitMode=""),waiting},Game_Interpreter.prototype.setWaitMode=function(waitMode){this._waitMode=waitMode},Game_Interpreter.prototype.wait=function(duration){this._waitCount=duration},Game_Interpreter.prototype.fadeSpeed=function(){return 48},Game_Interpreter.prototype.executeCommand=function(){var command=this.currentCommand();if(command){this._params=command.parameters,this._indent=command.indent;var methodName="command"+command.code;if("function"==typeof this[methodName]&&!this[methodName](command.parameters))return!1;this._index++}else this.terminate();return!0},Game_Interpreter.prototype.checkFreeze=function(){return this._frameCount!==Graphics.frameCount&&(this._frameCount=Graphics.frameCount,this._freezeChecker=0),this._freezeChecker++>=1e5},Game_Interpreter.prototype.terminate=function(){this._list=null,this._comments=""},Game_Interpreter.prototype.skipBranch=function(){for(;this._list[this._index+1].indent>this._indent;)this._index++},Game_Interpreter.prototype.currentCommand=function(){return this._list[this._index]},Game_Interpreter.prototype.nextEventCode=function(){var command=this._list[this._index+1];return command?command.code:0},Game_Interpreter.prototype.iterateActorId=function(param,callback){if(0===param)$gameParty.members().forEach(callback);else{var actor=$gameActors.actor(param);actor&&callback(actor)}},Game_Interpreter.prototype.iterateActorEx=function(param1,param2,callback){0===param1?this.iterateActorId(param2,callback):this.iterateActorId($gameVariables.value(param2),callback)},Game_Interpreter.prototype.iterateActorIndex=function(param,callback){if(param<0)$gameParty.members().forEach(callback);else{var actor=$gameParty.members()[param];actor&&callback(actor)}},Game_Interpreter.prototype.iterateEnemyIndex=function(param,callback){if(param<0)$gameTroop.members().forEach(callback);else{var enemy=$gameTroop.members()[param];enemy&&callback(enemy)}},Game_Interpreter.prototype.iterateBattler=function(param1,param2,callback){$gameParty.inBattle()&&(0===param1?this.iterateEnemyIndex(param2,callback):this.iterateActorId(param2,callback))},Game_Interpreter.prototype.character=function(param){return $gameParty.inBattle()?null:param<0?$gamePlayer:this.isOnCurrentMap()?$gameMap.event(param>0?param:this._eventId):null},Game_Interpreter.prototype.operateValue=function(operation,operandType,operand){var value=0===operandType?operand:$gameVariables.value(operand);return 0===operation?value:-value},Game_Interpreter.prototype.changeHp=function(target,value,allowDeath){target.isAlive()&&(!allowDeath&&target.hp<=-value&&(value=1-target.hp),target.gainHp(value),target.isDead()&&target.performCollapse())},Game_Interpreter.prototype.command101=function(params){if($gameMessage.isBusy())return!1;for($gameMessage.setFaceImage(params[0],params[1]),$gameMessage.setBackground(params[2]),$gameMessage.setPositionType(params[3]),$gameMessage.setSpeakerName(params[4]);401===this.nextEventCode();)this._index++,$gameMessage.add(this.currentCommand().parameters[0]);switch(this.nextEventCode()){case 102:this._index++,this.setupChoices(this.currentCommand().parameters);break;case 103:this._index++,this.setupNumInput(this.currentCommand().parameters);break;case 104:this._index++,this.setupItemChoice(this.currentCommand().parameters)}return this.setWaitMode("message"),!0},Game_Interpreter.prototype.command102=function(){return $gameMessage.isBusy()||(this.setupChoices(this._params),this._index++,this.setWaitMode("message")),!1},Game_Interpreter.prototype.setupChoices=function(params){var choices=params[0].clone(),cancelType=params[1],defaultType=params.length>2?params[2]:0,positionType=params.length>3?params[3]:2,background=params.length>4?params[4]:0;cancelType>=choices.length&&(cancelType=-2),$gameMessage.setChoices(choices,defaultType,cancelType),$gameMessage.setChoiceBackground(background),$gameMessage.setChoicePositionType(positionType),$gameMessage.setChoiceCallback(function(n){this._branch[this._indent]=n}.bind(this))},Game_Interpreter.prototype.command402=function(){return this._branch[this._indent]!==this._params[0]&&this.skipBranch(),!0},Game_Interpreter.prototype.command403=function(){return this._branch[this._indent]>=0&&this.skipBranch(),!0},Game_Interpreter.prototype.command103=function(){return $gameMessage.isBusy()||(this.setupNumInput(this._params),this._index++,this.setWaitMode("message")),!1},Game_Interpreter.prototype.setupNumInput=function(params){$gameMessage.setNumberInput(params[0],params[1])},Game_Interpreter.prototype.command104=function(){return $gameMessage.isBusy()||(this.setupItemChoice(this._params),this._index++,this.setWaitMode("message")),!1},Game_Interpreter.prototype.setupItemChoice=function(params){$gameMessage.setItemChoice(params[0],params[1]||2)},Game_Interpreter.prototype.command105=function(){if(!$gameMessage.isBusy()){for($gameMessage.setScroll(this._params[0],this._params[1]);405===this.nextEventCode();)this._index++,$gameMessage.add(this.currentCommand().parameters[0]);this._index++,this.setWaitMode("message")}return!1},Game_Interpreter.prototype.command108=function(){for(this._comments=[this._params[0]];408===this.nextEventCode();)this._index++,this._comments.push(this.currentCommand().parameters[0]);return!0},Game_Interpreter.prototype.command111=function(){var result=!1;switch(this._params[0]){case 0:result=$gameSwitches.value(this._params[1])===(0===this._params[2]);break;case 1:var value1=$gameVariables.value(this._params[1]),value2;switch(value2=0===this._params[2]?this._params[3]:$gameVariables.value(this._params[3]),this._params[4]){case 0:result=value1===value2;break;case 1:result=value1>=value2;break;case 2:result=value1<=value2;break;case 3:result=value1>value2;break;case 4:result=value1<value2;break;case 5:result=value1!==value2}break;case 2:if(this._eventId>0){var key=[this._mapId,this._eventId,this._params[1]];result=$gameSelfSwitches.value(key)===(0===this._params[2])}break;case 3:$gameTimer.isWorking()&&(result=0===this._params[2]?$gameTimer.seconds()>=this._params[1]:$gameTimer.seconds()<=this._params[1]);break;case 4:var actor=$gameActors.actor(this._params[1]);if(actor){var n=this._params[3];switch(this._params[2]){case 0:result=$gameParty.members().contains(actor);break;case 1:result=actor.name()===n;break;case 2:result=actor.isClass($dataClasses[n]);break;case 3:result=actor.hasSkill(n);break;case 4:result=actor.hasWeapon($dataWeapons[n]);break;case 5:result=actor.hasArmor($dataArmors[n]);break;case 6:result=actor.isStateAffected(n)}}break;case 5:var enemy=$gameTroop.members()[this._params[1]];if(enemy)switch(this._params[2]){case 0:result=enemy.isAlive();break;case 1:result=enemy.isStateAffected(this._params[3])}break;case 6:var character=this.character(this._params[1]);character&&(result=character.direction()===this._params[2]);break;case 7:switch(this._params[2]){case 0:result=$gameParty.gold()>=this._params[1];break;case 1:result=$gameParty.gold()<=this._params[1];break;case 2:result=$gameParty.gold()<this._params[1]}break;case 8:result=$gameParty.hasItem($dataItems[this._params[1]]);break;case 9:result=$gameParty.hasItem($dataWeapons[this._params[1]],this._params[2]);break;case 10:result=$gameParty.hasItem($dataArmors[this._params[1]],this._params[2]);break;case 11:result=Input.isPressed(this._params[1]);break;case 12:result=!!eval(this._params[1]);break;case 13:result=$gamePlayer.vehicle()===$gameMap.vehicle(this._params[1])}return this._branch[this._indent]=result,!1===this._branch[this._indent]&&this.skipBranch(),!0},Game_Interpreter.prototype.command411=function(){return!1!==this._branch[this._indent]&&this.skipBranch(),!0},Game_Interpreter.prototype.command112=function(){return!0},Game_Interpreter.prototype.command413=function(){do{this._index--}while(this.currentCommand().indent!==this._indent);return!0},Game_Interpreter.prototype.command113=function(){for(var depth=0;this._index<this._list.length-1;){this._index++;var command=this.currentCommand();if(112===command.code&&depth++,413===command.code){if(!(depth>0))break;depth--}}return!0},Game_Interpreter.prototype.command115=function(){return this._index=this._list.length,!0},Game_Interpreter.prototype.command117=function(){var commonEvent=$dataCommonEvents[this._params[0]];if(commonEvent){var eventId=this.isOnCurrentMap()?this._eventId:0;this.setupChild(commonEvent.list,eventId)}return!0},Game_Interpreter.prototype.setupChild=function(list,eventId){this._childInterpreter=new Game_Interpreter(this._depth+1),this._childInterpreter.setup(list,eventId)},Game_Interpreter.prototype.command118=function(){return EventManager.setLabel(this._params[0]),!0},Game_Interpreter.prototype.command119=function(){for(var labelName=this._params[0],i=0;i<this._list.length;i++){var command=this._list[i];if(118===command.code&&command.parameters[0]===labelName)return void this.jumpTo(i)}return!0},Game_Interpreter.prototype.jumpTo=function(index){for(var lastIndex=this._index,startIndex=Math.min(index,lastIndex),endIndex=Math.max(index,lastIndex),indent=this._indent,i=startIndex;i<=endIndex;i++){var newIndent=this._list[i].indent;newIndent!==indent&&(this._branch[indent]=null,indent=newIndent)}this._index=index},Game_Interpreter.prototype.command121=function(){for(var i=this._params[0];i<=this._params[1];i++)$gameSwitches.setValue(i,0===this._params[2]);return!0},Game_Interpreter.prototype.command122=function(){var value=0;switch(this._params[3]){case 0:value=this._params[4];break;case 1:value=$gameVariables.value(this._params[4]);break;case 2:value=this._params[5]-this._params[4]+1;for(var i=this._params[0];i<=this._params[1];i++)this.operateVariable(i,this._params[2],this._params[4]+Math.randomInt(value));return!0;case 3:value=this.gameDataOperand(this._params[4],this._params[5],this._params[6]);break;case 4:value=eval(this._params[4])}for(var i=this._params[0];i<=this._params[1];i++)this.operateVariable(i,this._params[2],value);return!0},Game_Interpreter.prototype.gameDataOperand=function(type,param1,param2){switch(type){case 0:return $gameParty.numItems($dataItems[param1]);case 1:return $gameParty.numItems($dataWeapons[param1]);case 2:return $gameParty.numItems($dataArmors[param1]);case 3:var actor=$gameActors.actor(param1);if(actor)switch(param2){case 0:return actor.level;case 1:return actor.currentExp();case 2:return actor.hp;case 3:return actor.mp;default:if(param2>=4&&param2<=11)return actor.param(param2-4)}break;case 4:var enemy=$gameTroop.members()[param1];if(enemy)switch(param2){case 0:return enemy.hp;case 1:return enemy.mp;default:if(param2>=2&&param2<=9)return enemy.param(param2-2)}break;case 5:var character=this.character(param1);if(character)switch(param2){case 0:return character.x;case 1:return character.y;case 2:return character.direction();case 3:return character.screenX();case 4:return character.screenY()}break;case 6:return(actor=$gameParty.members()[param1])?actor.actorId():0;case 7:switch(param1){case 0:return $gameMap.mapId();case 1:return $gameParty.size();case 2:return $gameParty.gold();case 3:return $gameParty.steps();case 4:return $gameSystem.playtime();case 5:return $gameTimer.seconds();case 6:return $gameSystem.saveCount();case 7:return $gameSystem.battleCount();case 8:return $gameSystem.winCount();case 9:return 0}}return 0},Game_Interpreter.prototype.operateVariable=function(variableId,operationType,value){try{var oldValue=$gameVariables.value(variableId);switch(operationType){case 0:$gameVariables.setValue(variableId,oldValue=value);break;case 1:$gameVariables.setValue(variableId,oldValue+value);break;case 2:$gameVariables.setValue(variableId,oldValue-value);break;case 3:$gameVariables.setValue(variableId,oldValue*value);break;case 4:$gameVariables.setValue(variableId,oldValue/value);break;case 5:$gameVariables.setValue(variableId,oldValue%value)}}catch(e){$gameVariables.setValue(variableId,0)}},Game_Interpreter.prototype.command123=function(params){if(this._eventId>0){const key=[this._mapId,this._eventId,params[0]];$gameSelfSwitches.setValue(key,0===params[1])}return!0},Game_Interpreter.prototype.command124=function(){return 0===this._params[0]?$gameTimer.start(60*this._params[1]):$gameTimer.stop(),!0},Game_Interpreter.prototype.command125=function(){var value=this.operateValue(this._params[0],this._params[1],this._params[2]);return $gameParty.gainGold(value),!0},Game_Interpreter.prototype.command126=function(){var value=this.operateValue(this._params[1],this._params[2],this._params[3]);return $gameParty.gainItem($dataItems[this._params[0]],value),value>0&&EventManager.startLogText("Get Item : "+$dataItems[this._params[0]].name+" x"+value),!0},Game_Interpreter.prototype.command127=function(){var value=this.operateValue(this._params[1],this._params[2],this._params[3]);return $gameParty.gainItem($dataWeapons[this._params[0]],value,this._params[4]),value>0&&EventManager.startLogText("Get Weapon : "+$dataWeapons[this._params[0]].name+" x"+value),!0},Game_Interpreter.prototype.command128=function(){var value=this.operateValue(this._params[1],this._params[2],this._params[3]);return $gameParty.gainItem($dataArmors[this._params[0]],value,this._params[4]),value>0&&EventManager.startLogText("Get Armor : "+$dataArmors[this._params[0]].name+" x"+value),!0},Game_Interpreter.prototype.command129=function(){var actor;return $gameActors.actor(this._params[0])&&(0===this._params[1]?(this._params[2]&&$gameActors.actor(this._params[0]).setup(this._params[0]),$gameParty.addActor(this._params[0])):$gameParty.removeActor(this._params[0])),!0},Game_Interpreter.prototype.command132=function(){return $gameSystem.setBattleBgm(this._params[0]),!0},Game_Interpreter.prototype.command133=function(){return $gameSystem.setVictoryMe(this._params[0]),!0},Game_Interpreter.prototype.command134=function(){return 0===this._params[0]?$gameSystem.disableSave():$gameSystem.enableSave(),!0},Game_Interpreter.prototype.command135=function(){return 0===this._params[0]?$gameSystem.disableMenu():$gameSystem.enableMenu(),!0},Game_Interpreter.prototype.command136=function(){return 0===this._params[0]?$gameSystem.disableEncounter():$gameSystem.enableEncounter(),!0},Game_Interpreter.prototype.command137=function(){return 0===this._params[0]?$gameSystem.disableFormation():$gameSystem.enableFormation(),!0},Game_Interpreter.prototype.command138=function(){return $gameSystem.setWindowTone(this._params[0]),!0},Game_Interpreter.prototype.command139=function(){return $gameSystem.setDefeatMe(this._params[0]),!0},Game_Interpreter.prototype.command140=function(){var vehicle=$gameMap.vehicle(this._params[0]);return vehicle&&vehicle.setBgm(this._params[1]),!0},Game_Interpreter.prototype.command201=function(){var mapId,x,y;return 0===this._params[0]?(mapId=this._params[1],x=this._params[2],y=this._params[3]):(mapId=$gameVariables.value(this._params[1]),x=$gameVariables.value(this._params[2]),y=$gameVariables.value(this._params[3])),$gamePlayer.reserveTransfer(mapId,x,y,this._params[4],this._params[5]),this.setWaitMode("transfer"),this._index++,!1},Game_Interpreter.prototype.command202=function(){var mapId,x,y;0===this._params[1]?(mapId=this._params[2],x=this._params[3],y=this._params[4]):(mapId=$gameVariables.value(this._params[2]),x=$gameVariables.value(this._params[3]),y=$gameVariables.value(this._params[4]));var vehicle=$gameMap.vehicle(this._params[0]);return vehicle&&vehicle.setLocation(mapId,x,y),!0},Game_Interpreter.prototype.command203=function(){var character=this.character(this._params[0]);if(character){if(0===this._params[1])character.locate(this._params[2],this._params[3]);else if(1===this._params[1]){var x=$gameVariables.value(this._params[2]),y=$gameVariables.value(this._params[3]);character.locate(x,y)}else{var character2=this.character(this._params[2]);character2&&character.swap(character2)}this._params[4]>0&&character.setDirection(this._params[4])}return!0},Game_Interpreter.prototype.command204=function(){},Game_Interpreter.prototype.command205=function(){return $gameMap.refreshIfNeeded(),this._character=this.character(this._params[0]),this._character&&(this._character.forceMoveRoute(this._params[1]),this._params[1].wait&&this.setWaitMode("route")),!0},Game_Interpreter.prototype.command206=function(){return $gamePlayer.getOnOffVehicle(),!0},Game_Interpreter.prototype.command211=function(){return!0},Game_Interpreter.prototype.command212=function(){return EventManager.showAnimation(this._params[1]),!0},Game_Interpreter.prototype.command213=function(){return EventManager.setPictureEmotion(this._params[1]),!0},Game_Interpreter.prototype.command214=function(){return this.isOnCurrentMap()&&this._eventId>0&&$gameMap.eraseEvent(this._eventId),!0},Game_Interpreter.prototype.command216=function(){return this._params[0],$gamePlayer.refresh(),!0},Game_Interpreter.prototype.command217=function(){return $gameParty.inBattle(),!0},Game_Interpreter.prototype.command221=function(){return EventManager.startFadeOut(this.fadeSpeed()),this.wait(this.fadeSpeed()),this._index++,!1},Game_Interpreter.prototype.command222=function(){return EventManager.startFadeIn(this.fadeSpeed()),this.wait(this.fadeSpeed()),this._index++,!1},Game_Interpreter.prototype.command223=function(){return $gameScreen.startTint(this._params[0],this._params[1]),BackGroundManager.startTint(this._params[0],this._params[1]),this._params[2]&&this.wait(this._params[1]),!0},Game_Interpreter.prototype.command224=function(){return EventManager.startFlash(this._params[0],this._params[1]),this._params[2]&&this.wait(this._params[1]),!0},Game_Interpreter.prototype.command225=function(){return $gameScreen.startShake(this._params[0],this._params[1],this._params[2]),this._params[3]&&this.wait(this._params[2]),!0},Game_Interpreter.prototype.command230=function(){return this.wait(this._params[0]),!0},Game_Interpreter.prototype.command231=function(){var x,y;return 0===this._params[3]?(x=this._params[4],y=this._params[5]):(x=$gameVariables.value(this._params[4]),y=$gameVariables.value(this._params[5])),EventManager.showPicture(this._params[1],this._params[1],x,y,this._params[0],this._params[6],this._params[7],this._params[8],this._params[9]),!0},Game_Interpreter.prototype.command232=function(){var x,y;return 0===this._params[3]?(x=this._params[4],y=this._params[5]):(x=$gameVariables.value(this._params[4]),y=$gameVariables.value(this._params[5])),EventManager.movePicture(x,y,this._params[0],this._params[6]/100,this._params[7]/100,this._params[8],this._params[10]/60),this._params[11]&&this.wait(this._params[10]),!0},Game_Interpreter.prototype.command233=function(){return!0},Game_Interpreter.prototype.command234=function(){return EventManager.tintPicture(this._params[1]),this._params[3]&&this.wait(this._params[2]),!0},Game_Interpreter.prototype.command235=function(){return!0},Game_Interpreter.prototype.command236=function(){return!0},Game_Interpreter.prototype.command241=function(){return AudioManager.playBgm(this._params[0]),!0},Game_Interpreter.prototype.command242=function(){return AudioManager.fadeOutBgm(this._params[0]),!0},Game_Interpreter.prototype.command243=function(){return $gameSystem.saveBgm(),!0},Game_Interpreter.prototype.command244=function(){return $gameSystem.replayBgm(),!0},Game_Interpreter.prototype.command245=function(){return AudioManager.playBgs(this._params[0]),!0},Game_Interpreter.prototype.command246=function(){return AudioManager.fadeOutBgs(this._params[0]),!0},Game_Interpreter.prototype.command249=function(){return AudioManager.playMe(this._params[0]),!0},Game_Interpreter.prototype.command250=function(){return AudioManager.playSe(this._params[0]),!0},Game_Interpreter.prototype.command251=function(){return AudioManager.stopSe(),!0},Game_Interpreter.prototype.command261=function(){if(!$gameMessage.isBusy()){var name=this._params[0];if(name.length>0){var ext=this.videoFileExt();Graphics.playVideo("movies/"+name+ext),this.setWaitMode("video")}this._index++}return!1},Game_Interpreter.prototype.videoFileExt=function(){return Graphics.canPlayVideoType("video/webm")&&!Utils.isMobileDevice()?".webm":".mp4"},Game_Interpreter.prototype.command281=function(){return 0===this._params[0]?$gameMap.enableNameDisplay():$gameMap.disableNameDisplay(),!0},Game_Interpreter.prototype.command282=function(){var tileset=$dataTilesets[this._params[0]],allReady;return this._imageReservationId||(this._imageReservationId=Utils.generateRuntimeId()),!!tileset.tilesetNames.map((function(tilesetName){return ImageManager.reserveTileset(tilesetName,0,this._imageReservationId)}),this).every((function(bitmap){return bitmap.isReady()}))&&($gameMap.changeTileset(this._params[0]),ImageManager.releaseReservation(this._imageReservationId),this._imageReservationId=null,!0)},Game_Interpreter.prototype.command283=function(){return BackGroundManager.changeBackGround(this._params[0],this._params[1]),$gameMap.changeBattleback(this._params[0],this._params[1]),!0},Game_Interpreter.prototype.command284=function(){},Game_Interpreter.prototype.command285=function(){var x,y,value;switch(0===this._params[2]?(x=this._params[3],y=this._params[4]):(x=$gameVariables.value(this._params[3]),y=$gameVariables.value(this._params[4])),this._params[1]){case 0:value=$gameMap.terrainTag(x,y);break;case 1:value=$gameMap.eventIdXy(x,y);break;case 2:case 3:case 4:case 5:value=$gameMap.tileId(x,y,this._params[1]-2);break;default:value=$gameMap.regionId(x,y)}return $gameVariables.setValue(this._params[0],value),!0},Game_Interpreter.prototype.command301=function(){let troopId;if(0===this._params[0]){troopId=this._params[1];let troop=new Game_Troop;troop.setup(troopId,1),$gameParty.stageEvent()._eventId=troop}else troopId=1===this._params[0]?$gameVariables.value(this._params[1]):$gamePlayer.makeEncounterTroopId();return $dataTroops[troopId]&&SceneManager.push(Battle_Scene),!0},Game_Interpreter.prototype.command601=function(){return 0!==this._branch[this._indent]&&this.skipBranch(),!0},Game_Interpreter.prototype.command602=function(){return 1!==this._branch[this._indent]&&this.skipBranch(),!0},Game_Interpreter.prototype.command603=function(){return 2!==this._branch[this._indent]&&this.skipBranch(),!0},Game_Interpreter.prototype.command302=function(params){if(!$gameParty.inBattle()){const goods=[params];for(;605===this.nextEventCode();)this._index++,goods.push(this.currentCommand().parameters);SceneManager.push(Scene_Shop),SceneManager.prepareNextScene(goods,params[4])}return!0},Game_Interpreter.prototype.command303=function(){return $gameParty.inBattle()||$dataActors[this._params[0]]&&(SceneManager.push(Scene_Name),SceneManager.prepareNextScene(this._params[0],this._params[1])),!0},Game_Interpreter.prototype.command311=function(){var value=this.operateValue(this._params[2],this._params[3],this._params[4]);return this.iterateActorEx(this._params[0],this._params[1],function(actor){this.changeHp(actor,value,this._params[5])}.bind(this)),!0},Game_Interpreter.prototype.command312=function(){var value=this.operateValue(this._params[2],this._params[3],this._params[4]);return this.iterateActorEx(this._params[0],this._params[1],function(actor){actor.gainMp(value)}.bind(this)),!0},Game_Interpreter.prototype.command326=function(){var value=this.operateValue(this._params[2],this._params[3],this._params[4]);return this.iterateActorEx(this._params[0],this._params[1],function(actor){actor.gainTp(value)}.bind(this)),!0},Game_Interpreter.prototype.command313=function(){return this.iterateActorEx(this._params[0],this._params[1],function(actor){var alreadyDead=actor.isDead();0===this._params[2]?actor.addState(this._params[3]):actor.removeState(this._params[3]),actor.isDead()&&!alreadyDead&&actor.performCollapse()}.bind(this)),!0},Game_Interpreter.prototype.command314=function(){return this.iterateActorEx(this._params[0],this._params[1],function(actor){actor.recoverAll()}.bind(this)),!0},Game_Interpreter.prototype.command315=function(){var value=this.operateValue(this._params[2],this._params[3],this._params[4]);return this.iterateActorEx(this._params[0],this._params[1],function(actor){actor.changeExp(actor.currentExp()+value,this._params[5])}.bind(this)),!0},Game_Interpreter.prototype.command316=function(){var value=this.operateValue(this._params[2],this._params[3],this._params[4]);return this.iterateActorEx(this._params[0],this._params[1],function(actor){actor.changeLevel(actor.level+value,this._params[5])}.bind(this)),!0},Game_Interpreter.prototype.command317=function(){var value=this.operateValue(this._params[3],this._params[4],this._params[5]);return this.iterateActorEx(this._params[0],this._params[1],function(actor){actor.addParam(this._params[2],value)}.bind(this)),!0},Game_Interpreter.prototype.command318=function(){return this.iterateActorEx(this._params[0],this._params[1],function(actor){0===this._params[2]?actor.learnSkill(this._params[3]):actor.forgetSkill(this._params[3])}.bind(this)),!0},Game_Interpreter.prototype.command319=function(){var actor=$gameActors.actor(this._params[0]);return actor&&actor.changeEquipById(this._params[1],this._params[2]),!0},Game_Interpreter.prototype.command320=function(){var actor=$gameActors.actor(this._params[0]);return actor&&actor.setName(this._params[1]),!0},Game_Interpreter.prototype.command321=function(){var actor=$gameActors.actor(this._params[0]);return actor&&$dataClasses[this._params[1]]&&actor.changeClass(this._params[1],this._params[2]),!0},Game_Interpreter.prototype.command322=function(){var actor=$gameActors.actor(this._params[0]);return actor&&(actor.setCharacterImage(this._params[1],this._params[2]),actor.setFaceImage(this._params[3],this._params[4]),actor.setBattlerImage(this._params[5])),$gamePlayer.refresh(),!0},Game_Interpreter.prototype.command323=function(){var vehicle=$gameMap.vehicle(this._params[0]);return vehicle&&vehicle.setImage(this._params[1],this._params[2]),!0},Game_Interpreter.prototype.command324=function(){var actor=$gameActors.actor(this._params[0]);return actor&&actor.setNickname(this._params[1]),!0},Game_Interpreter.prototype.command325=function(){var actor=$gameActors.actor(this._params[0]);return actor&&actor.setProfile(this._params[1]),!0},Game_Interpreter.prototype.command331=function(){var value=this.operateValue(this._params[1],this._params[2],this._params[3]);return this.iterateEnemyIndex(this._params[0],function(enemy){this.changeHp(enemy,value,this._params[4])}.bind(this)),!0},Game_Interpreter.prototype.command332=function(){var value=this.operateValue(this._params[1],this._params[2],this._params[3]);return this.iterateEnemyIndex(this._params[0],function(enemy){enemy.gainMp(value)}.bind(this)),!0},Game_Interpreter.prototype.command342=function(){var value=this.operateValue(this._params[1],this._params[2],this._params[3]);return this.iterateEnemyIndex(this._params[0],function(enemy){enemy.gainTp(value)}.bind(this)),!0},Game_Interpreter.prototype.command333=function(){return this.iterateEnemyIndex(this._params[0],function(enemy){var alreadyDead=enemy.isDead();0===this._params[1]?enemy.addState(this._params[2]):enemy.removeState(this._params[2]),enemy.isDead()&&!alreadyDead&&enemy.performCollapse()}.bind(this)),!0},Game_Interpreter.prototype.command334=function(){return this.iterateEnemyIndex(this._params[0],function(enemy){enemy.recoverAll()}.bind(this)),!0},Game_Interpreter.prototype.command335=function(){return this.iterateEnemyIndex(this._params[0],function(enemy){enemy.appear(),$gameTroop.makeUniqueNames()}.bind(this)),!0},Game_Interpreter.prototype.command336=function(){return this.iterateEnemyIndex(this._params[0],function(enemy){enemy.transform(this._params[1]),$gameTroop.makeUniqueNames()}.bind(this)),!0},Game_Interpreter.prototype.command337=function(){return 1==this._params[2]?this.iterateEnemyIndex(-1,function(enemy){enemy.isAlive()&&enemy.startAnimation(this._params[1],!1,0)}.bind(this)):this.iterateEnemyIndex(this._params[0],function(enemy){enemy.isAlive()&&enemy.startAnimation(this._params[1],!1,0)}.bind(this)),!0},Game_Interpreter.prototype.command339=function(){return this.iterateBattler(this._params[0],this._params[1],function(battler){battler.isDeathStateAffected()||(battler.forceAction(this._params[2],this._params[3]),this.setWaitMode("action"))}.bind(this)),!0},Game_Interpreter.prototype.command340=function(){return!0},Game_Interpreter.prototype.command351=function(){return $gameParty.inBattle()||(SceneManager.push(Menu_Scene),Window_MenuListCommand.initCommandPosition()),!0},Game_Interpreter.prototype.command352=function(){return $gameParty.inBattle()||SceneManager.push(Scene_Save),!0},Game_Interpreter.prototype.command353=function(){return SceneManager.goto(Scene_Gameover),!0},Game_Interpreter.prototype.command354=function(){return SceneManager.goto(Scene_Title),!0},Game_Interpreter.prototype.command355=function(){for(var script=this.currentCommand().parameters[0]+"\n";655===this.nextEventCode();)this._index++,script+=this.currentCommand().parameters[0]+"\n";return eval(script),!0},Game_Interpreter.prototype.command356=function(){var args=this._params[0].split(" "),command=args.shift();return this.pluginCommand(command,args),!0},Game_Interpreter.prototype.pluginCommand=function(){},Game_Interpreter.prototype.command357=function(params){return PluginManager.callCommand(this,params[0],params[1],params[3]),!0},Game_Interpreter.requestImages=function(list,commonList){list&&list.forEach((function(command){var params=command.parameters;switch(command.code){case 101:break;case 117:var commonEvent=$dataCommonEvents[params[0]];commonEvent&&(commonList||(commonList=[]),commonList.contains(params[0])||(commonList.push(params[0]),Game_Interpreter.requestImages(commonEvent.list,commonList)));break;case 129:var actor=$gameActors.actor(params[0]);if(actor&&0===params[1])var name=actor.characterName();break;case 205:params[1]&&params[1].list.forEach((function(command){var params=command.parameters;command.code,Game_Character.ROUTE_CHANGE_IMAGE}));break;case 212:case 337:if(params[1])var animation=$dataAnimations[params[1]],name1=animation.animation1Name,name2=animation.animation2Name,hue1=animation.animation1Hue,hue2=animation.animation2Hue;break;case 216:params[0];break;case 231:break;case 282:var tileset;$dataTilesets[params[0]].tilesetNames.forEach((function(tilesetName){}));break;case 283:$gameParty.inBattle();break;case 284:case 322:break;case 323:var vehicle=$gameMap.vehicle(params[0]);break;case 336:var enemy=$dataEnemies[params[1]],name=enemy.battlerName,hue=enemy.battlerHue;$gameSystem.isSideView()}}))};class Game_SkillHelp{constructor(battler,skillId,awakeFlag){this._damageRateUp=!1,skillId=this.changeExpSkill(battler,skillId),this._power=this.evalDamage(battler,skillId),this._hit=$dataSkills[skillId].repeats,0==$dataSkills[skillId].damage.type&&(this._hit=0),this._baseText=this.replaceText(battler,skillId)}get elementId(){return this._elementId}get baseText(){return this._baseText}get power(){return this._power}get hit(){return this._hit}get damageRateUp(){return this._damageRateUp}changeExpSkill(battler,skillId){return skillId}replaceText(battler,skillId){const scopeType=$dataSkills[skillId].scope;let text=this.stypeText(skillId)+"\n",descriptionId=skillId;const helpTextId=$dataSkills[skillId].helpTextId;helpTextId&&(descriptionId=helpTextId),text+=TextManager.getSkillDescription(descriptionId),text=TextManager.convertEscapeCharacters(text),text=text.replace(/\x1bS/gi,this.scopeText(scopeType));const skill=$dataSkills[skillId];let value;_.find(skill.effects,a=>21==a.code)?(value=20,text=text.replace(/\x1bE/gi,value)):(value=skill.stateEffect,text=text.replace(/\x1bE/gi,value)),text=text.replace(/\x1bT/gi,TextManager.getDamageElement(this._elementId));let name="";return name=battler instanceof Game_Battler&&battler.isActor()?TextManager.actorName(battler.actorId()):battler instanceof Game_Battler&&!battler.isActor()?TextManager.getEnemyName(battler.enemyId()):TextManager.getEnemyName(battler.id),text=text.replace(/\x1bA/gi,name),text=text.replace(/\x1bH/gi,this._power),text=text.replace(/\x1bD/gi,this._power),text=text.replace(/\x1bR/gi,this._hit),text=text.replace(/\x1bN/gi,"\n"),text}stypeText(skillId){const item=$dataSkills[skillId];let text="";return item.stypeId==Game_BattlerBase.SKILL_TYPE_MAGIC&&item.damage.elementId>0?text=TextManager.getText(700100):item.stypeId==Game_BattlerBase.SKILL_TYPE_MAGIC&&-1==item.damage.elementId?text=TextManager.getText(700100):item.stypeId==Game_BattlerBase.SKILL_TYPE_COMMON?text=TextManager.getText(700200):item.stypeId==Game_BattlerBase.SKILL_TYPE_PASSIVE?text=TextManager.getText(700300):item.stypeId==Game_BattlerBase.SKILL_TYPE_PASSIVE_SELF?text=TextManager.getText(700400):item.stypeId==Game_BattlerBase.SKILL_TYPE_SELF?text=TextManager.getText(700600):item.stypeId==Game_BattlerBase.SKILL_TYPE_SPECIAL?text=TextManager.getText(700700):0==item.stypeId&&item.id>$gameDefine.defaultSlotId?text=TextManager.getText(700800):this._battler&&(text="\n"),item.id>1e3&&(text+=TextManager.getText(700900)),text}scopeText(scopeType){return TextManager.getText(720100+Number(10*(scopeType-1)))}evalDamage(battler,skillId){var item=$dataSkills[skillId];if(0==item.damage.type||4==item.damage.type)return 0;var a=battler,value=Math.max(eval(item.damage.formula),0);if(battler instanceof Game_Battler&&1==item.damage.type){const damageRate=battler.damageRate();damageRate>0&&(value+=damageRate,this._damageRateUp=!0)}return value}}function Sprite_Button(){this.initialize.apply(this,arguments)}function Sprite_MZButton(){this.initialize(...arguments)}Sprite_Button.prototype=Object.create(Sprite.prototype),Sprite_Button.prototype.constructor=Sprite_Button,Sprite_Button.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this._touching=!1,this._coldFrame=null,this._hotFrame=null,this._clickHandler=null,this._pressHandler=null,this._clickCallTriggered=!1,this._clickCallReleased=!0,this._pressFrame=0},Sprite_Button.prototype.clickCallTypeChange=function(){this._clickCallTriggered=!0,this._clickCallReleased=!1},Sprite_Button.prototype.pressFrame=function(){return this._pressFrame},Sprite_Button.prototype.setPressFrame=function(frame){this._pressFrame=frame},Sprite_Button.prototype.update=function(){Sprite.prototype.update.call(this),this.updateFrame(),this.processTouch()},Sprite_Button.prototype.updateFrame=function(){let frame;frame=this._touching?this._hotFrame:this._coldFrame,frame&&this.setFrame(frame.x,frame.y,frame.width,frame.height)},Sprite_Button.prototype.setColdFrame=function(x,y,width,height){this._coldFrame=new Rectangle(x,y,width,height)},Sprite_Button.prototype.setHotFrame=function(x,y,width,height){this._hotFrame=new Rectangle(x,y,width,height)},Sprite_Button.prototype.setClickHandler=function(method){this._clickHandler=method},Sprite_Button.prototype.setPressHandler=function(method){this._pressHandler=method},Sprite_Button.prototype.callClickHandler=function(){this._clickHandler&&this._clickHandler()},Sprite_Button.prototype.callPressHandler=function(){this._pressHandler&&this._pressHandler()},Sprite_Button.prototype.setMoveHandler=function(method){this._moveHandler||(this._moveHandler=method)},Sprite_Button.prototype.callMoveHandler=function(x,y){this._moveHandler&&this._moveHandler(x,y)},Sprite_Button.prototype.setMoveReleaseHandler=function(method){this._moveReleaseHandler||(this._moveReleaseHandler=method)},Sprite_Button.prototype.callMoveReleaseHandler=function(num){this._moveReleaseHandler&&this._moveReleaseHandler()},Sprite_Button.prototype.processTouch=function(){if(this.isActive()){if(TouchInput.isTriggered()&&this.isButtonTouched()&&(this._touching=!0,this._pressFrame=0,this._moveHandler&&(this._moving=!0),this._lastPositionX=TouchInput.x,this._lastPositionY=TouchInput.y),this._touching&&(this._pressFrame+=1,this._pressFrame>36?(this.callPressHandler(),this._touching=!1):TouchInput.isReleased()||!this.isButtonTouched()?(this._touching=!1,1==this._clickCallReleased&&TouchInput.isReleased()&&this.callClickHandler()):!TouchInput.isPressed()&&this.isButtonTouched()||1==this._clickCallTriggered&&TouchInput.isPressed()&&this.callClickHandler()),this._moveHandler&&1==this._moving){const x=TouchInput.x,y=TouchInput.y;this._lastPositionY==y&&this._lastPositionX==x||(this.callMoveHandler(this._lastPositionX-x,this._lastPositionY-y),this._lastPositionY=y,this._lastPositionX=x),TouchInput.isReleased()&&(this.callMoveReleaseHandler(),this._moving=!1)}}else this._touching=!1},Sprite_Button.prototype.isActive=function(){let node=this;for(;node;){if(!node.visible)return!1;node=node.parent}return!0},Sprite_Button.prototype.isButtonTouched=function(){const x=this.canvasToLocalX(TouchInput.x),y=this.canvasToLocalY(TouchInput.y);return x>=0&&y>=0&&x<this.width*this.scale.x&&y<this.height*this.scale.y},Sprite_Button.prototype.canvasToLocalX=function(x){let node=this;for(;node;)x-=node.x,node=node.parent;return x},Sprite_Button.prototype.canvasToLocalY=function(y){let node=this;for(;node;)y-=node.y,node=node.parent;return y},Sprite_MZButton.prototype=Object.create(Sprite_Clickable.prototype),Sprite_MZButton.prototype.constructor=Sprite_MZButton,Sprite_MZButton.prototype.initialize=function(buttonType){Sprite_Clickable.prototype.initialize.call(this),this._buttonType=buttonType,this._clickHandler=null,this._coldFrame=null,this._hotFrame=null,this.setupFrames()},Sprite_MZButton.prototype.setupFrames=function(){const data=this.buttonData(),x=data.x*this.blockWidth(),width=data.w*this.blockWidth(),height=this.blockHeight();this.loadButtonImage(),this.setColdFrame(x,0,width,height),this.setHotFrame(x,height,width,height),this.updateFrame(),this.updateOpacity()},Sprite_MZButton.prototype.blockWidth=function(){return 48},Sprite_MZButton.prototype.blockHeight=function(){return 48},Sprite_MZButton.prototype.loadButtonImage=function(){this.bitmap=ImageManager.loadSystem("ButtonSet")},Sprite_MZButton.prototype.buttonData=function(){const buttonTable={cancel:{x:0,w:2},pageup:{x:2,w:1},pagedown:{x:3,w:1},down:{x:4,w:1},up:{x:5,w:1},down2:{x:6,w:1},up2:{x:7,w:1},ok:{x:8,w:2},menu:{x:10,w:1}};return buttonTable[this._buttonType]},Sprite_MZButton.prototype.update=function(){Sprite_Clickable.prototype.update.call(this),this.checkBitmap(),this.updateFrame(),this.updateOpacity(),this.processTouch()},Sprite_MZButton.prototype.checkBitmap=function(){if(this.bitmap.isReady()&&this.bitmap.width<11*this.blockWidth())throw new Error("ButtonSet image is too small")},Sprite_MZButton.prototype.updateFrame=function(){const frame=this.isPressed()?this._hotFrame:this._coldFrame;frame&&this.setFrame(frame.x,frame.y,frame.width,frame.height)},Sprite_MZButton.prototype.updateOpacity=function(){this.opacity=this._pressed?255:192},Sprite_MZButton.prototype.setColdFrame=function(x,y,width,height){this._coldFrame=new Rectangle(x,y,width,height)},Sprite_MZButton.prototype.setHotFrame=function(x,y,width,height){this._hotFrame=new Rectangle(x,y,width,height)},Sprite_MZButton.prototype.setClickHandler=function(method){this._clickHandler=method},Sprite_MZButton.prototype.onClick=function(){this._clickHandler?this._clickHandler():Input.virtualClick(this._buttonType)};class Sprite_IconButton extends Sprite_Button{constructor(){super(),this.bitmap=new Bitmap(104,104),this._backSprite=new Sprite,this._backSprite.bitmap=new Bitmap(120,80),this._backSprite.bitmap.fillRect(0,0,120,80,"black"),this._backSprite.x=0,this._backSprite.y=0,this._backSprite.skew.x=-.25,this._backSprite.opacity=128,this.addChild(this._backSprite),this._iconSprite=new Sprite,this._iconSprite.bitmap=ImageManager.loadSystem("IconSet");const iconIndex=156,pw=Window_Base._iconWidth,ph=Window_Base._iconHeight,sx=12*pw,sy=Math.floor(9.75)*ph;this._iconSprite.x=24,this._iconSprite.y=4,this._iconSprite.setFrame(sx,sy,2*pw,2*ph),this.addChild(this._iconSprite),this._textButton=new Sprite,this._textButton.x=24,this._textButton.y=20,this._textButton.bitmap=new Bitmap(62,62),this.addChild(this._textButton)}setup(text){this._textButton.bitmap.clear(),this._textButton.bitmap.fontSize=21,this._textButton.bitmap.drawText(text,0,20,64,40,"center")}callClickHandler(){PopupManager.busy()||super.callClickHandler()}terminate(){gsap.killTweensOf(this._backSprite),gsap.killTweensOf(this._textButton),gsap.killTweensOf(this._iconSprite),this._backSprite.destroy(),this._textButton.destroy(),this._iconSprite.destroy(),this.destroy()}}function Sprite_AnimationMV(){this.initialize.apply(this,arguments)}function Sprite_StateIcon(){this.initialize.apply(this,arguments)}Sprite_AnimationMV.prototype=Object.create(Sprite.prototype),Sprite_AnimationMV.prototype.constructor=Sprite_AnimationMV,Sprite_AnimationMV._checker1={},Sprite_AnimationMV._checker2={},Sprite_AnimationMV.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this._reduceArtifacts=!0,this.initMembers()},Sprite_AnimationMV.prototype.initMembers=function(){this._target=null,this._animation=null,this._mirror=!1,this._noSoundFlag=!1,this._delay=0,this._rate=4,this._duration=0,this._hidingDuration=0,this._bitmap1=null,this._bitmap2=null,this._cellSprites=[],this._duplicated=!1,this.z=8},Sprite_AnimationMV.prototype.setup=function(target,animation,mirror,delay,noSoundFlag){this._target=target,this._animation=animation,this._mirror=mirror,this._delay=delay,this._noSoundFlag=noSoundFlag,this._animation&&(this.remove(),this.setupRate(),this.setupDuration(),this.loadBitmaps(),this.createSprites())},Sprite_AnimationMV.prototype.remove=function(){this.parent&&this.parent.removeChild(this)&&(this._target.setBlendColor([0,0,0,0]),this._target.show())},Sprite_AnimationMV.prototype.terminate=function(){if(this._cellSprites)for(let i=this._cellSprites.length-1;i>=0;i--)this._cellSprites[i]&&this._cellSprites[i].destroy();this._cellSprites=[],this._bitmap1=null,this._bitmap2=null,this._target=null,this._animation=null,this._mirror=null,this._delay=null,this._noSoundFlag=null},Sprite_AnimationMV.prototype.setupRate=function(){this._rate=4},Sprite_AnimationMV.prototype.setupDuration=function(){this._duration=this._animation.frames.length*this._rate+1},Sprite_AnimationMV.prototype.update=function(){Sprite.prototype.update.call(this),this.updateMain(),this.updateHiding(),Sprite_AnimationMV._checker1={},Sprite_AnimationMV._checker2={}},Sprite_AnimationMV.prototype.updateFlash=function(){},Sprite_AnimationMV.prototype.updateScreenFlash=function(){},Sprite_AnimationMV.prototype.absoluteX=function(){let x=0,object=this;for(;object;)x+=object.x,object=object.parent;return x},Sprite_AnimationMV.prototype.absoluteY=function(){let y=0,object=this;for(;object;)y+=object.y,object=object.parent;return y},Sprite_AnimationMV.prototype.updateHiding=function(){this._hidingDuration>0&&(this._hidingDuration--,0===this._hidingDuration&&this._target.show())},Sprite_AnimationMV.prototype.isPlaying=function(){return this._duration>0},Sprite_AnimationMV.prototype.loadBitmaps=function(){const name1=this._animation.animation1Name,name2=this._animation.animation2Name;this._bitmap1=ImageManager.loadAnimation(name1),this._bitmap2=ImageManager.loadAnimation(name2)},Sprite_AnimationMV.prototype.isReady=function(){return this._bitmap1&&this._bitmap1.isReady()&&this._bitmap2&&this._bitmap2.isReady()},Sprite_AnimationMV.prototype.createSprites=function(){Sprite_AnimationMV._checker2[this._animation]||(this.createCellSprites(),3===this._animation.position&&(Sprite_AnimationMV._checker2[this._animation]=!0)),Sprite_AnimationMV._checker1[this._animation]?this._duplicated=!0:(this._duplicated=!1,3===this._animation.position&&(Sprite_AnimationMV._checker1[this._animation]=!0))},Sprite_AnimationMV.prototype.createCellSprites=function(){this._cellSprites=[];for(let i=0;i<16;i++){let sprite=new Sprite;sprite.anchor.x=.5,sprite.anchor.y=.5,this._cellSprites.push(sprite),this.addChild(sprite)}},Sprite_AnimationMV.prototype.createScreenFlashSprite=function(){},Sprite_AnimationMV.prototype.updateMain=function(){this.isPlaying()&&this.isReady()?this._delay>0?this._delay--:(this._duration--,this.updatePosition(),this._duration%this._rate==0&&this.updateFrame()):this.isReady()&&this.terminate()},Sprite_AnimationMV.prototype.updatePosition=function(){if(3===this._animation.position)this.x=Graphics.width/2,this.y=Graphics.height/2;else{const parent=this._target.parent,grandparent=parent?parent.parent:null;this.x=this._target.x,this.y=this._target.y,this.parent===grandparent&&(this.x+=parent.x,this.y+=parent.y),0===this._animation.position?this.y-=this._target.height:1===this._animation.position&&(this.y-=this._target.height/2)}},Sprite_AnimationMV.prototype.updateFrame=function(){if(this._duration>0){const frameIndex=this.currentFrameIndex();this.updateAllCellSprites(this._animation.frames[frameIndex]),this._animation.timings.forEach((function(timing){timing.frame===frameIndex&&this.processTimingData(timing)}),this)}},Sprite_AnimationMV.prototype.currentFrameIndex=function(){return this._animation.frames.length-Math.floor((this._duration+this._rate-1)/this._rate)},Sprite_AnimationMV.prototype.updateAllCellSprites=function(frame){for(let i=0;i<this._cellSprites.length;i++){const sprite=this._cellSprites[i];i<frame.length?this.updateCellSprite(sprite,frame[i]):sprite.visible=!1}},Sprite_AnimationMV.prototype.updateCellSprite=function(sprite,cell){const pattern=cell[0];if(pattern>=0){const sx=pattern%5*192,sy=192*Math.floor(pattern%100/5),mirror=this._mirror;sprite.bitmap=pattern<100?this._bitmap1:this._bitmap2,sprite.setFrame(sx,sy,192,192),sprite.x=cell[1],sprite.y=cell[2],sprite.rotation=cell[4]*Math.PI/180,sprite.scale.x=cell[3]/100,cell[5]&&(sprite.scale.x*=-1),mirror&&(sprite.x*=-1,sprite.rotation*=-1,sprite.scale.x*=-1),sprite.scale.y=cell[3]/100,sprite.opacity=cell[6],sprite.blendMode=cell[7],sprite.visible=!0}else sprite.visible=!1},Sprite_AnimationMV.prototype.processTimingData=function(timing){const duration=timing.flashDuration*this._rate;switch(timing.flashScope){case 1:this.startFlash(timing.flashColor,duration);break;case 2:this.startScreenFlash(timing.flashColor,duration);break;case 3:this.startHiding(duration)}if(!this._duplicated&&timing.se&&!this._noSoundFlag){let soundData={name:timing.se.name,volume:.7*timing.se.volume,pitch:timing.se.pitch,pan:timing.se.pan};AudioManager.playSe(soundData)}},Sprite_AnimationMV.prototype.startFlash=function(color,duration){},Sprite_AnimationMV.prototype.startScreenFlash=function(color,duration){1==$dataOption.getUserData("displayEffect")&&EventManager.startFlash(color,duration)},Sprite_AnimationMV.prototype.startHiding=function(duration){this._hidingDuration=duration,this._target.hide()},Sprite_StateIcon.prototype=Object.create(Sprite.prototype),Sprite_StateIcon.prototype.constructor=Sprite_StateIcon,Sprite_StateIcon.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this.initMembers(),this.loadBitmap()},Sprite_StateIcon._iconWidth=32,Sprite_StateIcon._iconHeight=32,Sprite_StateIcon.prototype.initMembers=function(){this._battler=null,this._iconIndex=0,this._animationCount=0,this._animationIndex=0,this.anchor.x=.5,this.anchor.y=.5,this._lastLength=0},Sprite_StateIcon.prototype.loadBitmap=function(){this.bitmap=ImageManager.loadSystem("IconSet"),this.setFrame(0,0,0,0),this._sprite=new Sprite,this._sprite.x=2,this._sprite.y=-24,this.addChild(this._sprite)},Sprite_StateIcon.prototype.setup=function(battler){this._battler=battler,this._animationCount=0},Sprite_StateIcon.prototype.update=function(){Sprite.prototype.update.call(this);const states=this.states();states.length!=this._lastLength&&(this._lastLength=states.length,this._animationCount=0),0==this._animationCount&&(this.updateIcon(states),this.updateFrame()),this._animationCount++,this._animationCount>=this.animationWait()&&(this._animationCount=0)},Sprite_StateIcon.prototype.animationWait=function(){return 60},Sprite_StateIcon.prototype.updateIcon=function(states){states.length>0?(this._animationIndex++,this._animationIndex>=states.length&&(this._animationIndex=0),this._iconIndex=states[this._animationIndex].iconIndex,this.createIconBadge(states[this._animationIndex])):(this._animationIndex=0,this._iconIndex=0,this._sprite.bitmap&&this._sprite.bitmap.clear())},Sprite_StateIcon.prototype.updateFrame=function(){var pw=Sprite_StateIcon._iconWidth,ph=Sprite_StateIcon._iconHeight,sx=this._iconIndex%16*pw,sy=Math.floor(this._iconIndex/16)*ph;this.setFrame(sx,sy,pw,ph)},Sprite_StateIcon.prototype.createIconBadge=function(state){this._sprite.bitmap=new Bitmap(24,24);const stateData=this._battler.getStateData(state.id);if(null==stateData)return;if(stateData.turns>900||stateData.turns<0)return;if(0==$dataStates[state.id].autoRemovalTiming)return;let badge=null,bitmap=new Bitmap(24,24);switch(bitmap.fontSize=18,bitmap.textColor="#ff3810",bitmap.drawText("●",0,0,24,24),bitmap.fontSize=14,bitmap.textColor="White",state.id){case $gameStateInfo.getStateId(StateType.CHARGE):badge=this._battler.getStateEffectTotal($gameStateInfo.getStateId(StateType.CHARGE));break;case $gameStateInfo.getStateId(StateType.VANTAGE):case $gameStateInfo.getStateId(StateType.DISCHARGE):case $gameStateInfo.getStateId(StateType.INVISIBLE):badge=stateData.effect;break;default:stateData&&(badge=stateData.turns)}bitmap.drawText(badge,5,1,20,20),this._sprite.bitmap=bitmap},Sprite_StateIcon.prototype.states=function(){let states=[];return this._battler&&this._battler.isAlive()&&(states=this._battler.stateIcons(),states=_.filter(states,state=>0!=state.priority&&0!=state.iconIndex)),states};class Sprite_Title extends Sprite{constructor(){super(),this.anchor.x=this.anchor.y=.5,this._textArray=[],this._textSprite=[],this._textSprite2=[],this._bgSprite=null}setup(text,x,y){void 0===x&&(x=240),void 0===y&&(y=264),this.x=x,this.y=y;let sprite=new Sprite,bitmap=new Bitmap(640,52);const baseWidth=640,margin=120;bitmap.gradientFillRect(0,0,120,120,"black","white",!1),bitmap.fillRect(120,0,400,120,"white"),bitmap.gradientFillRect(520,0,120,120,"white","black",!1),sprite.bitmap=bitmap,sprite.anchor.x=0,sprite.anchor.y=.5,sprite.x=-96,this._bgSprite=sprite,this.addChild(sprite),this._textArray=text.split(""),this._textArray.forEach(char=>{let sprite=new Sprite,bitmap=new Bitmap(48,48);bitmap.fontSize=32,bitmap.drawText(char,24,0,48,48),sprite.anchor.x=0,sprite.anchor.y=.5,sprite.alpha=1,sprite.bitmap=bitmap,this.addChild(sprite),this._textSprite.push(sprite)}),this._textArray.forEach(char=>{let sprite=new Sprite,bitmap=new Bitmap(96,48);bitmap.fontSize=32,bitmap.drawText(char,24,0,96,48,null,!0,!0),sprite.anchor.x=0,sprite.anchor.y=.5,sprite.alpha=0,sprite.bitmap=bitmap,this.addChild(sprite),this._textSprite2.push(sprite)})}start(endCall){let offsetX=0;const length=this._textArray.length;17>length&&(offsetX=12*(17-length));let idx=0;this._textSprite.forEach(sprite=>{sprite.width=24,sprite.x=offsetX,gsap.to(sprite,1,{width:48}),gsap.to(sprite,2,{x:sprite.x+24*idx,alpha:1}),gsap.to(sprite,.5,{alpha:0,delay:1.9}),idx+=1}),idx=0,this._textSprite2.forEach(sprite=>{sprite.x=offsetX,gsap.to(sprite,2,{x:sprite.x+24*idx}),gsap.to(sprite,.5,{alpha:1,delay:2}),idx+=1}),this._bgSprite.scale.x=0,this._bgSprite.opacity=0,gsap.to(this._bgSprite.scale,2,{x:1}),gsap.to(this._bgSprite,2,{opacity:128}),gsap.to(this._bgSprite,.5,{opacity:224,delay:2}),endCall&&gsap.to(this,6,{onComplete:function(){endCall()}})}reset(){this._textSprite.forEach(sprite=>{gsap.to(sprite,.25,{alpha:0,onComplete:function(){sprite.destroy()}})}),this._textSprite2.forEach(sprite=>{gsap.to(sprite,.25,{alpha:0,onComplete:function(){sprite.destroy()}})});var self=this;gsap.to(this._bgSprite,.25,{alpha:0,onComplete:function(){self._bgSprite.destroy(),self._bgSprite=null}}),this._textSprite=[],this._textSprite2=[]}}class Sprite_TransFade extends Sprite{constructor(){super(),this._animation=null}transLeft(speedRate){this._animation&&this._animation.kill(),this.x=-2e3,this._animation=gsap.to(this,.8*speedRate,{pixi:{x:this.x+3e3},onComplete:function(){this.x=2560}.bind(this)})}transRight(speedRate){this._animation&&this._animation.kill(),this.x=480,this._animation=gsap.to(this,.8*speedRate,{pixi:{x:this.x-3e3},onComplete:function(){this.x=-2560}.bind(this)})}}class Sprite_Particle extends ScreenSprite{constructor(){super(),this._emitter=null,this._pause=!1,this._distinct=!1}loadTexture(filename){return new Promise(resolve=>{ImageManager.loadParticle(filename,null,resolve())})}loadParticleData(filename){return new Promise(resolve=>DataManager.loadParticleFile(filename,resolve))}async setup(parent,filename,ext,start){void 0===ext&&(ext={}),void 0===start&&(start=0),this.clear(),await this.loadTexture(filename);var data=await this.loadParticleData(filename);ext.pos&&(data.pos.x=ext.pos.x,data.pos.y=ext.pos.y),this._emitter=new PIXI.particles.Emitter(parent,[new Sprite(ImageManager.loadParticle(filename)).texture],data),this._emitter.emit=!0,this._emitter.update(start)}clear(){this._emitter&&this._emitter.cleanup(),this._emitter&&this._emitter.emit&&(this._emitter.emit=!1),this._emitter=null}update(){this._emitter&&!this._pause&&(1==this._distinct?this.updateDistinct():this._emitter.update(.016))}updateDistinct(){Graphics.frameCount%30==0&&this._emitter.update(.16)}pause(){this._pause=!0}resume(){this._pause=!1}distinct(flag){this._distinct=flag}}class Sprite_BackGround extends TilingSprite{constructor(width,height){super(),this._defalutWidth=width,this._defalutHeight=height,this._init=!1,this._anim=[]}resetPosition(){const width=this._bitmap?this._bitmap.width:this._defalutWidth,height=this._bitmap?this._bitmap.height:this._defalutHeight,scaleX=this._bitmap?this._defalutWidth/width:1,scaleY=this._bitmap?this._defalutHeight/height:1,marginX=this._bitmap?(this._defalutWidth-width)/2:0,marginY=this._bitmap?(this._defalutHeight-height)/2:0,x=width/2+marginX,y=height/2+marginY;this.move(x,y,width,height),this.anchor.x=.5,this.anchor.y=.5,this.origin.x=0,this.origin.y=0,this.scale.x=scaleX,this.scale.y=scaleY}moveFront(rate){this.seekAnim(),this.killAnim();let anim=new TimelineMax;anim.to(this,.12*rate,{pixi:{y:this.y-6}}).to(this,.12*rate,{pixi:{y:this.y}}),this._anim.push(anim)}moveLeft(rate){const origin=this.origin,baseWidth=this.bitmap.width;let width=baseWidth;origin.x%baseWidth!=0&&(width+=origin.x%baseWidth+baseWidth);let lastOriginX=origin.x;lastOriginX%baseWidth!=0&&(lastOriginX-=lastOriginX%baseWidth);const per=Math.floor(lastOriginX/baseWidth);0!=per&&(lastOriginX-=per*baseWidth);const self=this;let anim=gsap.to(origin,.5*rate,{x:origin.x-width,onComplete:function(){self.origin.x=lastOriginX}});this._anim.push(anim)}moveRight(rate){const origin=this.origin,baseWidth=this.bitmap.width;let width=baseWidth;origin.x%baseWidth!=0&&(width-=origin.x%baseWidth-baseWidth);let lastOriginX=origin.x;lastOriginX%baseWidth!=0&&(lastOriginX-=lastOriginX%baseWidth);const per=Math.floor(lastOriginX/baseWidth);0!=per&&(lastOriginX-=per*baseWidth);const self=this;let anim=gsap.to(origin,.5*rate,{x:origin.x+width,onComplete:function(){self.origin.x=lastOriginX}});this._anim.push(anim)}fadeIn(duration,opacity){this.killAnim(),this.opacity=opacity;let anim=new TimelineMax;anim.to(this,duration,{opacity:255}),this._anim.push(anim)}fadeOut(duration,opacity){this.killAnim(),this.opacity=opacity;let anim=new TimelineMax;anim.to(this,duration,{opacity:0}),this._anim.push(anim)}frontBlur(opacity){this.killAnim(),this.opacity=opacity,this.scale.x=this.scale.y=1;let anim=new TimelineMax;anim.to(this,.5,{opacity:0,pixi:{scaleX:1.1,scaleY:1.1},onComplete:()=>{this.parent.removeChild(this),this.destroy()}}),this._anim.push(anim)}setRotation(duration,r){this.killAnim();let anim=new TimelineMax;anim.to(this,duration,{rotation:r}),this._anim.push(anim)}zoom(duration,zoomX,zoomY){this.killAnim();let anim=new TimelineMax;anim.to(this,duration,{pixi:{scaleX:zoomX,scaleY:zoomY}}),this._anim.push(anim)}moveDirection(duration,x,y){this.killAnim();let anim=new TimelineMax;anim.to(this,duration,{x:this.x+x,y:this.y+y,ease:Power0.easeNone}),this._anim.push(anim)}moveUV(duration,x,y,repeat){void 0===repeat&&(repeat=!1),this.killAnim();const rep=1==repeat?-1:0;let anim=gsap.to(this.origin,duration,{x:this.origin.x+x,y:this.origin.y+y,repeat:rep,ease:Power0.easeNone});this._anim.push(anim)}setSize(width,height){this.move(width/2,height/2,width,height),this.origin.x=0,this.origin.y=0}seekAnim(){this._anim.forEach(anim=>{anim.seek(anim.endTime())})}killAnim(){this._anim.forEach(anim=>{anim.kill()}),this._anim=[]}pause(){this._anim.forEach(anim=>{anim.pause()})}resume(){this._anim.forEach(anim=>{anim.resume()})}terminate(){this.killAnim(),this.filters=[],this.destroy()}update(){super.update(),null!=this._bitmap._baseTexture&&0==this._init&&(this.resetPosition(),this._init=!0)}}class Sprite_StageTitle extends Sprite{constructor(){super(),this.terminateTime=4}setup(no,name){this.createActsSprite(no),this.createNameSprite(name),this.start()}createActsSprite(no){this._acts=[];let _acts=["A","c","t"],numberArray;no.toString().split("").forEach(number=>{_acts.push(number)}),_acts.push("."),_acts.forEach((char,index)=>{let sprite=new Sprite,bitmap=new Bitmap(40,40);bitmap.fontSize=21,bitmap.drawText(char,0,0,40,40,"center",!0,!0),sprite.bitmap=bitmap,sprite.scale.x=1,sprite.scale.y=.8,sprite.x=40+14*index,sprite.y=16,sprite.opacity=0,this.addChild(sprite),this._acts.push(sprite)})}createNameSprite(name){let _name;this._names=[],name.split("").forEach((char,index)=>{let sprite=new Sprite,bitmap=new Bitmap(120,120);bitmap.drawText(char,0,0,120,120,"center",!0,!0),sprite.bitmap=bitmap,sprite.x=24+24*index,sprite.y=0,sprite.opacity=0,this.addChild(sprite),this._names.push(sprite)})}start(){const terminate=this.terminateTime;this._acts.forEach((act,index)=>{gsap.to(act,1,{x:14*index,opacity:255,delay:.05*index}),gsap.to(act,1,{opacity:0,delay:terminate,onComplete:function(){act.destroy()}})}),this._names.forEach((name,index)=>{gsap.to(name,.5,{x:40+24*index-48,opacity:255,delay:1.2+.1*index}),gsap.to(name,1,{opacity:0,delay:terminate,onComplete:function(){name.destroy()}})})}terminate(){this._acts.forEach(act=>{gsap.killTweensOf(act),null!=act&&null!=act._texture&&act.destroy()}),this._acts=[],this._names.forEach(name=>{gsap.killTweensOf(name),null!=name&&null!=name._texture&&name.destroy()}),this._names=[],this.destroy()}}class Sprite_MapName extends Sprite{constructor(){super(),this.y=270,this._backBlack=new Sprite,this._backBlack.bitmap=new Bitmap(960,64),this._backBlack.anchor.y=.5,this._backBlack.bitmap.fillAll("rgba(0, 0, 0, 0.5)"),this.addChild(this._backBlack),this._frontWhite=new Sprite,this._frontWhite.anchor.y=.5,this._frontWhite.y=-32,this._frontWhite.bitmap=ImageManager.loadSystem("Window"),this._frontWhite.setFrame(128,0,40,8),this._frontWhite.scale.x=24,this.addChild(this._frontWhite),this._backWhite=new Sprite,this._backWhite.anchor.y=.5,this._backWhite.y=32,this._backWhite.bitmap=ImageManager.loadSystem("Window"),this._backWhite.setFrame(128,0,40,8),this._backWhite.scale.x=24,this.addChild(this._backWhite),this._textSprite=new Sprite,this._textSprite.anchor.y=.5,this._textSprite.bitmap=new Bitmap(960,64),this.addChild(this._textSprite)}start(text){const dispText=TextManager.convertEscapeCharacters(text);this._textSprite.bitmap.clear(),this._textSprite.bitmap.drawText(dispText,0,0,960,64,"center"),this.showAnimation()}showAnimation(){const duration=.5;this._backBlack.alpha=0,gsap.to(this._backBlack,.5,{alpha:1}),this._frontWhite.x=960,gsap.to(this._frontWhite,.5,{x:0}),this._backWhite.x=-960,gsap.to(this._backWhite,.5,{x:0}),this._textSprite.width=0;let self=this;gsap.to(this._textSprite,.5,{width:960,onComplete:function(){self.hideAnimation()}})}hideAnimation(){const duration=.4,wait=1.2;gsap.to(this._backBlack,.4,{alpha:0,height:0,delay:1.2}),gsap.to(this._frontWhite,.4,{x:0,y:0,alpha:0,delay:1.2}),gsap.to(this._backWhite,.4,{x:0,y:0,alpha:0,delay:1.2});let self=this;gsap.to(this._textSprite,.4,{alpha:0,delay:1.2,onComplete:function(){self.terminate()}})}terminate(){gsap.killTweensOf(this),this.destroy()}}class Sprite_NextStage extends Sprite{constructor(title,endCall){super(),this._linesSprites=[],this._nextSprites=[],this._titleSprites=[],this._next=["N","e","x","t","","","","i","s"],this._title=title,this._title=this._title.split(""),this._whiteScreen=new ScreenSprite,this._whiteScreen.setColor(255,255,255),this.addChild(this._whiteScreen),this._whiteScreen.opacity=180;for(let i=0;i<12;i++)this.createLines(i);for(let i=0;i<9;i++)this.createNext(i);for(let i=0;i<this._title.length;i++)this.createTitle(i);this._endCall=endCall}createLines(){let sprite=new Sprite;sprite.x=280,sprite.anchor.x=1,sprite.anchor.y=.5,sprite.scale.x=1,sprite.scale.y=24;let bitmap=new Bitmap(2,64);sprite.bitmap=bitmap,sprite.bitmap.fillAll("white"),this.addChild(sprite),this._linesSprites.push(sprite)}createNext(idx){let sprite=new Sprite;sprite.x=36*idx+464,sprite.y=400,sprite.anchor.x=.5,sprite.anchor.y=.5,sprite.scale.x=1,sprite.scale.y=1,sprite.opacity=0;let bitmap=new Bitmap(64,64);bitmap.fontSize=32,sprite.bitmap=bitmap,sprite.bitmap.drawText(this._next[idx],0,0,64,64,"center"),this.addChild(sprite),this._nextSprites.push(sprite)}createTitle(idx){let sprite=new Sprite;sprite.x=36*idx+496,sprite.y=482,sprite.anchor.x=.5,sprite.anchor.y=.5,sprite.opacity=0;let bitmap=new Bitmap(64,64);bitmap.fontSize=32,sprite.bitmap=bitmap,sprite.bitmap.drawText(this._title[idx],0,0,64,64,"center"),this.addChild(sprite),this._titleSprites.push(sprite)}start(){let tl,t2,t3,t4,t5,t6,t7,t8,t9,t10,t11,t12;FilterMzUtility.addFilter(FilterType.OldFilmFade),gsap.to(this._whiteScreen,6,{opacity:0}),(new TimelineMax).to(this._linesSprites[0],.4,{x:this._linesSprites[0].x-64,opacity:128}).to(this._linesSprites[0],.8,{x:this._linesSprites[0].x-88,opacity:0}),(new TimelineMax).to(this._linesSprites[1],.4,{x:this._linesSprites[1].x+64,opacity:128,delay:.28}).to(this._linesSprites[1],.8,{x:this._linesSprites[1].x+72,opacity:0}),(new TimelineMax).to(this._linesSprites[2],.4,{x:this._linesSprites[2].x+96,opacity:128,delay:.56}).to(this._linesSprites[2],.8,{x:this._linesSprites[2].x+120,opacity:0}),(new TimelineMax).to(this._linesSprites[3],.4,{x:this._linesSprites[3].x+280,opacity:128,delay:.3*3}).to(this._linesSprites[3],2.4,{x:this._linesSprites[3].x+328,opacity:0}),(new TimelineMax).to(this._linesSprites[4],.4,{x:this._linesSprites[4].x+96,opacity:128,delay:1.25}).to(this._linesSprites[4],2,{x:this._linesSprites[4].x+128,opacity:0}),(new TimelineMax).to(this._linesSprites[5],.4,{x:this._linesSprites[5].x+200,opacity:128,delay:1.5}).to(this._linesSprites[5],1.6,{x:this._linesSprites[5].x+248,opacity:0}),(new TimelineMax).to(this._linesSprites[6],.4,{x:this._linesSprites[6].x+400,opacity:128,delay:1.75}).to(this._linesSprites[6],1.2,{x:this._linesSprites[6].x+448,opacity:0}),(new TimelineMax).to(this._linesSprites[7],.4,{x:this._linesSprites[7].x+280,opacity:128,delay:2.5}).to(this._linesSprites[7],1.2,{x:this._linesSprites[7].x+256,opacity:0}),(new TimelineMax).to(this._linesSprites[8],.3,{x:this._linesSprites[8].x+200,opacity:128,delay:2.5}).to(this._linesSprites[8],2,{x:this._linesSprites[8].x+174,opacity:0}),(new TimelineMax).to(this._linesSprites[9],.2,{x:this._linesSprites[9].x+140,opacity:128,delay:2.5}).to(this._linesSprites[9],2,{x:this._linesSprites[9].x+80,opacity:0}),(new TimelineMax).to(this._linesSprites[10],.4,{x:this._linesSprites[10].x+360,opacity:128,delay:3}).to(this._linesSprites[10],2.4,{x:this._linesSprites[10].x+520,opacity:0}),(new TimelineMax).to(this._linesSprites[11],.4,{x:this._linesSprites[11].x+360,opacity:128,delay:3}).to(this._linesSprites[11],1.2,{x:this._linesSprites[11].x+320,opacity:0}),this._nextSprites.forEach((next,index)=>{index<4?gsap.to(next,1,{x:28*index+440,opacity:255,delay:.8+.2*index}):(next.x=440,next.y=440,gsap.to(next,1,{x:28*(index-7)+440,opacity:255,delay:.8+.2*index}))}),this._titleSprites.forEach((title,index)=>{gsap.to(title,1,{x:28*index+440,opacity:255,delay:3+.01*index})});let self=this;gsap.to(this,5.25,{onComplete:function(){gsap.to(self,1,{opacity:0})}}),gsap.to(this,6.5,{onComplete:function(){self.terminate()}})}terminate(){this._endCall&&this._endCall(),this._endCall=null,FilterMzUtility.removeFilter(FilterType.OldFilmFade),gsap.killTweensOf(this),this.destroy()}}class Sprite_Element extends Sprite{constructor(x,y){super(),this._baseX=x,this.x=x,this.y=y,this.bitmap=ImageManager.loadSystem("elements")}baseX(){return this._baseX}terminate(){gsap.killTweensOf(this),this.destroy()}}class Sprite_TimeLine extends Sprite{constructor(){super(),this.anchor.x=this.anchor.y=.5,this._yearArray=["0","1","2","3","4","5","6","7","8","9","10","11","12"],this._monthArray=["Jan","Mar","May","Jul","Sep","Nov"],this._yearSprite=[],this._monthSprite=[]}setup(x,y){this.x=540,this.y=200,this._yearArray.forEach((char,index)=>{let sprite=new Sprite,bitmap=new Bitmap(120,120);bitmap.fontSize=22,bitmap.drawText(char,0,0,48,120),sprite.anchor.x=.5,sprite.alpha=0,sprite.bitmap=bitmap,sprite.x=-360*index-134,sprite.y=128,this.addChild(sprite),this._yearSprite.push(sprite)}),this._monthArray=this._monthArray.reverse();let sprite=new Sprite_BackGround;sprite.anchor.x=.5,sprite.alpha=0;var bitmap=new Bitmap(1080,120);bitmap.fontSize=16;for(var i=0;i<3;i++)this._monthArray.forEach((char,index)=>{bitmap.drawText(char,1080-(60*index+360*i)-60,0,48,120,"center")});sprite.bitmap=bitmap,sprite.setSize(1080,120),sprite.x=0,sprite.y=224,this.addChild(sprite),this._monthSprite.push(sprite),gsap.to(sprite.origin,8,{x:-1*x}),gsap.to(sprite,2,{alpha:1}),this._yearSprite.forEach(element=>{gsap.to(element,8,{x:x+element.x}),gsap.to(element,2,{alpha:1})})}endTimeLine(){const self=this;gsap.to(this,1,{alpha:0,onComplete:function(){self.terminate()}})}terminate(){gsap.killTweensOf(this),this._yearSprite.forEach(element=>{gsap.killTweensOf(element)}),this._monthSprite.forEach(element=>{gsap.killTweensOf(element)}),this.parent&&this.parent.removeChild(this),this._yearArray=null,this._monthArray=null,this._yearSprite=null,this._monthSprite=null,this.parent&&this.parent.removeChild(this),this.destroy()}}class Sprite_MenuBack extends Sprite{constructor(){super(),this._window2=new ScreenSprite,this._window2.setColor(255,255,255),this.addChild(this._window2),this._window2.opacity=224,this._window=new ScreenSprite,this._window.setColor(255,255,255),this._window.opacity=200,this.addChild(this._window);let menuBackFilter=new PIXI.filters.MenuBackFilter;this._window.filters=[menuBackFilter],this._weather=new PIXI.Graphics,this._weather.x=Graphics.width/2,this._weather.y=Graphics.height/2,this.addChild(this._weather),this._partcle=new Sprite_Particle,this.addChild(this._partcle),this._partcle.setup(this._weather,"menu")}update(){super.update(),this._window&&this._window.filters.length>0&&(this._window.filters[0].uniforms.time=.01*Graphics.frameCount)}terminate(){this._window.destroy(),this._window=null,this._window2.destroy(),this._window2=null,this._partcle.destroy(),this._partcle=null,this._weather.destroy(),this._weather=null,this.destroy()}}class Sprite_Ready extends Sprite{constructor(){super(),this._sprites=[]}setup(okAction){this.createBack(),this.createLine(),this.createBackReady();const self=this;gsap.to(this,0,{delay:2.2,onComplete:function(){FilterMzUtility.addFilter(FilterType.BlurFade)}.bind(this)}),gsap.to(this,0,{delay:4,onComplete:function(){okAction&&okAction(),FilterMzUtility.removeFilter(FilterType.BlurFade),self.terminate()}.bind(this)})}createLine(){this._frontWhite=new Sprite,this._frontWhite.anchor.y=.5,this._frontWhite.y=238,this._frontWhite.bitmap=ImageManager.loadSystem("Window"),this._frontWhite.setFrame(128,0,40,8),this._frontWhite.scale.x=24,this._frontWhite.x=960;const duration=.25;gsap.to(this._frontWhite,.25,{x:0,delay:.8}),this._backWhite=new Sprite,this._backWhite.anchor.y=.5,this._backWhite.y=302,this._backWhite.bitmap=ImageManager.loadSystem("Window"),this._backWhite.setFrame(128,0,40,8),this._backWhite.scale.x=24,this._backWhite.x=-960,gsap.to(this._backWhite,.25,{x:0,delay:.8})}createBack(){this._backBlack=new Sprite,this._backBlack.bitmap=new Bitmap(960,64),this._backBlack.anchor.y=.5,this._backBlack.y=270,this._backBlack.bitmap.fillAll("rgba(0, 0, 0, 0.5)"),this.addChild(this._backBlack),this._backBlack.alpha=0,gsap.to(this._backBlack,.5,{alpha:1,delay:.8})}createBackReady(){this._textSprite=new Sprite,this._textSprite.y=270,this._textSprite.anchor.y=.5;let bitmap=new Bitmap(960,64);bitmap.fontSize=32,bitmap.drawText(TextManager.getText(400500),0,0,960,64,"center"),this._textSprite.bitmap=bitmap,this.addChild(this._textSprite),this._sprites.push(this._textSprite),this._textSprite.width=0;let self=this;gsap.to(this._textSprite,.5,{width:965,delay:.8,onComplete:function(){self.hideAnimation()}})}hideAnimation(){const duration=.4,wait=1;gsap.to(this._backBlack,.4,{alpha:0,height:0,delay:1}),gsap.to(this._frontWhite,.4,{x:0,y:270,alpha:0,delay:1}),gsap.to(this._backWhite,.4,{x:0,y:270,alpha:0,delay:1});let self=this;gsap.to(this._textSprite,.4,{alpha:0,delay:1,onComplete:function(){}})}terminate(){for(let i=this._sprites.length-1;i>=0;i--)gsap.killTweensOf(this._sprites[i]),this._sprites[i].destroy();gsap.killTweensOf(this),this.parent&&this.parent.removeChild(this),this.destroy()}}class Sprite_Levelup extends Sprite{constructor(){super()}setup(levelUpType){const text=this.levelupText(levelUpType);return this.createText(text,32),new Promise(resolve=>{this.start(.5,()=>{resolve()})})}setupNewRecord(levelUpType,recordData){let text=this.levelupText(levelUpType);return recordData.old&&(text+="  "+recordData.old+TextManager.getText(900500)+TextManager.getText(900501)),recordData.new&&(text+="  "+recordData.new+TextManager.getText(900500)),this.createText(text,21),new Promise(resolve=>{this.start(2,()=>{resolve()})})}createText(text,fontSize){this.y=270,this._backBlack=new Sprite,this._backBlack.bitmap=new Bitmap(960,64),this._backBlack.anchor.y=.5,this._backBlack.bitmap.fillAll("rgba(0, 0, 0, 0.5)"),this.addChild(this._backBlack),this._textSprite=new Sprite,this._textSprite.anchor.y=.5,this._textSprite.bitmap=new Bitmap(960,64),this._textSprite.bitmap.fontSize=fontSize,this._textSprite.bitmap.drawText(text,0,0,960,64,"center"),this.addChild(this._textSprite)}levelupText(levelUpType){switch(levelUpType){case LevelUpType.Level:return TextManager.getText(601200);case LevelUpType.SkillAwake:return TextManager.getText(601210);case LevelUpType.Both:return TextManager.getText(601220);case LevelUpType.Victory:return TextManager.getText(601230);case LevelUpType.Lose:return TextManager.getText(601240);case LevelUpType.NewRecord:return TextManager.getText(901e3)}}start(delay,endCall){let anim;(new TimelineMax).to(this._textSprite,.5,{x:0,opacity:255}).to(this._textSprite,.3,{}),this._backBlack.alpha=0,gsap.to(this._backBlack,.5,{alpha:1}),this._textSprite.width=0;let self=this;gsap.to(this._textSprite,.5,{width:960}),gsap.to(this._textSprite,delay,{onComplete:function(){self.hideAnimation(endCall)}})}hideAnimation(endCall){const duration=.4,wait=.8;gsap.to(this._backBlack,.4,{alpha:0,height:0,delay:.8});let self=this;gsap.to(this._textSprite,.4,{alpha:0,delay:.8,onComplete:function(){self.terminate(),endCall&&endCall()}})}terminate(){gsap.killTweensOf(this),this.parent&&this.parent.removeChild(this),this.destroy()}}const LevelUpType={Level:1,SkillAwake:2,Both:11,Victory:101,Lose:102,NewRecord:201};class Sprite_MapDock extends Sprite{constructor(mapSprite,skipCallBack){super(),this._mapSprite=mapSprite,this._skipCallBack=skipCallBack,this.createButtons(),this.createSprites()}callSkip(){this._skipCallBack&&this._skipCallBack()}createButtons(){this.createMapScalePlus(),this.createMapScaleMinus(),this.createStageSkip()}createMapScalePlus(){this._mapScalePlus=new Sprite_Button,this._mapScalePlus.bitmap=new Bitmap(28,28),this._mapScalePlus.bitmap.fontSize=21,this._mapScalePlus.bitmap.drawText(TextManager.getText(5000030),0,0,28,28),this._mapScalePlus.x=824,this._mapScalePlus.y=6,this._mapScalePlus.setClickHandler(isScaleUp=>this.mapScaleChange(!0))}createMapScaleMinus(){this._mapScaleMinus=new Sprite_Button,this._mapScaleMinus.bitmap=new Bitmap(28,28),this._mapScaleMinus.bitmap.fontSize=21,this._mapScaleMinus.bitmap.drawText(TextManager.getText(5000040),0,0,28,28),this._mapScaleMinus.x=720,this._mapScaleMinus.y=6,this._mapScaleMinus.setClickHandler(isScaleUp=>this.mapScaleChange(!1))}createStageSkip(){this._skipButton=new Sprite_KeyMapButton,$gameSystem.isMenuEnabled()&&this.addChild(this._skipButton),this._skipButton.x=864,this._skipButton.y=4,this._skipButton.setClickHandler(this.callSkip.bind(this)),this._skipButton.setText(TextManager.getText(5000020))}mapScaleChange(isScaleUp){this._mapSprite.mapModeChange()}createSprites(){this.createMapScaleSprite()}createMapScaleSprite(){this._mapScaleSprite=new Sprite_KeyMapButton,this.addChild(this._mapScaleSprite),this._mapScaleSprite.x=736,$gameSystem.isMenuEnabled()||(this._mapScaleSprite.x=824),this._mapScaleSprite.y=4,this._mapScaleSprite.setClickHandler(this.mapScaleChange.bind(this)),this._mapScaleSprite.setText(TextManager.getText(5000010))}}class Sprite_ChallengeDock extends Sprite{constructor(callBack){super(),this._callBack=callBack,this.createButtons()}callBack(){this._callBack&&(SoundManager.playCancel(),this._callBack())}createButtons(){this.createStageSkip()}createStageSkip(){this._challengeEndButton=new Sprite_KeyMapButton,this.addChild(this._challengeEndButton),this._challengeEndButton.x=720,this._challengeEndButton.y=4,this._challengeEndButton.setClickHandler(this.callBack.bind(this)),this._challengeEndButton.setText(TextManager.getText(739))}}class Sprite_StageDock extends Sprite{constructor(){super(),this.createButtons()}createButtons(){this.createStageInfo()}createStageInfo(){this._stageInfoButton=new Sprite_KeyMapButton,this.addChild(this._stageInfoButton),this._stageInfoButton.y=4,this._stageInfoButton.setClickHandler(this.callStageInfo.bind(this)),this._stageInfoButton.setText(TextManager.getText(725)),this._stageInfoButton.x=944-this._stageInfoButton.width}callStageInfo(){SoundManager.playOk()}}class Sprite_BattleDock extends Sprite{constructor(){super(),this._action={},this.createButtons(),this.hideGuardButton(),this.hideSkillChangeButton(),this.hideLimitBreakButton(),this._buttons=[],this._buttons.push(this._guardButton),this._buttons.push(this._skillChangeButton),this._buttons.push(this._limitBreakButton),this._buttons.push(this._categoryChangeButton),this._buttons.push(this._categoryLeftButton),this._buttons.push(this._analyzeButton),this._buttons.push(this._categoryRightButton),this.showTypeChange(!1),this._skillChangeEnable=!0,this._categoryChangeEnable=!0,this._limitBreakEnable=!0,this._guardEnable=!0}setClickHandler(key,action){this._action[key]=action}createButtons(){this.createSkillChangeButton(),this.createLimitBreakButton(),this.createCategoryChangeButton(),this.createGuardButton(),this.createAnalyzeButton(),this.createArrows()}createSkillChangeButton(){this._skillChangeButton=new Sprite_KeyMapButton,this.addChild(this._skillChangeButton),this._skillChangeButton.x=694,this._skillChangeButton.y=4,this._skillChangeButton.setClickHandler(this.callHandler.bind(this,BattleDockActionType.SkillChange)),this._skillChangeButton.setText(TextManager.getText(714))}showSkillChangeButton(){this._skillChangeButton.visible=!0,this.setButtonsPosition(!1)}hideSkillChangeButton(){this._skillChangeButton.visible=!1}enableSkillChangeButton(enable){this._skillChangeButton.opacity=enable?255:128,this._skillChangeEnable=enable}callHandler(key){if(this._action[key]){if(key!=BattleDockActionType.AnalyzeNext&&key!=BattleDockActionType.AnalyzePrevios||SoundManager.playCursor(),key==BattleDockActionType.SkillChange){if(!this._skillChangeEnable)return}else if(key==BattleDockActionType.CategoryChange){if(!this._categoryChangeEnable)return}else if(key==BattleDockActionType.LimitBreak){if(!this._limitBreakEnable)return}else if(key==BattleDockActionType.Guard&&!this._guardEnable)return;this._action[key]()}}createLimitBreakButton(){this._limitBreakButton=new Sprite_KeyMapButton,this.addChild(this._limitBreakButton),this._limitBreakButton.x=454,this._limitBreakButton.y=4,this._limitBreakButton.setClickHandler(this.callHandler.bind(this,BattleDockActionType.LimitBreak)),this._limitBreakButton.setText(TextManager.getText(738))}showLimitBreakButton(){this._limitBreakButton.visible=!0,this.setButtonsPosition(!1)}hideLimitBreakButton(){this._limitBreakButton.visible=!1}enableLimitBreakButton(enable){this._limitBreakButton.opacity=enable?255:128,this._limitBreakEnable=enable}createCategoryChangeButton(){this._categoryChangeButton=new Sprite_KeyMapButton,this.addChild(this._categoryChangeButton),this._categoryChangeButton.x=694,this._categoryChangeButton.y=4,this._categoryChangeButton.setClickHandler(this.callHandler.bind(this,BattleDockActionType.CategoryChange)),this._categoryChangeButton.setText(TextManager.getText(726))}showCategoryChangeButton(){this._categoryChangeButton.visible=!0,this.setButtonsPosition(!1)}hideCategoryChangeButton(){this._categoryChangeButton.visible=!1}enableCategoryChangeButton(enable){this._categoryChangeButton.opacity=enable?255:128,this._categoryChangeEnable=enable}createGuardButton(){this._guardButton=new Sprite_KeyMapButton,this.addChild(this._guardButton),this._guardButton.x=824,this._guardButton.y=4,this._guardButton.clickCallTypeChange(),this._guardButton.setClickHandler(this.callHandler.bind(this,BattleDockActionType.Guard)),this._guardButton.setText(TextManager.getText(721))}createAnalyzeButton(){this._analyzeButton=new Sprite_KeyMapButton,this.addChild(this._analyzeButton),this._analyzeButton.y=4,this._analyzeButton.clickCallTypeChange(),this._analyzeButton.setText(TextManager.getText(713)),this._analyzeButton.x=924-this._analyzeButton.width}showAnalyzeButton(){this._analyzeButton.visible=!0,this.setButtonsPosition(!0)}hideAnalyzeButton(){this._analyzeButton.visible=!1}showGuardButton(){this._guardButton.visible=!0,this.setButtonsPosition(!1)}hideGuardButton(){this._guardButton.visible=!1}enableGuardButton(enable){this._guardButton.opacity=enable?255:128,this._guardEnable=enable}createArrows(){this._categoryRightButton=new Sprite_Button,this._categoryRightButton.bitmap=ImageManager.loadSystem("minus"),this._categoryRightButton.y=4,this._categoryRightButton.setClickHandler(this.callHandler.bind(this,BattleDockActionType.AnalyzePrevios)),this.addChild(this._categoryRightButton),this._categoryLeftButton=new Sprite_Button,this._categoryLeftButton.bitmap=ImageManager.loadSystem("plus"),this._categoryLeftButton.y=4,this._categoryLeftButton.setClickHandler(this.callHandler.bind(this,BattleDockActionType.AnalyzeNext)),this.addChild(this._categoryLeftButton)}showTypeChange(isSelecting){isSelecting?(this.showSkillChangeButton(),this.showGuardButton(),this.showCategoryChangeButton(),this.hideAnalyzeButton()):(this.hideSkillChangeButton(),this.hideGuardButton(),this.hideCategoryChangeButton(),this.showAnalyzeButton()),this._categoryLeftButton.visible=!isSelecting,this._categoryRightButton.visible=!isSelecting,this.setButtonsPosition(!isSelecting)}show(){super.show()}setButtonsPosition(isAnalyze){let posX=960;const marginX=6;this._buttons.forEach((button,index)=>{if(button.visible){let spacing=button.width;index%4!=0&&isAnalyze?spacing-=30:posX-=24,button.x=posX-spacing,posX-=spacing,posX-=6}})}}const BattleDockActionType={SkillChange:0,LimitBreak:1,Guard:2,Analyze:3,AnalyzeNext:4,AnalyzePrevios:5,CategoryChange:6};class Sprite_MenuDock extends Sprite{constructor(){super(),this._action={},this._buttons=[],this.createButtons(),this._buttons.push(this._actorPlusButton),this._buttons.push(this._actorChangeButton),this._buttons.push(this._actorMinusButton),this._buttons.push(this._spPlusButton),this._buttons.push(this._spChangeButton),this._buttons.push(this._spMinusButton),this.hide()}isTutorial(){return 1==$gameSwitches.value(6)}callHandler(key){this.isTutorial()||this._action[key]&&this._action[key]()}setClickHandler(key,action){this._action[key]=action}createButtons(){this.createSpButton(),this.createSpPlusMinus(),this.createActorChangeButton(),this.createActorPlusMinus()}createSpButton(){this._spChangeButton=new Sprite_KeyMapButton,this._spChangeButton.x=624,this._spChangeButton.y=4,this.addChild(this._spChangeButton),this._spChangeButton.setText(TextManager.getText(736))}createSpPlusMinus(){this._spMinusButton=new Sprite_Button,this._spMinusButton.bitmap=ImageManager.loadSystem("minus"),this._spMinusButton.y=4,this._spMinusButton.setClickHandler(this.callHandler.bind(this,MenuDockActionType.SpMinus)),this.addChild(this._spMinusButton),this._spPlusButton=new Sprite_Button,this._spPlusButton.bitmap=ImageManager.loadSystem("plus"),this._spPlusButton.y=4,this._spPlusButton.setClickHandler(this.callHandler.bind(this,MenuDockActionType.SpPlus)),this.addChild(this._spPlusButton)}createActorChangeButton(){this._actorChangeButton=new Sprite_KeyMapButton,this._actorChangeButton.x=824,this._actorChangeButton.y=4,this.addChild(this._actorChangeButton),this._actorChangeButton.setText(TextManager.getText(735))}createActorPlusMinus(){this._actorMinusButton=new Sprite_Button,this._actorMinusButton.bitmap=ImageManager.loadSystem("minus"),this._actorMinusButton.y=4,this._actorMinusButton.setClickHandler(this.callHandler.bind(this,MenuDockActionType.ActorMinus)),this.addChild(this._actorMinusButton),this._actorPlusButton=new Sprite_Button,this._actorPlusButton.bitmap=ImageManager.loadSystem("plus"),this._actorPlusButton.y=4,this._actorPlusButton.setClickHandler(this.callHandler.bind(this,MenuDockActionType.ActorPlus)),this.addChild(this._actorPlusButton)}show(){super.show(),this.setButtonsPosition()}show(isSpchange){super.show(),this._spChangeButton.visible=isSpchange,this._spMinusButton.visible=isSpchange,this._spPlusButton.visible=isSpchange,this.setButtonsPosition()}setButtonsPosition(){let posX=960;const marginX=6;this._buttons.forEach((button,index)=>{if(button.visible){let spacing=button.width;index%3!=0?spacing-=30:posX-=24,button.x=posX-spacing,posX-=spacing,posX-=6}})}}const MenuDockActionType={SpPlus:0,SpMinus:1,ActorPlus:2,ActorMinus:3};class Sprite_KeyMapButton extends Sprite_Button{constructor(){super(),this._marginX=0,this._height=30,this._baseWidth=1/.85*120,this._baseHeight=30}setText(text){this._buttonSprite=new Sprite,this._buttonSprite.bitmap=ImageManager.loadSystem("sabwindowF"),this.addChild(this._buttonSprite),this._textSprite=new Sprite,this._textSprite.bitmap=new Bitmap(0,this._height);const textWidth=this._textSprite.bitmap.measureTextWidth(text)+2*this._marginX;this._buttonSprite.scale.x=textWidth/this._baseWidth,this._buttonSprite.scale.y=this._height/this._baseHeight;const textHeight=this._height*(1/.85);this._textSprite.bitmap=new Bitmap(textWidth,textHeight),this._textSprite.bitmap.fontSize=21,this._textSprite.bitmap.drawText(text,0,0,textWidth,textHeight,"center"),this._textSprite.scale.x=this._textSprite.scale.y=.85,this.addChild(this._textSprite),this.width=.85*textWidth,this.height=this._height}}class Sprite_LoadDock extends Sprite{constructor(){super(),this._buttons=[],this._action={},this.createButtons(),this.setButtonsPosition()}setClickHandler(key,action){this._action[key]=action}callHandler(key){this._action[key]&&this._action[key]()}createButtons(){this.createUploadButton(),this.createDataTransportButton()}createUploadButton(){this._uploadButton=new Sprite_KeyMapButton,this.addChild(this._uploadButton),this._buttons.push(this._uploadButton),this._uploadButton.x=720,this._uploadButton.y=4,this._uploadButton.setClickHandler(this.callHandler.bind(this,LoadDockActionType.Upload)),this._uploadButton.setText(TextManager.getText(729))}createDataTransportButton(){this._dataTransportButton=new Sprite_KeyMapButton,this.addChild(this._dataTransportButton),this._buttons.push(this._dataTransportButton),this._dataTransportButton.x=720,this._dataTransportButton.y=4,this._dataTransportButton.setClickHandler(this.callHandler.bind(this,LoadDockActionType.DataTransport)),this._dataTransportButton.setText(TextManager.getText(730))}setButtonsPosition(){let posX=960;const marginX=6;this._buttons.forEach((button,index)=>{if(button.visible){let spacing=button.width;posX-=24,button.x=posX-spacing,posX-=spacing,posX-=6}})}}const LoadDockActionType={Upload:0,DataTransport:1};class Sprite_ResultDock extends Sprite{constructor(){super(),this._buttons=[],this._action={},this.createButtons(),this.setButtonsPosition()}setClickHandler(key,action){this._action[key]=action}callHandler(key){this._action[key]&&this._action[key]()}createButtons(){this.createUploadButton()}createUploadButton(){this._uploadButton=new Sprite_KeyMapButton,this.addChild(this._uploadButton),this._buttons.push(this._uploadButton),this._uploadButton.x=720,this._uploadButton.y=4,this._uploadButton.setClickHandler(this.callHandler.bind(this,LoadDockActionType.Upload)),this._uploadButton.setText(TextManager.getText(734))}setButtonsPosition(){let posX=960;const marginX=6;this._buttons.forEach((button,index)=>{if(button.visible){let spacing=button.width;posX-=24,button.x=posX-spacing,posX-=spacing,posX-=6}})}}const ResultDockActionType={Upload:0};class Model_Animation{constructor(){}get animationData(){return $dataAnimationsMv}getAnimationById(id){const animationData=this.animationData[id];return animationData||(Debug.error("getAnimationById"+id+" = null"),null)}}class Animation_Scene extends Scene_Base{constructor(){super(),this._presenter=new Presenter_Animation(this)}create(){BackGroundManager.resetup(),EventManager.resetup(),super.create(),this.createDisplayObjects()}setResourceData(resourceData){this._resourceData=resourceData}isReady(){return this._presenter.isReady()}createDisplayObjects(){this.createWindowLayer(),this._listWindow=new Window_AnimationSelect(0,0,160,540),this._listWindow.setHandler("index",this.changeSelectIndex.bind(this)),this.addChild(this._listWindow)}start(){super.start(),this.setCommand(AnimationCommand.Start)}setData(data){this._listWindow.setData(data),this._listWindow.activate()}changeSelectIndex(){this.setCommand(AnimationCommand.ChangeSelect)}playAnimation(data){let x=240,y=Graphics.height/4;3==data.position&&(x=0,y=0),EventManager.showAnimation(data.id,x,y,1,1)}}const AnimationCommand={Start:0,ChangeSelect:1};class Presenter_Animation extends Presenter_Base{constructor(view){super(),this._view=view,this._model=new Model_Animation,this.setEvent(),this.start()}setEvent(){this._view.setEvent(this.updateCommand.bind(this))}start(){this._isReady=!0}isReady(){return this._isReady}updateCommand(){switch(this._view._command){case AnimationCommand.Start:return this.commandStart();case AnimationCommand.ChangeSelect:return this.commandChangeSelect()}this._view.clearCommand()}commandStart(){const data=this._model.animationData;this._view.setData(data)}commandChangeSelect(){const item=this._view._listWindow.item();if(item){const id=item.id,animationData=this._model.getAnimationById(id);this._view.playAnimation(animationData)}}update(){}static animationDebug(){SceneManager.goto(Animation_Scene)}}function Window_AnimationSelect(){this.initialize.apply(this,arguments)}function BackGroundManager(){throw new Error("This is a static class")}Window_AnimationSelect.prototype=Object.create(Window_Selectable.prototype),Window_AnimationSelect.prototype.constructor=Window_AnimationSelect,Window_AnimationSelect.prototype.initialize=function(x,y,width,height){Window_Selectable.prototype.initialize.call(this,new Rectangle(x,y,2*width,2*height)),this._data=[],this.padding=0,this.scale.x=this.scale.y=.5},Window_AnimationSelect.prototype.lineHeight=function(){return 24},Window_AnimationSelect.prototype.setData=function(data){this._data=data,this.refresh()},Window_AnimationSelect.prototype.contentsHeight=function(){return 2*this.height},Window_AnimationSelect.prototype.maxItems=function(){return this._data?this._data.length:1},Window_AnimationSelect.prototype.item=function(){return this._data&&this.index()>=0?this._data[this.index()]:null},Window_AnimationSelect.prototype.drawItem=function(index){let animation=this._data[index];if(animation){this.resetTextColor();var rect=this.itemRect(index);const skillData=_.find($dataSkills,skill=>skill&&skill.animation==animation.id);skillData?(this.changeTextColor(ColorManager.systemColor()),this.drawText(animation.id+". "+skillData.name,rect.x,rect.y,rect.width)):this.drawText(animation.id+". "+animation.name,rect.x,rect.y,rect.width)}},Window_AnimationSelect.prototype.refresh=function(){this.createContents(),this.contents.fontSize=32,this.drawAllItems()},BackGroundManager.init=function(){this._backGroundView=new View_BackGround},BackGroundManager.resetup=function(){this._backGroundView.resetup()},BackGroundManager.backSprite1=function(){return this._backGroundView.backSprite1()},BackGroundManager.moveFront=function(rate){this._backGroundView.moveFront(rate)},BackGroundManager.moveFrontStage=function(rate){this._backGroundView.moveFrontStage(rate)},BackGroundManager.moveFrontStageRepeat=function(rate,repeatWait){this._backGroundView.moveFrontStageRepeat(rate,repeatWait)},BackGroundManager.moveStop=function(){this._backGroundView.moveStop()},BackGroundManager.moveLeft=function(rate){this._backGroundView.moveLeft(rate)},BackGroundManager.moveRight=function(rate){this._backGroundView.moveRight(rate)},BackGroundManager.startTint=function(color,duration){this._backGroundView.startTint(duration,color)},BackGroundManager.update=function(){this._backGroundView&&this._backGroundView.update()},BackGroundManager.changeBackGround=function(name1,name2){this._backGroundView.changeBackGround1(name1),this._backGroundView.changeBackGround2(name2)},BackGroundManager.autotileType=function(z){return $gameMap.autotileType($gamePlayer.x,$gamePlayer.y,z)},BackGroundManager.regionId=function(){const dir=$gamePlayer.direction();switch(dir){case 2:return $gameMap.regionId($gamePlayer.x,$gamePlayer.y+1);case 4:return $gameMap.regionId($gamePlayer.x-1,$gamePlayer.y);case 6:return $gameMap.regionId($gamePlayer.x+1,$gamePlayer.y);case 8:return $gameMap.regionId($gamePlayer.x,$gamePlayer.y-1)}},BackGroundManager.changeBackGroundByTile=function(){let changeBgName="";0==this.regionId()?changeBgName=$dataMap.battleback1Name:$gameMap.regionList()&&$gameMap.regionList().length>0&&(changeBgName=$gameMap.regionList()[this.regionId()-1])},BackGroundManager.setStageMode=function(){},BackGroundManager.resetStageMode=function(){},BackGroundManager.resetPosition=function(){this._backGroundView.resetPosition()},BackGroundManager.pause=function(){this._backGroundView.pause()},BackGroundManager.resume=function(){this._backGroundView.resume()},BackGroundManager.collapseBackGround=function(){this._backGroundView.collapseBackGround()},BackGroundManager.rooling=function(angle){let r=0;0==angle&&(r=0),90==angle&&(r=-1*Math.PI/2),180==angle&&(r=-1*Math.PI),this._backGroundView.setRotation(.5,r)},BackGroundManager.setupEndingBlur=function(){this._backGroundView.setupEndingBlur()},BackGroundManager.stopEndingBlur=function(){this._backGroundView.stopEndingBlur()},BackGroundManager.jump=function(){SoundManager.playLanding()},BackGroundManager.setWeather=async function(type,x,y,start,noSave){void 0===noSave&&(noSave=!1),type&&(noSave||$gameScreen.changeBackGroundWeather(type),1==$dataOption.getUserData("displayEffect")?this._backGroundView.setWeather(type,x,y,start):this._backGroundView.clearWeather())},BackGroundManager.pauseWeather=function(){this._backGroundView.pauseWeather()},BackGroundManager.resumeWeather=function(){this._backGroundView.resumeWeather()},BackGroundManager.distinctWeather=function(flag){this._backGroundView.distinctWeather(flag)},BackGroundManager.clearWeather=function(){$gameScreen.clearBackGroundWeather(),this._backGroundView.clearWeather()},BackGroundManager.clearWeatherLoad=function(){this._backGroundView.clearWeather()},BackGroundManager.zoom=function(duration,zoomX,zoomY){this._backGroundView.zoom(duration,zoomX,zoomY)},BackGroundManager.move=function(duration,x,y){this._backGroundView.move(duration,x,y)},BackGroundManager.moveUV=function(duration,x,y,repeat){},BackGroundManager.bgFadeOut=function(duration){this._backGroundView.bgFadeOut(duration)},BackGroundManager.bgFadeIn=function(duration){this._backGroundView.bgFadeIn(duration)},BackGroundManager.setSize=function(width,height){this._backGroundView.setSize(width,height)},BackGroundManager.enableWeather=function(enable){this._backGroundView.enableWeather(enable)},BackGroundManager.remove=function(){this._scene=SceneManager._scene,this._scene.removeChild(this._backGroundView.layer),this._scene=null};class View_BackGround{constructor(){this._scene=null,this._layer=new Sprite,this._layer.filters=[],this.createBackGround(),this.createWeather(),this._bgAnimSprite=[]}get layer(){return this._layer}get _defaultWidth(){return Graphics.width}get _defaultHeight(){return Graphics.height}backSprite1(){return this._backSprite1}createBackGround(){this._backSprite1=new Sprite_BackGround(Graphics.width,Graphics.height),this._toneSprite=new ScreenSprite,this._layer.addChild(this._backSprite1),this._layer.addChild(this._toneSprite)}createWeather(){this._weather=new PIXI.Graphics,this._weather.x=Graphics.width/2,this._weather.y=Graphics.height/2,this._layer.addChild(this._weather),this._partcle=new Sprite_Particle,this._layer.addChild(this._partcle)}async setWeather(type,x,y,start){var ext={};null!=x&&null!=y&&(ext={pos:{x:x,y:y}}),await this._partcle.setup(this._weather,type,ext,start)}pauseWeather(){this._partcle.pause()}resumeWeather(){this._partcle.resume()}clearWeather(){this._partcle.clear()}distinctWeather(flag){this._partcle.distinct(flag)}resetup(){$dataSystem&&DataManager.isBattleTest()&&(this._backSprite1.bitmap=ImageManager.loadBattleback1($dataSystem.battleback1Name)),this._scene=SceneManager._scene,this._scene.addChild(this._layer),this.startTint(0,$gameScreen.tone()),console.log(this._layer)}moveFront(rate){var bg=new Sprite_BackGround;bg.bitmap=this._backSprite1.bitmap,bg.setSize(this._defaultWidth,this._defaultHeight),this._backSprite1.moveFront(rate)}moveFrontStage(rate){let bg=new Sprite_BackGround;bg.bitmap=this._backSprite1.bitmap,bg.setSize(this._defaultWidth,this._defaultHeight),bg.moveUV(0,this._backSprite1.origin.x,this._backSprite1.origin.y,!1),this._layer.addChild(bg),bg.frontBlur(128),this._backSprite1.moveFront(rate)}moveFrontStageRepeat(rate,repeatWait){var timeline=new TimelineMax,self=this;timeline.to(this,repeatWait,{repeat:-1,onRepeat:function(){AudioManager.playSe($gamePlayer._stepSound),self.moveFrontStage(rate)}})}moveStop(){gsap.killTweensOf(this)}moveLeft(rate){this._backSprite1.moveLeft(rate)}moveRight(rate){this._backSprite1.moveRight(rate)}changeBackGround1(name){name?(this._backSprite1.bitmap=null,this._backSprite1._init=!1,this._backSprite1.opacity=255,this._backSprite1.bitmap=ImageManager.loadBattleback1(name)):this._backSprite1.bitmap=null}changeBackGround2(name){}changeBackGroundByTile(lastBgName,changeBgName){var bg=new Sprite_BackGround;bg.bitmap=ImageManager.loadBattleback1(lastBgName),bg.setSize(this._defaultWidth,this._defaultHeight);const index=_.findIndex(this._layer.children,l=>l==this._backSprite1);index>=0&&this._layer.addChildAt(bg,index+1),bg.frontBlur(255),this._backSprite1.bitmap=ImageManager.loadBattleback1(changeBgName),this._backSprite1.resetPosition(),this._backSprite1.fadeIn(.5,128)}collapseBackGround(){this._backSprite1.opacity=0}setRotation(duration,rotation){this._backSprite1.setRotation(duration,rotation)}startTint(duration,color){this._toneSprite.setColor(color[0],color[1],color[2]),gsap.to(this._toneSprite,duration/60,{opacity:color[3]})}setupEndingBlur(){this._blurEndingFilter=new PIXI.filters.ZoomBlurFilter,this._blurEndingFilter.strength=.1;var x=.5*Graphics.width,y=.5*Graphics.height;this._blurEndingFilter.center=[x,y],this._scene.filters=[this._blurEndingFilter]}stopEndingBlur(){this._blurEndingFilter.strength=0,this._blurEndingFilter=null,this._scene.filters=[]}zoom(duration,zoomX,zoomY){this._backSprite1.zoom(duration,zoomX,zoomY)}move(duration,x,y){this._backSprite1.moveDirection(duration,x,y)}moveUV(duration,x,y,repeat){this._backSprite1.moveUV(duration,x,y,repeat)}bgFadeOut(duration){this._backSprite1.fadeOut(duration,255)}bgFadeIn(duration){this._backSprite1.fadeIn(duration,0)}update(){null!==this._layer&&this._scene===SceneManager._scene&&(this.updateBlur(),this.updateShake())}updateBlur(){null!=this._blurEndingFilter&&this._blurEndingFilter.strength<.4&&(this._blurEndingFilter.strength+=.01)}updateShake(){this._layer.y=Math.round($gameScreen.shake())}setSize(width,height){console.error(width),this._backSprite1.setSize(width,height)}pause(){this._pause=!0,this._backSprite1.pause(),this.pauseWeather()}resume(){this._pause=!1,this._backSprite1.resume(),this.resumeWeather()}resetPosition(){this._backSprite1.resetPosition()}terminate(){this._backSprite1.terminate()}enableWeather(enable){DataManager.isEventTest()&&(enable=!0),enable?null==this._weather.parent&&this._layer.addChildAt(this._weather,3):null!=this._weather.parent&&this._layer.removeChild(this._weather)}}class Model_Event extends Model_Base{constructor(){super()}gainCommonEventFlag(eventName){}loadEventFile(filename){return new Promise((function(resolve){DataManager.loadEventFile(filename+".json",(function(data){resolve(data)}))}))}allEventFileOutput(){var eventReadInfo={};let list=[],common=[];if($dataCommonEvents.forEach(event=>{if(null!=event&&""!=event.name&&!event.name.includes("*")){var isFadeOut=!1,isFadeIn=!1;let fadeoutdata=[],isEnd=!1,actor=null;event.list.forEach(element=>{eventReadInfo[event.name]||(eventReadInfo[event.name]=1),element.code,118==element.code&&"End"==element.parameters[0]&&(isEnd=!0),221==element.code&&(isEnd&&(isFadeIn=!1),isEnd||fadeoutdata.push(!0)),222==element.code&&(isEnd&&(isFadeIn=!0),isEnd||fadeoutdata.push(!1)),element.code,101==element.code&&1==element.parameters[2]&&element.parameters[3],101==element.code&&(actor=element.parameters[0]),401==element.code&&element.parameters.forEach((param,index)=>{})}),fadeoutdata.length>0&&0==isFadeIn&&(Debug.log(event.name+"= "+fadeoutdata),console.log(isFadeIn));var data=JSON.stringify(event),fs=require("fs"),dirPath=this.localFileDirectoryPath(),filePath=event.name+".json";fs.existsSync(dirPath)||fs.mkdirSync(dirPath),fs.writeFileSync(dirPath+filePath,data)}common.push(event)}),console.log(eventReadInfo),eventReadInfo){var data=JSON.stringify(eventReadInfo),fs=require("fs"),dirPath=this.localFileDataDirectoryPath(),filePath="EventReadInfos.json";fs.existsSync(dirPath)||fs.mkdirSync(dirPath),fs.writeFileSync(dirPath+filePath,data)}}localFileDirectoryPath(){const path=require("path"),base=path.dirname(process.mainModule.filename);return path.join(base,"event/jp/")}localFileDataDirectoryPath(){const path=require("path"),base=path.dirname(process.mainModule.filename);return path.join(base,"data/")}isChangeMessageActor(messageActor){return this.initMessageActor(),this._lastMessageActor!=messageActor&&(this._lastMessageActor=messageActor,!0)}initMessageActor(){null==this._lastMessageActor&&(this._lastMessageActor=null)}clearMessageActor(){this._lastMessageActor=null}outputActorsText(){let list={};$dataCommonEvents.forEach(event=>{if(null!=event&&""!=event.name&&!event.name.includes("*")){let actor=null;event.list.forEach(element=>{101==element.code&&1==element.parameters[2]&&element.parameters[3],101==element.code&&(actor=element.parameters[0]),401==element.code&&element.parameters.forEach((param,index)=>{null!=actor&&actor.includes("Actor")&&(null==list[actor]&&(list[actor]=[]),list[actor].push(param))})})}})}}class View_Event{constructor(){this._layer=new Sprite,this.createSpritePictureLayer(),this.createMapEventPicture(),this.createWeather(),this.createFadeSprite(),this.createTransFadeSprite(),this.createFlashSprite(),this.createAutoSprite(),this.createMessageCursorSprite(),this._eventMessageWindow=[]}get layer(){return this._layer}resetup(){this._scene=SceneManager._scene,this._scene.addChild(this._layer)}pause(){this._messageWindow.setSkipBusyMode(!0),this._eventMessageWindow.forEach(message=>{message.setSkipBusyMode(!0)}),this._spritePictureLayer.children.forEach(sprite=>{sprite.pause()}),this.pauseWeather()}resume(){this._messageWindow.setSkipBusyMode(!1),this._eventMessageWindow.forEach(message=>{message.setSkipBusyMode(!1)}),this._spritePictureLayer.children.forEach(sprite=>{sprite.resume()}),this.resumeWeather()}createSpritePictureLayer(){this._spritePictureLayer=new Sprite,this._layer.addChild(this._spritePictureLayer)}getEventPicture(labelName){return _.find(this._spritePictureLayer.children,p=>p&&p._pictureLabel==labelName)}showPicture(labelName,fileName,x,y,z,scaleX,scaleY,opacity,blendmode){let eventPicture=this.getEventPicture(labelName);eventPicture?eventPicture.setup(labelName,x,y,eventPicture._z):(eventPicture=new Sprite_EventPicture,eventPicture.setup(fileName,x,y,z),this._spritePictureLayer.addChild(eventPicture)),eventPicture.opacity=opacity,eventPicture.setScale(.01*scaleX,.01*scaleY),blendmode&&(eventPicture._mainSprite._blendMode=blendmode),console.error(this._spritePictureLayer.children)}movePicture(label,x,y,z,scaleX,scaleY,opacity,duration,delay){const sprite=this.getEventPicture(label);sprite&&(sprite._z=z,this._spritePictureLayer.children=_.sortBy(this._spritePictureLayer.children,picture=>picture._z),sprite.move(x,y,scaleX,scaleY,opacity,duration,delay))}changePictureFace(fileName,index){const sprite=this.getEventPicture(fileName);sprite&&sprite.setFace(index)}startMessagePoint(fileName,name){const sprite=this.getEventPicture(fileName);sprite&&sprite.startMessagePoint(name)}stopMessagePoint(){this._spritePictureLayer.children.forEach(sprite=>{sprite.stopMessagePoint()})}fadeoutPictures(){this._spritePictureLayer.children.forEach(child=>{child.fadeOut(1)})}fadeoutMapPictures(){this._mapEventPicture.fadeOut(.5)}anglePicture(label,duration,angle){const sprite=this.getEventPicture(label);if(sprite){const rotate=angle*(Math.PI/180);gsap.to(sprite,duration,{rotation:rotate})}}angleReset(label,duration){const sprite=this.getEventPicture(label);sprite&&gsap.to(sprite,duration,{rotation:0})}setPictureEmotion(label,index){const sprite=this.getEventPicture(label);sprite&&sprite.setEmotion(index)}walkPicture(label,repeat,x,duration,opacity,scale){const sprite=this.getEventPicture(label);sprite&&sprite.walk(repeat,x,duration,opacity,scale)}walkPictureX(label,repeat,x,duration){const sprite=this.getEventPicture(label);sprite&&sprite.walkX(repeat,x,duration)}walkStop(label,duration,endAction){const sprite=this.getEventPicture(label);sprite&&sprite.walkStopPicture(duration,endAction)}flipPicture(label,duration){const sprite=this.getEventPicture(label);sprite&&sprite.flip(duration)}stopPicture(label){const sprite=this.getEventPicture(label);sprite&&sprite.stopAnime()}createCopyPicture(label,fileName){let sprite=this.getEventPicture(label);if(sprite){let copysprite=new Sprite_EventPicture;copysprite.setup(sprite._pictureLabel,sprite.x,sprite.y,sprite._z),copysprite.opacity=sprite.opacity,this._spritePictureLayer.addChild(copysprite),copysprite._pictureLabel=fileName}}createCopyEnemy(label,fileName){let sprite=this.getEventPicture(label);if(sprite){let copysprite=new Sprite_EventPicture;copysprite.setup(sprite._pictureLabel,sprite.x,sprite.y,sprite._z),copysprite.opacity=sprite.opacity,copysprite.setEnemyPicture(),this._spritePictureLayer.addChild(copysprite),copysprite._pictureLabel=fileName}}setSpriteHue(label,hue){let sprite=this.getEventPicture(label);sprite&&sprite.setHue(hue)}setBattlePicture(label,x,y,opacity){let sprite=this.getEventPicture(label);sprite||(sprite=new Sprite_EventPicture,sprite.setup(label),sprite.setBattleback1(),void 0!==x&&(sprite.x=x),void 0!==y&&(sprite.y=y),void 0!==opacity&&(sprite.opacity=opacity),this._spritePictureLayer.addChild(sprite))}setEnemyPicture(label,x,y,opacity){let sprite=this.getEventPicture(label);sprite||(sprite=new Sprite_EventPicture,sprite.setup(label),sprite.setEnemyPicture(),sprite.x=x,sprite.y=y,opacity&&(sprite.opacity=opacity),this._spritePictureLayer.addChild(sprite))}setTextPicture(label,x,y,opacity,vertical,flat){let sprite=this.getEventPicture(label);sprite||(sprite=new Sprite_EventPicture,sprite.setup(label),sprite.setTextPicture(label,vertical,flat),sprite.x=x,sprite.y=y,sprite._z=this._spritePictureLayer.children.length,sprite.opacity=0,this._spritePictureLayer.addChild(sprite),this._spritePictureLayer.children=_.sortBy(this._spritePictureLayer.children,picture=>picture._z))}pauseAnim(label){let sprite=this.getEventPicture(label);sprite&&sprite.pauseAnim()}playAnim(label){let sprite=this.getEventPicture(label);sprite&&sprite.playAnim()}walkFast(label){let sprite=this.getEventPicture(label);sprite&&sprite.walkFast()}eventFilterSet(){this._spritePictureLayer.children.forEach(sprite=>{sprite.pauseAnim(),sprite.filterEventAdd()})}eventFilterStart(){this._spritePictureLayer.children.forEach(sprite=>{sprite.playAnim(),sprite.filterEventStart()})}eventFilterEnd(){this._spritePictureLayer.children.forEach(sprite=>{sprite.filterEventRemove()})}shadowOn(label,onlyShadow,distance,rotation,alpha){const sprite=this.getEventPicture(label);sprite&&sprite.shadowOn(onlyShadow,distance,rotation,alpha)}shadowOff(label){const sprite=this.getEventPicture(label);sprite&&sprite.filterShadowRemove()}setAnchor(label,x,y){let sprite=this.getEventPicture(label);sprite&&sprite.setAnchor(x,y)}windAnime(label,duration,rotation){let sprite=this.getEventPicture(label);sprite&&sprite.windAnime(duration,rotation)}createMapEventPicture(){this._mapEventPicture=new Sprite_EventPicture(""),this._spritePictureLayer.addChild(this._mapEventPicture)}showMapPicture(fileName){this._mapEventPicture.setup(fileName,Graphics.width/2,376,1),this._mapEventPicture.fadeOut(0),this._mapEventPicture.fadeIn(.5,.2)}showFastMapPicture(fileName){this._mapEventPicture.setup(fileName,Graphics.width/2,376,1),this._mapEventPicture.fadeIn(0)}resetMapPicture(){this._mapEventPicture.resetMapPicture()}clearPictures(){let length;for(let i=this._spritePictureLayer.children.length-1;i>=0;i--)this._mapEventPicture!=this._spritePictureLayer.children[i]&&this._spritePictureLayer.children[i].terminate();this._spritePictureLayer.children=[],this._spritePictureLayer.addChild(this._mapEventPicture),this.resetMapPicture(),this.messageClear()}createWeather(){this._weather=new PIXI.Graphics,this._weather.x=Graphics.width/2,this._weather.y=Graphics.height/2,this._layer.addChild(this._weather),this._partcle=new Sprite_Particle,this._layer.addChild(this._partcle)}createFadeSprite(){this._fadeSprite=new ScreenSprite,this._layer.addChild(this._fadeSprite),this._fadeSprite.setBlack()}startFade(duration,opacity){gsap.to(this._fadeSprite,duration/60,{opacity:opacity})}messageWindowRect(){const ww=Graphics.boxWidth,wh=Graphics.boxHeight,wx=(Graphics.boxWidth-ww)/2,wy=0;return new Rectangle(wx,0,ww,wh)}getEventMessage(sprite){return _.find(this._eventMessageWindow,e=>e._sprite._pictureLabel==sprite._pictureLabel)}setMessageAssign(fileName,isAssign){const sprite=this.getEventPicture(fileName);if(sprite){let message=this.getEventMessage(sprite);message||(message=new Window_EventMessage,message.setSprite(sprite),this._layer.addChild(message),this._eventMessageWindow.push(message)),message&&message.setMessageAssign(isAssign)}}setMessagePosition(fileName,x,y){const sprite=this.getEventPicture(fileName);if(sprite){let message=this.getEventMessage(sprite);message||(message=new Window_EventMessage,message.setSprite(sprite),this._layer.addChild(message),this._eventMessageWindow.push(message)),message.setMessagePosition(x,y)}}setNormalMessage(){this._messageWindow.activate()}messageClear(){this._messageWindow.terminateMessage(),this._messageWindow.pause=!1,this._messageWindow.setSkipBusyMode(!1),this._messageWindow._textState=null,this._eventMessageWindow.forEach(message=>{message.close(),message.terminate()}),this._eventMessageWindow=[]}createTransFadeSprite(){this._transfadeSprite=new Sprite_TransFade,this._transfadeSprite.bitmap=ImageManager.loadSystem("Fade"),this._transfadeSprite.x=1280,this._transfadeSprite.scale.x=2,this._transfadeSprite.scale.y=3,this._transfadeSprite.opacity=224,this._transfadeSprite.blendMode=PIXI.BLEND_MODES.MULTIPLY,this._layer.addChild(this._transfadeSprite)}transLeft(speedRate){this._transfadeSprite.transLeft(speedRate)}transRight(speedRate){this._transfadeSprite.transRight(speedRate)}createFlashSprite(){this._flashSprite=new ScreenSprite,this._layer.addChild(this._flashSprite)}startFlash(duration,color){this._flashSprite.setColor(color[0],color[1],color[2]),gsap.to(this._flashSprite,duration/60/2,{opacity:color[3]}),gsap.to(this._flashSprite,duration/60/2,{delay:duration/60/2,opacity:0})}showAnimation(id,x,y,scaleX,scaleY,noSoundFlag){void 0===x&&(x=0),void 0===y&&(y=0),void 0===scaleX&&(scaleX=1),void 0===scaleY&&(scaleY=1),void 0===noSoundFlag&&(noSoundFlag=!1);let anim=new Sprite_AnimationMV;if(null!=x&&null!=y){let animation=new Sprite;this._layer.addChild(animation),animation.x=x,animation.y=y,animation.scale.x=scaleX,animation.scale.y=scaleY,anim.setup(animation,$dataAnimationsMv[id],!1,0,noSoundFlag),animation.addChild(anim),gsap.to(anim,4*$dataAnimationsMv[id].frames.length/60,{onComplete:()=>{animation.removeChild(anim),this._layer.removeChild(animation),animation.destroy()}})}else anim.setup(this._layer,$dataAnimations[id],!1,0),this._layer.addChild(anim),gsap.to(anim,4*$dataAnimations[id].frames.length/60,{onComplete:()=>{this._layer.removeChild(anim)}})}showEffekseer(id,x,y,scaleX,scaleY){void 0===x&&(x=0),void 0===y&&(y=0),void 0===scaleX&&(scaleX=1),void 0===scaleY&&(scaleY=1);let sprite=new Sprite_Animation,target=new Sprite;target.x=x,console.log(x),this._layer.addChild(target);const animation=$dataAnimations[id];sprite.targetObjects=target,sprite.setup([target],animation,!1,0,null),this._layer.addChild(sprite),target.getCenterY=function(){return y}}startBossCollapseAnimation(x,y){}setEaseMode(fileName,isEase){const sprite=this.getEventPicture(fileName);sprite&&sprite.setEaseMode(isEase)}createAutoSprite(){this._eventMenuSprite=new Sprite_EventMenu,this._eventMenuSprite.setAction(EventMenuButton.Auto,this.commandEventAuto.bind(this)),this._eventMenuSprite.setAction(EventMenuButton.Skip,this.commandEventSkip.bind(this)),this._eventMenuSprite.setAction(EventMenuButton.Log,this.commandEventLog.bind(this)),this._eventMenuSprite.setAction(EventMenuButton.Display,this.commandEventDisplay.bind(this)),this._layer.addChild(this._eventMenuSprite),this.hideEventMenu()}createMessageCursorSprite(){const sx=144,sy=96,p=24;this._messageCursor=new Sprite,this._messageCursor.bitmap=ImageManager.loadSystem("Window"),this._messageCursor.anchor.x=.5,this._messageCursor.anchor.y=1,this._messageCursor.x=Graphics.width-36,this._messageCursor.y=Graphics.height-32,this._messageCursor.setFrame(sx,96,p,p),this._messageCursor.alpha=1,this._messageanim=new TimelineMax,this._messageanim.set(this._messageCursor,{alpha:0}).to(this._messageCursor,.4,{alpha:0}).to(this._messageCursor,.4,{alpha:1,y:Graphics.height-24}).to(this._messageCursor,.8,{alpha:0,y:Graphics.height-16}),this._messageanim.repeat(-1),this._messageanim.pause(),this._messageCursor.visible=!1,this._layer.addChild(this._messageCursor)}showMessageCursor(){this._messageanim.resume(),this._messageanim.seek("-=1.5"),this._messageCursor.visible=!0}hideMessageCursor(){this._messageanim.pause(),this._messageCursor.visible=!1}commandEventAuto(){}commandEventSkip(){EventManager.callSkip()}commandEventLog(){EventManager.onLogOpen()}commandEventDisplay(){EventManager.onDisplay()}showEventMenu(){this._eventMenuSprite.visible=!0}hideEventMenu(){this._eventMenuSprite.visible=!1}eventMenuSprite(){return this._eventMenuSprite}choiseMessageIndex(){return this._messageWindow._choiceListWindow.index()}skipQuiz(){this._messageWindow._choiceListWindow.callOkHandler()}async setWeather(type,x,y,start){let ext={};null!=x&&null!=y&&(ext={pos:{x:x,y:y}}),await this._partcle.setup(this._weather,type,ext,start)}clearWeather(){this._partcle.clear()}setFootSound(fileName,sound){const sprite=this.getEventPicture(fileName);sprite&&sprite.setFootSound(sound)}update(){null!=this._layer&&this.updateShake()}updateShake(){this._layer.y=Math.round($gameScreen.shake())}enableWeather(enable){DataManager.isEventTest()&&(enable=!0),enable?null==this._weather.parent&&this._layer.addChildAt(this._weather,2):null!=this._weather.parent&&this._layer.removeChild(this._weather)}stageTitle(no,x,y){let sprite=new Sprite_StageTitle;sprite.x=x,sprite.y=y;let stage=DataManager.getStageInfos(no);sprite.setup(no,TextManager.getText(stage.nameId)),this._layer.addChild(sprite)}showMapName(text){let sprite=new Sprite_MapName;this._layer.addChild(sprite),sprite.start(text)}hideStageTitle(){this._layer.children.forEach(sprite=>{sprite instanceof Sprite_StageTitle&&(gsap.killTweensOf(sprite),sprite.terminate())})}changeActorFace(fileName,index){const sprite=this.getEventPicture(fileName);sprite&&sprite.setFace(index)}resetScale(fileName){const sprite=this.getEventPicture(fileName);sprite&&sprite.resetScale()}resetPosition(fileName){const sprite=this.getEventPicture(fileName);sprite&&sprite.resetPosition()}exit(){this.stopMessagePoint(),this._spritePictureLayer.children.forEach(sprite=>{sprite.setEmotion(11)}),this.closeChioceWindow()}showJingle(){}showNextStage(title,endCall){let sprite=new Sprite_NextStage(title,endCall);this._layer.addChild(sprite),sprite.start()}pauseWeather(){this._partcle.pause()}resumeWeather(){this._partcle.resume()}setTimeLine(x){null==this._timeLine&&(this._timeLine=new Sprite_TimeLine,this._layer.addChild(this._timeLine)),this._timeLine.setup(x)}endTimeLine(){null!=this._timeLine&&(this._timeLine.endTimeLine(),this._timeLine=null)}tintPicture(fileName,color){const sprite=this.getEventPicture(fileName);sprite&&sprite.setBlendColor(color)}closeChioceWindow(){this._messageWindow.closeChioceWindow()}setTypeSoundEnable(fileName,enable){const sprite=this.getEventPicture(fileName);if(sprite){let message=this.getEventMessage(sprite);message||(message=new Window_EventMessage,message.setSprite(sprite),this._layer.addChild(message),this._eventMessageWindow.push(message)),message.setTypeSoundEnable(enable)}}endRollCredit(no,x,y,onlyOnes,noIndent){}}function EventManager(){throw new Error("This is a static class")}EventManager.init=function(){this._interpreter=new Game_Interpreter,this._model=new Model_Event,this._eventView=new View_Event,this._label=null,this._fastFlag=!1,this._reserveEvent=[],this._reserveEndCall=[],this._loading=!1,this._bgmLoader=new BgmLoader_Event,this._pictureLoader=new PictureLoader_Event,this._messageName={},this.destinationEvent=[],this._resetValue=null,this._nextStageBusy=!1,this._logSprites=[],this._busyLogSprites=[],this._waitLogData=[],this.createLogSprite()},EventManager.createLogSprite=function(){for(let i=0;i<4;i++){let sprite=new Sprite(new Bitmap(560,40));this._eventView.layer.addChild(sprite),this._logSprites.push(sprite),sprite.opacity=0}},EventManager.startLogText=function(text){if(0==this._logSprites.length)return void this._waitLogData.push(text);let _sprite=this._logSprites.shift();_sprite.bitmap.clear(),_sprite.bitmap.fontSize=21,_sprite.bitmap.drawText(text,24,0,360,40),_sprite.y=8,gsap.to(_sprite,.4,{opacity:255}),this._busyLogSprites.length>0&&this._busyLogSprites.forEach((element,index)=>{let idx=this._busyLogSprites.length-index;gsap.to(element,.15,{y:40*idx+8})}),this._busyLogSprites.push(_sprite);const self=this;gsap.to(_sprite,.4,{delay:4,opacity:0,onComplete:function(){if(self._busyLogSprites=_.without(self._busyLogSprites,_sprite),_sprite.y=8,self._logSprites.push(_sprite),self._waitLogData.length>0){const log=self._waitLogData.shift();self.startLogText(log)}}})},EventManager.setup=async function(eventName,endCall){this._loading=!0,this._interpreter.isRunning()?this.setNextEvent(eventName,endCall):(await this._model.loadEventFile(eventName).then(event=>{this.start(event)}),this._model.gainCommonEventFlag(eventName),endCall&&(this._endCall=endCall))},EventManager.setupEvent=function(event,endCall){this._loading=!0,this.start(event),endCall&&(this._endCall=endCall)},EventManager.start=async function(event){Debug.log(event),this._label=null,this._messageName={},this._skipEnable=event.name&&!event.name.includes("common"),this._eventSkip=!1,this._skipEnable&&$dataOption.getUserData("messageDockDisplay")?this._eventView.showEventMenu():this._eventView.hideEventMenu(),this._loading=!1,this._skipEnable&&Presenter_Loading.open(),this._interpreter.setup(event.list),this._bgmLoader.setCommand(event.list),this._pictureLoader.setCommand(event.list),event&&event.name&&!event.name.includes("common")&&await Promise.all([this._bgmLoader.loadBgmFirst(),this._pictureLoader.loadPictureFirst()]),this._skipEnable&&Presenter_Loading.close(),TutorialManager.clear()},EventManager.setupTest=async function(testData){this._interpreter.isRunning()||(this._label=null,this._eventSkip=!1,Presenter_Loading.open(),this._bgmLoader.setCommand(testData),this._pictureLoader.setCommand(testData),await Promise.all([this._bgmLoader.loadBgmFirst(),this._pictureLoader.loadPictureFirst()]),Presenter_Loading.close(),this._eventView.showEventMenu(),this._skipEnable=!0,this._interpreter.setup(testData))},EventManager.nowEvent=function(){return null==this._interpreter?null:null==this._interpreter._list||this._interpreter._list.length<1?null:this._interpreter._list[this._interpreter._index]},EventManager.exit=function(){EventManager.hideMessageCursor(),this._eventView.hideEventMenu(),this._eventView.messageClear(),this._eventView.exit(),this._interpreter._list=null,this._model.clearMessageActor(),this._reserveEvent.length>0&&(this.setup(this._reserveEvent[0],this._reserveEndCall[0]),this._reserveEvent.shift(),this._reserveEndCall.shift()),$gameDefine.mobileMode&&(TouchInput._pressedTime=0),this._endCall&&(this._endCall(),this._endCall=null),TouchInput.clear(),Window_BackLog._lastActorName="",this.eventFilterEnd()},EventManager.setMessagePosition=function(x,y){this._eventView.setMessagePosition(this._label,x,y)},EventManager.setNextEvent=function(eventName,endcall){this._reserveEvent.push(eventName),this._reserveEndCall.push(endcall)},EventManager.resetup=function(){this._eventView.resetup()},EventManager.remove=function(){this._scene=SceneManager._scene,this._scene.removeChild(this._eventView.layer),this._scene=null},EventManager.moveActors=function(direction,isMoveBg){void 0===isMoveBg&&(isMoveBg=!0);var speedRate=4/$gamePlayer.moveSpeed();8==direction?isMoveBg&&BackGroundManager.moveFront(speedRate):4==direction?(this._eventView.transLeft(speedRate),isMoveBg&&BackGroundManager.moveLeft(speedRate)):6==direction&&(this._eventView.transRight(speedRate),isMoveBg&&BackGroundManager.moveRight(speedRate))},EventManager.getEventPicture=function(labelName){return _.find(this._spritePictureLayer.children,p=>p&&p._pictureLabel==labelName)},EventManager.setLabel=function(label){this._label=label,"End"==label&&(this._eventSkip=!0,this._eventView.hideEventMenu())},EventManager.showPicture=function(labelName,fileName,x,y,z,scaleX,scaleY,opacity,blendmode){this._eventView.showPicture(labelName,fileName,x,y,z,scaleX,scaleY,opacity,blendmode)},EventManager.clearPictures=function(){this._eventView.clearPictures()},EventManager.showMapPicture=function(fileName){this._eventView.showMapPicture(fileName)},EventManager.showFastMapPicture=function(fileName){this._eventView.showFastMapPicture(fileName)},EventManager.resetMapPicture=function(){this._eventView.resetMapPicture()},EventManager.movePicture=function(x,y,z,scaleX,scaleY,opacity,duration,delay){this._eventView.movePicture(this._label,x,y,z,scaleX,scaleY,opacity,duration,delay)},EventManager.fadeoutPictures=function(){this._eventView.fadeoutPictures()},EventManager.fadeoutMapPictures=function(){this._eventView.fadeoutMapPictures()},EventManager.changePictureFace=function(fileName,index){this._eventView.changePictureFace(fileName,index)},EventManager.anglePicture=function(duration,angle){this._eventView.anglePicture(this._label,duration,angle)},EventManager.angleReset=function(duration){this._eventView.angleReset(this._label,duration)},EventManager.setPictureEmotion=function(index){this._eventView.setPictureEmotion(this._label,index)},EventManager.walkPicture=function(repeat,x,duration,opacity,scale){this._eventView.walkPicture(this._label,repeat,x,duration,opacity,scale)},EventManager.walkPictureX=function(repeat,x,duration){this._eventView.walkPictureX(this._label,repeat,x,duration)},EventManager.walkStop=function(duration,endAction){this._eventView.walkStop(this._label,duration,endAction)},EventManager.flipPicture=function(duration){this._eventView.flipPicture(this._label,duration)},EventManager.stopPicture=function(){this._eventView.stopPicture(this._label)},EventManager.createCopyPicture=function(num){this._eventView.createCopyPicture(this._label,this._label+"_"+num)},EventManager.createCopyEnemy=function(num){this._eventView.createCopyEnemy(this._label,this._label+"_"+num)},EventManager.setSpriteHue=function(hue){this._eventView.setSpriteHue(this._label,hue)},EventManager.startFadeIn=function(duration){this._eventView.startFade(duration,0)},EventManager.startFadeOut=function(duration){this._eventView.startFade(duration,255)},EventManager.startFlash=function(color,duration){this._eventView.startFlash(duration,color)},EventManager.busy=function(){return!!this._loading||this._interpreter&&this._interpreter.isRunning()},EventManager.nextStagebusy=function(){return this._nextStageBusy},EventManager.update=function(){null!=this._interpreter&&(this._quizEvent&&2==this._quizstate&&0==$gameTimer._frames&&this.skipQuiz(),this._scene,SceneManager._scene,null!=this._interpreter._list&&(PopupManager.busy()||this._bgmLoader.busy()||this._pictureLoader.busy()||(this._eventView&&this._eventView.update(),this.updateSkip(),0!=this._interpreter.isRunning()&&(this._interpreter.eventId()>0&&(this.unlockEvent(this._interpreter.eventId()),this._interpreter.clear()),this._interpreter.update()))))},EventManager.setWeather=async function(type,x,y,start,noSave){void 0===noSave&&(noSave=!1),type&&(noSave||$gameScreen.changeEventWeather(type),1==$dataOption.getUserData("displayEffect")?await this._eventView.setWeather(type,x,y,start):await this._eventView.clearWeather())},EventManager.clearWeather=function(){$gameScreen.clearEventWeather(),this._eventView.clearWeather()},EventManager.clearWeatherLoad=function(){this._eventView.clearWeather()},EventManager.setStage=async function(num){},EventManager.loadStageSequenceData=function(){return new Promise(resolve=>DataManager.loadStageSequenceData(resolve))},EventManager.callSkip=function(){this._callSkip=!0},EventManager.onSkip=function(){this._callSkip=!1;const mainText=TextManager.getText(800100),text1=TextManager.getDecideText(),text2=TextManager.getCancelText(),_popup=PopupManager;_popup.setPopup(mainText,{select:1}),_popup.setHandler(text1,"ok",()=>{this._eventSkip=!0;let index=_.findIndex(this._interpreter._list,l=>118==l.code&&"End"==l.parameters[0]);this._interpreter._index=index,this._eventView.hideEventMenu(),this.pauseResume(!1),this._eventView.messageClear(),this._eventView.closeChioceWindow()}),_popup.setHandler(text2,"cancel",()=>{this.pauseResume(!1)}),_popup.open(),this.pauseResume(!0)},EventManager.onEventMenu=function(){if(!this._skipEnable)return;const eventMenu=this._eventView.eventMenuSprite();eventMenu.visible=!eventMenu.visible},EventManager.onLogOpen=function(){this._onLogOpen=!0,null==this._backLogWIndow&&(this._backLogWIndow=new Window_BackLog(60,-12,840,564),this._backLogWIndow.setHandler("ok",this.onLogClose.bind(this)),this._backLogWIndow.setHandler("cancel",this.onLogClose.bind(this)),this._eventView.layer.addChild(this._backLogWIndow)),null!=this._backLogWIndow.parent&&(this._eventView.layer.removeChild(this._backLogWIndow),this._eventView.layer.addChild(this._backLogWIndow)),this._backLogWIndow.show(),this._backLogWIndow.activate(),this._backLogWIndow.refresh(),this._backLogWIndow.selectLast(),this.pauseResume(!0)},EventManager.onLogClose=function(){this._backLogWIndow.hide(),this._backLogWIndow.deactivate(),this.pauseResume(!1),this._onLogOpen=!1},EventManager.onDisplay=function(){this._onDisplay=!0,this._eventView.hideEventMenu(),this.pauseResume(!0)},EventManager.updateSkip=function(){1!=this._eventSkip&&this._skipEnable&&(this._onDisplay?(Input.isTriggered("cancel")||TouchInput.isTriggered())&&(this._onDisplay=!1,this._eventView.showEventMenu(),this.pauseResume(!1)):this._onLogOpen?TouchInput.isTriggered()&&(TouchInput.x<200||TouchInput.x>720)&&this.onLogClose():Input.isTriggered("pageup")||this._callSkip?this.onSkip():Input.isTriggered("pagedown")&&this.onEventMenu())},EventManager.shutdown=function(){$gameDefine.platForm()==PlatForm.Android||$gameDefine.platForm()==PlatForm.iOS?navigator.app.exitApp():SceneManager.exit()},EventManager.endLastBattle=function(){this.exit(),SceneManager.goto(Map_Scene),this.setup($gameDefine.endLastBattleEvent)},EventManager.showAnimation=function(id,x,y,scaleX,scaleY,noSoundFlag){this._eventView.showAnimation(id,x,y,scaleX,scaleY,noSoundFlag)},EventManager.showEffekseer=function(id,x,y,scaleX,scaleY){this._eventView.showEffekseer(id,x,y,scaleX,scaleY)},EventManager.startBossCollapseAnimation=function(x,y){this._eventView.startBossCollapseAnimation(x,y)},EventManager.setTitleSprite=function(x,y,endCall){null==this._titleSprite&&(this._titleSprite=new Sprite_Title,this._eventView.layer.addChild(this._titleSprite)),this._titleSprite.setup(TextManager.getText(DataManager.getStageInfos($gameParty.stageData().id).nameId),x,y),this._titleSprite.start(endCall)},EventManager.endTitleSprite=function(){this._titleSprite.reset()},EventManager.setBattlePicture=function(fileName,x,y,opacity){this._eventView.setBattlePicture(fileName,x,y,opacity)},EventManager.setEnemyPicture=function(fileName,x,y,opacity){this._eventView.setEnemyPicture(fileName,x,y,opacity)},EventManager.setTextPicture=function(text,x,y,opacity,vertical,flat){this._eventView.setTextPicture(text,x,y,opacity,vertical,flat)},EventManager.pauseAnim=function(){this._eventView.pauseAnim(this._label)},EventManager.playAnim=function(){this._eventView.playAnim(this._label)},EventManager.walkFast=function(){this._eventView.walkFast(this._label)},EventManager.pauseResume=function(isResume){isResume?(this._eventView.pause(),BackGroundManager.pause()):(this._eventView.resume(),BackGroundManager.resume())},EventManager.eventFilterSet=function(){this._eventView.eventFilterSet()},EventManager.eventFilterStart=function(){this._eventView.eventFilterStart()},EventManager.eventFilterEnd=function(){this._eventView.eventFilterEnd()},EventManager.shadowOn=function(onlyShadow,distance,rotation,alpha){void 0===onlyShadow&&(onlyShadow=!0),void 0===distance&&(distance=0),void 0===rotation&&(rotation=0),void 0===alpha&&(alpha=.5),this._eventView.shadowOn(this._label,onlyShadow,distance,rotation,alpha)},EventManager.shadowOff=function(){this._eventView.shadowOff(this._label)},EventManager.setAnchor=function(x,y){this._eventView.setAnchor(this._label,x,y)},EventManager.windAnime=function(duration,rotation){this._eventView.windAnime(this._label,duration,rotation)},EventManager.setMessageAssign=function(isAssign){this._eventView.setMessageAssign(this._label,isAssign)},EventManager.fadeEventBgm=function(){const bgmData=AudioManager._currentBgm;null!=bgmData&&(this._resetValue=bgmData.volume,AudioManager.fadeToBgm(1,bgmData.volume,.7))},EventManager.resetEventBgm=function(){this._resetValue&&AudioManager.fadeToBgm(1,this._resetValue,1),this._resetValue=null},EventManager.loadBgm=async function(bgm){this.nowEvent()&&(AudioManager.loadedBgmResource([bgm])||Presenter_Loading.open(),await this._bgmLoader.loadBgm(this.nowEvent()),Presenter_Loading.close())},EventManager.setEaseMode=function(isEase){this._eventView.setEaseMode(this._label,isEase)},EventManager.allEventFileOutput=function(){this._model.allEventFileOutput()},EventManager.outputActorsText=function(){this._model.outputActorsText()},EventManager.setFootSound=function(sound){this._eventView.setFootSound(this._label,sound)},EventManager.enableWeather=function(enable){this._eventView.enableWeather(enable)},EventManager.stageTitle=function(no,x,y){this._eventView.stageTitle(no,x,y)},EventManager.showMapName=function(text){text||(text=$dataMap.displayName),this._eventView.showMapName(text)},EventManager.changeActorFace=function(index){this._eventView.changeActorFace(this._label,index)},EventManager.setMessageName=function(key,toName){const isEnglish=$dataOption.getUserData("language")==LanguageType.English;if(isEnglish){const strArray=toName.split("");if("？"==strArray[0]){toName="";for(let i=0;i<strArray.length;i++)toName+="?"}}this._messageName[key]=toName},EventManager.resetScale=function(faceName){this._eventView.resetScale(faceName)},EventManager.resetPosition=function(faceName){this._eventView.resetPosition(faceName)},EventManager.showJingle=function(){this._eventView.showJingle()},EventManager.showNextStage=function(title){this._eventView.showNextStage(title,()=>this._nextStageBusy=!1),this._nextStageBusy=!0},EventManager.pauseWeather=function(){this._eventView.pauseWeather()},EventManager.resumeWeather=function(){this._eventView.resumeWeather()},EventManager.hideEventMenu=function(){this._eventView.hideEventMenu()},EventManager.setSkipEnable=function(enable){this._skipEnable=enable},EventManager.showMessageCursor=function(){this._eventView.showMessageCursor()},EventManager.hideMessageCursor=function(){this._eventView.hideMessageCursor()},EventManager.tintPicture=function(color){this._eventView.tintPicture(this._label,color)},EventManager.setTypeSoundEnable=function(enable){this._eventView.setTypeSoundEnable(this._label,enable)},EventManager.endRollCredit=function(no,x,y,onlyOnes,noIndent){this._eventView.endRollCredit(no,x,y,onlyOnes,noIndent)};class BgmLoader_Event{constructor(){this.initMember()}initMember(){this._commands=[],this.saveLength=2,this.currentId=0,this._busy=!1}setCommand(commands){this._commands=_.filter(commands,(function(com){return 241==com.code||655==com.code&&_.find(com.parameters,param=>param.includes("playBgm"))}))}async loadBgmFirst(){this._commands.length>0&&await this.loadBgm(this._commands[0])}async loadBgm(command){if(this._busy=!0,this.currentId=_.findIndex(this._commands,com=>com==command),this._commands.length>0&&this.currentId>=0){this.releaseBgm();var bgms=[];this._commands.forEach((com,index)=>{if(this.currentId<=index&&index<this.saveLength+this.currentId){if(655==com.code){var fileName=this.getBgmData(com);Debug.log(fileName)}AudioManager.loadedBgmResource([fileName])||(AudioManager.loadBgm(fileName),bgms.push(fileName))}}),Debug.error("waitLoadBgm start"),await this.waitLoadBgm(bgms)}this._busy=!1}releaseBgm(){this._commands.forEach((com,index)=>{if(index<this.currentId-1){if(655==com.code){var fileName=this.getBgmData(com);Debug.log(fileName)}AudioManager.purgeBgm(fileName)}})}releaseBgmAll(){this._commands.forEach((com,index)=>{if(655==com.code)var fileName=this.getBgmData(com)})}getBgmData(com){var fileName=com.parameters[0].replace("AudioManager.playBgm","");return fileName=(fileName=(fileName=(fileName=(fileName=(fileName=(fileName=(fileName=(fileName=fileName.replace("$gameBGM.","")).replace("getBgm","")).replace("(","")).replace(")","")).replace("(","")).replace(")","")).replace(";","")).replace('"',"")).replace('"',""),Debug.error(fileName),fileName=$gameBGM.getBgm(fileName)}waitLoadBgm(fileName){const self=this;return new Promise((function(resolve){self.intervalRepeater(fileName,(function(){resolve()}))}))}async intervalRepeater(fileName,resolve){const self=this;for(;;)if(await Promise.all([self.sleep(500)]),AudioManager.loadedBgmResource(fileName)){resolve();break}}async sleep(msec){return new Promise(resolve=>setTimeout(resolve,msec))}busy(){return this._busy}}class PictureLoader_Event{constructor(){this.initMember()}initMember(){this._commands=[],this.saveLength=2,this.currentId=0,this._busy=!1}setCommand(commands){this._commands=_.filter(commands,(function(com){return 283==com.code}))}async loadPictureFirst(){this._commands.length>0&&await this.loadPicture(this._commands[0])}async loadPicture(command){if(this._busy=!0,this.currentId=_.findIndex(this._commands,com=>com==command),this._commands.length>0&&this.currentId>=0){this.releasePicture();var pictures=[];this._commands.forEach((com,index)=>{if(this.currentId<=index&&index<this.saveLength+this.currentId){let fileName=com.parameters[0];null==fileName||""==fileName||ImageManager.loadedBattleBack1Resource([fileName])||(ImageManager.loadBattleback1(fileName),pictures.push(fileName))}}),pictures.length>0&&(Debug.error("waitLoadPicture start"),await this.waitLoadPicture(pictures))}this._busy=!1}releasePicture(){this._commands.forEach((com,index)=>{index<this.currentId-1&&ImageManager.clearImageBattleBack1(com.parameters[0])})}waitLoadPicture(fileName){const self=this;return new Promise((function(resolve){self.intervalRepeater(fileName,(function(){resolve()}))}))}async intervalRepeater(fileName,resolve){const self=this;for(;;)if(await Promise.all([self.sleep(500)]),ImageManager.loadedBattleBack1Resource(fileName)){resolve();break}}async sleep(msec){return new Promise(resolve=>setTimeout(resolve,msec))}busy(){return this._busy}}class Sprite_EventMenu extends Sprite{constructor(){super(),this._action={},this._autoButton=null,this._skipButton=null,this._logButton=null,this._displayButton=null,this._fastButton=null,this.createSprites(),this.createButtons()}createSprites(){this._dimmerSprite=new Sprite,this._dimmerSprite.bitmap=new Bitmap(0,0),this._dimmerSprite.y=-24;let bitmap=this._dimmerSprite.bitmap;const w=Graphics.width,h=88,m=24,c1=ColorManager.dimColor1(),c2=ColorManager.dimColor2();bitmap.resize(w,h),bitmap.fillRect(0,m,w,40,c1),bitmap.gradientFillRect(0,64,w,m,c1,c2,!0),this._dimmerSprite.setFrame(0,0,w,h),this._dimmerSprite.opacity=96,this.addChild(this._dimmerSprite)}createButtons(){this.createAutoButton(),this.createSkipButton(),this.createLogButton(),this.createDisplayButton(),this.createFastButton()}get buttonTextWidth(){return 120}get buttonTextHeight(){return 32}createAutoButton(){this._autoButton=new Sprite_Button,this._autoButton.bitmap=new Bitmap(this.buttonTextWidth,this.buttonTextHeight),this._autoButton.bitmap.fontSize=21,this._autoButton.bitmap.drawText(TextManager.getText(330),0,0,this.buttonTextWidth,this.buttonTextHeight,"center"),this._autoSprite=new Sprite,this._autoSprite.bitmap=new Bitmap(this.buttonTextWidth,this.buttonTextHeight),this._autoSprite.bitmap.fontSize=18,this._autoSprite.bitmap.drawText(TextManager.getText(320),84,1,this.buttonTextWidth,this.buttonTextHeight),gsap.to(this._autoSprite,.6,{alpha:0,repeat:-1,yoyo:!0,ease:Power1.easeOut}),this.addChild(this._autoButton),this.addChild(this._autoSprite),this._autoButton.x=this._autoSprite.x=760,this._autoButton.y=this._autoSprite.y=8,this._autoButton.setClickHandler(this.commandAuto.bind(this))}showAutoButton(){this._autoSprite.visible=!0}hideAutoButton(){this._autoSprite.visible=!1}createSkipButton(){this._skipButton=new Sprite_Button,this._skipButton.bitmap=new Bitmap(this.buttonTextWidth,this.buttonTextHeight),this._skipButton.bitmap.fontSize=21,this._skipButton.bitmap.drawText(TextManager.getText(340),0,0,this.buttonTextWidth,this.buttonTextHeight,"center"),this.addChild(this._skipButton),this._skipButton.x=840,this._skipButton.y=8,this._skipButton.setClickHandler(this.commandSkip.bind(this))}createLogButton(){this._logButton=new Sprite_Button,this._logButton.bitmap=ImageManager.loadSystem("IconSet");const w=Window_Base._iconWidth,h=Window_Base._iconHeight;this._logButton.setFrame(1*w,12*h,w,h),this.addChild(this._logButton),this._logButton.x=24,this._logButton.y=8,this._logButton.scale.x=this._logButton.scale.y=1,this._logButton.setClickHandler(this.commandLog.bind(this))}createDisplayButton(){this._displayButton=new Sprite_Button,this._displayButton.bitmap=ImageManager.loadSystem("IconSet");const w=Window_Base._iconWidth,h=Window_Base._iconHeight;this._displayButton.setFrame(15*w,10*h,w,h),this.addChild(this._displayButton),this._displayButton.x=72,this._displayButton.y=8,this._displayButton.scale.x=this._displayButton.scale.y=1,this._displayButton.setClickHandler(this.commandDisPlay.bind(this))}createFastButton(){this._fastButton=new Sprite_EventFast,this.addChild(this._fastButton)}commandAuto(){this._action[EventMenuButton.Auto](),SoundManager.playCursor(),TouchInput.clear()}commandSkip(){this._action[EventMenuButton.Skip](),TouchInput.clear()}commandLog(){this._action[EventMenuButton.Log](),TouchInput.clear()}commandDisPlay(){this._action[EventMenuButton.Display](),TouchInput.clear()}setAction(menubutton,func){this._action[menubutton]=func}}const EventMenuButton={Auto:1,Skip:2,Log:3,Display:4};class Window_BackLog extends Window_Selectable{constructor(x,y,width,height){super(new Rectangle(x,y,width,height)),this._data=[],this.hide(),this.deactivate(),this._cursorSprite.visible=!1}makeItemList(){this._data=Window_BackLog._logData}selectLast(){this.forceSelect(this._data?this._data.length-1:0)}drawItem(index){const logData=this._data[index];if(logData){const rect=this.itemRect(index);this.changeTextColor(this.normalColor()),this._data.length-1==index&&(this.drawBack(rect.x,rect.y,rect.width,rect.height,"rgba(216,96,132,255)",164),this.drawText("▶",rect.x+36,rect.y,rect.width,"left"));let marginX=logData.name?24:96;this.drawText(logData.logText,rect.x+marginX,rect.y,rect.width,"left")}}maxItems(){return this._data?this._data.length:0}itemHeight(){return 40}refresh(){this.makeItemList(),this.createContents(),this.drawAllItems()}_updateCursor(){}}Window_BackLog._logData=[],Window_BackLog._lastActorName="";class Sprite_EventPicture extends Sprite{constructor(){super(),this._animation=[],this._pictureLabel="",this.anchor.x=.5,this.anchor.y=.5,this._posData=null,this._z=0,this._mainSprite=new Sprite,this._mainSprite.anchor.x=.5,this._mainSprite.anchor.y=.5,this.addChild(this._mainSprite),this._faceSprite=new Sprite,this._faceSprite.anchor.x=.5,this._faceSprite.anchor.y=.5,this.addChild(this._faceSprite),this._easeMode=!0,this._footSound=null,this._filters={}}setup(labelName,x,y,z){void 0===x&&(x=0),void 0===y&&(y=0),void 0===z&&(z=0),this.x=x,this.y=y,this._z=z,this._pictureLabel=labelName,this.setFacePosition()}setFacePosition(){this._posData=DataManager.getFacePositionData(this._pictureLabel),this._posData&&(this.y=this._posData.y,this._faceSprite.x=0,this._faceSprite.y=0,this._mainSprite.scale.x<0?(this._mainSprite.scale.x=-1*this._posData.scale,this._mainSprite.scale.y=this._posData.scale):this._mainSprite.scale.x=this._mainSprite.scale.y=this._posData.scale)}resetAnim(){this._animation.forEach(anim=>{anim.seek(anim.endTime())}),gsap.killTweensOf(this)}move(x,y,scaleX,scaleY,opacity,duration,delay){void 0===delay&&(delay=0),this.resetAnim();let SX=this._mainSprite.scale.x*scaleX,SY=this._mainSprite.scale.y*scaleY,easeMode=this._easeMode?Power1.easeOut:Power0.easeNone;var tl=new TimelineMax;tl.to(this,duration,{x:this.x+x,y:this.y+y,opacity:opacity,delay:delay,ease:easeMode});var tl2=new TimelineMax;tl2.to(this._mainSprite.scale,duration,{x:SX,y:SY}),this._animation=[tl,tl2]}walk(repeat,x,duration,opacity,scale){void 0===x&&(x=0),void 0===duration&&(duration=0),void 0===opacity&&(opacity=255),this.resetAnim(),this.setFacePosition();var tl1=new TimelineMax;tl1.to(this,duration,{x:this.x+x,ease:Power0.easeNone,onComplete:()=>{this.playFootSound(),this.resetAnim()}});var tl2=new TimelineMax;tl2.to(this,repeat,{y:this.y-24,repeat:1,yoyo:!0,ease:Power1.easeOut,onRepeat:()=>{this.shouldStop(repeat)},onComplete:()=>{this.shouldStopComplete()}});var tl3=new TimelineMax;tl3.to(this,duration,{opacity:opacity});var tl4=new TimelineMax;void 0!==scale&&tl4.to(this,duration,{pixi:{scaleX:scale,scaleY:scale},ease:Power0.easeNone}),this._animation=[tl1,tl2,tl3,tl4],this._repeat=0,this._walkStop=!1}playFootSound(){this._footSound?2==this._footSound?SoundManager.footSound2((480-this.x)/-3):3==this._footSound?SoundManager.footSound3((480-this.x)/-3):1==this._footSound&&SoundManager.footSound1((480-this.x)/-6):SoundManager.footSound1((480-this.x)/-6)}walkX(repeat,x,duration){this._animation[0].to(this,duration,{x:this.x+x,ease:Power0.easeNone})}shouldStop(duration,x){this._walkStop||(this._repeat+=1,this._animation[1].repeat(this._repeat))}shouldStopComplete(duration,x){void 0===duration&&(duration=0),void 0===x&&(x=0),this._walkStop&&(this._animation[0].to(this,duration,{x:this.x,ease:Power0.easeNone}),this._animation[1].kill(),this.resetAnim(),this._walkEndAction&&(this._walkEndAction(),this._walkEndAction=null),this.walkStop=!1),this.playFootSound()}walkStopPicture(duration,endAction){this._animation.length>2&&(this._walkStop=!0,this._walkEndAction=endAction)}flip(duration){this.resetAnim();var targetSprite=this._mainSprite,targetX=targetSprite.scale.x<1?1:-1;this._posData&&(targetX*=this._posData.scale);var tl=new TimelineMax;tl.to(targetSprite.scale,duration,{x:targetX});var tl2=new TimelineMax;tl2.to(this,duration/2,{y:this.y,repeat:1,yoyo:!0}),this._animation=[tl,tl2]}setFace(index){}startMessagePoint(name){if(-1==this._pictureLabel.indexOf("Actor"))return;let positionX=this._faceSprite.x;this._mainSprite.scale.x<0&&(positionX*=-1);var actor=this._pictureLabel.substring(5,9);let targetScale=1;targetScale=Math.abs(this._mainSprite.scale.x),this._posData&&this._posData.scale&&(targetScale+=1-this._posData.scale)}stopMessagePoint(){}setEmotion(index){}update(){this.updateFaceName(),super.update()}updateFaceName(){this._animation}setBattleback1(){this._mainSprite.bitmap=ImageManager.loadBattleback1(this._pictureLabel)}setPicture(){this._mainSprite.bitmap=ImageManager.loadPicture(this._pictureLabel)}setEnemyPicture(){this._mainSprite.bitmap=ImageManager.loadEnemy(this._pictureLabel)}setTextPicture(text,vertical,flat){this._mainSprite.bitmap=new Bitmap(40*text.length,40),flat?(this._mainSprite.bitmap.textColor="rgba(40, 40, 40, 1)",this._mainSprite.bitmap.drawText(text,0,0,40*text.length,40,"center",!1,!1)):this._mainSprite.bitmap.drawText(text,0,0,40*text.length,40,"center",!0,!0),vertical&&(this._mainSprite.rotation=1*Math.PI/2)}setAnimation(animation,loop){}walkFast(){this.resetAnim()}setSelected(flag){this.opacity=flag?160:255}setSelecting(flag){flag?this.setBlendColor([255,255,255,64]):this.setBlendColor([0,0,0,0])}pause(){this._animation.forEach(anim=>{anim.pause()})}resume(){this._animation.forEach(anim=>{anim.resume()})}fadeOut(duration){this.removeFilters("_alphaFilter"),gsap.to(this,duration,{opacity:0})}fadeIn(duration,delay){void 0===delay&&(delay=0),this.removeFilters("_alphaFilter"),gsap.to(this,duration,{opacity:255,delay:delay})}filterEventAdd(){let drawActorFilter;this.existFilters("_drawActorFilter")||(drawActorFilter=new PIXI.filters.DrawActorFilter),this.setFilters("_drawActorFilter",drawActorFilter),drawActorFilter=this._filters._drawActorFilter;var actor=this._pictureLabel.substring(5,9);drawActorFilter.uniforms.time=0,drawActorFilter.uniforms.element=Number(actor)}filterEventStart(){this.existFilters("_drawActorFilter")&&(this._eventStart=!0)}filterEventRemove(){this._eventStart=!1,this.removeFilters("_drawActorFilter")}shadowOn(onlyShadow,distance,rotation,alpha){let drawShadowFilter;this.existFilters("drawShadowFilter")||(drawShadowFilter=new PIXI.filters.DropShadowFilter),this.setFilters("drawShadowFilter",drawShadowFilter),drawShadowFilter=this._filters.drawShadowFilter,drawShadowFilter.shadowOnly=onlyShadow,drawShadowFilter.blur=0,drawShadowFilter.quality=0,drawShadowFilter.pixelSize=0,drawShadowFilter.distance=distance,drawShadowFilter.rotation=rotation,drawShadowFilter.alpha=alpha}filterShadowRemove(){this.removeFilters("drawShadowFilter")}glowOn(){let glowFilter;this.existFilters("glowFilter")||(glowFilter=new PIXI.filters.GlowFilter,this.setFilters("glowFilter",glowFilter),glowFilter=this._filters.glowFilter,glowFilter.outerStrength=1.5,this._tpEffectTiming=!1)}glowRemove(){this.removeFilters("glowFilter")}pauseAnim(){}playAnim(){}setEaseMode(isEase){this._easeMode=isEase}stopAnime(){this.resetAnim()}setAnchor(x,y){this._anchor.x=x,this._anchor.y=y}windAnime(duration,rotation){var tl;(new TimelineMax).to(this,duration,{rotation:this.rotation+rotation,repeat:-1,yoyo:!0,ease:RoughEase.ease.config({template:Power0.easeNone,strength:.25,points:15,taper:"none",randomize:!0,clamp:!1})})}terminate(){this._faceSprite&&(this._faceSprite.destroy(),this.removeChild(this._faceSprite)),this._mainSprite&&(this._mainSprite.destroy(),this.removeChild(this._mainSprite)),this._animation&&(this._animation.forEach(element=>{element&&element.kill()}),this._animation=[],gsap.killTweensOf(this)),this._faceSprite=null,this._filters=null,this._tweens=null,this._posData=null,this.destroy()}resetMapPicture(){this.resetAnim(),this.x=Graphics.width/2,this.y=376,this._z=1,this._mainSprite.scale.x=1,this._mainSprite.scale.y=1,this.setFacePosition()}setFootSound(footSound){this._footSound=footSound}setScale(scaleX,scaleY){var targetSprite=this._mainSprite;this._posData?(targetSprite.scale.x=scaleX*this._posData.scale,targetSprite.scale.y=scaleY*this._posData.scale):(targetSprite.scale.x=scaleX,targetSprite.scale.y=scaleY)}setFilters(key,filter){null==this._mainSprite.filters&&(this._mainSprite.filters=[]),this.existFilters(key)||(this._mainSprite.filters.push(filter),this._filters[key]=filter)}existFilters(key){return null!=this._filters[key]}removeFilters(key){this.existFilters(key)&&(this.filters=_.without(this.filters,this._filters[key]),this._mainSprite.filters=_.without(this._mainSprite.filters,this._filters[key]),delete this._filters[key])}resetScale(){this._posData&&(this.scale.x=this.scale.y=this._posData.scale,this._mainSprite.scale.x=this._mainSprite.scale.y=this._posData.scale)}resetPosition(){this.setFacePosition()}}const FaceType={Normal:0,Smile:1,Damage:2,Attack:3,Victory:4,Angry:5,Surprise:6,Sad:7,Other1:8,Other2:9};class Sprite_EventFast extends Sprite{constructor(){super(),this._baseButton=null,this._fastBaseSprite=null,this._fastMeterSprite=null,this._fastMeterState=FastMeterState.Idel,this._anim=[],this.createButtons(),this.createSprites()}createButtons(){this.createBaseButton()}createBaseButton(){this._baseButton=new Sprite_Button,this._baseButton.bitmap=new Bitmap(960,540),this.addChild(this._baseButton),this._baseButton.x=0,this._baseButton.y=16}createSprites(){this.createFastMeterSprite(),this.createFastBaseSprite()}createFastBaseSprite(){const w=64,h=64;this._fastBaseSprite=new Sprite,this._fastBaseSprite.bitmap=new Bitmap(128,128),this._fastBaseSprite.bitmap.drawCircle(w,w,32,"white"),this._fastBaseSprite.bitmap.drawCircle(w,w,29,"balck"),this._fastBaseSprite.bitmap.fontSize=28,this._fastBaseSprite.bitmap.drawText(TextManager.getText(370),32,32,w,h,"center"),this._fastBaseSprite.x=160,this._fastBaseSprite.anchor.x=this._fastBaseSprite.anchor.y=.5,this._fastBaseSprite.y=270,this._fastBaseSprite.opacity=128,this.addChild(this._fastBaseSprite)}createFastMeterSprite(){const w=56,h=56;this._fastMeterSprite=new Sprite,this._fastMeterSprite.bitmap=new Bitmap(112,112),this._fastMeterSprite.bitmap.drawCircle(w,w,28,"white"),this._fastMeterSprite.x=160,this._fastMeterSprite.anchor.x=.5,this._fastMeterSprite.anchor.y=.5,this._fastMeterSprite.y=270,this._fastMeterSprite.opacity=200,this.addChild(this._fastMeterSprite)}update(){super.update(),this.updatePressFrame(),this.updateFastState()}updatePressFrame(){if(PopupManager.busy()||$gameMessage.isChoice()||!EventManager.busy()||EventManager.nextStagebusy())return void this.clearPressState();if(null==this._baseButton)return;if(null==this._fastMeterSprite)return;let pressFrame=this._baseButton.pressFrame();const maxFrame=32;$gameDefine.platForm()!=PlatForm.Android&&$gameDefine.platForm()!=PlatForm.iOS||(pressFrame-=4),pressFrame>32&&(pressFrame=32),pressFrame>8&&pressFrame<32&&(this._fastMeterState=FastMeterState.Touching),32==pressFrame&&(this._fastMeterState=FastMeterState.Pressed),this.isPressOrTouch()&&TouchInput.isReleased()&&(this._baseButton.setPressFrame(0),this._fastMeterState=FastMeterState.Idel),this._fastBaseSprite.visible=this.isPressOrTouch(),this._fastMeterSprite.visible=this.isPressOrTouch();const frameper=pressFrame/32;this._fastMeterSprite.scale.x=this._fastMeterSprite.scale.y=frameper,this.isPress()||(this._fastBaseSprite.opacity=128*frameper,this._fastMeterSprite.opacity=200*frameper)}isPress(){return this._fastMeterState==FastMeterState.Pressed&&TouchInput.isPressed()}isPressOrTouch(){return(this._fastMeterState==FastMeterState.Touching||this._fastMeterState==FastMeterState.Pressed)&&TouchInput.isPressed()}updateFastState(){if(PopupManager.busy())return;const fastSpeed=this.isPress()?2:1,hitX=TouchInput.x,hitY=TouchInput.y;if(this._fastBaseSprite.x=this._fastMeterSprite.x=hitX,this._fastBaseSprite.y=this._fastMeterSprite.y=hitY,null==$gameTemp.fastSpeed&&($gameTemp.fastSpeed=1),$gameTemp.fastSpeed=fastSpeed,EventManager.busy()||($gameTemp.fastSpeed=1),this.isPress()){if(0==this._anim.length){var t2=gsap.to(this._fastMeterSprite,.4,{opacity:128,repeat:-1,yoyo:!0});this._anim.push(t2)}}else this.killAnim()}killAnim(){this._anim.forEach(anim=>{anim.kill()}),this._anim=[]}clearPressState(){this._fastBaseSprite.visible=!1,this._fastMeterSprite.visible=!1,this._baseButton.setPressFrame(0),this._fastMeterState=FastMeterState.Idel}}const FastMeterState={Idel:0,Touching:1,Pressed:2};class Event_Scene extends Scene_Base{constructor(){super()}create(){BackGroundManager.resetup(),EventManager.resetup()}update(){super.update(),$gameScreen.update()}}class Model_Help{constructor(){}get animationData(){return $dataAnimationsMv}helpData(key){const helpData=$gameHelp.getHelpData(key);return helpData||(Debug.error("helpData = null"),null)}helpList(){let helpData=$gameHelp._data;return helpData=_.filter(helpData,help=>_.find($gameParty.getHelpKeyData(),keyData=>keyData.key==help.key)),helpData}readHelpData(helpData){let readableHelp=_.filter($gameParty.getHelpKeyData(),helpkey=>helpkey.key==helpData.key);null!=readableHelp&&readableHelp.length>0&&readableHelp.forEach(help=>{help.isRead=!0})}}class Help_Scene extends Scene_Base{constructor(){super(),this._presenter=new Presenter_Help(this)}create(){BackGroundManager.resetup(),EventManager.resetup(),super.create(),this.createDisplayObjects()}setResourceData(resourceData){this._resourceData=resourceData}isReady(){return!0}createDisplayObjects(){this.createScreenSprite(),this.createWindowLayer(),this._listWindow=new Window_HelpList(-16,96,264,408),this._listWindow.setHandler("index",this.changeSelectIndex.bind(this)),this._listWindow.setHandler("cancel",this.popScene.bind(this)),this.addChild(this._listWindow),this._statusWindow=new Window_HelpStatus(264,64,1080,540),this._statusWindow.setHandler("index",this.refreshArrows.bind(this)),this.addChild(this._statusWindow),this.createMenuButton(),this.createBackButton(),this.createMenuSprite(),this.createKeyMapWindow(),this.setMenuSprite(TextManager.getText(2090)),this._backButton.setClickHandler(()=>{SoundManager.playCancel(),this.popScene()}),this.createArrows()}createKeyMapWindow(){this._keyMapWindow=new Window_KeyMap,$gameDefine.mobileMode||(this.addChild(this._keyMapWindow),this._keyMapWindow.refresh("menuHelp"))}createArrows(){this._categoryRightButton=new Sprite_Button,this._categoryRightButton.bitmap=ImageManager.loadSystem("minus"),this._categoryRightButton.x=534,this._categoryRightButton.y=488,this._categoryRightButton.setClickHandler(this.callPageArrow.bind(this,-1)),this.addChild(this._categoryRightButton);const scale=1;this._categoryRightButton.scale.x=1,this._categoryRightButton.scale.y=1,this._categoryLeftButton=new Sprite_Button,this._categoryLeftButton.bitmap=ImageManager.loadSystem("plus"),this._categoryLeftButton.x=584,this._categoryLeftButton.y=488,this._categoryLeftButton.setClickHandler(this.callPageArrow.bind(this,1)),this.addChild(this._categoryLeftButton),this._categoryLeftButton.scale.x=1,this._categoryLeftButton.scale.y=1}callPageArrow(plus){SoundManager.playCursor(),plus>0?this._statusWindow.cursorRight():this._statusWindow.cursorLeft(),this._statusWindow.refresh(),this.refreshArrows()}refreshArrows(){this._statusWindow.refresh(),this._categoryRightButton.visible=0!=this._statusWindow.index()&&1!=this._statusWindow._data.length,this._categoryLeftButton.visible=this._statusWindow.index()!=this._statusWindow._data.length-1&&1!=this._statusWindow._data.length}start(){super.start(),this.setCommand(HelpCommand.Start)}setData(data){this._listWindow.setData(data),this._listWindow.activate(),this._listWindow.selectLast()}changeSelectIndex(){this.setCommand(HelpCommand.ChangeSelect)}commandChangeSelect(helpData){this._listWindow.activate(),this._listWindow.refresh(),this._statusWindow.select(0),this._statusWindow.setData(helpData),this._statusWindow.activate(),this.refreshArrows()}update(){super.update()}swipHelp(moveX){this._statusWindow.swipHelp(moveX)}swipReset(){this._statusWindow.swipReset()}swipEndHelp(moveX){this._statusWindow.swipEndHelp(moveX)}commandNextHelpStatus(cursor){SoundManager.playCursor(),cursor>0?this._statusWindow.cursorRight():this._statusWindow.cursorLeft(),this._statusWindow.refresh(),this.refreshArrows()}}const HelpCommand={Start:0,ChangeSelect:1};class Presenter_Help extends Presenter_Base{constructor(view){super(),this._view=view,this._model=new Model_Help,this.setEvent(),this.setSwipEvent(),this.setSwipEndEvent()}setEvent(){this._view.setEvent(this.updateCommand.bind(this))}setSwipEvent(){this._view.setSwipEvent(this.updateSwipEvent.bind(this))}setSwipEndEvent(){this._view.setSwipEndEvent(this.updateSwipEndEvent.bind(this))}updateSwipEvent(swipX,swipY,lastswipX,lastswipY){var swipEneble;this._view._statusWindow.active&&lastswipX>240&&lastswipX<960&&this._view.swipHelp(swipX)}updateSwipEndEvent(swipX,swipY,lastswipX,lastswipY){swipX<100&&swipX>-100?this._view.swipEndHelp(swipX):swipX>=100?(this.commandNextHelpStatus(1),this._view.swipEndHelp(swipX)):swipX<=-100&&(this.commandNextHelpStatus(-1),this._view.swipEndHelp(swipX)),this._view.swipReset(),this._lastSkillSwipX=null}updateCommand(){switch(super.updateCommand(),this._view._command){case HelpCommand.Start:return this.commandStart();case HelpCommand.ChangeSelect:return this.commandChangeSelect()}this._view.clearCommand()}commandStart(){const data=this._model.helpList();this._view.setData(data),this.commandChangeSelect()}commandChangeSelect(){const listItem=this._view._listWindow.item(),helpData=this._model.helpData(listItem.key);if(helpData){this._view.commandChangeSelect(helpData);const nextItem=this._view._listWindow.item();this._model.readHelpData(nextItem)}}commandNextHelpStatus(cursor){this._view.commandNextHelpStatus(cursor)}}class Popup_Help{constructor(){}static init(){1!=this._isInit&&(this._busy=!1,this._isInit=!0,this._model=new Model_Help)}static open(key,endCall,select){if(this.init(),this._busy)return;null==this._window&&(this._bgSprite=new ScreenSprite,this._bgSprite.setColor(0,0,0),this._bgSprite.opacity=0,this._window=new Window_HelpStatus(152,40,1080,540)),this._window&&this._window.parent&&(this._bgSprite.parent.removeChild(this._bgSprite),this._window.parent.removeChild(this._window),this._categoryLeftButton.parent.removeChild(this._categoryLeftButton),this._categoryRightButton.parent.removeChild(this._categoryRightButton)),SceneManager._scene.addChild(this._bgSprite),SceneManager._scene.addChild(this._window),this.createArrows(),this._endCall=endCall,this._window.setHandler("ok",this.closecheck.bind(this)),this._window.setHandler("cancel",this.closecheck.bind(this)),this._window.setHandler("index",this.refreshArrowsCursor.bind(this));const helpData=this._model.helpData(key);select?this._window.select(select):this._window.select(0),this._window.setData(helpData),this._window.activate(),gsap.to(this._bgSprite,.5,{opacity:128}),this.refreshArrows(),this._busy=!0}static closecheck(){TouchInput.y>440||PopupManager.busy()||(TouchInput.y<440&&TouchInput.isTriggered()&&SoundManager.playCancel(),PopupManager.openHelpCheck(this.close.bind(this),()=>{this._window.activate()}))}static close(){this._window.hide(),this._window.deactivate(),this._window&&this._window.parent&&(this._bgSprite.parent.removeChild(this._bgSprite),this._window.parent.removeChild(this._window),this._categoryLeftButton.parent.removeChild(this._categoryLeftButton),this._categoryRightButton.parent.removeChild(this._categoryRightButton)),this._window.destroy(),this._bgSprite.destroy(),this._categoryLeftButton.destroy(),this._categoryRightButton.destroy(),gsap.killTweensOf(this._bgSprite),this._window=null,this._bgSprite=null,this._busy=!1,this._endCall&&this._endCall(),this._endCall=null,TouchInput.clear(),Input.clear()}static busy(){return this._busy}static createArrows(){this._categoryRightButton=new Sprite_Button,this._categoryRightButton.bitmap=ImageManager.loadSystem("minus"),this._categoryRightButton.x=420,this._categoryRightButton.y=464,this._categoryRightButton.setClickHandler(this.callPageArrow.bind(this,-1)),SceneManager._scene.addChild(this._categoryRightButton);const scale=1;this._categoryRightButton.scale.x=1,this._categoryRightButton.scale.y=1,this._categoryLeftButton=new Sprite_Button,this._categoryLeftButton.bitmap=ImageManager.loadSystem("plus"),this._categoryLeftButton.x=480,this._categoryLeftButton.y=464,this._categoryLeftButton.setClickHandler(this.callPageArrow.bind(this,1)),SceneManager._scene.addChild(this._categoryLeftButton),this._categoryLeftButton.scale.x=1,this._categoryLeftButton.scale.y=1}static callPageArrow(plus){PopupManager.busy()||(SoundManager.playCursor(),plus>0?this._window.cursorRight():this._window.cursorLeft(),this._window.refresh(),this.refreshArrows())}static refreshArrows(){this._categoryRightButton.visible=0!=this._window.index()&&1!=this._window._data.length,this._categoryLeftButton.visible=this._window.index()!=this._window._data.length-1&&1!=this._window._data.length}static refreshArrowsCursor(){this._window.refresh(),this.refreshArrows()}}class Window_HelpList extends Window_Selectable{constructor(x,y,width,height){super(new Rectangle(x,y,width,height)),this._data=[],this._cursorSprite.opacity=0,this.opacity=0}setData(data){this._data=data,this.refresh()}contentsHeight(){return this.height}itemHeight(){return 48}maxItems(){return this._data?this._data.length:1}item(){return this._data&&this.index()>=0?this._data[this.index()]:null}isCurrentItemEnabled(){return!0}selectLast(){this.select(this.index()>=0?this.index():0),this.refresh()}drawItem(index){const help=this._data[index];if(help){var rect=this.itemRect(index);this.resetTextColor(),this.setFlatMode(),this.index()==index&&(this.drawBackSkewX(rect.x+12*(index-this.topIndex()),rect.y+1,rect.width-2,this.itemHeight()-2,this.cursorColor(),128),this.resetTextColor()),this.drawText(TextManager.getText(help.nameId),rect.x+24,rect.y+2,rect.width-60);const isNew=this.newDispFlag(help);isNew&&(this.contents.fontSize=12,this.changeTextColor(this.powerUpColor()),this.drawText(TextManager.getNewText(),rect.x+4,rect.y-10,rect.width),this.resetFontSettings())}}newDispFlag(help){const keyData=_.find($gameParty.getHelpKeyData(),helpKey=>helpKey.key==help.key);return!!keyData&&!keyData.isRead}refresh(){this.createContents(),this.drawAllItems()}_updateCursor(){}}class Window_HelpStatus extends Window_Selectable{constructor(x,y,width,height){super(new Rectangle(x,y,width,height)),this._data=null,this._sprite=new Sprite,this._sprite.scale.x=this._sprite.scale.y=1.5,this.addChild(this._sprite),this._cursorSprite.opacity=0,this.setHandler("index",this.refresh.bind(this)),this.scale.x=this.scale.y=2/3,this._baseX=x,this.padding=0,this.opacity=0,this._canRepeat=!1,this._stockSprite=[]}itemHeight(){return this.innerHeight}itemWidth(){return this.innerWidth}maxItems(){return this._data?this._data.length:1}maxRows(){return 1}maxCols(){return this._data?this._data.length:1}setData(data){this._helpData=data,this._data=this._helpData.imgs,this.refresh()}refresh(){super.refresh(),this.refreshTexts()}refreshTexts(){this._stockSprite.forEach(sprite=>{sprite.bitmap.clear()});const helpTextData=this.helpText(),createNum=helpTextData.length-this._stockSprite.length;this.createSprite(createNum),helpTextData.forEach((textData,index)=>{let sprite=this._stockSprite[index];sprite.bitmap=new Bitmap(Number(textData.width),Number(textData.height)),textData.color&&(sprite.bitmap.textColor=$gameColor.getColor(textData.color)),textData.textId&&sprite.bitmap.drawText(TextManager.getText(textData.textId),0,0,480,28),1!=textData.rect&&"true"!=textData.rect||(sprite.bitmap.fillRect(0,0,Number(textData.width),Number(textData.height),$gameColor.getColor(textData.color)),sprite.bitmap.clearRect(4,4,Number(textData.width)-8,Number(textData.height)-8,$gameColor.getColor(textData.color))),sprite.scale.x=sprite.scale.y=1,textData.scale&&(sprite.scale.x=sprite.scale.y=Number(textData.scale)),sprite.x=Number(textData.x),sprite.y=Number(textData.y)})}createSprite(length){for(let i=0;i<length;i++){let sprite=new Sprite;sprite.bitmap=new Bitmap(480,40),this.addChild(sprite),this._stockSprite.push(sprite)}}helpText(){return this._helpData.imgsTexts?_.filter(this._helpData.imgsTexts,textData=>textData.index==this.index()):[]}drawItem(index){if(index>=0&&this._data){const data=this._data[index];if(""==data&&index==this.index()){const scalePer=2/3/.75;this.scale.x=this.scale.y=.75,this._sprite.bitmap=null,this._sprite.visible=!1,this.contents.fontSize=29*scalePer,this.setFlatMode(),this._helpData.pages[index].forEach((pageInfo,idx)=>{var textY=44*idx+40;this.drawIcon(pageInfo.iconId,0,textY),this.drawText(pageInfo.title,48,textY,144,16),this.drawText(pageInfo.text,208,textY,600,16)}),this.contents.fontSize=26*scalePer,this.drawText(this.index()+1+"/"+this._data.length,0,640*scalePer,960*scalePer,"center")}else if(data&&index==this.index()){this.resetFontSettings(),this.scale.x=this.scale.y=2/3,this._sprite.bitmap=ImageManager.loadHelp(data),this._sprite.visible=!0,this.drawBack(0,480,960,208,"rgba(0,0,0,196)",128);const helpIndex=_.findIndex($gameHelp._data,mHelp=>mHelp==this._helpData);let marginY=$dataOption.getUserData("language")==LanguageType.English?.75:1;if(helpIndex>=0){let helpText=TextManager.getHelpText(helpIndex)[index].split("\n"),isIcon=!1;helpText.forEach((element,index)=>{element.includes("K")&&(isIcon=!0)}),helpText.forEach((element,index)=>{isIcon?this.drawTextEx(element,16,548+index*this.lineHeight()*marginY,924):this.drawText(element,16,548+index*this.lineHeight()*marginY,924)})}this.drawText(this.index()+1+"/"+this._data.length,0,640,960,"center")}}}onTouchSelect(){}swipHelp(moveX){0!=moveX&&(this._movedX=moveX,this.x=this._baseX+moveX,this.alpha=(355-Math.abs(moveX))/255)}swipReset(){this._movedX=0}swipEndHelp(moveX){0!=this._movedX&&gsap.to(this,.25,{x:this._baseX,alpha:1})}drawTextEx(text,x,y,width,index){this.resetFontSettings();const textState=this.createTextState(text,x,y,width);return this.processAllText(textState),textState.outputWidth}resetFontSettings(){this.contents.fontFace=$gameSystem.mainFontFace(),this.contents.fontSize=26,this.resetTextColor()}updateHelp(){}_updateCursor(){}update(){super.update(),TouchInput.isTriggered()&&this.callOkHandler()}}class Presenter_Fade{constructor(){}static init(){this._window=new ScreenSprite,this._window.alpha=0,this._busy=!1,this._endCall=null}static async fadein(duration){this._busy||(this.init(),this._window&&this._window.parent&&this._window.parent.removeChild(this._window),SceneManager._scene.addChild(this._window),gsap.to(this._window,duration,{alpha:1}),this._busy=!1)}static async fadeout(duration,resolve){const self=this;gsap.to(this._window,duration,{alpha:0,onComplete:function(){self._busy=!1,self._window&&self._window.parent&&(self._window.parent.removeChild(self._window),self._window.destroy())}})}static async setWait(duration){return new Promise(resolve=>{const delayTime=duration;setTimeout(()=>resolve(),delayTime)})}static busy(){return this._busy}}class Presenter_Loading{constructor(){}static init(){this._window=null,this._busy=!1,this._endCall=null}static open(){this._busy||(this._window=new Window_Loading(0,0,Graphics.boxWidth,Graphics.boxHeight),SceneManager._scene.addChild(this._window),this._window.open(),this._busy=!0)}static close(action){this._busy&&(this._window.close(),this._busy=!1,action&&action(),this._window.destroy())}static refreshProgress(value){this._busy&&this._window.refreshProgress(value)}static busy(){return this._busy}}class Window_Loading extends Window_Base{constructor(x,y,width,height){super(new Rectangle(x,y,width,height)),this._tween=[],this.hide(),this.opacity=0,this._window=new ScreenSprite,this._window.setColor(0,0,0),this._window.opacity=128,this.addChild(this._window),this._loading=new Sprite,this._loading.bitmap=ImageManager.loadSystem("Loading"),this._loading.x=560,this._loading.y=440,this.addChild(this._loading),this._gaugeSprite=new Sprite(new Bitmap(250,6)),this._gaugeSprite.bitmap.gradientFillRect(0,0,360,6,$gameColor.getColor("hpgauge2"),$gameColor.getColor("hpgauge1")),this._gaugeSprite.pivot.x=0,this._gaugeSprite.x=640,this._gaugeSprite.y=512,this._gaugeSprite.scale.x=0,this.addChild(this._gaugeSprite),this._lastValue=null}open(){this._tween&&this._tween.length&&this._tween.forEach(tween=>{tween.kill()}),this.show(),this.activate(),this._window.alpha=0,this._loading.alpha=0;var loading=gsap.to(this._loading,.5,{alpha:1,delay:.1,repeat:-1,yoyo:!0}),window=gsap.to(this._window,0,{alpha:.5,delay:0});this._tween.push(loading),this._tween.push(window)}close(){this._tween&&this._tween.length&&this._tween.forEach(tween=>{tween.kill()}),this.hide(),this.deactivate(),this._window.alpha=0,this._loading.alpha=0}refreshProgress(value){this._gaugeSprite&&(this._gaugeSprite.scale.x=value)}}class Presenter_Pause{constructor(){}static open(){this._busy||(this._window=new Window_Pause(0,0,Graphics.boxWidth,Graphics.boxHeight),SceneManager._scene.addChild(this._window),this._window.open(),this._busy=!0)}static close(){this._busy&&(this._window.close(),this._busy=!1,this._window.destroy())}static busy(){return this._busy}}class Window_Pause extends Window_Base{constructor(x,y,width,height){super(new Rectangle(x,y,width,height)),this.hide(),this.opacity=0,this._window=new ScreenSprite,this._window.setColor(0,0,0),this._window.opacity=128,this.addChild(this._window),this._loading=new Sprite,this._loading.bitmap=new Bitmap(960,80),this._loading.bitmap.drawText("Pause",0,0,960,80,"center"),this._loading.x=0,this._loading.y=240,this.addChild(this._loading)}open(){this.show(),this.activate()}close(){this.hide(),this.deactivate(),this._window.alpha=0,this._loading.alpha=0}}function Window_BattleStatus(){this.initialize.apply(this,arguments)}function Window_BattleActor(){this.initialize.apply(this,arguments)}function Window_BattleEnemy(){this.initialize.apply(this,arguments)}function Window_SkillHelp(){this.initialize.apply(this,arguments)}Window_BattleStatus.prototype=Object.create(Window_Selectable.prototype),Window_BattleStatus.prototype.constructor=Window_BattleStatus,Window_BattleStatus.prototype.initialize=function(){var width=this.windowWidth(),height=this.windowHeight(),x=Graphics.boxWidth-width/2,y=Graphics.boxHeight-height;Window_Selectable.prototype.initialize.call(this,new Rectangle(x,y,width,height)),this.opacity=0,this.deactivate()},Window_BattleStatus.prototype.maxCols=function(){return this.maxItems()},Window_BattleStatus.prototype.itemHeight=function(){return 64},Window_BattleStatus.prototype.windowWidth=function(){return 840},Window_BattleStatus.prototype.windowHeight=function(){return 96},Window_BattleStatus.prototype.maxItems=function(){return $gameParty.battleMembers().length},Window_BattleStatus.prototype.refresh=function(){},Window_BattleStatus.prototype.drawItem=function(index){},Window_BattleActor.prototype=Object.create(Window_BattleStatus.prototype),Window_BattleActor.prototype.constructor=Window_BattleActor,Window_BattleActor.prototype.initialize=function(x,y){Window_BattleStatus.prototype.initialize.call(this),this.x=x,this.y=y,this.width=296*$gameParty.battleMembers().length},Window_BattleActor.prototype.drawItem=function(){},Window_BattleActor.prototype.show=function(){Window_BattleStatus.prototype.show.call(this)},Window_BattleActor.prototype.hide=function(){Window_BattleStatus.prototype.hide.call(this),$gameParty.aliveMembers().forEach(actor=>{actor.deselect()})},Window_BattleActor.prototype.select=function(index){Window_BattleStatus.prototype.select.call(this,index),this._cursorAll=!1,$gameParty.select(this.actor())},Window_BattleActor.prototype.selectAll=function(){$gameParty.aliveMembers().forEach(actor=>{actor.select()}),this._cursorAll=!0},Window_BattleActor.prototype.actor=function(){return $gameParty.battleMembers()[this.index()]},Window_BattleActor.prototype.commandSelect=function(index){1==index&&1==this._index&&this.cursorRight(),$gameParty.select($gameParty.battleMembers()[index])},Window_BattleActor.prototype.updateHelp=function(){this.actor()&&this.setHelpWindowItem(this.actor())},Window_BattleActor.prototype._updateCursor=function(){},Window_BattleActor.prototype._refreshCursor=function(){},Window_BattleEnemy.prototype=Object.create(Window_Selectable.prototype),Window_BattleEnemy.prototype.constructor=Window_BattleEnemy,Window_BattleEnemy.prototype.initialize=function(){this._enemies=[],this._battlerStatusSprite=[],Window_Selectable.prototype.initialize.call(this,new Rectangle(0,0,0,0)),this.opacity=0,this.refresh()},Window_BattleEnemy.prototype.maxCols=function(){return $gameTroop.aliveMembers().length},Window_BattleEnemy.prototype.maxItems=function(){return this._enemies.length},Window_BattleEnemy.prototype.enemy=function(){return this._enemies[this.index()]},Window_BattleEnemy.prototype.enemyIndex=function(){var enemy=this.enemy();return enemy?enemy.index():-1},Window_BattleEnemy.prototype.show=function(){Window_Selectable.prototype.show.call(this)},Window_BattleEnemy.prototype.deactivate=function(){Window_Selectable.prototype.deactivate.call(this),$gameTroop.select(null)},Window_BattleEnemy.prototype.refresh=function(){this._enemies=$gameTroop.aliveMembers(),Window_Selectable.prototype.refresh.call(this),this._battlerStatusSprite.forEach((sprite,index)=>{sprite.changeHp(),sprite.changeMp(),this._enemies&&!this._enemies[index].isAlive()&&(sprite.opacity=0)})},Window_BattleEnemy.prototype.select=function(index){Window_Selectable.prototype.select.call(this,index),this._cursorAll=!1,$gameTroop.select(this.enemy())},Window_BattleEnemy.prototype.selectTarget=function(target){this._cursorAll=!1;var index=-1;if(target&&(index=_.findIndex(this._enemies,target)),index<0)return Window_Selectable.prototype.select.call(this,0),void $gameTroop.select(this._enemies[0]);Window_Selectable.prototype.select.call(this,index),$gameTroop.select(target)},Window_BattleEnemy.prototype.updateCursor=function(){},Window_BattleEnemy.prototype._refreshCursor=function(){},Window_BattleEnemy.prototype.updateHelp=function(){this.enemy()&&this.setHelpWindowItem(this.enemy())},Window_BattleEnemy.prototype.selectAll=function(){$gameTroop.aliveMembers().forEach(enemy=>{enemy.select()}),this._cursorAll=!0},Window_BattleEnemy.prototype.loadWindowskin=function(){},Window_BattleEnemy.prototype._updateCursor=function(){},Window_BattleEnemy.prototype._updateFrame=function(){},Window_BattleEnemy.prototype._updateContentsBack=function(){},Window_BattleEnemy.prototype._updatePauseSign=function(){},Window_BattleEnemy.prototype._updateArrows=function(){},Window_BattleEnemy.prototype.updateBackOpacity=function(){},Window_BattleEnemy.prototype.loadWindowskin=function(){},Window_BattleEnemy.prototype._createAllParts=function(){this._createContainer(),this._createClientArea(),this._createContentsSprite()},Window_BattleEnemy.prototype._refreshAllParts=function(){},Window_SkillHelp.prototype=Object.create(Window_Base.prototype),Window_SkillHelp.prototype.constructor=Window_SkillHelp,Window_SkillHelp.prototype.initialize=function(x,y,width,height,backGroundType){Window_Base.prototype.initialize.call(this,new Rectangle(x,y,width,height)),this.opacity=0,this._battler=null,this._textContent=new Sprite,this._textContent.x=48,this._textContent.y=18,this._textContent.scale.x=.5,this._textContent.scale.y=.5,this._textContent.bitmap=new Bitmap(2*this.width,192),this._backGroundType=!0,null!=backGroundType&&(this._backGroundType=backGroundType),this.addChild(this._textContent),this.refresh()},Window_SkillHelp.prototype.setData=function(data){this._data=data,this.refresh()},Window_SkillHelp.prototype.clear=function(){},Window_SkillHelp.prototype.refresh=function(){this.contents.clear(),this._textContent.bitmap.clear(),this.contents.fontSize=38,this._textContent.bitmap.fontSize=38,this._backGroundType&&this.drawBackSkewX(52,0,this.width-104,96,0,128,-.27),this.drawTextEx(this._data,56,6)},Window_SkillHelp.prototype.drawTextEx=function(helpData,x,y){if(helpData&&""!=helpData.baseText){var textState={index:0,x:x,y:y,left:x};textState.text=this.convertEscapeCharacters(helpData.baseText),textState.height=this.calcTextHeight(textState,!1);var damage=(.01*helpData.power).toFixed(2),repeat=helpData.hit;damage&&helpData.power&&(repeat>=1&&(this._textContent.bitmap.drawText(TextManager.getText(710200),720,7,200,40),this._textContent.bitmap.drawText(repeat,760,7,120,40,"right")),this._textContent.bitmap.drawText(TextManager.getText(710100),360,7,200,40,"right"),helpData.damageRateUp&&(this._textContent.bitmap.textColor=$gameColor.getColor("powerup")),this._textContent.bitmap.drawText("x"+damage,560,7,120,40,"right"),this._textContent.bitmap.textColor=$gameColor.getColor("text"));let desplayText=textState.text.split("\n");desplayText.length;let lineHeight=2;return desplayText.forEach((text,index)=>{text=text.replace(/\x1b/gi,"");let textWidth=1.5*this.width-24;if(0==index){let measureTextWidth;this._textContent.bitmap.measureTextWidth(text)>360&&(textWidth=360)}this._textContent.bitmap.drawText(text,textState.x,lineHeight,textWidth,textState.height),desplayText.length>=4&&0==index&&(this.contents.fontSize=36,this._textContent.bitmap.fontSize=36),desplayText.length>=4?lineHeight+=index>=1?textState.height-20:textState.height-8:lineHeight+=textState.height}),textState.x-x}return 0},Window_SkillHelp.prototype.loadWindowskin=function(){},Window_SkillHelp.prototype._updateCursor=function(){},Window_SkillHelp.prototype._updateFrame=function(){},Window_SkillHelp.prototype._updateContentsBack=function(){},Window_SkillHelp.prototype._updatePauseSign=function(){},Window_SkillHelp.prototype._updateArrows=function(){},Window_SkillHelp.prototype.updateBackOpacity=function(){},Window_SkillHelp.prototype.loadWindowskin=function(){},Window_SkillHelp.prototype._createAllParts=function(){this._createContainer(),this._createClientArea(),this._createContentsSprite()},Window_SkillHelp.prototype._refreshAllParts=function(){};class Window_KeyMap extends Window_Base{constructor(){super()}initialize(){this._keyMapIcon=ImageManager.loadSystem("keyMapIcons"),this._textWidth=24,super.initialize(new Rectangle(0,-9,Graphics.width,this.fittingHeight(1))),this.opacity=0,this.show(),this._lastNo=0,this.scale.x=this.scale.y=.9}refresh(key){this._text=$gameKeyMap.getKeyMap(key),this.contents.clear(),this._addX=0;let x=this.drawTextEx(this._text,0,0);this.x=924-.9*(x+this._addX);let scale=.9;this.x<240&&(scale*=(1440-this.x)/1440),this.scale.x=this.scale.y=scale,scale<.9?(this.x=this.x+880*(.9-scale),this.y=492+24*(.9-scale)):this.y=492,this._lastNo!=key&&(this._lastNo=key,this.alpha=0,this.x+=48,gsap.to(this,.25,{alpha:1,x:this.x-48}))}showAnimation(){this.show(),this.alpha=0,gsap.to(this,.1,{alpha:1,x:this.x})}drawKeyIcon(iconIndex,x,y,width){const bitmap=this._keyMapIcon,pw=24,ph=24,sx=iconIndex%16*24,sy=24*Math.floor(iconIndex/16);this.contents.blt(bitmap,sx,sy,24*width,24,x,y)}processEscapeCharacter(code,textState){switch(code){case"C":this.changeTextColor(this.textColor(this.obtainEscapeParam(textState)));break;case"I":case"H":this.processDrawIcon(this.obtainEscapeParam(textState),textState);break;case"{":this.makeFontBigger();break;case"}":this.makeFontSmaller()}}convertEscapeCharacters(text){return text=(text=(text=(text=(text=(text=(text=(text=text.replace(/\\/g,"")).replace(/\x1b\x1b/g,"\\")).replace(/\x1bV\[(\d+)\]/gi,function(){return $gameVariables.value(parseInt(arguments[1]))}.bind(this))).replace(/\x1bV\[(\d+)\]/gi,function(){return $gameVariables.value(parseInt(arguments[1]))}.bind(this))).replace(/\x1bN\[(\d+)\]/gi,function(){return this.actorName(parseInt(arguments[1]))}.bind(this))).replace(/\x1bP\[(\d+)\]/gi,function(){return this.partyMemberName(parseInt(arguments[1]))}.bind(this))).replace(/\x1bT\[(\d+)\]/gi,function(){return TextManager.getText(parseInt(arguments[1]))}.bind(this))).replace(/\x1bG/gi,TextManager.currencyUnit)}processDrawIcon(iconIndex,textState){let width=1;const controlType=$dataOption.getUserData("controlType");0===controlType?iconIndex=this.changeKeyIcon(iconIndex):1===controlType?iconIndex=this.changePadIcon(iconIndex):2===controlType&&(iconIndex=this.changePadIcon2(iconIndex)),68!=iconIndex&&70!=iconIndex||(width=2),this.drawKeyIcon(iconIndex,textState.x+2,textState.y+8,width),68!=iconIndex&&70!=iconIndex||(textState.x+=24,this._addX+=24),textState.x+=28}terminate(){gsap.killTweensOf(this),this.destroy()}}class Window_BattleResult extends Window_Selectable{constructor(x,y,width,height){super(new Rectangle(x,y,width,height)),this._statusWindow=new Window_StatusSkill(0,-40,640,384),this._statusWindow.setNoRemoveNewSkillId(),this._sprite=new Sprite_EventPicture(null,0,0,1),this.addChild(this._sprite),this.addChild(this._statusWindow),this.deactivate(),this.hide(),this.opacity=0,this._downArrowSprite.opacity=0,this._upArrowSprite.opacity=0,this._waitDuration=0;var func=function(){};this._statusWindow._skillList.onTouchSelect=func,this._statusWindow._skillList.processTouchScroll=func,this._statusWindow._skillList.updateSmoothScroll=func,this._statusWindow._skillList.isTouchScrollEnabled=function(){return!1}}setResultData(actor,skills,flagList,forceSelectSkillId){if(actor.faceName()!=this._sprite._pictureLabel){const posData=DataManager.getFacePositionData(actor.faceName());this._sprite.y=posData.y-80,this._sprite.x=-480,gsap.to(this._sprite,.5,{x:-120})}this.show(),this._statusWindow.setParameterFlag(flagList),this._statusWindow.show(),this._statusWindow.activate(),this._statusWindow.setData(skills,actor),forceSelectSkillId?this._statusWindow.selectSkill(forceSelectSkillId):this._statusWindow.selectLast(),this._statusWindow.showAnimation(),this._waitDuration=60}setEndCall(endCall){this._endCall=endCall}update(){super.update(),this._waitDuration>0?this._waitDuration-=1:(Input.isTriggered("ok")||TouchInput.isReleased())&&null!=this._endCall&&this._endCall()}terminate(){this._sprite&&(this._sprite.terminate(),this.removeChild(this._sprite)),this._statusWindow&&(this._statusWindow.terminate(),this.removeChild(this._statusWindow)),this.parent.removeChild(this),this.destroy()}}class Window_Confirm extends Window_Command{constructor(){const _marginX=40,_height=184;super(new Rectangle(-40,Graphics.height/2-92,Graphics.width+80,184)),this._commandText={},this._lastIndex=this.index(),this._canRepeat=!1,this._cursorSprite.opacity=0}setTextData(mainText,subText){this._mainText=mainText,this._subText=subText}setCommandText(key,text){this._commandText[key]=text}refresh(){if(this.createContents(),super.refresh(),this._mainText)if(this._subText){const text=this.convertEscapeCharacters(this._mainText);this.drawText(text,40,8,Graphics.width,"center");const text2=this.convertEscapeCharacters(this._subText);this.drawText(text2,40,40,Graphics.width,"center")}else{const text=this.convertEscapeCharacters(this._mainText);this.drawText(text,40,24,Graphics.width,"center")}}maxCols(){return this._commandText?Object.keys(this._commandText).length:1}topRow(){return 0}itemWidth(){return 200}itemHeight(){return 40}makeCommandList(){this._handlers&&Object.keys(this._handlers).forEach(key=>{this.addCommand(this._commandText[key],key)})}itemRect(index){let rect=new Rectangle;rect.width=this.itemWidth(),rect.height=this.itemHeight();const offsetX=Graphics.width-Object.keys(this._handlers).length*this.itemWidth();return rect.x=this.itemWidth()*index+20+offsetX/2,rect.y=this._height-88,rect}itemTextAlign(){return"center"}drawItem(index){const rect=this.itemRect(index),align=this.itemTextAlign();index==this.index()&&(this.resetTextColor(),this.drawBack(rect.x,rect.y,rect.width,rect.height,"rgba(216,96,132,255)",164)),this.changePaintOpacity(this.isCommandEnabled(index)),this.drawText(this.commandName(index),rect.x,rect.y,rect.width,align)}update(){super.update(),this._lastIndex!=this.index()&&(this._lastIndex=this.index(),this.refresh())}initHandlers(){this._handlers={}}updateOpen(){this._opening&&(this.openness+=64,this.isOpen()&&(this._opening=!1))}_refreshCursor(){}}class Window_Caution extends Window_Base{constructor(text,x,y,width,height){super(new Rectangle(x,y,width,height)),this._tween=null,this.hide(),this.close(),this.contents.drawText(text,0,-16,this.width,this.height,"center")}}class Window_StageInfo extends Window_Selectable{constructor(x,y,width,height){super(new Rectangle(x,y,width,height)),this._bitmap=ImageManager.loadSystem("plateA"),this._stage=null,this._cursorSprite.opacity=0,this._canRepeat=!1}itemWidth(){return this.width-2*this.padding}itemHeight(){return this.height-2*this.padding}maxItems(){return 1}item(){return this._stage?this._stage:null}selectLast(){this.select(0)}itemRect(index){var rect=new Rectangle,maxCols=this.maxCols();return rect.width=this.itemWidth(),rect.height=this.itemHeight(),rect.x=index%maxCols*(rect.width+this.spacing())-this._scrollX,rect.y=Math.floor(index/maxCols)*rect.height-this._scrollY,rect}drawStage(){const marginX=$dataOption.getUserData("language")==LanguageType.English?240:160;if(this._stage){const padding=12,spacing=12;this.contents.blt(this._bitmap,0,0,96,30,padding+26,spacing+6);let text=TextManager.getText(201e3)+this._stage.id;this.contents.fontItalic=!0,this.contents.fontSize=21,this.drawText(text,padding-4,spacing+1,160,"center"),this.resetFontSettings(),this.contents.fontItalic=!1,this.drawText(TextManager.getText(DataManager.getStageInfos(this._stage.id).nameId),2*padding+marginX,spacing,400);let line=0;this.drawText(TextManager.getText(1000100),2*padding,this.lineHeight()+2*spacing,240,100),0==this._stage.loseType?this.drawText(TextManager.getText(1000300),2*padding+marginX,this.lineHeight()+2*spacing,320,100):this.drawText(TextManager.getText(1000400),2*padding+marginX,this.lineHeight()+2*spacing,320,100),this.drawText(TextManager.getText(1000200),2*padding,2*this.lineHeight()+3*spacing,240,100),$gameParty.members().forEach(member=>{this.drawText(member.name()+TextManager.getText(1000500),2*padding+marginX,this.lineHeight()*(2+line)+3*spacing,320,100),line+=1}),1==this._stage.loseType&&(this.changeTextColor(this.crisisColor()),this.drawText(TextManager.getText(1000600),2*padding+marginX,this.lineHeight()*(2+line)+3*spacing,320,100),this.resetFontSettings())}}updateHelp(){}refresh(stageData){this._stage=stageData,this.createContents(),this.drawStage()}_updateCursor(){}}class Window_Credit extends Window_Selectable{constructor(x,y,width,height){super(new Rectangle(x,y,4*width/3,4*height/3)),this._cursorSprite.opacity=0,this._data=null,this.scale.x=this.scale.y=.75;const spacing=13;this._upArrowSprite.move(this._width-13,9),this._downArrowSprite.move(this._width-13,this._height-8),this._sideBarBack=new Sprite(new Bitmap(12,this.height-39)),this._sideBarBack.bitmap.fillRect(0,0,6,this.height-39,"black"),this._sideBarBack.x=this._width-13+3,this._sideBarBack.y=20,this._sideBarBack.anchor.x=.5,this._sideBarBack.alpha=.5,this.addChild(this._sideBarBack)}itemWidth(){return this.width-2*this.padding}itemHeight(){return 32}maxItems(){return this._data?this._data.length:null}item(){return this._data?this._data[this.index()]:null}setData(data){this._data=data,this.refresh()}selectLast(){this.select(0)}drawItem(index){const text=this._data[index];if(text){const rect=this.itemRect(index);this.resetFontSettings(),this.drawText(text,rect.x,rect.y,rect.width)}}update(){super.update(),this.updateSideBarBack()}updateSideBarBack(){this._sideBarBack&&(this._sideBarBack.alpha=this._upArrowSprite.visible||this._downArrowSprite.visible?.5:0),this._scrollBar&&(this._scrollBar.alpha=this._upArrowSprite.visible||this._downArrowSprite.visible?1:0)}updateHelp(){}refresh(){this.createContents(),this.drawAllItems(),null==this._scrollBar&&(this._scrollBar=new ScrollBar(this))}_updateCursor(){}ensureCursorVisible(smooth){if(this._cursorAll)this.scrollTo(0,0);else if(this.innerHeight>0&&this.row()>=0){const itemTop=this.row()*this.itemHeight(),itemBottom=itemTop+this.itemHeight(),scrollMin=itemBottom-this.innerHeight;smooth?this.smoothScrollTo(0,scrollMin):this.scrollTo(0,scrollMin)}}}function Window_PartyCommand(){this.initialize.apply(this,arguments)}Window_PartyCommand.prototype=Object.create(Window_Command.prototype),Window_PartyCommand.prototype.constructor=Window_PartyCommand,Window_PartyCommand.prototype.initialize=function(){Window_Command.prototype.initialize.call(this,new Rectangle(-40,184,1080,160)),this.openness=0,this._canRepeat=!1,this.hide(),this.deactivate(),this._cursorSprite.opacity=0},Window_PartyCommand.prototype.itemWidth=function(){return 200},Window_PartyCommand.prototype.itemHeight=function(){return 40},Window_PartyCommand.prototype.itemRect=function(index){let rect=new Rectangle;return rect.width=this.itemWidth(),rect.height=this.itemHeight(),rect.x=280*index+280,rect.y=80,rect},Window_PartyCommand.prototype.refresh=function(){this.createContents(),Window_Command.prototype.refresh.call(this);const loseType=DataManager.getStageInfos($gameParty.stageNo()).loseType;loseType==GameStageLoseType.TROOPMEMBERLOST?this.drawText(TextManager.getText(601111),40,20,960,"center"):this.drawText(TextManager.getText(601110),40,20,960,"center")},Window_PartyCommand.prototype.maxCols=function(){return 2},Window_PartyCommand.prototype.itemTextAlign=function(){return"center"},Window_PartyCommand.prototype.makeCommandList=function(){this.addCommand(TextManager.getText(601e3),"fight"),this.addCommand(TextManager.getText(601100),"menu",!0)},Window_PartyCommand.prototype.setup=function(){this.clearCommandList(),this.makeCommandList(),this.refresh(),this.select(Window_PartyCommand._lastCommand),this.activate(),this.open()},Window_PartyCommand.prototype._updatePauseSign=function(){},Window_PartyCommand.prototype._updateArrows=function(){},Window_PartyCommand.prototype._updateContentsBack=function(){},Window_PartyCommand.prototype._updateCursor=function(){},Window_PartyCommand.prototype.drawItem=function(index){const rect=this.itemRect(index),align=this.itemTextAlign();index==this.index()&&(this.resetTextColor(),this.drawBack(rect.x,rect.y,rect.width,rect.height,"rgba(216,96,132,255)",164),Window_PartyCommand._lastCommand=index),this.changePaintOpacity(this.isCommandEnabled(index)),this.drawText(this.commandName(index),rect.x,rect.y,rect.width,align)},Window_PartyCommand.prototype.update=function(){Window_Command.prototype.update.call(this),this._lastIndex!=this.index()&&(this._lastIndex=this.index(),this.refresh())},Window_PartyCommand.prototype._createAllParts=function(){this._createContainer(),this._createClientArea(),this._createBackSprite(),this._createCursorSprite(),this._createFrameSprite(),this._createContentsSprite()},Window_PartyCommand.prototype._refreshAllParts=function(){this._refreshBack(),this._refreshFrame()},Window_PartyCommand._lastCommand=0;class MemberSelect_Model{constructor(){this._actorList=null,this._selectActorId=[]}actorList(){if(null==this._actorList){let actorList=[];$gameActors._data.forEach(actorData=>{actorData&&actorList.push(actorData)}),this._actorList=actorList}return this._actorList}selectActor(actorId){-1==this._selectActorId.indexOf(actorId)?this._selectActorId.push(actorId):this._selectActorId=_.without(this._selectActorId,actorId)}refreshData(){const _param={actorList:this._actorList,selectActorId:this._selectActorId};return _param}}class MemberSelect_View extends Scene_Base{constructor(){super(),this._presenter=new MemberSelect_Presenter(this)}create(){BackGroundManager.resetup(),EventManager.resetup(),super.create(),this.createDisplayObjects()}setResourceData(resourceData){this._resourceData=resourceData}isReady(){return!0}createDisplayObjects(){this.createScreenSprite(),this.createWindowLayer(),this._listWindow=new MemberSelect_ActorList(0,0,960,540),this._listWindow.setHandler("ok",this.selectActor.bind(this)),this._listWindow.setHandler("right",this.changeActor.bind(this,1)),this._listWindow.setHandler("left",this.changeActor.bind(this,-1)),this._listWindow.setHandler("index",this.changeSelectIndex.bind(this)),this._listWindow.setHandler("cancel",this.popScene.bind(this)),this.addChild(this._listWindow),this.createHelpWindow(),this.createKeyMapWindow()}createKeyMapWindow(){this._keyMapWindow=new Window_KeyMap,$gameDefine.mobileMode||(this.addChild(this._keyMapWindow),this._keyMapWindow.refresh("memberSelect"))}createArrows(){this._categoryRightButton=new Sprite_Button,this._categoryRightButton.bitmap=ImageManager.loadSystem("minus"),this._categoryRightButton.x=534,this._categoryRightButton.y=488,this._categoryRightButton.setClickHandler(this.callPageArrow.bind(this,-1)),this.addChild(this._categoryRightButton);const scale=1;this._categoryRightButton.scale.x=1,this._categoryRightButton.scale.y=1,this._categoryLeftButton=new Sprite_Button,this._categoryLeftButton.bitmap=ImageManager.loadSystem("plus"),this._categoryLeftButton.x=584,this._categoryLeftButton.y=488,this._categoryLeftButton.setClickHandler(this.callPageArrow.bind(this,1)),this.addChild(this._categoryLeftButton),this._categoryLeftButton.scale.x=1,this._categoryLeftButton.scale.y=1}callPageArrow(plus){SoundManager.playCursor(),plus>0?this._statusWindow.cursorRight():this._statusWindow.cursorLeft(),this._statusWindow.refresh(),this.refreshArrows()}refreshArrows(){this._statusWindow.refresh(),this._categoryRightButton.visible=0!=this._statusWindow.index()&&1!=this._statusWindow._data.length,this._categoryLeftButton.visible=this._statusWindow.index()!=this._statusWindow._data.length-1&&1!=this._statusWindow._data.length}start(){super.start(),this.setCommand(MemberSelectCommand.Start)}setActorData(data){this._listWindow.setData(data),this._listWindow.activate(),this._listWindow.selectLast()}changeSelectIndex(){}changeActor(value){value>0?this._listWindow.cursorDown():this._listWindow.cursorUp(),this._listWindow.refresh(),this._listWindow.activate()}selectActor(){this.setCommand(MemberSelectCommand.Select),this.setCommand(MemberSelectCommand.Refresh),this._listWindow.activate()}currentActorId(){return this._listWindow.item().actorId()}update(){super.update()}swipHelp(moveX){this._statusWindow.swipHelp(moveX)}swipReset(){this._statusWindow.swipReset()}swipEndHelp(moveX){this._statusWindow.swipEndHelp(moveX)}commandNextHelpStatus(cursor){SoundManager.playCursor(),cursor>0?this._statusWindow.cursorRight():this._statusWindow.cursorLeft(),this._statusWindow.refresh(),this.refreshArrows()}refresh(param){this._listWindow.selectActorId(param.selectActorId)}}const MemberSelectCommand={Start:0,Select:1,Refresh:100};class MemberSelect_Presenter extends Presenter_Base{constructor(view){super(),this._view=view,this._model=new MemberSelect_Model,this.setEvent(),this.setSwipEvent(),this.setSwipEndEvent()}setEvent(){this._view.setEvent(this.updateCommand.bind(this))}setSwipEvent(){this._view.setSwipEvent(this.updateSwipEvent.bind(this))}setSwipEndEvent(){this._view.setSwipEndEvent(this.updateSwipEndEvent.bind(this))}updateSwipEvent(swipX,swipY,lastswipX,lastswipY){var swipEneble;this._view._statusWindow.active&&lastswipX>240&&lastswipX<960&&this._view.swipHelp(swipX)}updateSwipEndEvent(swipX,swipY,lastswipX,lastswipY){swipX<100&&swipX>-100?this._view.swipEndHelp(swipX):swipX>=100?(this.commandNextHelpStatus(1),this._view.swipEndHelp(swipX)):swipX<=-100&&(this.commandNextHelpStatus(-1),this._view.swipEndHelp(swipX)),this._view.swipReset(),this._lastSkillSwipX=null}updateCommand(){super.updateCommand();const _currentCommand=this._view._command.pop();switch(_currentCommand){case MemberSelectCommand.Start:return this.commandStart();case MemberSelectCommand.Select:return this.commandSelect();case MemberSelectCommand.Refresh:return this.commandRefresh()}this._view.clearCommand()}commandStart(){this._view.setActorData(this._model.actorList())}commandSelect(){const _currentActorId=this._view.currentActorId();this._model.selectActor(_currentActorId)}commandRefresh(){this._view.refresh(this._model.refreshData())}}class MemberSelect_ActorList extends Window_Selectable{constructor(x,y,width,height){super(new Rectangle(x,y,width,height)),this._data=[],this._selectId=[],this._cursorSprite.opacity=0,this._actorSprite=new Sprite,this._actorSprite.scale.x=this._actorSprite.scale.y=1.25,this._actorSprite.x=40,this._actorSprite.y=64,this.addChild(this._actorSprite),this._actorListItem=new MemberSelect_ActorListItem(x+width/2+40,y+40,width/2,height),this.addChild(this._actorListItem)}setData(data){this._data=data,this.refresh()}selectActorId(actorId){this._selectId=actorId,this.refresh()}contentsHeight(){return this.height}itemHeight(){return 48}maxItems(){return this._data?this._data.length:1}item(){return this._data&&this.index()>=0?this._data[this.index()]:null}isCurrentItemEnabled(){return!0}selectLast(){this.select(this.index()>=0?this.index():0),this.refresh()}drawItem(index){const actor=this._data[index];actor&&(this._actorSprite.bitmap=ImageManager.loadPicture(actor.faceName().replace("yhmv","yh")),this._actorListItem.setActor(actor))}newDispFlag(help){const keyData=_.find($gameParty.getHelpKeyData(),helpKey=>helpKey.key==help.key);return!!keyData&&!keyData.isRead}refresh(){this.createContents(),this.drawItem(this.index())}_updateCursor(){}}class MemberSelect_ActorListItem extends Window_Base{constructor(x,y,width,height){super(new Rectangle(x,y,width,height)),this._cursorSprite.opacity=0,this._actor=null}setActor(actor){this._actor=actor,this.refresh()}lineHeight(){return 36}refresh(){this.createContents(),this.updateFace(16,0),this.updateName(184,0),this.updateElement(184,this.lineHeight()),this.updateLvExp(184,2*this.lineHeight()),this.updateElementStatus(24,184),this.updateStatus(24,240)}updateFace(x,y){this.drawFace(this._actor.faceName(),0,x,y)}updateName(x,y){this.drawText(this._actor.name(),x,y,240)}updateElement(x,y){this.drawText(TextManager.getText(600),x,y,240),this.drawText($dataSystem.elements[this._actor._elementId],x+80,y,120,"right")}updateLvExp(x,y){this.drawText(TextManager.getText(700)+".",x,y,240),this.drawText(this._actor.level,x+this.lineHeight(),y,240),this.drawText(TextManager.getText(720),x,y+this.lineHeight(),240),this.drawText(this._actor.currentLevelExp(),x+8,y+this.lineHeight(),120,"right"),this.drawText(TextManager.getText(710),x+136,y+this.lineHeight(),240),this.drawText(this._actor.nextLevelExp(),x+80,y+this.lineHeight(),120,"right")}updateStatus(x,y){const _lineHeight=this.lineHeight(),_statusTextId=[500,510,520,530,540],_statusParamId=[0,1,2,6,3],_upperStatusType=[StateType.HP_UPPER_STATUS,StateType.MP_UPPER_STATUS,StateType.ATK_UPPER_STATUS,StateType.SPD_UPPER_STATUS,StateType.GRD_UPPER_STATUS];for(let i=0;i<_statusTextId.length;i++){this.drawText(TextManager.getText(_statusTextId[i]),x,y+_lineHeight*i,120),this.drawText(this._actor.param(_statusParamId[i]),x+80,y+_lineHeight*i,120,"right");let upper=this._actor.getStateEffectTotal($gameStateInfo.getStateId(_upperStatusType[i]));null!=upper&&upper>0&&this.drawText("(+"+upper+"%)",x+184,y+_lineHeight*i,120,"right")}}updateElementStatus(x,y){const _element=$dataSystem.elements,_elementId=[1,2,3,4,5],_elementStatusType=[StateType.FIRE_STATUS,StateType.THUNDER_STATUS,StateType.ICE_STATUS,StateType.WHITE_STATUS,StateType.BLACK_STATUS];for(let i=0;i<_elementId.length;i++)this.drawText(_element[_elementId[i]],x+80*i,y,120),this.drawElementStatus(this._actor,_elementStatusType[i],x+80*i+32,y,120)}drawElementStatus(actor,elementStatusType,x,y){const _elementStatus=actor.getStateEffectTotal($gameStateInfo.getStateId(elementStatusType));let status="G";_elementStatus>100?status="S":_elementStatus>80?status="A":_elementStatus>60?status="B":_elementStatus>40?status="C":_elementStatus>20?status="D":_elementStatus>10?status="E":_elementStatus>0&&(status="F"),this.drawText(status,x,y,120)}_updateCursor(){}}class Tactics_Model{constructor(){0==$gameParty._stageData._init&&$gameParty._stageData.initialize(),this._selectedData=$gameParty._stageData._selectedData;const _actorList=$gameParty.members();let _position=$gameTacticsActorPosition.data();_position=_.shuffle(_position),_actorList.forEach((actor,index)=>{actor.setPosition(_position[index])}),this._members=this.positionSelectData(_actorList),this._selectedMembers=[],this._alchemyMagicList=[],$gameAlchemy.data().forEach(alchemy=>{this._alchemyMagicList.push({skill:$dataSkills[alchemy.skill],needRank:alchemy.needRank,cost:alchemy.cost})}),console.log($gameParty),console.log(this._members),console.log(this._selectedMembers)}energy(){return $gameParty.gold()}positionSelectData(data){return data.sort((a,b)=>a.position().x-b.position().x)}commandList(){return $gameCommand.menuCommand()}magicCategory(){return $gameElement.data()}alchemyMagicList(){return this._alchemyMagicList}searchList(){return $gameSearch.data()}turnInfo(){return $gameParty._stageData._turns}refreshData(){const _param={actorList:this._actorList,selectActorId:this._selectActorId};return _param}actorSpriteList(){return this._members}actorPositionData(){return $gameTacticsActorPosition.data()}selectedData(category){return this._selectedData[category]}selectedActorNameList(category){return this._selectedData[category].map(a=>$gameActors.actor(a).name()).join(",")}isSelectedActor(category,actorId){return this._selectedData[category].find(a=>a==actorId)}addSelectData(category,actorId){this._selectedData[category].push(actorId)}removeSelectData(category,actorId){this._selectedData[category]=_.without(this._selectedData[category],actorId)}clearSelectData(category){let members=[];const selectIds=this._selectedData[category];for(let i=0;i<selectIds.length;i++){let member=this._selectedMembers.find(a=>a.actorId()==selectIds[i]);this._members.push(member),this._selectedMembers=_.without(this._selectedMembers,member),members.push(member)}return this._members=this.positionSelectData(this._members),this._selectedData[category]=[],members}decidedMember(category){let members=[];const selectIds=this._selectedData[category];for(let i=0;i<selectIds.length;i++){let member=this._members.find(a=>a.actorId()==selectIds[i]);this._selectedMembers.push(member),this._members=_.without(this._members,member),members.push(member)}return this._members=this.positionSelectData(this._members),members}}class Tactics_View extends Scene_Base{constructor(){super(),this._presenter=new Tactics_Presenter(this)}create(){BackGroundManager.resetup(),EventManager.resetup(),super.create(),this.createDisplayObjects()}setResourceData(resourceData){this._resourceData=resourceData}isReady(){return!0}createDisplayObjects(){let background=new Sprite;background.bitmap=ImageManager.loadBackground("nexfan_01"),background.x=-40,background.y=-200,this.addChild(background),this.createWindowLayer()}createObjectAfter(){this.createHelpWindow(),this.createKeyMapWindow()}createKeyMapWindow(){this._keyMapWindow=new Window_KeyMap,$gameDefine.mobileMode||this.addChild(this._keyMapWindow)}createArrows(){this._categoryRightButton=new Sprite_Button,this._categoryRightButton.bitmap=ImageManager.loadSystem("minus"),this._categoryRightButton.x=534,this._categoryRightButton.y=488,this._categoryRightButton.setClickHandler(this.callPageArrow.bind(this,-1)),this.addChild(this._categoryRightButton);const scale=1;this._categoryRightButton.scale.x=1,this._categoryRightButton.scale.y=1,this._categoryLeftButton=new Sprite_Button,this._categoryLeftButton.bitmap=ImageManager.loadSystem("plus"),this._categoryLeftButton.x=584,this._categoryLeftButton.y=488,this._categoryLeftButton.setClickHandler(this.callPageArrow.bind(this,1)),this.addChild(this._categoryLeftButton),this._categoryLeftButton.scale.x=1,this._categoryLeftButton.scale.y=1}callPageArrow(plus){SoundManager.playCursor(),plus>0?this._statusWindow.cursorRight():this._statusWindow.cursorLeft(),this._statusWindow.refresh(),this.refreshArrows()}refreshArrows(){this._statusWindow.refresh(),this._categoryRightButton.visible=0!=this._statusWindow.index()&&1!=this._statusWindow._data.length,this._categoryLeftButton.visible=this._statusWindow.index()!=this._statusWindow._data.length-1&&1!=this._statusWindow._data.length}start(){super.start(),this.setCommand(TacticsCommand.Start)}setActorSpriteList(data){null==this._actorSpriteList&&(this._actorSpriteList=new Tactics_ActorSpriteList(0,270),this.addChild(this._actorSpriteList)),this._actorSpriteList.setData(data)}setCommandData(commandData){if(null!=this._commandList)return;let commandListBack=new Sprite;commandListBack.bitmap=ImageManager.loadSystem("textplateC"),commandListBack.x=48,commandListBack.y=416,commandListBack.scale.x=1.2,commandListBack.scale.y=1.2,this.addChild(commandListBack),this._commandList=new Tactics_CommandList(144,384,680,commandData),commandData.forEach((command,index)=>{this._commandList.setHandler(command.key,this.commandDecide.bind(this,index))}),this.addChild(this._commandList)}commandDecide(commandIndex){this.setCommand(TacticsCommand.CommandOk)}commandCommandOk(isEnable,selectedActorNameList){if(isEnable)this._actorSelect.activate(),this._actorSelect.select(0);else{const mainText=TextManager.getText(1e4).replace("/d",selectedActorNameList),text1=TextManager.getCancelText(),text2=TextManager.getDecideText(),_popup=PopupManager;_popup.setPopup(mainText,{select:0,subText:null}),_popup.setHandler(text1,"ok",()=>{this._commandList.activate()}),_popup.setHandler(text2,"cancel",()=>{this.setCommand(TacticsCommand.SelectClear),this._commandList.activate()}),_popup.open()}}setTurnInfoData(data){null==this._turnInfo&&(this._turnInfo=new Sprite_TurnInfo,this.addChild(this._turnInfo)),this._turnInfo.setTurn(data)}setEnergyData(data){null==this._energyInfo&&(this._energyInfo=new Tactics_EnergyInfo(40,8,320,64),this.addChild(this._energyInfo)),this._energyInfo.setEnergy(data)}setSelectActor(data){null==this._actorSelect&&(this._actorSelect=new Tactics_ActorSelect(0,0,2,2),this._actorSelect.setHandler("ok",this.setCommand.bind(this,TacticsCommand.SelectOk)),this._actorSelect.setHandler("cancel",this.setCommand.bind(this,TacticsCommand.SelectCancel)),this._actorSelect.setHandler("save",this.setCommand.bind(this,TacticsCommand.SelectEnd)),this._actorSelect.setHandler("index",this.refreshActorIndex.bind(this)),this.addChild(this._actorSelect)),this._actorSelect.setData(data)}setMagicCategory(data){null==this._magicCategory&&(this._magicCategory=new Tactics_MagicCategory(120,128,72,264),this._magicCategory.setHandler("index",this.refreshCategoryIndex.bind(this)),this.addChild(this._magicCategory)),this._magicCategory.setMagicCategory(data),this._magicCategory.hide()}refreshCategoryIndex(){const _category=this._magicCategory.category();this._alchemyMagicList.setCategory(_category)}setAlchemyMagicList(data){null==this._alchemyMagicList&&(this._alchemyMagicList=new Tactics_AlchemyMagicList(184,128,640,360),this.addChild(this._alchemyMagicList)),this._alchemyMagicList.setAlchemyMagic(data),this._alchemyMagicList.hide()}setSearchList(data){null==this._searchList&&(this._searchList=new Tactics_SearchList(120,128,640,360),this._searchList.setHandler("ok",this.setCommand.bind(this,TacticsCommand.SearchMember)),this._searchList.setHandler("cancel",this.setCommand.bind(this,TacticsCommand.SelectCancel)),this.addChild(this._searchList)),this._searchList.setSearch(data),this._searchList.hide()}selectActorId(){return this._actorSelect.actor().actorId()}selectCategory(){return this._commandList.currentSymbol()}commandSelectOk(isSelected){const _index=this._actorSelect.index();this._actorSpriteList.setSelectedIndex(_index,isSelected),this._actorSelect.activate(),this._actorSpriteList.activate()}commandSelectClear(actorIdList,memberList){this._actorSelect.setData(memberList),this._actorSpriteList.addActorList(actorIdList)}commandSelectCancel(isEnable,selectedActorNameList){if(this._actorSelect.deactivate(),isEnable){const mainText=selectedActorNameList+TextManager.getText(10100).replace("/d",TextManager.getText(this._commandList.currentCommand().textId)),text1=TextManager.getCancelText(),text2=TextManager.getDecideText(),_popup=PopupManager;_popup.setPopup(mainText,{select:0,subText:null}),_popup.setHandler(text1,"ok",()=>{this.setCommand(TacticsCommand.SelectClear),this._commandList.activate()}),_popup.setHandler(text2,"cancel",()=>{this.setCommand(TacticsCommand.DecideMember),this._commandList.activate()}),_popup.open()}else this._commandList.activate()}refreshActorIndex(){const _index=this._actorSelect.index();this._actorSpriteList.selectingIndex(_index)}commandDecideMember(actorIdList){this._actorSelect.removeActorList(actorIdList),this._actorSpriteList.removeActorList(actorIdList),this._actorSpriteList.deactivate()}commandSelectAlchemy(){this._commandList.deactivate(),this._alchemyMagicList.show(),this._alchemyMagicList.activate(),this._magicCategory.show(),this._magicCategory.activate()}commandCommandSearch(){this._searchList.show(),this._searchList.activate(),this._searchList.select(0)}commandCommandTurnend(){const mainText=TextManager.getText(10200),text1=TextManager.getCancelText(),text2=TextManager.getDecideText(),_popup=PopupManager;_popup.setPopup(mainText,{select:0,subText:null}),_popup.setHandler(text1,"ok",()=>{this._commandList.activate()}),_popup.setHandler(text2,"cancel",()=>{this.setCommand(TacticsCommand.Turnend)}),_popup.open()}update(){super.update()}swipHelp(moveX){}swipReset(){}swipEndHelp(moveX){}commandNextHelpStatus(cursor){SoundManager.playCursor(),cursor>0?this._statusWindow.cursorRight():this._statusWindow.cursorLeft(),this._statusWindow.refresh(),this.refreshArrows()}refresh(param){this._listWindow.selectActorId(param.selectActorId)}}const TacticsCommand={Start:0,CommandOk:10,Train:11,SelectOk:30,SelectCancel:31,SelectClear:32,SelectEnd:33,DecideMember:51,TrainMagic:71,SearchMember:91,Turnend:111,Refresh:100};class Tactics_Presenter extends Presenter_Base{constructor(view){super(),this._view=view,this._model=new Tactics_Model,this.setEvent(),this.setSwipEvent(),this.setSwipEndEvent()}setEvent(){this._view.setEvent(this.updateCommand.bind(this))}setSwipEvent(){this._view.setSwipEvent(this.updateSwipEvent.bind(this))}setSwipEndEvent(){this._view.setSwipEndEvent(this.updateSwipEndEvent.bind(this))}updateSwipEvent(swipX,swipY,lastswipX,lastswipY){}updateSwipEndEvent(swipX,swipY,lastswipX,lastswipY){swipX<100&&swipX>-100?this._view.swipEndHelp(swipX):swipX>=100?(this.commandNextHelpStatus(1),this._view.swipEndHelp(swipX)):swipX<=-100&&(this.commandNextHelpStatus(-1),this._view.swipEndHelp(swipX)),this._view.swipReset(),this._lastSkillSwipX=null}updateCommand(){super.updateCommand();const _currentCommand=this._view._command.pop();switch(_currentCommand){case TacticsCommand.Start:return this.commandStart();case TacticsCommand.CommandOk:return this.commandCommandOk();case TacticsCommand.SelectOk:return this.commandSelectOk();case TacticsCommand.SelectCancel:return this.commandSelectCancel();case TacticsCommand.SelectClear:return this.commandSelectClear();case TacticsCommand.SelectEnd:return this.commandSelectEnd();case TacticsCommand.DecideMember:return this.commandDecideMember();case TacticsCommand.SearchMember:return this.commandSearchMember()}this._view.clearCommand()}commandStart(){this._view.setEnergyData(this._model.energy()),this._view.setTurnInfoData(this._model.turnInfo());const _speiteList=this._model.actorSpriteList();this._view.setActorSpriteList(_speiteList),this._view.setSelectActor(_speiteList),this._view.setCommandData(this._model.commandList()),this._view.createObjectAfter(),this._view.setMagicCategory(this._model.magicCategory()),this._view.setAlchemyMagicList(this._model.alchemyMagicList()),this._view.setSearchList(this._model.searchList())}commandCommandOk(){const _category=this._view.selectCategory(),_selected=this._model.selectedData(_category);"turnend"==_category?this._view.commandCommandTurnend():"status"==_category?SceneManager.push(MemberSelect_View):"search"==_category&&0==_selected.length?this._view.commandCommandSearch():this._view.commandCommandOk(0==_selected.length,this._model.selectedActorNameList(_category))}commandSelectOk(){const _actorId=this._view.selectActorId(),_category=this._view.selectCategory(),_isSelected=this._model.isSelectedActor(_category,_actorId);_isSelected?this._model.removeSelectData(_category,_actorId):this._model.addSelectData(_category,_actorId),this._view.commandSelectOk(_isSelected)}commandSelectCancel(){const _category=this._view.selectCategory();this._view.commandSelectCancel(this._model.selectedData(_category).length>0,this._model.selectedActorNameList(_category))}commandSelectClear(){const _category=this._view.selectCategory(),_selected=this._model.selectedData(_category);this._model.clearSelectData(_category),this._view.commandSelectClear(_selected,this._model.actorSpriteList())}commandSelectEnd(){}commandDecideMember(){const _category=this._view.selectCategory();this._model.decidedMember(_category),this._view.commandDecideMember(this._model.selectedData(_category)),"alchemy"==_category&&this._view.commandSelectAlchemy(this._model.alchemyMagicList())}commandSearchMember(){const _category=this._view.selectCategory(),_selected=this._model.selectedData(_category);this._view.commandCommandOk(0==_selected.length,this._model.selectedActorNameList(_category))}commandRefresh(){this._view.refresh(this._model.refreshData())}}class Tactics_CommandList extends Window_HorzCommand{constructor(x,y,width,commandData){super(x,y,width,commandData)}initialize(x,y,width,commandData){this._commandData=commandData,super.initialize(new Rectangle(x,y,width,40*commandData.length)),this._cursorSprite.opacity=0,this.opacity=0,this._lastIndex=this.index(),this.selectLast(),this.refresh()}currentCommand(){return this._commandData[this.index()]}maxCols(){return 7}static initCommandPosition(){this._lastCommandSymbol=null}makeCommandList(){this._commandData.forEach(data=>{this.addCommand(TextManager.getText(data.textId),data.key,!0)})}lineHeight(){return 88}drawItem(index){const rect=this.itemLineRect(index);this.resetTextColor(),this.contents.fontSize=21,this.index(),this.changePaintOpacity(this.isCommandEnabled(index));const iconPath=this._commandData[index].iconPath;if(iconPath){const bitmap=ImageManager.loadIcon(iconPath),pw=64,ph=64;this.contents.blt(bitmap,0,0,pw,ph,rect.x,rect.y)}const text=this.commandName(index);this.contents.drawText(text,rect.x,rect.y+28,rect.width,this.lineHeight(),"center",!0)}newDispFlag(index){if(1==index)for(let i=0;i<$gameParty.members().length;i++){let actor=$gameParty.members()[i];if(_.find($gameParty._newSkillIdList,s=>_.find(actor._skills,skillId=>skillId==s)))return!0}return 3==index&&($gameSwitches.value(1)&&_.find($gameParty.getHelpKeyData(),helpkey=>!helpkey.isRead))}processOk(){EventManager.busy()||super.processOk()}updateHelp(){if(this._commandData[this.index()]){const id=this._commandData[this.index()].helpTextId;this.setHelpWindowText(TextManager.getText(id))}}selectLast(){this.selectSymbol(Window_MenuListCommand._lastCommandSymbol)}update(){super.update(),this._lastIndex!=this.index()&&(this._lastIndex=this.index(),this.refresh())}terminate(){gsap.killTweensOf(this._cursorSprite),this.destroy()}}class Tactics_EnergyInfo extends Window_Base{constructor(x,y,width,height){super(x,y,width,height)}initialize(x,y,width,height){super.initialize(new Rectangle(x,y,width,height))}setEnergy(value){this.contents.clear(),this.drawText(value,0,0,this._width-2*this.padding-32,"right",!0),this.contents.fontSize=16,this.drawText("pt",0,4,this._width-2*this.padding-8,"right",!0)}_updateCursor(){}terminate(){gsap.killTweensOf(this._cursorSprite),this.destroy()}}class Tactics_ActorSelect extends Window_Selectable{constructor(x,y,width,height){super(new Rectangle(x,y,width,height)),this._data=[]}setData(data){this._data=data,this.refresh()}maxItems(){return this._data.length}drawItem(index){const rect=this.itemLineRect(index);this.resetTextColor(),this.contents.fontSize=21,this.contents.drawText("text",rect.x,rect.y+28,rect.width,this.lineHeight(),"center",!0)}processOk(){EventManager.busy()||super.processOk()}updateHelp(){if(this._commandData[this.index()]){const id=this._commandData[this.index()].helpTextId;this.setHelpWindowText(TextManager.getText(id))}}selectLast(){this.selectSymbol(Window_MenuListCommand._lastCommandSymbol)}update(){super.update(),this._lastIndex!=this.index()&&(this._lastIndex=this.index(),this.refresh())}cursorRight(wrap){super.cursorDown(wrap)}cursorLeft(wrap){super.cursorUp(wrap)}cursorUp(wrap){}cursorDown(wrap){}actor(){return this._data[this.index()]}removeActorList(actorIdList){for(let i=0;i<actorIdList.length;i++){let data=this._data.find(a=>a.actorId()==actorIdList[i]);this._data=_.without(this._data,data)}this.refresh()}terminate(){gsap.killTweensOf(this._cursorSprite),this.destroy()}}class Tactics_ActorSpriteList extends Sprite{constructor(x,y){super(),this.x=x,this.y=y,this._data=null,this._actorSprites=[],this._arrowSprite=new Sprite,this._arrowSprite.bitmap=ImageManager.loadSystem("arrowA_2d"),this.addChild(this._arrowSprite),this._arrowSprite.anchor.x=.5,this._arrowSprite.anchor.y=.5,this.deactivate()}setData(data){this._data=data,this.createActorSprite()}createActorSprite(data){this._data.forEach(d=>{let position=d.position(),actor=d,sprite=new Sprite;sprite.bitmap=ImageManager.loadPicture(actor.faceName()+"_00_s"),sprite.scale.x=sprite.scale.y=position.scale,sprite.x=position.x,sprite.y=position.y,sprite.anchor.y=1,this.addChild(sprite),this._actorSprites.push(sprite)})}actorSprites(selectIndex){return this._actorSprites.filter(a=>0!=a.opacity)[selectIndex]}selectingIndex(selectIndex){this.activate();const _index=this._actorSprites.findIndex(a=>a==this.actorSprites(selectIndex)),_position=this._data[_index].position();this._arrowSprite.x=0+_position.x+this.actorSprites(selectIndex).width*_position.scale*.5,this._arrowSprite.y=-24+_position.y-this.actorSprites(selectIndex).height*_position.scale}setSelectedIndex(selectIndex,isSelected){isSelected?this._actorSprites[selectIndex].setBlendColor([0,0,0,0]):this._actorSprites[selectIndex].setBlendColor([255,255,255,64])}addActorList(actorIdList){for(let i=0;i<actorIdList.length;i++){let index=this._data.findIndex(a=>a.actorId()==actorIdList[i]);this._actorSprites[index].opacity=255,this._actorSprites[index].setBlendColor([0,0,0,0])}this.refresh()}removeActorList(actorIdList){for(let i=0;i<actorIdList.length;i++){let index=this._data.findIndex(a=>a.actorId()==actorIdList[i]);this._actorSprites[index].opacity=0}this.refresh()}activate(){this._arrowSprite.visible=!0}deactivate(){this._arrowSprite.visible=!1}refresh(){}terminate(){gsap.killTweensOf(this._cursorSprite),this.destroy()}}class Tactics_AlchemyMagicList extends Window_Selectable{constructor(x,y,width,height){super(new Rectangle(x,y,width,height)),this._data=[],this._magicList=[]}setAlchemyMagic(data){this._data=data,this._magicList=data,super.refresh()}setCategory(category){this._magicList=this._data.filter(a=>a.skill.damage.elementId==category.elementId),super.refresh()}maxItems(){return null!=this._magicList?this._magicList.length:0}drawItem(index){const _alchemy=this._magicList[index];if(_alchemy){const rect=this.itemLineRect(index);this.resetTextColor(),this.contents.fontSize=21,this.drawText(TextManager.getSkillName(_alchemy.skill.id),rect.x,rect.y,rect.width),_alchemy.needRank&&_alchemy.needRank.forEach((rank,index)=>{0==rank&&(rank="－"),this.drawText(rank,rect.x+264+40*index,rect.y,40,"center")}),this.drawText(_alchemy.cost+"pt",rect.x,rect.y,rect.width,"right")}}updateHelp(){}update(){super.update(),this._lastIndex!=this.index()&&(this._lastIndex=this.index(),this.refresh())}terminate(){gsap.killTweensOf(this._cursorSprite),this.destroy()}}class Tactics_SearchList extends Window_Selectable{constructor(x,y,width,height){super(new Rectangle(x,y,width,height)),this._data=[]}setSearch(data){this._data=data,super.refresh()}maxItems(){return null!=this._data?this._data.length:0}drawItem(index){const _search=this._data[index];if(_search){const rect=this.itemLineRect(index);this.resetTextColor(),this.contents.fontSize=21;const _enemy=$dataEnemies[_search.bossEnemy],width=240,height=80,bitmap=ImageManager.loadFace(_enemy.faceName);this.contents.blt(bitmap,0,0,width,height,rect.x,rect.y),this.drawText("Lv."+_search.bossLv+" "+_enemy.name,rect.x+200,rect.y,rect.width),this.drawText("+"+_enemy.gold+" pt",rect.x+200,rect.y+40,rect.width)}}updateHelp(){}update(){super.update(),this._lastIndex!=this.index()&&(this._lastIndex=this.index(),this.refresh())}terminate(){gsap.killTweensOf(this._cursorSprite),this.destroy()}}class Tactics_MagicCategory extends Window_Selectable{constructor(x,y,width,height){super(new Rectangle(x,y,width,height)),this._data=[]}category(){return this._data[this.index()]}setMagicCategory(data){this._data=data,this.refresh()}maxItems(){return this._data.length}drawItem(index){const _category=this._data[index];if(_category){const rect=this.itemLineRect(index);this.drawSkillIcon(_category.iconIndex,rect.x,rect.y)}}updateHelp(){}update(){super.update(),this._lastIndex!=this.index()&&(this._lastIndex=this.index(),this.refresh())}terminate(){gsap.killTweensOf(this._cursorSprite),this.destroy()}}class Presenter_Top extends Presenter_Base{constructor(view){super(),this._view=view,this._model=new Model_Top,this._busy=!1,this.setEvent()}setEvent(){this._view.setEvent(this.updateCommand.bind(this))}updateCommand(){if(super.updateCommand(),!this._busy){switch(this._view._command[0]){case TopCommand.Start:return this.commandStart()}this._view.clearCommand()}}async commandStart(){$dataOption.adjustScreen(),this.commandGameStart()}commandGameStart(){Presenter_Loading.close(),this._view.commandGameStart()}}class Model_Top{constructor(){}async convertTextData(){}}class Top_Scene extends Scene_Base{constructor(){super(),this._presenter=new Presenter_Top(this)}create(){super.create()}createKeyMapWindow(){this._keyMapWindow=new Window_KeyMap,$gameDefine.mobileMode||(this.addChild(this._keyMapWindow),this._keyMapWindow.refresh("menuEnemy"))}start(){super.start(),this.setCommand(TopCommand.Start)}commandLogo(){TutorialManager.openGuide("release001",0,()=>{this.commandGameStart()})}commandGameStart(){SceneManager.goto(Title_Scene),Window_TitleCommand.initCommandPosition()}update(){super.update(),TutorialManager.busy()&&(Input.isTriggered("ok")||Input.isTriggered("cancell")||TouchInput.isReleased())&&(SoundManager.playOk(),TutorialManager.clear(()=>{this.commandGameStart()}))}}const TopCommand={Start:1};class Title_Scene extends Scene_Base{constructor(){super(),this._resourceData=null,this._presenter=new Presenter_Title(this),this._lastLanguage=null}create(){super.create(),BackGroundManager.resetup(),BackGroundManager.changeBackGround("Ruins",null),BackGroundManager.resetPosition(),BackGroundManager.clearWeather(),EventManager.resetup(),EventManager.clearWeather(),this.createWindowLayer(),this.createCommandWindow(),this.createDebugWindow(),this.createVersionSprite(),this.createTitleSprite(),this.createHelpWindow(),this.createMenuButton(),this.createMenuSprite(),this._menuPlate.visible=!1,this.createBackButton(),this.createKeyMapWindow(),Presenter_Fade.fadein(0)}async start(){super.start(),this._commandWindow.deactivate(),SceneManager.clearStack(),Presenter_Loading.open(),SceneManager._previousClass.name&&"Load_Scene"!=SceneManager._previousClass.name&&await this.loading(this.waitResourceLoad.bind(this)),Presenter_Loading.close(),Presenter_Fade.fadeout(0),this.playTitleMusic(),this.startFadeIn(this.fadeSpeed(),!1),this._commandWindow.activate()}waitResourceLoad(){return AudioManager.loadedBgmResource(this._resourceData.bgm)&&this.isReady()}setResourceData(resourceData){this._resourceData=resourceData}isBusy(){return this._commandWindow.isClosing()||Scene_Base.prototype.isBusy.call(this)}createCommandWindow(){const rectData=this.convertRect(.75,.65,320,180);this._commandWindow=new Window_TitleCommandList(rectData.x,rectData.y,320,180),this._commandWindow.setHandler("newGame",this.commandNewGame.bind(this)),this._commandWindow.setHandler("continue",this.commandContinue.bind(this)),this._commandWindow.setHandler("option",this.commandOptions.bind(this)),$gameTemp.isPlaytest()&&this._commandWindow.setHandler("shift",this.commandDebug.bind(this)),this.addWindow(this._commandWindow)}createDebugWindow(){this._debugWindow=new Window_DebugCommand,this._debugWindow.setHandler("outputeventfile",this.outputeventfile.bind(this)),this._debugWindow.setHandler("outputAndroid",this.outputAndroid.bind(this)),this._debugWindow.setHandler("outputtextdata",this.outputtextdata.bind(this)),this._debugWindow.setHandler("outputactorstext",this.outputActorsText.bind(this)),this._debugWindow.setHandler("csvtotextdata",this.csvtotextdata.bind(this)),this._debugWindow.setHandler("csvtoeventdata",this.csvtoeventdata.bind(this)),this._debugWindow.setHandler("scriptminify",this.scriptminify.bind(this)),this._debugWindow.setHandler("versioncheck",this.versioncheck.bind(this)),this._debugWindow.setHandler("resourcedownload",this.resourcedownload.bind(this)),this._debugWindow.setHandler("twitterApply",this.twitterApply.bind(this)),this._debugWindow.setHandler("deploysteamwin",this.deploysteamwin.bind(this)),this._debugWindow.setHandler("deploysteammac",this.deploysteammac.bind(this)),this._debugWindow.setHandler("deploydlsitewin",this.deploydlsitewin.bind(this)),this._debugWindow.setHandler("deploydlsitemac",this.deploydlsitemac.bind(this)),this._debugWindow.setHandler("deployandroid",this.deployandroid.bind(this)),this._debugWindow.setHandler("deployios",this.deployios.bind(this)),this._debugWindow.setHandler("outputDeployAssetOnly",this.outputDeployAssetOnly.bind(this)),this._debugWindow.setHandler("outputDeployAll",this.outputDeployAll.bind(this)),this.addWindow(this._debugWindow)}createVersionSprite(){const rectData=this.convertRect(.8,.95,0,0);this._versionSprite=new Sprite,this._versionSprite.x=rectData.x,this._versionSprite.y=rectData.y,this._versionSprite.scale.x=.75,this._versionSprite.scale.y=.75;let bitmap=new Bitmap(320,128);bitmap.drawText(TextManager.getText(100300)+$gameDefine.gameVersion,0,0,320,64,"right"),this._versionSprite.bitmap=bitmap,this.addChild(this._versionSprite)}createTitleSprite(){}createHelpWindow(){this._helpWindow=new Window_Help,this.addChild(this._helpWindow)}createKeyMapWindow(){this._keyMapWindow=new Window_KeyMap,$gameDefine.mobileMode||this.addChild(this._keyMapWindow)}createBackButton(){this._backButton=new Sprite_IconButton,this._backButton.hide(),this.addChild(this._backButton)}commandNewGame(){SoundManager.playOk(),DataManager.setupNewGame(),this._commandWindow.hide(),this._versionSprite.hide(),SceneManager.goto(Tactics_View)}commandContinue(){this._commandWindow.close(),DataManager.loadGame(0).then(()=>this.onLoadSuccess()).catch(()=>this.onLoadFailure())}onLoadSuccess(){SoundManager.playLoad(),SceneManager.goto(Map_Scene)}onLoadFailure(){SoundManager.playBuzzer()}commandOptions(){let index=_.findIndex(this.children,child=>child instanceof Window_Help);this._lastLanguage=$dataOption.getUserData("language"),Scene_Option.setPopup(()=>{this._commandWindow.activate(),this._keyMapWindow.hide(),this.setMenuSprite("");const lastLanguage=$dataOption.getUserData("language");lastLanguage!=this._lastLanguage&&SceneManager.goto(Title_Scene)},5),this._keyMapWindow&&(Scene_Option.setKeyHelpWindow(this._keyMapWindow),this._keyMapWindow.show(),this._keyMapWindow.refresh("menuOption")),this._backButton&&(Scene_Option.setBackButton(this._backButton),this._backButton.show()),this._menuPlate&&(Scene_Option.setMenuButton(this._menuPlate),this._menuPlate.show()),this.setMenuSprite(TextManager.getText(2050)),Scene_Option.setHelpWindow(this._helpWindow)}commandDebug(){this.setCommand(TitleCommand.Debug)}sendDebugMode(){this._commandWindow.deactivate(),this._debugWindow.show(),this._debugWindow.activate()}commandUpdate(){}playTitleMusic(){AudioManager.playBgm($gameBGM.getBgm("title")),AudioManager.stopBgs(),AudioManager.stopMe()}async checkUpdatePopup(){}outputeventfile(){this.setCommand(TitleCommand.OutputEventFile)}outputAndroid(){this.setCommand(TitleCommand.OutputAndroid)}outputtextdata(){this.setCommand(TitleCommand.OutputTextData)}outputActorsText(){this.setCommand(TitleCommand.OutputActorsText)}csvtotextdata(){this.setCommand(TitleCommand.CsvToTextData)}csvtoeventdata(){this.setCommand(TitleCommand.CsvToEventData)}scriptminify(){this.setCommand(TitleCommand.ScriptMinify)}versioncheck(){this.setCommand(TitleCommand.VersionCheck)}resourcedownload(){this.setCommand(TitleCommand.ResourceDownload)}twitterApply(){this.setCommand(TitleCommand.TwitterApply)}deploysteamwin(){this.setCommand(TitleCommand.DeploySteamWin)}deploysteammac(){this.setCommand(TitleCommand.DeploySteamMac)}deploydlsitewin(){this.setCommand(TitleCommand.DeployDlSiteWin)}deploydlsitemac(){this.setCommand(TitleCommand.DeployDlSiteMac)}deployandroid(){this.setCommand(TitleCommand.DeployAndroid)}deployios(){this.setCommand(TitleCommand.DeployiOS)}outputDeployAssetOnly(){this.setCommand(TitleCommand.OutputDeployAssetOnly)}outputDeployAll(){this.setCommand(TitleCommand.OutputDeployAll)}terminate(){super.terminate(),BackGroundManager.clearWeather(),EventManager.remove(),BackGroundManager.remove(),this.destroy()}update(){if(this.isBusy()||this._commandWindow.open(),super.update(),!Input.isTriggered("pagedown")){if(null!=this._reader&&this._reader.result){var data=JSON.parse(this._reader.result),textData=[],idx=0;data.forEach(d=>{var length=0;if(d){d.list.forEach(prm=>{if("401"==prm.code){var t={type:"common"};t.id=idx,t.length=length,t.parameters=prm.parameters[0],textData.push(t)}length+=1});var jsonData=JSON.stringify(d.list),fs;if(idx<10)var name="Event00"+idx.toString();else if(idx<100)var name="Event0"+idx.toString();require("fs").writeFileSync(StorageManager.localFileEventDirectoryPath()+name+".json",jsonData)}idx+=1});var tData=JSON.stringify(textData),csvText="type,id,length,paramater\n";textData.forEach(element=>{Object.keys(element).forEach((function(key){csvText+=element[key],csvText+=","})),csvText+="\n"});var name="Text_Common",fs;require("fs").writeFileSync(StorageManager.localFileEventDirectoryPath()+name+".csv",csvText),Debug.log(textData),this._reader=null}if(null!=this._reader2&&this._reader2.result){var array=this._reader2.result.split("\n"),data=[];array.forEach(element=>{data.push(element.split(","))}),data.forEach(element=>{if("common"===element[0]){var id=element[1],length=element[2];Debug.log("id="+element[1]),Debug.log("length="+element[2]),Debug.log("param="+element[3]),Debug.log($dataCommonEvents[+id].list[+length].parameters[0]),$dataCommonEvents[+id].list[+length].parameters[0]=element[3]}}),this._reader2=null;var jsonData=JSON.stringify($dataCommonEvents);Debug.log($dataCommonEvents),$("<a>",{href:window.URL.createObjectURL(new Blob([jsonData],{type:"text/plain"})),download:"CommonEvents.json"})[0].click()}}}checkUpdate(){var xhr=new XMLHttpRequest,url="http://ecoddr.blog.jp/System.json";xhr.open("GET",url),xhr.setRequestHeader("Pragma","no-cache"),xhr.setRequestHeader("Cache-Control","no-cache"),xhr.setRequestHeader("If-Modified-Since","Thu, 01 Jun 1970 00:00:00 GMT");var self=this;xhr.onload=function(){if(xhr.status<400){var data=JSON.parse(xhr.responseText);if(Debug.log(data.currencyUnit),Debug.log($dataSystem.currencyUnit),$dataSystem.currencyUnit!=data.currencyUnit){var text="ver"+data.currencyUnit+TextManager.getItemName(142),text1=TextManager.getDecideText(),text2=TextManager.getCancelText(),text3=TextManager.getItemDescription(142);text=self._updateWindow.convertEscapeCharacters(text),self._updateWindow.setup(text,text1,text2,text3,()=>{window.open("http://ecoddr.blog.jp/archives/588533.html"),self._commandWindow.activate()},()=>{self._commandWindow.activate()})}else{if(null==self._cautionWindow){var text="最新の状態です";self._cautionWindow=new Window_Caution(text,360,280,560,160),self.addChild(self._cautionWindow)}self._cautionWindow.disp(),self._commandWindow.activate()}}},xhr.onerror=this._mapLoader||function(){DataManager._errorUrl=DataManager._errorUrl||url},xhr.send()}}const TitleCommand={NewGame:0,Continue:1,Debug:2,OutputEventFile:11,OutputAndroid:12,VersionCheck:13,ResourceDownload:14,TwitterApply:15,ScriptMinify:16,OutputTextData:21,CsvToTextData:22,CsvToEventData:23,OutputActorsText:31,DeploySteamWin:101,DeploySteamMac:102,DeployDlSiteWin:103,DeployDlSiteMac:104,DeployAndroid:105,DeployiOS:106,OutputDeployAssetOnly:107,OutputDeployAll:108};class Presenter_Title extends Presenter_Base{constructor(view){super(),this._busy=!1,this._view=view,this._model=new Model_Title,this.setEvent()}setEvent(){this._resourcedata=this._model.loadResourceData(),this._view.setResourceData(this._resourcedata),this._view.setEvent(this.updateCommand.bind(this))}async checkVersion(){await this.commandVersionCheck()}updateCommand(){if(super.updateCommand(),this._busy)return;if(EventManager.busy())return;if(PopupManager.busy())return;const _currentCommand=this._view._command.pop();switch(console.log(_currentCommand),_currentCommand){case TitleCommand.NewGame:return this.commandNewGame();case TitleCommand.Continue:return this.commandContinue();case TitleCommand.Debug:return this.commandDebug();case TitleCommand.OutputEventFile:return this.commandOutputEventFile();case TitleCommand.OutputTextData:return this.commandOutputTextData();case TitleCommand.CsvToTextData:return this.commandCsvToTextData();case TitleCommand.CsvToEventData:return this.commandCsvToEventData();case TitleCommand.CsvToTextDataUTF8:return this.commandCsvToTextDataUTF8();case TitleCommand.CsvToEventDataUTF8:return this.commandCsvToEventData();case TitleCommand.OutputAndroid:return this.commandOutputAndroid();case TitleCommand.OutputActorsText:return this.commandOutPutActorsText();case TitleCommand.VersionCheck:return this.commandVersionCheck();case TitleCommand.ResourceDownload:return this.commandResourceDownload();case TitleCommand.TwitterApply:return this.commandTwitterApply();case TitleCommand.ScriptMinify:return this.commandScriptMinify();case TitleCommand.DeploySteamWin:return this.commandDeploySteamWin();case TitleCommand.DeploySteamMac:return this.commandDeploySteamMac();case TitleCommand.DeployDlSiteWin:return this.commandDeployDlSiteWin();case TitleCommand.DeployDlSiteMac:return this.commandDeployDlSiteMac();case TitleCommand.DeployAndroid:return this.commandDeployAndroid();case TitleCommand.DeployiOS:return this.commandDeployiOS();case TitleCommand.OutputDeployAssetOnly:return this.commandOutputDeployAssetOnly();case TitleCommand.OutputDeployAll:return this.commandOutputDeployAll()}this._view.clearCommand()}commandNewGame(){this._view.commandNewGame()}commandContinue(){}commandDebug(){this._view.sendDebugMode()}commandOutputEventFile(){EventManager.allEventFileOutput()}commandOutputTextData(){this._model.outputTextdata()}commandCsvToTextData(){const _popup=PopupManager;_popup.setPopup("エンコードタイプは？",{select:0}),_popup.setHandler("Shift_JIS","ok",()=>{this._model.csvToTextdata("Shift_JIS")}),_popup.setHandler("utf-8","cancel",()=>{this._model.csvToTextdata("utf-8")}),_popup.open()}commandCsvToEventData(){const _popup=PopupManager;_popup.setPopup("エンコードタイプは？",{select:0}),_popup.setHandler("Shift_JIS","ok",()=>{this._model.csvToEventdata("Shift_JIS")}),_popup.setHandler("utf-8","cancel",()=>{this._model.csvToEventdata("utf-8")}),_popup.open()}commandOutputAndroid(){}commandOutPutActorsText(){this._model.outputActorsText()}async commandVersionCheck(){const version=DataManager.checkUpdate();return!(!version||version.currencyUnit==$dataSystem.currencyUnit)&&(Debug.log("バージョン違い"),this._view.checkUpdatePopup(),!0)}async commandResourceDownload(){}commandTwitterApply(){}commandScriptMinify(){this._model.scriptMinify()}commandDeploySteamWin(){this._model.outputSteamWin()}commandDeploySteamMac(){this._model.outputSteamMac()}commandDeployDlSiteWin(){this._model.outputDlSiteWin()}commandDeployDlSiteMac(){this._model.outputDlSiteMac()}commandDeployAndroid(){this._model.outputAndroid()}commandDeployiOS(){this._model.outputiOS()}commandOutputDeployAssetOnly(){this._model.outputDeployAssetOnly()}commandOutputDeployAll(){this._model.outputDeployAll()}setWait(num){return new Promise(resolve=>{const delayTime=num;setTimeout(()=>resolve(),delayTime)})}update(){}}class Model_Title{constructor(){}outputDeproy(platform,basePath,targetPath,isWindows){const path=require("path");let bPath,resourcePath=path.dirname(process.mainModule.filename).replace("project","static\\asset_bundle");DeployUtility.outputAudio(platform,basePath,targetPath,resourcePath,isWindows),DeployUtility.outputData(basePath,targetPath,resourcePath,isWindows),DeployUtility.outputImage(basePath,targetPath,resourcePath,isWindows),DeployUtility.outputEvent(basePath,targetPath),DeployUtility.outputEventEnglish(basePath,targetPath),DeployUtility.outputSource(platform,basePath,targetPath),DeployUtility.outputCssData(basePath,targetPath),DeployUtility.outputIconData(basePath,targetPath),DeployUtility.outputTextData(basePath,targetPath),DeployUtility.unlinkSaveData(targetPath),DeployUtility.renamePackageJson(platform,targetPath),DeployUtility.renameMobileVersionCode(platform,targetPath),DeployUtility.renameGameDefine(platform,targetPath),DeployUtility.replaceGameAppId(platform,targetPath)}outputAndroid(){const path=require("path");let basePath=path.dirname(process.mainModule.filename),targetPath=basePath.replace("project","static\\android\\www");this.outputDeproy(PlatForm.Android,basePath,targetPath,!1)}outputiOS(){const path=require("path");let basePath=path.dirname(process.mainModule.filename),targetPath=basePath.replace("project","static\\iOS\\www");this.outputDeproy(PlatForm.iOS,basePath,targetPath,!1)}outputSteamWin(){const path=require("path");let basePath=path.dirname(process.mainModule.filename),targetPath=basePath.replace("project","static\\steam\\project");this.outputDeproy(PlatForm.Steam,basePath,targetPath,!0)}outputSteamMac(){const path=require("path");let basePath=path.dirname(process.mainModule.filename),targetPath=basePath.replace("project","static\\mac\\project\\Game.app\\Contents\\Resources\\app.nw");this.outputDeproy(PlatForm.Steam,basePath,targetPath,!1)}outputDlSiteWin(){const path=require("path");let basePath=path.dirname(process.mainModule.filename),targetPath=basePath.replace("project","static\\dlsite\\project");this.outputDeproy(PlatForm.DlSite,basePath,targetPath,!0)}outputDlSiteMac(){const path=require("path");let basePath=path.dirname(process.mainModule.filename),targetPath=basePath.replace("project","static\\dlsite_mac\\project\\Game.app\\Contents\\Resources\\app.nw");this.outputDeproy(PlatForm.DlSite,basePath,targetPath,!1)}loadResourceData(){let needBgm=$gameBGM.getBgm("title");return AudioManager.loadedBgmResource([needBgm])||AudioManager.loadBgm(needBgm),{bgm:[needBgm]}}outputTextdata(){LocalizeUtility.outputTextdata()}csvToTextdata(type){}csvToEventdata(type){}scriptMinify(){CommonUtility.scriptMinify()}outputActorsText(){EventManager.outputActorsText()}outputDeployAssetOnly(){}outputDeployAll(){this.outputSteamWin(),this.outputSteamMac(),this.outputDlSiteWin(),this.outputDlSiteMac(),this.outputAndroid(),this.outputiOS()}}class Window_TitleCommandList extends Window_Command{constructor(x,y,width,height){super(new Rectangle(x,y,width,height)),this.x=x,this.y=y,this.openness=0,this.opacity=0,this._lastIndex=null,this._cursorSprite.opacity=0,this.selectLast()}static initCommandPosition(){Window_TitleCommand._lastCommandSymbol=null}itemTextAlign(){return"center"}makeCommandList(){this.addCommand(TextManager.getText(100100),"newGame"),this.addCommand(TextManager.getText(100200),"continue",this.isContinueEnabled()),this.addCommand(TextManager.getText(100400),"option")}isContinueEnabled(){return DataManager.isAnySavefileExists()}processOk(){Window_TitleCommand._lastCommandSymbol=this.currentSymbol(),super.processOk()}selectLast(){Window_TitleCommand._lastCommandSymbol?this.selectSymbol(Window_TitleCommand._lastCommandSymbol):this.isContinueEnabled()&&this.selectSymbol("continue")}itemTextAlign(){return"left"}itemLineRect(index){const rect=this.itemRectWithPadding(index),padding=(rect.height-this.lineHeight())/2;return rect.x+=12*padding,rect.y+=padding,rect.height-=2*padding,rect}drawItem(index){const rect=this.itemLineRect(index),align=this.itemTextAlign();this.resetTextColor(),this.currentData()&&this.currentData().symbol==this.commandSymbol(index)&&(this.drawBackSkewX(rect.x,rect.y,rect.width,rect.height,this.cursorColor(),128),this.resetTextColor()),this.changePaintOpacity(this.isCommandEnabled(index)),this.drawText(this.commandName(index),rect.x+24+-12*index,rect.y,rect.width,align)}update(){super.update(),this._lastIndex!=this.index()&&(this._lastIndex=this.index(),this.refresh())}_updateCursor(){}}Window_TitleCommand._lastCommandSymbol=null;class Window_DebugCommand extends Window_Command{constructor(){super(new Rectangle(0,0,540,540)),this.x=0,this.y=0,this.hide(),this.deactivate()}itemTextAlign(){return"center"}makeCommandList(){this.addCommand("イベントデータ出力","outputeventfile"),this.addCommand("テキストデータ出力","outputtextdata"),this.addCommand("Csvから英語版テキスト出力","csvtotextdata"),this.addCommand("Csvから英語版イベントを出力","csvtoeventdata"),this.addCommand("スクリプト圧縮","scriptminify"),this.addCommand("Steam-Window版をデプロイ","deploysteamwin"),this.addCommand("Steam-Mac版をデプロイ","deploysteammac"),this.addCommand("DLSite-Window版をデプロイ","deploydlsitewin"),this.addCommand("DLSite-Mac版をデプロイ","deploydlsitemac"),this.addCommand("Android版をデプロイ","deployandroid"),this.addCommand("iOS版をデプロイ","deployios"),this.addCommand("アセットを更新","outputDeployAssetOnly"),this.addCommand("全部一括でを更新","outputDeployAll")}}class Layer_BattleParty extends Sprite{constructor(members){super(),this._actorSprites=[],this._checkAnimation=[],this._mpAnimation=[],this.createActors(members)}createActors(members){members.forEach(actor=>{let sprite=new Sprite_Actor;sprite.setBattler(actor,!0),this.addChild(sprite),this._actorSprites.push(sprite)})}refreshBattleStatus(){this._actorSprites&&this._actorSprites.forEach(actorSprite=>{actorSprite.refreshStatus()})}changeTpEffect(actors){this._actorSprites&&this._actorSprites.forEach(actorSprite=>{actorSprite.changeTpEffect(_.find(actors,a=>a==actorSprite._battler))})}startMpAnimation(battler,mpNumber){}setDamagePopup(target,type,value,length){if(!target.isActor())return;let sprite=_.find(this._actorSprites,sprite=>sprite._battler==target);const damageSprite=sprite.setDamagePopup(type,value,length);sprite.addChild(damageSprite)}startStatePopup(target,type,value){if(!target.isActor())return;let sprite=_.find(this._actorSprites,sprite=>sprite._battler==target),stateSprite=sprite.setupStatePopup(type,value);sprite.addChild(stateSprite)}startCounterAnimation(battler){if(!battler.isActor())return;let sprite=_.find(this._actorSprites,sprite=>sprite._battler==battler);const counterSprite=sprite.setCounterPopup();sprite.addChild(counterSprite)}startChainAnimation(battler){if(!battler.isActor())return;let sprite=_.find(this._actorSprites,sprite=>sprite._battler==battler);const chainSprite=sprite.setChainPopup();sprite.addChild(chainSprite)}startAnimation(battler,animationId,mirror,delay,scale,nosound,nocheck){if(!battler.isActor())return;if(!battler)return void Debug.log("対象がいない");const target=_.find(this._actorSprites,a=>a._battler==battler);if(target){const animation=$dataAnimationsMv[animationId];delay=3===animation.position?0:delay,scale=1!=scale?scale:1;const result=target.startAnimation(animation,mirror,delay,scale,nosound);if(nocheck)return;this._checkAnimation||(this._checkAnimation=[]),this._checkAnimation.push(result)}}startAnimationEffect(baseSprite,battler,animationId,mirror,delay,scale,nosound,nocheck){if(!battler.isActor())return;if(!battler)return void Debug.log("対象がいない");let target=_.find(this._actorSprites,a=>a._battler==battler);if(target._anchor.y=0,target){const animation=$dataAnimations[animationId];delay=3===animation.position?0:delay,scale=1!=scale?scale:1;const result=baseSprite.createAnimationSprite([target],animation,mirror);if(nocheck)return;this._checkAnimation||(this._checkAnimation=[]),this._checkAnimation.push(result)}}clearAnimation(){this._actorSprites.forEach(sprite=>{sprite._animationSprites.length>0&&(sprite._animationSprites.forEach(element=>{element.destroy()}),sprite._animationSprites=[])})}clearStatePopup(){this._actorSprites.forEach(sprite=>{sprite.clearStatePopup()})}clearDamagePopup(){this._actorSprites.forEach(sprite=>{sprite.clearDamagePopup()})}clearMpAnimation(){this._mpAnimation.forEach(sprite=>{sprite&&this.removeChild(sprite)}),this._mpAnimation=[]}isAnimationPlaying(){return!!_.find(this._checkAnimation,anim=>anim.isPlaying())}clearPlaying(){let destroyAnimations=[];this._checkAnimation.forEach(animation=>{animation.terminate(),destroyAnimations.push(animation)});for(let i=destroyAnimations.length-1;i>=0;i--)null!=destroyAnimations[i].parent&&(destroyAnimations[i].parent.removeChild(destroyAnimations[i]),destroyAnimations[i].destroy());this._checkAnimation=[]}performCollapse(target,type){target.isActor()}setDragHandler(handler){this._dragHandler=handler}updateDraging(){if(null==this._dragHandler)return;if(0==TouchInput.isPressed())return void this._dragHandler(null);let isDrag=!1;this._actorSprites.forEach(sprite=>{sprite.isBeingTouched()&&(isDrag=!0,this._dragHandler(sprite))}),0==isDrag&&this._dragHandler(null)}update(){super.update(),this.updateDraging()}changeFace(battler,faceType){let sprite=_.find(this._actorSprites,actorSprite=>actorSprite._battler==battler);null!=sprite&&sprite.changeFace(faceType)}changeFaceAll(faceType){this._actorSprites.forEach(sprite=>{sprite.changeFace(faceType)})}terminate(){for(let i=this._mpAnimation.length-1;i>=0;i--)this._mpAnimation[i].terminate(),this.removeChild(this._mpAnimation[i]);this._mpAnimation=[];for(let i=this._actorSprites.length-1;i>=0;i--)this._actorSprites[i].terminate(),this.removeChild(this._actorSprites[i]);this._actorSprites=[],this.destroy()}}class Layer_BattleTroop extends Sprite{constructor(enemies){super(),this._enemySprites=null,this._moveTarget=null,this._checkAnimation=[],this.createEnemies(enemies)}createEnemies(enemies){if(!enemies)return;let sprites=[];for(let i=0;i<enemies.length;i++)sprites[i]=new Sprite_Enemy(enemies[i]);sprites.sort(this.compareEnemySprite.bind(this));for(let j=0;j<sprites.length;j++)this.addChild(sprites[j]);this._enemySprites=sprites}compareEnemySprite(a,b){return a.y!==b.y?a.y-b.y:b.spriteId-a.spriteId}setEnemyClickHandler(handler){this._enemySprites.forEach(sprite=>{sprite.setEnemyClickHandler(handler)})}setEnemyPressHandler(handler){this._enemySprites.forEach(sprite=>{sprite.setEnemyPressHandler(handler)})}startAnimation(battler,animationId,mirror,delay,scale,nosound,nocheck){if(battler.isActor())return;if(!battler)return void Debug.log("対象がいない");const target=_.find(this._enemySprites,a=>a._battler==battler);if(target){const animation=$dataAnimationsMv[animationId];delay=3===animation.position?0:delay,scale=1!=scale?scale:1;const result=target.startAnimation(animation,mirror,delay,scale,nosound);if(nocheck)return;this._checkAnimation||(this._checkAnimation=[]),this._checkAnimation.push(result)}}startAnimationEffect(baseSprite,battler,animationId,mirror,delay,scale,nosound,nocheck){if(battler.isActor())return;if(!battler)return void Debug.log("対象がいない");const target=_.find(this._enemySprites,a=>a._battler==battler);if(target){const animation=$dataAnimations[animationId];delay=3===animation.position?0:delay,scale=1!=scale?scale:1;const result=baseSprite.createAnimationSprite([target],animation,mirror);if(nocheck)return;return this._checkAnimation||(this._checkAnimation=[]),this._checkAnimation.push(result),result}}easeStop(){this._enemySprites.forEach(element=>{element.easeStop()})}performActionStart(battler){const sprite=_.find(this._enemySprites,sprite=>sprite._battler==battler);sprite.performActionStart()}setDamagePopup(target,type,value,length){if(target.isActor())return;let sprite=_.find(this._enemySprites,sprite=>sprite._battler==target);const damageSprite=sprite.setDamagePopup(type,value,length);sprite.addChild(damageSprite)}startStatePopup(target,type,value){if(target.isActor())return;const sprite=_.find(this._enemySprites,sprite=>sprite._battler==target);let stateSprite=sprite.setupStatePopup(type,value);sprite.addChild(stateSprite)}startCounterAnimation(battler){if(battler.isActor())return;let sprite=_.find(this._enemySprites,sprite=>sprite._battler==battler);const counterSprite=sprite.setCounterPopup();sprite.addChild(counterSprite)}startChainAnimation(battler){if(battler.isActor())return;let sprite=_.find(this._enemySprites,sprite=>sprite._battler==battler);const chainSprite=sprite.setChainPopup();sprite.addChild(chainSprite)}setSkillAddict(battler){const enemies=_.filter($gameTroop.aliveMembers(),e=>e.isSelected()),damageCutId=$gameStateInfo.getStateId(StateType.DAMAGE_CUT),guardId=$gameStateInfo.getStateId(StateType.GUARD),penetrateId=$gameStateInfo.getStateId(StateType.PENETRATE);this._enemySprites.forEach(sprite=>{if(_.contains(enemies,sprite._battler)){let action=battler.currentAction();if(action.isHpEffect()){let value=action.makeDamageValue(sprite._battler,!1,!1),repeats=action.numRepeats();repeats>1&&(value*=repeats);let max=value+.01*action.item().damage.variance*value,min=value-.01*action.item().damage.variance*value;const chargeId=$gameStateInfo.getStateId(StateType.CHARGE);battler.isStateAffected(chargeId)&&(max+=battler.getStateEffectTotal(chargeId),min+=battler.getStateEffectTotal(chargeId)),sprite._battler.isStateAffected(damageCutId)&&(max-=sprite._battler.getStateEffectTotal(damageCutId)*repeats,min-=sprite._battler.getStateEffectTotal(damageCutId)*repeats),sprite._battler.isStateAffected(guardId)&&battler.isStateAffected(penetrateId),max<0&&(max=1*repeats),min<0&&(min=1*repeats),sprite.changeHpAddict(max,min);const elementValue=action.calcElementRate(sprite._battler);sprite.changeWeakAddict(elementValue>1)}}else sprite.stopAddict()})}stopSkillAddict(){this._enemySprites.forEach(sprite=>{sprite.stopAddict()})}resetEnemyOpacity(){this._enemySprites.forEach(enemy=>{enemy._battler.isAlive()&&(gsap.killTweensOf(enemy),gsap.to(enemy,.2,{opacity:255})),enemy.resetPosition()})}refreshBattleStatus(){this._enemySprites&&this._enemySprites.forEach(enemySprite=>{enemySprite.refreshStatus()})}analyseSelectMove(select){let sprite=null;this._enemySprites.forEach(enemy=>{select==enemy._battler?(gsap.to(enemy,.2,{x:144,y:360}),enemy.opacity=255,sprite=enemy):(enemy._battler.isAlive()&&(enemy.opacity=128),enemy.resetPosition())}),sprite&&(this.removeChild(sprite),this.addChild(sprite))}substituteMove(battler,target){if(!battler.isActor()&&!target.isActor()){this._moveTarget=_.find(this._enemySprites,e=>e._enemy==battler);var realtarget=_.find(this._enemySprites,e=>e._enemy==target);this.removeChild(this._moveTarget),this.addChild(this._moveTarget),this._moveTarget.x=realtarget.x,this._moveTarget.y=realtarget.y+40}}substituteMoveReset(){this._moveTarget&&(this._moveTarget.resetPosition(),this._moveTarget=null)}clearAnimation(){this._enemySprites.forEach(sprite=>{sprite._animationSprites.length>0&&(sprite._animationSprites.forEach(element=>{element.destroy()}),sprite._animationSprites=[])})}clearStatePopup(){this._enemySprites.forEach(sprite=>{sprite.clearStatePopup()})}clearDamagePopup(){this._enemySprites.forEach(sprite=>{sprite.clearDamagePopup()})}isAnimationPlaying(){return!!_.find(this._checkAnimation,anim=>anim.isPlaying())}clearPlaying(){let destroyAnimations=[];this._checkAnimation.forEach(animation=>{animation.terminate(),destroyAnimations.push(animation)});for(let i=destroyAnimations.length-1;i>=0;i--)null!=destroyAnimations[i].parent&&(destroyAnimations[i].parent.removeChild(destroyAnimations[i]),destroyAnimations[i].destroy());this._checkAnimation=[]}performCollapse(target,type){if(target.isActor())return;const sprite=_.find(this._enemySprites,sprite=>sprite._battler==target);if(sprite)switch(type){case 0:sprite.startEffect("collapse")}}setDragHandler(handler){this._dragHandler=handler}updateDraging(){if(null==this._dragHandler)return;if(0==TouchInput.isPressed())return void this._dragHandler(null);let isDrag=!1;this._enemySprites.forEach(sprite=>{sprite.isBeingTouched()&&(isDrag=!0,this._dragHandler(sprite))}),0==isDrag&&this._dragHandler(null)}update(){super.update(),this.updateDraging()}terminate(){if(this._enemySprites){for(let i=this._enemySprites.length-1;i>=0;i--)this._enemySprites[i].terminate(),this.removeChild(this._enemySprites[i]);this._enemySprites=null}this.destroy()}addTroops(troops){if(troops){for(var sprites=[],i=0;i<troops.length;i++)sprites[i]=new Sprite_Enemy(troops[i]);sprites.sort(this.compareEnemySprite.bind(this));for(var j=0;j<sprites.length;j++)this.addChild(sprites[j]),this._enemySprites.push(sprites[j]),sprites[j].alpha=0,gsap.to(sprites[j],.5,{alpha:1})}}approacheTroops(troops){troops&&this._enemySprites.forEach(sprite=>{troops.forEach(enemy=>{enemy===sprite._battler&&(gsap.to(sprite,.25,{alpha:0}),gsap.to(sprite,.25,{y:sprite.y+100,alpha:1,delay:.25}))})})}clear(){this._enemySprites&&(this._enemySprites.forEach(element=>{element.terminate(),this.removeChild(element)}),this._enemySprites=null)}}class Layer_BattlePicture extends Sprite{constructor(members){super(),this._pictureSprites=[],this.createPictures(members)}createPictures(members){members.forEach(battler=>{let sprite=new Sprite_EventPicture;sprite.setup(battler.faceName(),96,0,0),sprite.opacity=0,sprite.scale.x=sprite.scale.y=.9,this.addChild(sprite),this._pictureSprites.push(sprite)},this)}refreshBattlerPicture(battler){battler.isActor()&&this._pictureSprites.forEach(sprite=>{battler.faceName()==sprite._pictureLabel?this.showAnimation(sprite):this.hideAnimation(sprite)})}hideBattlerPicture(){this._pictureSprites.forEach(sprite=>{this.hideAnimation(sprite)})}showAnimation(sprite){gsap.to(sprite,.2,{x:168,opacity:255})}hideAnimation(sprite){gsap.to(sprite,.2,{x:96,opacity:0})}terminate(){for(let i=this._pictureSprites.length-1;i>=0;i--)this._pictureSprites[i].terminate(),this.removeChild(this._pictureSprites[i]);this.destroy()}}Window_BattleLog.prototype.messageSpeed=function(){return 16};class Window_BattleRecord extends Window_Base{constructor(x,y){super(x,y)}initialize(x,y){const width=this.windowWidth(),height=this.windowHeight();super.initialize(new Rectangle(x,y,width,height)),Window_Base.prototype.initialize.call(this,new Rectangle(x,y,width,height)),this.opacity=0,this._lines=[],this._recordCollapse=[]}windowWidth(){return 0}windowHeight(){return 0}clear(){this._lines.forEach(line=>{gsap.killTweensOf(line),gsap.to(line,.25,{opacity:0,onComplete:function(){line.parent&&line.parent.removeChild(line),line&&line.destroy()}})}),this._lines=[],this._recordCollapse=[]}addText(text,isdim){void 0===isdim&&(isdim=!0);const color=this.backColor();let line=new Sprite;line.bitmap=new Bitmap(540,40),line.bitmap.fontSize=21,isdim&&line.bitmap.gradientFillRect(0,0,540,30,color,ColorManager.dimColor2()),line.bitmap.drawText(text,24,2,540,26,"left"),line.scale.x=line.scale.y=.75,line.opacity=0,line.x=40,line.y=26*this._lines.length,this.addChild(line),this._lines.push(line);const tl=new TimelineMax;tl.to(line,.25,{opacity:255,x:-12}).to(line,2,{opacity:255}).to(line,.25,{opacity:255,x:-12})}addDamageText(battler,type,damage){let text="";"hpHeal"==type&&(text=TextManager.getText(610100).format(battler.name(),TextManager.getText(500),Math.abs(damage))),"hpDamage"!=type&&"hpDamageWeak"!=type||(text=TextManager.getText(610200).format(battler.name(),damage)),"mpHeal"==type&&(text=TextManager.getText(610100).format(battler.name(),TextManager.getText(510),Math.abs(damage))),"missed"==type&&(text=TextManager.getText(610400).format(battler.name(),TextManager.getSkillName(damage.id))),"invisible"==type&&(text=TextManager.getText(610300).format(battler.name(),TextManager.getSkillName(damage.id))),"damageBlock"==type&&(text=TextManager.getText(610300).format(battler.name(),TextManager.getSkillName(damage.id))),"vantageBlock"==type&&(text=TextManager.getText(610300).format(battler.name(),TextManager.getSkillName(damage.id))),""!=text&&this.addText(text)}addStateText(target,type,value){if(type==PopupTextType.AddState){var text=TextManager.getText(610500).format(target.name(),value);this.addText(text)}if(type==PopupTextType.RemoveState){var text=TextManager.getText(610600).format(target.name(),value);this.addText(text)}if(type==PopupTextType.ResistState){var text=TextManager.getText(610300).format(target.name(),value);this.addText(text)}if(type==PopupTextType.Grow){var text=TextManager.getText(610700).format(target.name(),value);this.addText(text)}if(type==PopupTextType.Summon&&this.addText(value),type==PopupTextType.Charge){var text=TextManager.getText(610500).format(target.name(),TextManager.getStateName($gameStateInfo.getStateId(StateType.CHARGE)));this.addText(text)}}recordCollapse(battler){if(_.contains(this._recordCollapse,battler))return;this._recordCollapse.push(battler);const text=TextManager.getText(610800).format(battler.name());this.addText(text)}backColor(){return"#000000"}terminate(){this._lines.forEach(line=>{gsap.killTweensOf(line),line.parent&&line.parent.removeChild(line),line&&line.destroy()}),this.destroy()}}function Spriteset_BattleGrid(){this.initialize.apply(this,arguments)}function Sprite_BattleOrder(){this.initialize.apply(this,arguments)}function Sprite_Battler(){this.initialize.apply(this,arguments)}function Sprite_Actor(){this.initialize.apply(this,arguments)}function Sprite_Enemy(){this.initialize.apply(this,arguments)}Spriteset_BattleGrid.prototype=Object.create(Sprite.prototype),Spriteset_BattleGrid.prototype.constructor=Spriteset_BattleGrid,Spriteset_BattleGrid.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this._phase="init",this._battlerLayer=new Sprite,this.addChild(this._battlerLayer),$gameParty.battleMembers().forEach(actor=>{var order=new Sprite_BattleOrder;order.initialize(),order.setBattler(actor),order.x=Graphics.boxWidth-168,this._battlerLayer.addChild(order)}),$gameTroop.members().forEach(enemy=>{var order=new Sprite_BattleOrder;order.initialize(),order.setBattler(enemy),order.x=Graphics.boxWidth-88,this._battlerLayer.addChild(order)});var sprite=new Sprite;this._nextOrder=new Sprite_BattleOrder,this._nextOrder.initialize(),this._nextOrder.setBattler($gameParty.battleMembers()[0]),this._nextOrder.setNextText(),this._nextOrder.x=Graphics.boxWidth-168,this._nextOrderAnimation=gsap.to(sprite,.75,{alpha:.75,repeat:-1,yoyo:!0}),this._nextOrder.opacity=0,this.addChild(sprite),sprite.addChild(this._nextOrder),this.refresh()},Spriteset_BattleGrid.prototype.ready=function(){gsap.to(this,.5,{pixi:{},onComplete:function(){this._phase="ap"}.bind(this)})},Spriteset_BattleGrid.prototype.setPhase=function(phase){this._phase=phase},Spriteset_BattleGrid.prototype.refresh=function(){this._battlerLayer.children=_.sortBy(this._battlerLayer.children,sprite=>sprite.battler()._ap),this._battlerLayer.children=this._battlerLayer.children.reverse(),this._battlerLayer.children.forEach(sprite=>{sprite.battler().isAlive()?sprite.alpha=1:sprite.alpha=0})},Spriteset_BattleGrid.prototype.refreshPosition=function(){this._battlerLayer.children.forEach(sprite=>{sprite.refreshPosition()})},Spriteset_BattleGrid.prototype.update=function(){switch(this._phase){case"init":this._battlerLayer.children.forEach(sprite=>{sprite.setInitAnim()});break;case"ap":this._battlerLayer.children.forEach(sprite=>{sprite.setApAnim()});break;case"wait":this._battlerLayer.children.forEach(sprite=>{sprite.setWaitAnim()});break;case"action":this._battlerLayer.children.forEach(sprite=>{sprite.setActionAnim()})}},Spriteset_BattleGrid.prototype.showNextOrder=function(battler,nextap){battler&&battler.isActor()&&(this._nextOrder.opacity=255,this._nextOrder.changeBattler(battler),this._nextOrder.changeFace(battler.characterName()),this._nextOrder.y=Sprite_BattleOrder._basePositionY-nextap)},Spriteset_BattleGrid.prototype.clearNextOrder=function(){this._nextOrder.opacity=0},Spriteset_BattleGrid.prototype.addTroops=function(troops){troops.forEach(enemy=>{var order=new Sprite_BattleOrder;order.initialize(),order.setBattler(enemy),order.x=Graphics.boxWidth-88,this._battlerLayer.addChild(order)})},Spriteset_BattleGrid.prototype.terminate=function(){this._nextOrderAnimation.kill(),this._nextOrderAnimation=null;for(let i=this._battlerLayer.children.length-1;i>=0;i--)this._battlerLayer.children[i].terminate();this._nextOrder.terminate(),this._battlerLayer=null,this._nextOrder=null,this.destroy()},Sprite_BattleOrder.prototype=Object.create(Sprite.prototype),Sprite_BattleOrder.prototype.constructor=Sprite_BattleOrder,Sprite_BattleOrder._basePositionY=320,Sprite_BattleOrder.prototype.initialize=function(){this._baseSize=144,Sprite.prototype.initialize.call(this),this._destroySprites=[],this._faceSprite=null,this._battler=null,this._faceLayer=new Sprite,this._gridLayer=new Sprite,this.addChild(this._gridLayer),this.addChild(this._faceLayer),this._animation=null,this.alpha=0,this._selected=!1,this._state="init"},Sprite_BattleOrder.prototype.battler=function(){return this._battler},Sprite_BattleOrder.prototype.setBattler=function(battler){this._battler=battler,this.setBack(),this.setFace(),this.setSquare(),battler.isActor()||this.setEnemyNumber()},Sprite_BattleOrder.prototype.setBack=function(){this._backSprite=new PIXI.Graphics,this._backSprite.beginFill(0),this._backSprite.drawRect(0,0,80,64),this._backSprite.alpha=0,this._faceLayer.addChild(this._backSprite)},Sprite_BattleOrder.prototype.setFace=function(){if(this._faceSprite=new Sprite,this._faceSprite.scale.x=.5,this._faceSprite.scale.y=.5,this._faceSprite.x+=8,this._battler.isActor())this._faceSprite.bitmap=ImageManager.loadFace(this._battler.characterName()),this._faceSprite.setFrame(0,0,this._baseSize-16,this._baseSize-20);else{this._faceSprite.bitmap=ImageManager.loadEnemy(this._battler.battlerName()),this._faceSprite.x+=2,this._faceSprite.scale.x=.75,this._faceSprite.scale.y=.75;const enemyData=$dataEnemies[this._battler.enemyId()];if(enemyData){const hue=enemyData.battlerHue;hue&&this._faceSprite.setHue(hue),this._faceSprite.setFrame(0,0,this._baseSize-64,this._baseSize-60)}else this._faceSprite.setFrame(0,0,this._baseSize-64,this._baseSize-60)}this._faceLayer.addChild(this._faceSprite)},Sprite_BattleOrder.prototype.setSquare=function(){this._squareSprite=new Sprite,this._battler.isActor()?(this._squareSprite.bitmap=ImageManager.loadSystem("gridSquare"),this._squareSprite.x+=8,this._squareSprite.y-=1):this._squareSprite.bitmap=ImageManager.loadSystem("gridSquare2"),this.addChild(this._squareSprite)},Sprite_BattleOrder.prototype.setEnemyNumber=function(){if(this._battler._plural){var sprite=new Sprite,bitmap=new Bitmap(64,64);bitmap.drawText(this._battler._letter,0,0,64,64,"center",!0),sprite.bitmap=bitmap,sprite.x=36,sprite.y=28,sprite.scale.x=.75,sprite.scale.y=.75,this.addChild(sprite),this._destroySprites.push(sprite)}},Sprite_BattleOrder.prototype.setNextText=function(){var sprite=new Sprite,bitmap=new Bitmap(64,64);sprite.scale.x=sprite.scale.y=.75,bitmap.drawText("Next",0,0,64,64,"right",!0),sprite.bitmap=bitmap,sprite.x=22,sprite.y=36,this.addChild(sprite),this._destroySprites.push(sprite)},Sprite_BattleOrder.prototype.changeBattler=function(battler){this._battler=battler},Sprite_BattleOrder.prototype.changeFace=function(fileName){this._faceSprite.bitmap=ImageManager.loadFace(fileName),this._faceSprite.setFrame(0,0,this._baseSize-16,this._baseSize-20)},Sprite_BattleOrder.prototype.ap=function(){return this._ap},Sprite_BattleOrder.prototype.setInitAnim=function(){this._animation&&this._animation.kill(),this._animation=gsap.to(this,.25,{alpha:1,y:Sprite_BattleOrder._basePositionY-this.battler()._ap})},Sprite_BattleOrder.prototype.refreshPosition=function(){this.y=Sprite_BattleOrder._basePositionY-this.battler()._ap},Sprite_BattleOrder.prototype.setApAnim=function(){this._animation&&this._animation.kill(),this.y=Sprite_BattleOrder._basePositionY-this.battler()._ap},Sprite_BattleOrder.prototype.setWaitAnim=function(){var enemy=_.filter($gameTroop.members(),enemy=>enemy.isSelected());if(_.find(enemy,e=>e==this.battler())){if(this._selected)return;this._selected=!0,this._animation&&this._animation.kill(),this._animation=gsap.to(this,.4,{alpha:.75,repeat:-1,yoyo:!0})}else this._animation&&this._animation.kill(),this._battler.isAlive()&&(this.alpha=1),this._selected=!1},Sprite_BattleOrder.prototype.setActionAnim=function(){this._state="action",this._animation&&this._animation.kill(),this._animation=gsap.to(this,.25,{y:Sprite_BattleOrder._basePositionY-this.battler()._ap})},Sprite_BattleOrder.prototype.terminate=function(){this._faceSprite.destroy(),this._faceSprite=null,this._maskGraphic=null,this._gridLayer=null,this._squareSprite.destroy(),this._squareSprite=null,this._backSprite=null,this._battler=null,this._faceLayer=null,this._destroySprites.forEach(sprite=>{sprite.destroy(),sprite=null}),this._animation&&this._animation.kill(),this._animation=null,this._destroySprites=null},Sprite_Battler.prototype=Object.create(Sprite.prototype),Sprite_Battler.prototype.constructor=Sprite_Battler,Sprite_Battler.prototype.initialize=function(battler){Sprite.prototype.initialize.call(this),this.initMembers(),this.setBattler(battler)},Sprite_Battler.prototype.initMembers=function(){this.anchor.x=.5,this.anchor.y=1,this._battler=null,this._popupTexts=[],this._damagePopup=[],this._homeX=0,this._homeY=0,this._offsetX=0,this._offsetY=0,this._selectionEffectCount=0,this._animationSprites=[]},Sprite_Battler.prototype.setBattler=function(battler){this._battler=battler},Sprite_Battler.prototype.setHome=function(x,y){this._homeX=x,this._homeY=y,this.updatePosition()},Sprite_Battler.prototype.update=function(){Sprite.prototype.update.call(this),this._battler?(this.updateMain(),this.updateAnimation(),this.updateSelectionEffect()):this.bitmap=null},Sprite_Battler.prototype.updateVisibility=function(){Sprite.prototype.updateVisibility.call(this),this._battler&&this._battler.isSpriteVisible()||(this.visible=!1)},Sprite_Battler.prototype.updateMain=function(){this._battler.isSpriteVisible()&&(this.updateBitmap(),this.updateFrame()),this.updatePosition()},Sprite_Battler.prototype.updateBitmap=function(){},Sprite_Battler.prototype.updateFrame=function(){},Sprite_Battler.prototype.updateMove=function(){},Sprite_Battler.prototype.updatePosition=function(){this.x=this._homeX+this._offsetX,this.y=this._homeY+this._offsetY},Sprite_Battler.prototype.updateAnimation=function(){this.setupAnimation()},Sprite_Battler.prototype.updateSelectionEffect=function(){var target=this._effectTarget;this._battler.isSelected()?(this._selectionEffectCount++,this._selectionEffectCount%30<15?target.setBlendColor([255,255,255,64]):target.setBlendColor([0,0,0,0])):this._selectionEffectCount>0&&(this._selectionEffectCount=0,target.setBlendColor([0,0,0,0]))},Sprite_Battler.prototype.setupAnimation=function(){for(;this._battler.isAnimationRequested();){var data=this._battler.shiftAnimation(),animation=$dataAnimationsMv[data.animationId],mirror=data.mirror,delay=3===animation.position?0:data.delay,scale=data&&1!=data.scale?data.scale:1;this.startAnimation(animation,mirror,delay,scale);for(var i=0;i<this._animationSprites.length;i++){var sprite;this._animationSprites[i].visible=this._battler.isSpriteVisible()}}},Sprite_Battler.prototype.setDamagePopup=function(type,value,length){void 0===length&&(length=0);let sprite=new Sprite_Damage;return sprite.x=this.damageOffsetX(),sprite.y=this.damageOffsetY()-length%10*32,sprite.setup(type,value),this._damagePopup.push(sprite),sprite},Sprite_Battler.prototype.setupStatePopup=function(type,value){let sprite=new Sprite_PopupText;return sprite.x=this.damageOffsetX(),sprite.y=this.damageOffsetY(),sprite.setup(type,value,this._popupTexts.length),this._popupTexts.push(sprite),sprite},Sprite_Battler.prototype.clearStatePopup=function(){let destroySprites=[];this._popupTexts.forEach(sprite=>{sprite.terminate(),destroySprites.push(sprite)});for(let i=destroySprites.length-1;i>=0;i--)null!=destroySprites[i].parent&&(destroySprites[i].parent.removeChild(destroySprites[i]),destroySprites[i].destroy());this._popupTexts=[]},Sprite_Battler.prototype.clearDamagePopup=function(){let destroySprites=[];this._damagePopup.forEach(sprite=>{sprite.terminate(),destroySprites.push(sprite)});for(let i=destroySprites.length-1;i>=0;i--)null!=destroySprites[i].parent&&(destroySprites[i].parent.removeChild(destroySprites[i]),destroySprites[i].destroy());this._damagePopup=[]},Sprite_Battler.prototype.damageOffsetX=function(){return 0},Sprite_Battler.prototype.damageOffsetY=function(){return 0},Sprite_Battler.prototype.startMove=function(x,y,duration){},Sprite_Battler.prototype.onMoveEnd=function(){},Sprite_Battler.prototype.isEffecting=function(){return!1},Sprite_Battler.prototype.inHomePosition=function(){return 0===this._offsetX&&0===this._offsetY},Sprite_Battler.prototype.setCounterPopup=function(){let sprite=new Sprite_Damage;return sprite.x=this.damageOffsetX(),sprite.y=this.damageOffsetY(),sprite.setCounterPopup(),this._damagePopup.push(sprite),sprite},Sprite_Battler.prototype.setChainPopup=function(){let sprite=new Sprite_Damage;return sprite.x=this.damageOffsetX(),sprite.y=this.damageOffsetY(),sprite.setChainPopup(),this._damagePopup.push(sprite),sprite},Sprite_Battler.prototype.startAnimation=function(animation,mirror,delay,scale,noSoundFlag){void 0===noSoundFlag&&(noSoundFlag=!1);let sprite=new Sprite_AnimationMV;return sprite.setup(this._effectTarget,animation,mirror,delay,noSoundFlag),null==scale?(sprite.scale.x=1.5,sprite.scale.y=1.5):(sprite.scale.x=scale,sprite.scale.y=scale),this.parent.addChild(sprite),this._animationSprites.push(sprite),sprite},Sprite_Battler.prototype.getCenterY=function(){},Sprite_Actor.prototype=Object.create(Sprite_Battler.prototype),Sprite_Actor.prototype.constructor=Sprite_Actor,Sprite_Actor.MOTIONS={walk:{index:0,loop:!0},wait:{index:1,loop:!0},chant:{index:2,loop:!0},guard:{index:3,loop:!0},damage:{index:4,loop:!1},evade:{index:5,loop:!1},thrust:{index:6,loop:!1},swing:{index:7,loop:!1},missile:{index:8,loop:!1},skill:{index:9,loop:!1},spell:{index:10,loop:!1},item:{index:11,loop:!1},escape:{index:12,loop:!0},victory:{index:13,loop:!0},dying:{index:14,loop:!0},abnormal:{index:15,loop:!0},sleep:{index:16,loop:!0},dead:{index:17,loop:!0}},Sprite_Actor.prototype.initialize=function(battler){Sprite_Battler.prototype.initialize.call(this,battler)},Sprite_Actor.prototype.initMembers=function(){Sprite_Battler.prototype.initMembers.call(this),this._battlerName="",this.createBackSprite(),this.createMainSprite(),this.createStateSprite(),this.createBattlerStatusSprite()},Sprite_Actor.prototype.createBackSprite=function(){this._backSprite=new Sprite(new Bitmap(240,88)),this._backSprite.x=0,this._backSprite.y=-4,this._backSprite.bitmap.context.setTransform(1,0,-.25,1,0,0),this._backSprite.bitmap.fillRect(0,-16,240,96,"black"),this._backSprite.bitmap.context.setTransform(1,0,0,1,0,0),this._backSprite.opacity=64,this.addChild(this._backSprite)},Sprite_Actor.prototype.createMainSprite=function(){this._mainSprite=new Sprite,this._mainSprite.anchor.x=.5,this._mainSprite.anchor.y=.5,this._mainSprite.scale.x=.5,this._mainSprite.scale.y=.5,this._mainSprite.y=0,this.addChild(this._mainSprite),this._effectTarget=this._mainSprite},Sprite_Actor.prototype.createStateSprite=function(){this._stateSprite=new Sprite_StateOverlay,this._stateSprite.y=Window_Base._faceHeight/2+16,this.addChild(this._stateSprite)},Sprite_Actor.prototype.createBattlerStatusSprite=function(){this._battlerStatusSprite=new Sprite_BattlerStatus,this.addChild(this._battlerStatusSprite),this._battlerStatusSprite.x=-48,this._battlerStatusSprite.y=-8},Sprite_Actor.prototype.setBattler=function(battler){Sprite_Battler.prototype.setBattler.call(this,battler);const changed=battler!==this._actor;changed&&(this._actor=battler,battler&&(this.setActorHome(battler.index()),this.setElementRect()),this._stateSprite.setup(battler),this._battlerStatusSprite.setup(battler))},Sprite_Actor.prototype.setActorHome=function(index){this.setHome(280*index+120,Graphics.boxHeight-120)},Sprite_Actor.prototype.setElementRect=function(){},Sprite_Actor.prototype.update=function(){Sprite_Battler.prototype.update.call(this)},Sprite_Actor.prototype.setupMotion=function(){},Sprite_Actor.prototype.startMotion=function(){},Sprite_Actor.prototype.updateBitmap=function(){Sprite_Battler.prototype.updateBitmap.call(this);var name=this._actor.faceName();this._battlerName!==name&&(this._battlerName=name,this._mainSprite.bitmap=ImageManager.loadFace(name),this._mainSprite.setFrame(0,0,1.5*Window_Base._faceWidth,2*Window_Base._faceHeight),this._mainSprite.scale.x=.75,this._mainSprite.scale.y=.75,this._mainSprite.anchor.y=1,this._mainSprite.x=20,this._mainSprite.y=168)},Sprite_Actor.prototype.updateFrame=function(){},Sprite_Actor.prototype.updateMove=function(){},Sprite_Actor.prototype.updateMotion=function(){},Sprite_Actor.prototype.updateMotionCount=function(){},Sprite_Actor.prototype.motionSpeed=function(){return 60},Sprite_Actor.prototype.refreshMotion=function(){},Sprite_Actor.prototype.onMoveEnd=function(){Sprite_Battler.prototype.onMoveEnd.call(this)},Sprite_Actor.prototype.updateSelectionEffect=function(){var target=this._effectTarget;this._battler.isSelected()?(this._selectionEffectCount++,this._selectionEffectCount%60<30?target.setBlendColor([255,255,255,64]):target.setBlendColor([0,0,0,0])):this._selectionEffectCount>0&&(this._selectionEffectCount=0,target.setBlendColor([0,0,0,0]))},Sprite_Actor.prototype.damageOffsetX=function(){return 0},Sprite_Actor.prototype.damageOffsetY=function(){return 104},Sprite_Actor.prototype.refreshStatus=function(){this._battlerStatusSprite.changeHp(),this._battlerStatusSprite.changeMp()},Sprite_Actor.prototype.changeTpEffect=function(isGrow){this._battlerStatusSprite.changeTpEffect(isGrow)},Sprite_Actor.prototype.getCenterY=function(){return this._mainSprite?Graphics.height/2-this.y:0},Sprite_Actor.prototype.isBeingTouched=function(){const touchPos=new Point(TouchInput.x,TouchInput.y),localPos=this.worldTransform.applyInverse(touchPos);return this.hitTest(localPos.x,localPos.y)&&0!=touchPos.x&&0!=touchPos.y},Sprite_Actor.prototype.hitTest=function(x,y){let anchorX=0;const anchorY=0;let width=280,height=78,rect;return $gameDefine.mobileMode,anchorX=156,width=64,height=48,rect=new Rectangle(anchorX+width-40,0*height,width,height),rect.contains(x,y)},Sprite_Actor.prototype.changeFace=function(faceType){},Sprite_Actor.prototype.terminate=function(){if(this._animationSprites)for(let i=this._animationSprites.length-1;i>=0;i--)this._animationSprites[i].terminate(),this.removeChild(this._animationSprites[i]);this._battlerStatusSprite&&(this._battlerStatusSprite.terminate(),this.removeChild(this._battlerStatusSprite)),this._battlerStatusSprite=null,this._stateSprite=null,this._backSprite&&(this._backSprite.destroy(),this.removeChild(this._backSprite)),this._backSprite=null,this._battler=null,this._effectTarget=null,this._mainSprite&&(this._mainSprite.destroy(),this.removeChild(this._mainSprite)),this._mainSprite=null,this._actor=null,this.destroy()},Sprite_Enemy.prototype=Object.create(Sprite_Battler.prototype),Sprite_Enemy.prototype.constructor=Sprite_Enemy,Sprite_Enemy.prototype.initialize=function(battler){Sprite_Battler.prototype.initialize.call(this,battler),this._button=new Sprite_Button,this._button.setClickHandler(this.selectButton.bind(this)),this._button.setPressHandler(this.pressButton.bind(this)),this.addChild(this._button)},Sprite_Enemy.prototype.selectButton=function(){this._clickHandler&&this._clickHandler(this._battler)},Sprite_Enemy.prototype.pressButton=function(){this._pressHandler&&this._pressHandler(this._battler)},Sprite_Enemy.prototype.setEnemyClickHandler=function(handler){this._clickHandler=handler},Sprite_Enemy.prototype.setEnemyPressHandler=function(handler){this._pressHandler=handler},Sprite_Enemy.prototype.initMembers=function(){Sprite_Battler.prototype.initMembers.call(this),this._enemy=null,this._appeared=!1,this._battlerName="",this._battlerHue=0,this._effectType=null,this._effectDuration=0,this._shake=0,this._setPosition=!1,this._targetSprite=null,this._setStateOverlay=!1,this.createTargetSprite(),this.createMainSprite(),this.createStateSprite(),this.createBattlerStatusSprite()},Sprite_Enemy.prototype.createMainSprite=function(){this._mainSprite=new Sprite,this._mainSprite.anchor.x=.5,this._mainSprite.anchor.y=1,this.addChild(this._mainSprite),this._effectTarget=this._mainSprite},Sprite_Enemy.prototype.createTargetSprite=function(){this._targetSprite=new Sprite_BattleTarget,this._targetSprite.anchor.x=.5,this._targetSprite.anchor.y=.5,this._targetSprite.y=16,this.addChild(this._targetSprite)},Sprite_Enemy.prototype.createBattlerStatusSprite=function(){this._battlerStatusSprite=new Sprite_BattlerStatus,this.addChild(this._battlerStatusSprite),this._battlerStatusSprite.anchor.x=.5,this._battlerStatusSprite.anchor.y=.5,this._battlerStatusSprite.x=-160,this._battlerStatusSprite.y=-40},Sprite_Enemy.prototype.createStateSprite=function(){this._stateSprite=new Sprite_StateOverlay,this._stateSprite.y=Window_Base._faceHeight/3,this.addChild(this._stateSprite)},Sprite_Enemy.prototype.setBattler=function(battler){Sprite_Battler.prototype.setBattler.call(this,battler),this._enemy=battler,this.setHome(battler.screenX()-24,battler.screenY()-24),this._setPosition=!0,this._battlerStatusSprite.setup(battler),this._targetSprite.setEnemy(battler);let upscale=1;const scale=$dataEnemies[this._enemy.enemyId()].scale;1!=scale&&(upscale=scale),upscale*=1.5,this._mainSprite.scale.x=upscale,this._mainSprite.scale.y=upscale,this._stateSprite.setup(battler)},Sprite_Enemy.prototype.update=function(){Sprite_Battler.prototype.update.call(this),this._enemy&&(this.updateEffect(),this.updateStateSprite())},Sprite_Enemy.prototype.updateBitmap=function(){Sprite_Battler.prototype.updateBitmap.call(this);var name=this._enemy.battlerName(),hue=this._enemy.battlerHue();this._battlerName===name&&this._battlerHue===hue||(this._battlerName=name,this._battlerHue=hue,this.loadBitmap(name,hue),this.initVisibility()),0==this._button.y&&this._mainSprite.bitmap&&0!=this._mainSprite.bitmap.height&&(this._button.y-=this._mainSprite.bitmap.height,this._button.x-=this._mainSprite.bitmap.width/2,this._button.opacity=0)},Sprite_Enemy.prototype.loadBitmap=function(name,hue){this._mainSprite.bitmap=ImageManager.loadEnemy(name,hue),this._battlerHue=hue,this._mainSprite.setHue(hue),this._button.bitmap=this._mainSprite.bitmap,this.anchor.y=1;const margin=344;if(this._button.width>344){const marzinX=(this._button.width-344)/2;this._button.width=344,this._button.x+=marzinX}$gameDefine.mobileMode||(gsap.to(this._mainSprite,4,{pixi:{scaleX:this._mainSprite.scale.x+.01},y:this._mainSprite.y,repeat:-1,yoyo:!0,ease:Circ.easeInOut}),gsap.to(this._mainSprite,16,{pixi:{scaleY:this._mainSprite.scale.y+.1},y:this._mainSprite.y,repeat:-1,yoyo:!0,ease:RoughEase.ease.config({template:Power0.easeNone,strength:1,points:20,taper:"none",randomize:!0,clamp:!1})}))},Sprite_Enemy.prototype.updateFrame=function(){Sprite_Battler.prototype.updateFrame.call(this);let frameHeight=this._mainSprite.bitmap.height;"bossCollapse"===this._effectType&&(frameHeight=this._effectDuration),this.setFrame(0,0,this._mainSprite.bitmap.width,frameHeight)},Sprite_Enemy.prototype.updatePosition=function(){1!=this._setPosition&&Sprite_Battler.prototype.updatePosition.call(this)},Sprite_Enemy.prototype.updateStateSprite=function(){if(null==this._enemy)return;if(this._mainSprite&&0==this._mainSprite.width)return;if(1==this._setStateOverlay)return;const masterEnemy=$dataEnemies[this._enemy.enemyId()];if(0!=this._mainSprite.width&&0!=this._mainSprite.height){let scale=null!=masterEnemy.scale?masterEnemy.scale:1;const marginX=(48-this._mainSprite.width/2)*scale;this._stateSprite.x+=marginX;const marginY=(72-this._mainSprite.height)*scale;this._stateSprite.y+=marginY,this._setStateOverlay=!0}},Sprite_Enemy.prototype.initVisibility=function(){this._appeared=this._enemy.isAlive(),this._appeared||(this.opacity=0)},Sprite_Enemy.prototype.setupEffect=function(){this._appeared&&this._enemy.isEffectRequested()&&(this.startEffect(this._enemy.effectType()),this._enemy.clearEffect()),!this._appeared&&this._enemy.isAlive()?this.startEffect("appear"):this._appeared&&this._enemy.isHidden()&&this.startEffect("disappear")},Sprite_Enemy.prototype.startEffect=function(effectType){switch(this._effectType=effectType,this._effectType){case"appear":this.startAppear();break;case"disappear":this.startDisappear();break;case"whiten":this.startWhiten();break;case"blink":this.startBlink();break;case"collapse":this.startCollapse();break;case"bossCollapse":this.startBossCollapse();break;case"instantCollapse":this.startInstantCollapse()}this.revertToNormal()},Sprite_Enemy.prototype.startAppear=function(){this._effectDuration=16,this._appeared=!0},Sprite_Enemy.prototype.startDisappear=function(){this._effectDuration=32,this._appeared=!1},Sprite_Enemy.prototype.startWhiten=function(){this._effectDuration=16},Sprite_Enemy.prototype.performActionStart=function(){this._effectDuration=16;const homeY=0;let t1;(new TimelineMax).to(this._mainSprite,.15,{y:-16}).to(this._mainSprite,.3,{y:32,ease:Elastic.easeOut.config(1,.3)}).to(this._mainSprite,{y:0,ease:Elastic.easeOut.config(1,.3)})},Sprite_Enemy.prototype.startBlink=function(){this._effectDuration=20},Sprite_Enemy.prototype.startCollapse=function(){this._effectDuration=32,this._appeared=!1},Sprite_Enemy.prototype.startBossCollapse=function(){this._effectDuration=120,this._appeared=!1},Sprite_Enemy.prototype.startInstantCollapse=function(){this._effectDuration=16,this._appeared=!1},Sprite_Enemy.prototype.updateEffect=function(){if(this.setupEffect(),this._effectDuration>0){switch(this._effectDuration--,this._effectType){case"whiten":this.updateWhiten();break;case"blink":this.updateBlink();break;case"appear":this.updateAppear();break;case"disappear":this.updateDisappear();break;case"collapse":this.updateCollapse();break;case"bossCollapse":this.updateBossCollapse();break;case"instantCollapse":this.updateInstantCollapse()}0===this._effectDuration&&(this._effectType=null)}},Sprite_Enemy.prototype.isEffecting=function(){return null!==this._effectType},Sprite_Enemy.prototype.revertToNormal=function(){this._shake=0,this.blendMode=0,this.opacity=255,this.setBlendColor([0,0,0,0])},Sprite_Enemy.prototype.updateWhiten=function(){if(Utils.isMobileDevice())var alpha=128-40*Math.ceil((16-this._effectDuration)/4);else var alpha=128-10*(16-this._effectDuration);this._mainSprite.setBlendColor([255,255,255,alpha])},Sprite_Enemy.prototype.updateBlink=function(){this._mainSprite.opacity=this._effectDuration%10<5?255:0},Sprite_Enemy.prototype.updateAppear=function(){this._mainSprite.opacity=16*(16-this._effectDuration)},Sprite_Enemy.prototype.updateDisappear=function(){this.opacity=256-10*(32-this._effectDuration)},Sprite_Enemy.prototype.updateCollapse=function(){this.blendMode=PIXI.BLEND_MODES.ADD,this._mainSprite.opacity*=this._effectDuration/(this._effectDuration+1)},Sprite_Enemy.prototype.updateBossCollapse=function(){this._effectDuration%20==19&&SoundManager.playBossCollapse2()},Sprite_Enemy.prototype.updateInstantCollapse=function(){this.opacity=0},Sprite_Enemy.prototype.damageOffsetX=function(){return 0},Sprite_Enemy.prototype.damageOffsetY=function(){return 8},Sprite_Enemy.prototype.refreshStatus=function(){this._battlerStatusSprite.changeHp(),this._battlerStatusSprite.changeMp()},Sprite_Enemy.prototype.resetPosition=function(num){this.x=this._homeX+this._offsetX,this.y=this._homeY+this._offsetY},Sprite_Enemy.prototype.stopAddict=function(){this._battlerStatusSprite.stopAddict()},Sprite_Enemy.prototype.changeHpAddict=function(max,min){this._battlerStatusSprite.changeHpAddict(max,min)},Sprite_Enemy.prototype.changeWeakAddict=function(weak){this._battlerStatusSprite.changeWeakAddict(weak)},Sprite_Enemy.prototype.isBeingTouched=function(){const touchPos=new Point(TouchInput.x,TouchInput.y),localPos=this.worldTransform.applyInverse(touchPos);return this.hitTest(localPos.x,localPos.y)&&0!=touchPos.x&&0!=touchPos.y},Sprite_Enemy.prototype.hitTest=function(x,y){let anchorX=-.5;const anchorY=-1;let width=this._mainSprite.width,height=this._mainSprite.height,rect;return rect=($gameDefine.mobileMode,new Rectangle(64,-48,64,48)),rect.contains(x,y)},Sprite_Enemy.prototype.terminate=function(){if(this._animationSprites){for(let i=this._animationSprites.length-1;i>=0;i--)this._animationSprites[i].terminate();this._animationSprites=null}this._battlerStatusSprite&&this._battlerStatusSprite.terminate(),this._battlerStatusSprite=null,this._targetSprite&&this._targetSprite.destroy(),this._targetSprite=null,this._enemy=null,this._battler=null,this._effectTarget=null,this._mainSprite&&this._mainSprite.destroy(),this._mainSprite=null,this._targetSprite=null,this._stateSprite=null,this._button&&this._button.destroy(),this._button=null},Sprite_Enemy.prototype.getCenterY=function(){return this._mainSprite?-Graphics.height/2-48+this._battler.screenY()-this._mainSprite.height/2:0};class Sprite_BattleTarget extends Sprite{constructor(){super(),this._enemy=null,this.bitmap=ImageManager.loadSystem("target"),this._animIdx=0,this.setFrame(0,0,this.frameSize(),this.frameSize()),this.scale.x=1.25,this.scale.y=1.25,this._duration=gsap.to(this.scale,.08,{x:1.25,repeat:-1,onRepeat:()=>{this.changeCycle()}}),this._lastCycle=0,this.visible=!1}frameSize(){return 192}setEnemy(enemy){this._enemy=enemy}update(){super.update();const enemy=_.filter($gameTroop.members(),enemy=>enemy.isSelected());_.contains(enemy,this._enemy)?this.visible=!0:this.visible=!1}changeCycle(){if(this.visible){let size=this.frameSize();this._lastCycle=this._duration._animationCycle;let x=this._animIdx%5*size,y=this._animIdx%10;y=5>y?0:1,this.setFrame(x,y*size,size,size),this.opacity=255-this._animIdx%10*40,this._animIdx+=1}}}class Sprite_BattlerStatus extends Sprite{constructor(){super(),this._nameSprite=null,this._hpSprite=null,this._hpGaugeSprite=null,this._requestHpUpdateAddict=!1,this._battler=null,this._addictHpSprite=null,this._weakText=null,this._weakAnim=null,this._statusMpSprite=null,this._elementImage=ImageManager.loadSystem("IconSet")}setup(battler){if(this._battler=battler,1==this._isInit){const width=Math.floor(4*this._battler.mhp),height=12;this._hpGaugeSpriteBack.bitmap=new Bitmap(width,height),this._hpGaugeSpriteBack.bitmap.fillRect(0,0,width,height,$gameColor.getColor("gaugeback"));const x=80;return this._hpGaugeSpriteBack.x=x+-1*width/4,this._hpGaugeSprite.bitmap=new Bitmap(width-4,height-2),this._hpGaugeSprite.bitmap.gradientFillRect(0,0,width-4,height-2,$gameColor.getColor("hpgauge2"),$gameColor.getColor("hpgauge1")),this._hpGaugeSprite.scale.x=this._battler.hp/this._battler.mhp,this._hpGaugeSprite.x=x+2+-1*width/4,void this.setHpBitmap(this._battler.hp)}this.setHp(),this.setMp(),this.setStateIconSprite(),this.setWeakSprite(),this.setSkillSet(),this._isInit=!0}setName(){this._nameSprite=new Sprite,this._nameSprite.bitmap=this.createBitmap(this._battler.name(),21,"left"),this._nameSprite.x=78,this.addChild(this._nameSprite)}setSkillSet(){}updateSkillSet(){}setHp(){if(this._battler.isActor()){const width=Math.floor(2*this._battler.mhp),height=12,x=80,y=62;this._hpGaugeSpriteBack=new Sprite(new Bitmap(width,height)),this._hpGaugeSpriteBack.bitmap.fillRect(0,0,width,height,$gameColor.getColor("gaugeback")),this._hpGaugeSpriteBack.pivot.x=0,this.addChild(this._hpGaugeSpriteBack),this._hpGaugeSpriteBack.x=x,this._hpGaugeSpriteBack.y=y,this._hpGaugeSprite=new Sprite(new Bitmap(width-4,height-2)),this._hpGaugeSprite.bitmap.gradientFillRect(0,0,width-4,height-2,$gameColor.getColor("hpgauge2"),$gameColor.getColor("hpgauge1")),this._hpGaugeSprite.pivot.x=0,this._hpGaugeSprite.x=x+2,this._hpGaugeSprite.y=y+1,this._hpGaugeSprite.scale.x=this._battler.hp/this._battler.mhp,this.addChild(this._hpGaugeSprite),this._hpSprite=new Sprite,this.setHpBitmap(this._battler.hp),this._hpSprite.x=100,this._hpSprite.y=y/2,this.addChild(this._hpSprite)}else{const width=Math.floor(4*this._battler.mhp),height=12,x=80,y=62;this._hpGaugeSpriteBack=new Sprite(new Bitmap(width,height)),this._hpGaugeSpriteBack.bitmap.fillRect(0,0,width,height,$gameColor.getColor("gaugeback")),this._hpGaugeSpriteBack.pivot.x=.5,this.addChild(this._hpGaugeSpriteBack),this._hpGaugeSpriteBack.x=x,this._hpGaugeSpriteBack.y=y,this._hpGaugeSprite=new Sprite(new Bitmap(width-4,height-2)),this._hpGaugeSprite.bitmap.gradientFillRect(0,0,width-4,height-2,$gameColor.getColor("hpgauge2"),$gameColor.getColor("hpgauge1")),this._hpGaugeSprite.pivot.x=.5,this._hpGaugeSprite.x=x+2,this._hpGaugeSprite.y=y+1,this._hpGaugeSprite.scale.x=this._battler.hp/this._battler.mhp,this.addChild(this._hpGaugeSprite),this._hpSprite=new Sprite,this.setHpBitmap(this._battler.hp),this._hpSprite.x=100,this._hpSprite.y=y/2,this.addChild(this._hpSprite)}}setMp(){const width=Math.floor(1*this._battler.mmp),height=8,x=80,y=76;this._mpGaugeSpriteBack=new Sprite(new Bitmap(width,8)),this._mpGaugeSpriteBack.bitmap.fillRect(0,0,width,8,$gameColor.getColor("gaugeback")),this._mpGaugeSpriteBack.pivot.x=0,this.addChild(this._mpGaugeSpriteBack),this._mpGaugeSpriteBack.x=x,this._mpGaugeSpriteBack.y=y,this._mpGaugeSprite=new Sprite(new Bitmap(width-4,6)),this._mpGaugeSprite.bitmap.gradientFillRect(0,0,width-4,6,$gameColor.getColor("mpgauge2"),$gameColor.getColor("mpgauge1")),this._mpGaugeSprite.pivot.x=0,this._mpGaugeSprite.x=82,this._mpGaugeSprite.y=77,this._mpGaugeSprite.scale.x=this._battler.mp/this._battler.mmp,this.addChild(this._mpGaugeSprite),this._mpSprite=new Sprite,this.setMpBitmap(this._battler.mp),this._mpSprite.x=100,this._mpSprite.y=38}setTp(){}setWeakSprite(){this._weakText=new Sprite,this._weakText.scale.x=.75,this._weakText.scale.y=.75,this._weakText.x=192,this._weakText.y=20;let bitmap=new Bitmap(200,40);bitmap.fontSize=21,bitmap.drawText(TextManager.getText(600400),0,0,200,40,"left",!0),this._weakText.bitmap=bitmap,this.addChild(this._weakText),this._weakText.opacity=0}refreshStatus(){this.changeHp(),this.changeMp(),this.changeTp()}changeHp(){if(!this._battler)return;if(this._battler.isAlive()||this._battler.isActor()?this.alpha=1:this.alpha=0,this._lastHp==this._battler.hp&&this._lastMHp==this._battler.mhp)return;this._lastMHp=this._battler.mhp,this._lastHp=this._battler.hp;let tl=new TimelineMax;this._hpAnim&&this._hpAnim.kill(),tl.to(this._hpGaugeSprite.scale,.4,{x:this._battler.hp/this._battler.mhp,onUpdate:()=>{let hp=Math.floor(this._battler.mhp*this._hpGaugeSprite.scale.x);this.setHpBitmap(hp)},onComplete:()=>{this.setHpBitmap(this._battler.hp)}}),this._hpAnim=tl}changeMp(){if(!this._battler)return;if(this._battler.isAlive()||this._battler.isActor()?this.alpha=1:this.alpha=0,this._lastMp==this._battler.mp&&this._lastMMp==this._battler.mmp)return;this._lastMMp=this._battler.mmp,this._lastMp=this._battler.mp;let tl=new TimelineMax;this._mpAnim&&this._mpAnim.kill(),console.log(this._mpGaugeSprite),tl.to(this._mpGaugeSprite.scale,.4,{x:this._battler.mp/this._battler.mmp,onUpdate:()=>{let mp=Math.floor(this._battler.mmp*this._mpGaugeSprite.scale.x);this.setMpBitmap(mp)},onComplete:()=>{this.setMpBitmap(this._battler.mp)}}),this._mpAnim=tl}changeTp(){}changeTpEffect(isGlow){}update(){super.update(),this._infoSprite.visible=this._stateIconSprite.states().length>0}setStateIconSprite(){this._infoSprite=new Sprite,this._infoSprite.bitmap=ImageManager.loadSystem("pageA_1off"),this._infoSprite.x=228,this._infoSprite.y=-10,this._infoSprite.visible=!1,this.addChild(this._infoSprite),this._stateIconSprite=new Sprite_StateIcon,this._stateIconSprite.setup(this._battler),this._stateIconSprite.x=248,this._stateIconSprite.y=54,this.addChild(this._stateIconSprite)}setAddictHpBar(){}createBitmap(text,fontSize,align){let bitmap=new Bitmap(160,48);return bitmap.fontSize=fontSize,bitmap.drawText(text,0,0,160,48,align,!0),bitmap}createBitmapPlus(text,fontSize,align){let bitmap=new Bitmap(160,48);return bitmap.fontSize=fontSize,bitmap.textColor=$gameColor.getColor("powerup"),bitmap.drawText(text,0,0,160,48,align,!0),bitmap}createBitmapDying(text,fontSize,align){let bitmap=new Bitmap(160,48);return bitmap.fontSize=fontSize,bitmap.textColor=$gameColor.getColor("crisis"),bitmap.drawText(text,0,0,160,48,align,!0),bitmap}changeHpAddict(max,min){if(1==this._requestHpUpdateAddict)return;this._requestHpUpdateAddict=!0,this._hpAnim&&this._hpAnim.kill(),this._addictHpSprite.scale.x=this._battler.hp/this._battler.mhp,this._hpGaugeSprite.scale.x=(this._battler.hp-max)/this._battler.mhp,this._hpGaugeSprite.scale.x<0&&(this._hpGaugeSprite.scale.x=0),(min=(this._battler.hp-min)/this._battler.mhp)<0&&(min=0);let tl=new TimelineMax;tl.to(this._hpGaugeSprite.scale,.5,{x:min,repeat:-1,yoyo:!0,ease:Power1.easeInOut,onUpdate:()=>{let hp=Math.floor(this._battler.mhp*this._hpGaugeSprite.scale.x);this._hpSprite.bitmap=this.createBitmap(hp,21,"right")}}).to(this._addictHpSprite,.5,{alpha:1,repeat:-1,yoyo:!0,ease:Power1.easeInOut},"-=0.5"),this._hpAnim=tl}changeWeakAddict(flag){if(!this._weakAnim&&(this._weakText.alpha=0,1==flag)){let t1=gsap.to(this._weakText,.5,{alpha:1,repeat:-1,yoyo:!0});this._weakAnim=t1}}stopAddict(){if(0==this._requestHpUpdateAddict)return;this._hpAnim.kill(),this._weakAnim&&this._weakAnim.kill(),this._weakAnim=null,this._addictHpSprite.alpha=0,this._requestHpUpdateAddict=!1;let hp=Math.floor(this._battler.hp);this.setHpBitmap(hp),this._hpGaugeSprite.scale.x=this._battler.hp/this._battler.mhp,this._addictHpSprite.scale.x=this._hpGaugeSprite.scale.x,this._weakText.opacity=0}setHpBitmap(hp){if(hp<this._battler.hp)return;const _text=hp+" / "+this._battler.mhp;this._battler.isStatusParamUp(0,hp)?this._hpSprite.bitmap=this.createBitmapPlus(_text,21,"center"):this._battler.isDying(hp)?this._hpSprite.bitmap=this.createBitmapDying(_text,21,"center"):this._hpSprite.bitmap=this.createBitmap(_text,21,"center")}setMpBitmap(mp){if(mp<this._battler.mp)return;const _text=mp+" / "+this._battler.mmp;this._battler.isStatusParamUp(1,mp)?this._mpSprite.bitmap=this.createBitmapPlus(_text,21,"center"):this._battler.mp/this._battler.mmp<.25?this._mpSprite.bitmap=this.createBitmapDying(_text,21,"center"):this._mpSprite.bitmap=this.createBitmap(_text,21,"center")}setTpBitmap(tp){if(tp<this._battler.tp)return;const _text=tp+" / "+this._battler.maxTp();this._battler.tp/this._battler.maxTp()<.25?this._tpSprite.bitmap=this.createBitmapDying(_text,21,"center"):this._tpSprite.bitmap=this.createBitmap(_text,21,"center")}terminate(){this._statusMpSprite&&this._statusMpSprite.terminate(),this._statusMpSprite=null,this._stateIconSprite&&this._stateIconSprite.destroy(),this._stateIconSprite=null,this._weakText&&this._weakText.destroy(),this._weakText=null,this._addictHpSprite&&this._addictHpSprite.destroy(),this._addictHpSprite=null;for(let i=this.children.length-1;i>=0;i--)this.children[i].destroy(),this.removeChild(this.children[i]);this._battler=null,this._nameSprite=null,this._hpGaugeSprite=null,this._hpSprite=null,this._hpAnim&&this._hpAnim.kill(),this._hpAnim=null,this._weakAnim&&this._weakAnim.kill(),this._weakAnim=null,this._elementImage=null,this._texture=null,this._lastHp=null,this._lastMHp=null,this._lastMp=null,this._lastMMp=null,this._lastTp=null,this._lastMTp=null}}function Sprite_Damage(){this.initialize.apply(this,arguments)}Sprite_Damage.prototype=Object.create(Sprite.prototype),Sprite_Damage.prototype.constructor=Sprite_Damage,Sprite_Damage.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this._damageBitmap=ImageManager.loadSystem("Damage")},Sprite_Damage.prototype.reset=function(){this.children=[],this.opacity=255},Sprite_Damage.prototype.setup=function(type,value){switch(type){case"hpDamage":return void this.createDigits(2,value);case"hpDamageWeak":return void this.createDigits(0,value);case"hpHeal":return void this.createDigitsHeal(1,value);case"mpHeal":return void this.createDigitsHeal(3,value);case"missed":return void this.createMiss();case"invisible":case"damageBlock":case"vantageBlock":return void this.createInvisible()}},Sprite_Damage.prototype.digitWidth=function(){return this._damageBitmap?this._damageBitmap.width/10:0},Sprite_Damage.prototype.digitHeight=function(){return this._damageBitmap?this._damageBitmap.height/8:0},Sprite_Damage.prototype.createMiss=function(){var w=this.digitWidth(),h=this.digitHeight(),sprite=this.createChildSprite();sprite.setFrame(0,4*h,10*w,h),sprite.dy=0,sprite.x=3*w/2+8,sprite.y=-13,sprite.scale.x=sprite.scale.y=.5,this.setZoomEffectHeal(sprite)},Sprite_Damage.prototype.createInvisible=function(){var sprite=new Sprite;this.setBaseData(sprite);var bitmap=new Bitmap(240,40);bitmap.fontSize=20,bitmap.textColor="#ffffff",bitmap.drawText(TextManager.getStateName($gameStateInfo.getStateId(StateType.INVISIBLE)),0,0,bitmap.width,bitmap.height,"center",!0),sprite.bitmap=bitmap,sprite.dy=0,sprite.scale.x=sprite.scale.y=1,this.setZoomEffect(sprite)},Sprite_Damage.prototype.setCounterPopup=function(){var w=this.digitWidth(),h=this.digitHeight(),sprite=this.createChildSprite();sprite.setFrame(0,6*h,10*w,h),sprite.x=48,sprite.y=-56,this.setZoomEffectHeal(sprite)},Sprite_Damage.prototype.setChainPopup=function(){var sprite=new Sprite;this.setBaseData(sprite);var bitmap=new Bitmap(240,40);bitmap.fontSize=24,bitmap.textColor=$gameColor.getColor("chain"),bitmap.drawText(TextManager.getText(611900),0,0,bitmap.width,bitmap.height,"center",!0),sprite.bitmap=bitmap,sprite.dy=0,sprite.scale.x=sprite.scale.y=1,sprite.y=-72,this.setZoomEffectHeal(sprite)},Sprite_Damage.prototype.createDigits=function(baseRow,value,delay){for(var string=Math.abs(value).toString(),row=baseRow,w=this.digitWidth(),h=this.digitHeight(),index=0,i=string.length-1;i>=0;i--){var sprite=this.createChildSprite(),n=Number(string[i]);sprite.setFrame(n*w,row*h,w,h),sprite.x=(i-(string.length-1)/2)*w/2,sprite.dy=-i,this.setZoomEffect(sprite,2*string.length,index),index+=1,delay>0&&(sprite.zt+=5*delay)}},Sprite_Damage.prototype.createDigitsHeal=function(baseRow,value,delay){for(var string=Math.abs(value).toString(),row=baseRow,w=this.digitWidth(),h=this.digitHeight(),i=string.length-1;i>=0;i--){var sprite=this.createChildSprite(),n=Number(string[i]);sprite.setFrame(n*w,row*h,w,h),sprite.x=(i-(string.length-1)/2)*w/2,sprite.dy=-i,this.setZoomEffectHeal(sprite),delay>0&&(sprite.zt+=5*delay)}},Sprite_Damage.prototype.createChildSprite=function(){var sprite=new Sprite;return sprite.bitmap=this._damageBitmap,this.setBaseData(sprite),sprite},Sprite_Damage.prototype.setBaseData=function(sprite){sprite.anchor.x=.5,sprite.anchor.y=1,sprite.scale.x=.5,sprite.scale.y=.5,sprite.opacity=0,sprite.y=-40,sprite.zt=0,sprite.ry=sprite.y,sprite.yf=0,sprite.yf2=0,sprite.yf3=0,sprite.ex=!1,this.addChild(sprite)},Sprite_Damage.prototype.setZoomEffect=function(sprite,d,i){d||(d=0),i||(i=0);var delay=.05*i;gsap.to(sprite,.1,{opacity:255,delay:0+delay}),gsap.to(sprite,.2,{opacity:0,delay:.8}),gsap.to(sprite,.1,{y:sprite.y-16,delay:delay,ease:Power2.easeInOut}),gsap.to(sprite,.2,{y:sprite.y,delay:.1+delay,ease:Power2.easeInOut}),gsap.to(sprite,.05,{y:sprite.y-4,delay:.25+delay,ease:Power2.easeInOut}),gsap.to(sprite,.05,{y:sprite.y,delay:.3+delay,ease:Power2.easeInOut})},Sprite_Damage.prototype.setZoomEffectHeal=function(sprite){gsap.to(sprite,.1,{opacity:255,delay:0}),gsap.to(sprite,.1,{opacity:0,delay:.9}),gsap.to(sprite,1,{y:sprite.y-24})},Sprite_Damage.prototype.terminate=function(){for(let i=this.children.length-1;i>=0;i--)gsap.killTweensOf(this.children[i]),this.children[i].destroy();this.children=[],gsap.killTweensOf(this)};class Sprite_PopupText extends Sprite{constructor(){super(),this._animation=new TimelineMax}setup(type,value,delay){const text=this.convertText(type,value);let sprite=new Sprite;this.setBaseData(sprite);let bitmap=new Bitmap(240,40);bitmap.fontSize=20,bitmap.textColor="#ffffff",bitmap.drawText(text,0,0,bitmap.width,bitmap.height,"center",!0),sprite.bitmap=bitmap,sprite.y-=24,sprite.opacity=0,type==PopupTextType.RemoveState?(sprite.y-=24,this.setPopupAnim(sprite,delay)):this.setPopupUpAnim(sprite,delay)}convertText(type,value){switch(type){case PopupTextType.AddState:case PopupTextType.Grow:return"+"+value;case PopupTextType.RemoveState:return"-"+value;case PopupTextType.Text:case PopupTextType.UpText:case PopupTextType.Charge:return value}return value}setPopupAnim(sprite,delay){this._animation.to(sprite,0,{opacity:255,delay:delay}).to(sprite,.5,{y:sprite.y+24,ease:Power2.easeOut}).to(sprite,1,{y:sprite.y+48,ease:Power2.easeOut,alpha:0,onComplete:()=>{this.terminate(sprite)}})}setPopupUpAnim(sprite,delay){this._animation.to(sprite,0,{opacity:255,delay:delay}).to(sprite,.5,{y:sprite.y-24,ease:Power2.easeOut}).to(sprite,1,{y:sprite.y-48,ease:Power2.easeOut,alpha:0,onComplete:()=>{this.terminate(sprite)}})}setBaseData(sprite){sprite.anchor.x=.5,sprite.anchor.y=1,sprite.y=-40,sprite.zt=0,sprite.ry=sprite.y,sprite.yf=0,sprite.yf2=0,sprite.yf3=0,sprite.ex=!1,this.addChild(sprite)}terminate(sprite){this._animation&&this._animation.kill(),this._animation=null,sprite&&(gsap.killTweensOf(sprite),sprite.destroy(!0))}}const PopupTextType={AddState:0,RemoveState:1,Text:2,UpText:3,ResistState:4,Damage:5,Grow:6,Summon:7,Charge:8};class PopupTextData{constructor(battler,type,value,animationId){this.battler=battler,this.type=type,this.value=value,this.animationId=animationId}}class Window_SkillCategory extends Window_Selectable{constructor(x,y,width,height){super(new Rectangle(x,y,width,height)),this._data=[SkillCategory.Skill,SkillCategory.Magic,SkillCategory.Equip,SkillCategory.Item,SkillCategory.Special,SkillCategory.Passive],this.padding=8,this.select(0),this.hide()}maxPageRows(){return this._data.length}contentsHeight(){return this.height}maxCols(){return this._data?this._data.length:1}itemHeight(){return 48}maxItems(){return this._data?this._data.length:1}category(){return this._data&&this.index()>=0?this._data[this.index()]:null}selectLast(){this.select(this.index()>=0?this.index():0)}drawItem(index){const category=this._data[index];if(this.contents.fontSize=14,null!=category){const rect=this.itemRect(index);this.index()==index&&this.drawBack(rect.x+1,rect.y+1,rect.width-2,this.itemHeight()-2,this.cursorColor(),128),this.drawSkillIcon(this.getIconData(category),rect.x+4,rect.y+2,rect.width);const _text=TextManager.getText(this.getTextData(category));this.drawText(_text,rect.x+2,rect.y+18,rect.width,"center")}}updateHelp(){this.item()}refresh(){this.createContents(),this.drawAllItems()}update(){super.update(),this._lastIndex!=this.index()&&(this._lastIndex=this.index(),this.refresh())}getIconData(category){switch(category){case SkillCategory.All:return 209;case SkillCategory.Skill:return 76;case SkillCategory.Magic:return 79;case SkillCategory.Equip:return 132;case SkillCategory.Item:return 228;case SkillCategory.Special:return 186;case SkillCategory.Passive:return 82}}getTextData(category){switch(category){case SkillCategory.All:return 1400;case SkillCategory.Skill:return 1410;case SkillCategory.Magic:return 1420;case SkillCategory.Equip:return 1430;case SkillCategory.Item:return 1440;case SkillCategory.Special:return 1450;case SkillCategory.Passive:return 1460}}}var SkillCategory={All:0,Skill:1,Magic:2,Equip:3,Item:4,Special:5,Passive:6};class Window_SkillSelect extends Window_Selectable{constructor(x,y,width,height){super(new Rectangle(x,y,width,height)),this._category=SkillCategory.Learning,this.resetData(),this.refresh(),this.hide(),this.deactivate()}resetData(){this._allData=[];const _learning=$gameParty.battleMembers()[0].skills();_learning.forEach(learn=>{this._allData.push({type:SkillSelectType.Learning,item:learn})});const _myequip=$gameParty.battleMembers()[0].equips();_myequip.forEach(item=>{null!=item&&this._allData.push({type:SkillSelectType.MyEquip,item:item})});const _item=$gameParty.allItems();_item.forEach(item=>{item.wtypeId&&4==item.wtypeId&&null!=this._allData.find(a=>a.item.id==item.id)||this._allData.push({type:SkillSelectType.Item,item:item})}),console.log(this._allData)}setData(data){this._data=data,this.refresh()}setCategory(category){this._category=category,this.refresh()}contentsHeight(){return this.height}maxCols(){return 1}itemHeight(){return 40}maxItems(){return this._data?this._data.length:1}item(){return this._data&&this.index()>=0?this._data[this.index()]:null}selectLast(){this.select(this.index()>=0?this.index():0)}drawItem(index){if(!this._data||0==this._data.length)return;const _type=this._data[index].type,item=this._data[index].item,_player=$gameParty.battleMembers()[0];if(this.contents.fontSize=21,null!=item){const rect=this.itemRect(index);this.index()==index&&(this.drawBack(rect.x+1,rect.y+1,rect.width-2,this.itemHeight()-2,this.cursorColor(),128),this.resetTextColor()),this.drawSkillIcon(item.iconIndex,rect.x+2+28,rect.y+4,rect.width);let name=item.name;_type==SkillSelectType.Item&&$gameParty.numItems(item)>1&&(name+="("+$gameParty.numItems(item)+")"),_type==SkillSelectType.MyEquip&&item.wtypeId&&4==item.wtypeId&&$gameParty.numItems(item)>1&&(name+="("+Number($gameParty.numItems(item)+1)+")"),this.drawText(name,rect.x+36+28,rect.y+1,rect.width,"left"),_type==SkillSelectType.MyEquip&&_player.equips().find(a=>a==item)&&(this.drawText("▷",rect.x+6,rect.y+1,rect.width,"left",!0),this.contents.fontSize=16),_type!=SkillSelectType.Learning&&_type!=SkillSelectType.Item||item!=_player.skillSet1()&&item!=_player.skillSet2()||(item==_player.skillSet1()&&item==_player.skillSet2()?this.drawText("LR",rect.x+2,rect.y+1,32,"center",!0):item==_player.skillSet1()?this.drawText("R",rect.x+2,rect.y+1,32,"center",!0):this.drawText("L",rect.x+2,rect.y+1,32,"center",!0),this.contents.fontSize=16)}}updateHelp(){this.item()}refresh(){this.createContents(),this._data=this.getData(),this.drawAllItems()}getData(){const _category=this._category;switch(_category){case SkillCategory.All:return this._allData;case SkillCategory.Skill:return this._allData.filter(a=>DataManager.isSkill(a.item)&&1==a.item.stypeId);case SkillCategory.Magic:return this._allData.filter(a=>DataManager.isSkill(a.item)&&2==a.item.stypeId);case SkillCategory.Equip:return this._allData.filter(a=>DataManager.isWeapon(a.item)||DataManager.isArmor(a.item));case SkillCategory.Item:return this._allData.filter(a=>DataManager.isItem(a.item));case SkillCategory.Special:return this._allData.filter(a=>DataManager.isSkill(a.item)&&3==a.item.stypeId);case SkillCategory.Passive:return this._allData.filter(a=>DataManager.isSkill(a.item)&&4==a.item.stypeId)}}_makeCursorAlpha(){return 255}update(){super.update(),this._lastIndex!=this.index()&&(this._lastIndex=this.index(),this.refresh())}processCancel(){this.updateInputData(),this.deactivate(),this.callCancelHandler()}}var SkillSelectType={None:0,Learning:1,Item:2,Equipment:3,MyEquip:4,Skill:5};class Window_RoleSkillSelect extends Window_Selectable{constructor(x,y,width,height){super(new Rectangle(x,y,width,height)),this.opacity=0}setData(data){this._data=data,this.refresh()}contentsHeight(){return this.height}maxCols(){return 2}itemHeight(){return 40}maxItems(){return this._data?this._data.length:1}item(){return this._data&&this.index()>=0?this._data[this.index()]:null}selectLast(){this.select(this.index()>=0?this.index():0)}drawItem(index){if(!this._data||0==this._data.length)return;const item=this._data[index];if(this.contents.fontSize=21,null!=item){const rect=this.itemRect(index);this.resetTextColor(),this.index()==index&&this.drawBack(rect.x,rect.y,rect.width,this.itemHeight()-2,this.cursorColor(),128),this.drawText(TextManager.getStateName(item.state.id),rect.x+8,rect.y+1,rect.width,"left"),item.up&&this.changeTextColor(this.powerUpColor()),this.drawText(item.level,rect.x-8,rect.y+1,rect.width,"right")}}updateHelp(){this.item()}refresh(){this.createContents(),this.drawAllItems()}_updateCursor(){}update(){super.update(),this._lastIndex!=this.index()&&(this._lastIndex=this.index(),this.refresh())}}var SkillSelectType={None:0,Learning:1,Item:2,Equipment:3,MyEquip:4,Skill:5};class Menu_Scene extends Scene_Base{constructor(){super(),this._presenter=new Presenter_Menu(this),Menu_Scene._calledScene=SceneManager._scene,this._lastLanguage=null}create(){super.create(),this.createBackground(),this.createSkillCategoryWindow(),this.createSkillSelectWindow(),this.createPlayerStatus(),this.createStatusWindow(),this.createRoleSkillSelectWindow(),this.createBattleStatus(),this.createHelpWindow(),this.createKeyMapWindow(),this.createFeatureWindow(),$gameDefine.mobileMode&&this.createMenuDockButton(),this._keyMapWindow&&!$gameDefine.mobileMode&&(this.removeChild(this._keyMapWindow),this.addChild(this._keyMapWindow))}createBackground(){this._backgroundFilter=new PIXI.filters.BlurFilter,this._backgroundSprite=new Sprite,this._backgroundSprite.bitmap=SceneManager.backgroundBitmap(),this._backgroundSprite.filters=[this._backgroundFilter],this.addChild(this._backgroundSprite),this._backgroundSprite.opacity=192}createPlayerStatus(){this._playerStatus=new Window_PlayerStatus(80,520),this._playerStatus.setup($gameParty.battleMembers()[0]),this.addChild(this._playerStatus)}createSkillCategoryWindow(){this._categoryWindow=new Window_SkillCategory(80,56,480,64),this.addChild(this._categoryWindow)}createSkillSelectWindow(){this._selectWindow=new Window_SkillSelect(80,120,480,400),this._selectWindow.setHandler("ok",this.okSelect.bind(this)),this._selectWindow.setHandler("cancel",this.cancelSelect.bind(this)),this._selectWindow.setHandler("shift",this.okSkillSet1.bind(this)),this._selectWindow.setHandler("menu",this.okSkillSet2.bind(this)),this._selectWindow.setHandler("pagedown",this.changeCategory.bind(this,1)),this._selectWindow.setHandler("pageup",this.changeCategory.bind(this,-1)),this._selectWindow.setHandler("right",this.changeCategory.bind(this,1)),this._selectWindow.setHandler("left",this.changeCategory.bind(this,-1)),this._selectWindow.setHandler("index",this.changeSelect.bind(this,-1)),this.addChild(this._selectWindow)}createRoleSkillSelectWindow(){this._roleSelectWindow=new Window_RoleSkillSelect(600,240,480,320),this._roleSelectWindow.setHandler("ok",this.okRoleSelect.bind(this)),this._roleSelectWindow.setHandler("cancel",this.cancelRoleSelect.bind(this)),this.addChild(this._roleSelectWindow)}createStatusWindow(){this._statusWindow=new Window_StatusDetail(560,56),this.addChild(this._statusWindow);const _player=$gameParty.battleMembers()[0];this._statusWindow.setup(_player)}createBattleStatus(){this._battleStatus=new Sprite_BattlerStatus;const _player=$gameParty.battleMembers()[0];this._battleStatus.setup(_player),this.addChild(this._battleStatus),this._battleStatus.x=536,this._battleStatus.y=104}okSelect(){const _category=this._categoryWindow.category(),_item=this._selectWindow.item();if(null!=_item)switch(_category){case SkillCategory.Item:this.setCommand({command:MenuCommand.UseItem,select:_item});break;case SkillCategory.Equip:this.setCommand({command:MenuCommand.ChangeEquip,select:_item});break;default:this._selectWindow.activate()}else this._selectWindow.activate()}cancelSelect(){SceneManager.pop()}okSkillSet1(){const _item=this._selectWindow.item();this.setCommand({command:MenuCommand.ChangeSetSkill1,select:_item})}okSkillSet2(){SoundManager.playOk();const _item=this._selectWindow.item();this.setCommand({command:MenuCommand.ChangeSetSkill2,select:_item})}changeSelect(){const _category=this._categoryWindow.category(),_item=this._selectWindow.item();this._playerStatus.refresh(_category,_item),this.updateFeature()}changeCategory(plusIndex){SoundManager.playCursor(),plusIndex>0?this._categoryWindow.cursorRight():this._categoryWindow.cursorLeft(),this._categoryWindow.refresh();const _category=this._categoryWindow.category(),_item=this._selectWindow.item();this._selectWindow.setCategory(_category),this._selectWindow.activate(),this._selectWindow.select(-1),this._playerStatus.refresh(_category,_item),this.updateFeature()}callBackButton(){EventManager.busy()||Popup_Help.busy()||Presenter_Loading.busy()||PopupInputManager.busy()||(SoundManager.playCancel(),Scene_Option.busy()?Scene_Option.cancelOption():this.callPopScene())}createHelpWindow(){this._helpWindow=new Window_Help,this.addChild(this._helpWindow)}start(){super.start(),this.setCommand({command:MenuCommand.Start})}setRoleData(roleData){this._roleSelectWindow.setData(roleData),this._roleSelectWindow.refresh()}commandStart(_player){this._categoryWindow.show();const _category=this._categoryWindow.category();this._selectWindow.setCategory(_category),this._selectWindow.show(),this._playerStatus.show(),this.refreshWindow(_player),Input.clear()}okRoleSelect(){}cancelRoleSelect(){}createFeatureWindow(){this._featureWindow=new Window_FeatureList(80,96,640,384),this.addChild(this._featureWindow)}setDragHandler(handler){}updateFeature(){const _item=this._selectWindow.item();if(null!=_item&&_item.item.description){console.log(_item.item);let feature=[_item.item.description];_item.item.damage&&1==_item.item.damage.type&&_item.item.damage.formula&&feature.push("ダメージ値:x"+_item.item.damage.formula),DataManager.isWeapon(_item.item)&&feature.push("攻撃:"+_item.item.params[2]),DataManager.isArmor(_item.item)&&feature.push("防御:"+_item.item.params[3]),this.commandFeature(feature,this._selectWindow.x+160,40*this._selectWindow.index()+192)}else this.clearFeature()}commandFeature(feature,x,y){this._featureWindow.show(),x=80,y=496,this._featureWindow.refresh(feature,x,y)}clearFeature(){this._featureWindow.hide()}createKeyMapWindow(){this._keyMapWindow=new Window_KeyMap,$gameDefine.mobileMode||(this.addChild(this._keyMapWindow),this._keyMapWindow.refresh("menuCommand"))}createMenuDockButton(){this._dockMenu=new Sprite_MenuDock,this._dockMenu.setClickHandler(MenuDockActionType.SpPlus,this.onSkillSpGain.bind(this)),this._dockMenu.setClickHandler(MenuDockActionType.SpMinus,this.onSkillSpLess.bind(this)),this._dockMenu.setClickHandler(MenuDockActionType.ActorPlus,this.onNextActor.bind(this)),this._dockMenu.setClickHandler(MenuDockActionType.ActorMinus,this.onPreviousActor.bind(this,"start")),this.addChild(this._dockMenu)}commandOptions(){this.refreshKeyHelpWindow("menuOption"),this.setMenuSprite(this._commandWindow.currentSymbol());let index=_.findIndex(this.children,child=>child instanceof Window_Help);this._lastLanguage=$dataOption.getUserData("language"),Scene_Option.setPopup(this.cancelOption.bind(this),index-3),this._keyMapWindow&&Scene_Option.setKeyHelpWindow(this._keyMapWindow),Scene_Option.setHelpWindow(this._helpWindow)}cancelOption(){$gameDefine.mobileMode||this._keyMapWindow.show(),this.refreshKeyHelpWindow("menuCommand"),this.setMenuSprite(TextManager.getText(2e3)),this._commandWindow.activate();const lastLanguage=$dataOption.getUserData("language");lastLanguage!=this._lastLanguage&&SceneManager.goto(Menu_Scene)}refresh(){const skillWindow=this.skillWindow();skillWindow.refresh(),skillWindow.updateHelp()}update(){super.update(),this._presenter&&this._presenter.update()}refreshWindow(_player){const _category=this._categoryWindow.category();this._selectWindow.resetData(),this._selectWindow.refresh(),this._selectWindow.activate(),null==this._selectWindow.item()&&this._selectWindow.select(-1),this._playerStatus.setup(_player);const _redrawitem=this._selectWindow.item();this._playerStatus.refresh(_category,_redrawitem),this._battleStatus.refreshStatus(),this._statusWindow.setup(_player),this.updateFeature()}refreshKeyHelpWindow(key){this._keyMapWindow&&this._keyMapWindow.refresh(key)}swipChara(moveX){this._statusWindow.swipChara(moveX)}swipSkill(upper){upper?this.onSkillSpGain():this.onSkillSpLess()}swipReset(){this._statusWindow.swipReset()}swipEndChara(moveX){this._statusWindow.swipEndChara(moveX)}terminate(){super.terminate(),this._skillWindow&&this._skillWindow.terminate(),this._skillWindow=null,this._helpWindow=null,this._itemWindow&&this._itemWindow.terminate(),this._itemWindow=null,this._actorInfoWindow&&this._actorInfoWindow.terminate(),this._actorInfoWindow=null,this._statusWindow&&this._statusWindow.destroy(),this._statusWindow=null,this._keyMapWindow.terminate(),this._keyMapWindow=null,this._presenter=null,EventManager.remove(),BackGroundManager.remove(),TipsManager.remove(),this.destroy()}callPopScene(){this.setCommand(MenuCommand.PopScene)}popScene(){Window_MenuListCommand._lastCommandSymbol=null,super.popScene()}}const MenuCommand={SkillChange:0,SkillSpGain:1,SkillSpLess:2,SwapOrder:3,CallSave:4,CallLoad:5,CallEnemyInfo:6,Debug:7,Result:8,Magic:9,SkillItemOpen:10,NextActor:11,PreviousActor:12,Status:13,CallHelp:14,Formation:15,PopScene:16,SwipChara:21,CallMagicInfo:31,ChangeEquip:41,UseItem:42,ChangeSetSkill1:51,ChangeSetSkill2:52,Start:100};class Presenter_Menu extends Presenter_Base{constructor(view){super(),this._view=view,this._model=new Model_Menu,this.setEvent()}setEvent(){this._view.setEvent(this.updateCommand.bind(this))}commandStart(){this._view.setRoleData(this._model.roleData()),this._view.commandStart(this._model.player()),this._view.setDragHandler(sprite=>{this.commandFeature(sprite)})}commandPopScene(){EventManager.busy()||($gameTemp._needDisPlayEffectChange=this._model.needDisPlayEffectChange(),this._view.popScene())}updateCommand(){switch(super.updateCommand(),this._view._command.command){case MenuCommand.ChangeEquip:return this.commandChangeEquip(this._view._command.select);case MenuCommand.UseItem:return this.commandUseItem(this._view._command.select);case MenuCommand.ChangeSetSkill1:return this.commandChangeSetSkill(1,this._view._command.select);case MenuCommand.ChangeSetSkill2:return this.commandChangeSetSkill(2,this._view._command.select);case MenuCommand.Debug:return this.commandDebug();case MenuCommand.Start:return this.commandStart();case MenuCommand.PopScene:return this.commandPopScene()}this._view.clearCommand()}commandChangeEquip(select){const _player=this._model.player(),_index=_player.equips().findIndex(a=>a==select.item);if(_index>=0)_player.changeEquip(_index,null);else if(_player.canEquip(select.item)){const isArrow=select.item.wtypeId&&4==select.item.wtypeId;if(isArrow){const _slotIndex=1;_player.changeEquip(_slotIndex,select.item)}else{const _slotIndex=_player.equipSlots().findIndex(a=>a==select.item.etypeId);_player.changeEquip(_slotIndex,select.item)}}this._view.refreshWindow(_player)}commandUseItem(select){const _player=this._model.player();SoundManager.playUseItem(),_player.useItem(select.item);const action=new Game_Action(_player);action.setItem(select.item.id),action.makeActionResult([_player]);const results=action.results();results.forEach(result=>{action.applyResult(result.target,result)}),this._view.refreshWindow(_player)}commandChangeSetSkill(slot,select){const _player=this._model.player();if(null!=select){const _skillSet=1==slot?_player.skillSet1():_player.skillSet2(),_type=select.type,_isSkill=DataManager.isSkill(select.item);switch(_type){case SkillSelectType.Learning:select.item==_skillSet?_player.setSlotSkill(slot,null,!1):_player.setSlotSkill(slot,select.item.id,_isSkill)}}this._view.refreshWindow(_player)}commandDebug(){Debug.log("debug"),EventManager.exit(),EventManager.setup("debug"),this._view.popScene()}commandFeature(sprite){if(null==sprite)return void this._view.clearFeature();const feature=this._model.battlerFeature(sprite._battler),x=sprite.x+112,y=sprite.y+80;this._view.commandFeature(feature,x,y)}update(){Input.isTriggered("pageup")&&$gameTemp.isPlaytest()}}class Model_Menu extends Model_Base{constructor(){super(),this._lastDisPlayEffect=$dataOption.getUserData("displayEffect")}selectActor(){return $gameParty.menuActor()}selectActorIndex(){return $gameParty.allMembers().indexOf($gameParty.menuActor())}selectActorSkillIds(){return[]}selectActorSkillItems(index,selectSkill){const actor=this.selectActor(),element=actor.slotElement(index),data=actor.getReserveSkillData(element);return _.chain(data).sortBy(d=>d).sortBy(d=>$dataSkills[d]&&$dataSkills[d].damage.elementId==element).sortBy(d=>d!=selectSkill.skillId).value()}removeNewSkillId(item){item&&($gameParty._newSkillIdList=_.without($gameParty._newSkillIdList,item))}changeSlotSkill(index,item){this.selectActor().changeSlotSkill(index,item)}changeSelectActor(value){1==value&&$gameParty.makeMenuActorNext(),-1==value&&$gameParty.makeMenuActorPrevious()}pushLimitBreakSkillId(actor,ids){}menuCommand(){return $gameCommand.menuCommand()}libraryCommand(){return $gameCommand.menuSubCommand()}slotSkillData(){const actor=this.selectActor();let slotSkillData;return[]}needDisPlayEffectChange(){return this._lastDisPlayEffect!=$dataOption.getUserData("displayEffect")}roleData(){const _player=this.player(),_roleStateId=$gameDefine.RoleStateIdArray;let list=[];return _roleStateId.forEach(roleStateId=>{list.push({state:$dataStates[roleStateId],level:_player.getStateEffect(roleStateId)})}),list}player(){return $gameParty.battleMembers()[0]}}class Window_FeatureList extends Window_Base{constructor(x,y,width,height){super(new Rectangle(x,y,width,height)),this.hide(),this.scale.x=this.scale.y=1,this.padding=4,this._lastFeature=null}refresh(features,x,y){if(0==features.length)return this.width=0,void(this._lastFeature&&(this._lastFeature=null));this.x=x,this.y=y,this.height=28*features.length+5*this.padding,this.y=this.y-.75*this.height;const widthX=this.x+.75*this.width;if(widthX>960&&(this.x=960-.75*this.width),this._lastFeature!=features.toString()){let width=0;this.contents.fontSize=21,features.forEach(feature=>{let measureTextWidth=this.contents.measureTextWidth(feature);measureTextWidth>width&&(width=measureTextWidth)}),this.width=width+4*this.padding,this.createContents(),features&&this.drawFeatures(features),this._lastFeature=features.toString()}}drawFeatures(features){this.contents.fontSize=21;let y=0;features.forEach((feature,index)=>{y=28*index,this.drawText(feature,2*this.padding,y,this.width,24)})}}class Window_MenuListCommand extends Window_Command{constructor(x,y,menuCommand){super(x,y,menuCommand)}initialize(x,y,menuCommand){this._commandData=menuCommand,super.initialize(new Rectangle(x,y,264,48*this._commandData.length)),gsap.to(this._cursorSprite,0,{pixi:{skewX:-15}}),this._cursorSprite.opacity=0,this.opacity=0,this._lastIndex=this.index(),this.selectLast(),"Library"==Window_MenuListCommand._lastCommandSymbol&&(this._isSub=!0),this.refresh(),"Library"==Window_MenuListCommand._lastCommandSymbol&&(this.deselect(),this.deactivate())}static initCommandPosition(){this._lastCommandSymbol=null}makeCommandList(){let flag;this._commandData.forEach((data,index)=>{flag=!0,2==index&&(flag=$gameParty.allMembers().length>1),3==index&&(flag=$gameSwitches.value(1)),7==index&&(flag=$gameParty.hasStage(2)),this.addCommand(TextManager.getText(data.textId),TextManager.getText(data.textId),flag)})}lineHeight(){return 36}drawItem(index){const rect=this.itemLineRect(index);this.resetTextColor(),this.setFlatMode(),this.index()==index&&(this.drawBackSkewX(rect.x+10*index,rect.y+1,rect.width-2,this.itemHeight()-2,this.cursorColor(),128),this.resetTextColor()),this.changePaintOpacity(this.isCommandEnabled(index));const text=this.commandName(index);this._isSub&&index>3?this.drawText(text,rect.x+36,rect.y+2+40*(index-4)+156,rect.width,"left"):this.drawText(text,rect.x+36,rect.y+2,rect.width,"left");const isNew=this.newDispFlag(index);isNew&&(this.contents.fontSize=12,this.changeTextColor(this.powerUpColor()),this.drawText(TextManager.getNewText(),rect.x+12,rect.y-10,rect.width),this.resetFontSettings())}newDispFlag(index){if(1==index)for(let i=0;i<$gameParty.members().length;i++){let actor=$gameParty.members()[i];if(_.find($gameParty._newSkillIdList,s=>_.find(actor._skills,skillId=>skillId==s)))return!0}return 3==index&&($gameSwitches.value(1)&&_.find($gameParty.getHelpKeyData(),helpkey=>!helpkey.isRead))}isFormationEnabled(){return $gameParty.size()>=2&&$gameSystem.isFormationEnabled()}isSaveEnabled(){return!DataManager.isEventTest()&&$gameSystem.isSaveEnabled()}processOk(){EventManager.busy()||(Window_MenuListCommand._lastCommandSymbol=this.currentSymbol(),Window_Command.prototype.processOk.call(this))}updateHelp(){if(this._commandData[this.index()]){const id=this._commandData[this.index()].helpTextId;this.setHelpWindowText(TextManager.getText(id))}}selectLast(){this.selectSymbol(Window_MenuListCommand._lastCommandSymbol)}update(){super.update(),this._lastIndex!=this.index()&&(this._lastIndex=this.index(),this.refresh())}_updateCursor(){}subCommmandMode(isSub){this._isSub=isSub,this.refresh()}terminate(){gsap.killTweensOf(this._cursorSprite),this.destroy()}}Window_MenuListCommand._lastCommandSymbol=null;class Window_MenuActorStatus extends Window_Selectable{constructor(x,y,width,height){super(new Rectangle(x,y,width,height)),this.deactivate(),this._pendingIndex=-1,this._selectionEffectCount=0,this.createActor(),this.createStatus(),this._animation=[],this.opacity=0,this._cursorSprite.opacity=0}spacingBase(){return 240}offsetRightX(){return 296}createActor(){this._actorSprites=[],this._actorStatusSprites=[],$gameParty.allMembers().forEach((actor,index)=>{let sprite=new Sprite_EventPicture;sprite.setup(actor.faceName()),sprite.setAnimation("wait",!0),sprite.x=index<3?this._actorSprites.length*this.spacingBase()+this.offsetRightX():this._actorSprites.length*this.spacingBase()+2*this.offsetRightX(),this._actorSprites.push(sprite),this.addChild(sprite),sprite.scale.x=sprite.scale.y=.9,sprite.y-=120})}createStatus(){this._actorStatusSprites=[],$gameParty.allMembers().forEach(actor=>{actor.setHp(1)}),$gameParty.allMembers().forEach((actor,index)=>{var status=new Sprite_MenuStatus;status.setup(actor),status.x=index<3?this._actorStatusSprites.length*this.spacingBase()+this.offsetRightX()-160:this._actorStatusSprites.length*this.spacingBase()+2*this.offsetRightX()-160,status.y=320,this._actorStatusSprites.push(status),this.addChild(status)}),$gameParty.allMembers().forEach(actor=>{actor.setHp(actor.mhp)}),this._actorStatusSprites.forEach(status=>{status.changeHp()})}showAllMembers(){this.resetAnim(),this._actorSprites.forEach((sprite,index)=>{gsap.to(sprite,.25,{x:this.positionX(index)}),gsap.to(this._actorStatusSprites[index],.25,{x:this.positionX(index)-168})})}showBattleMembers(){this.resetAnim(),this._actorSprites.forEach((sprite,index)=>{index<3?(gsap.to(sprite,.25,{x:index*this.spacingBase()+this.offsetRightX()}),gsap.to(this._actorStatusSprites[index],.25,{x:index*this.spacingBase()+this.offsetRightX()-160})):(gsap.to(sprite,.25,{x:index*this.spacingBase()+2*this.offsetRightX()}),gsap.to(this._actorStatusSprites[index],.25,{x:index*this.spacingBase()+2*this.offsetRightX()-160}))})}positionX(index){return 976/$gameParty.allMembers().length*index+36+16*(5-$gameParty.allMembers().length)}selectPersonal(selectIndex){this._actorSprites.forEach((sprite,index)=>{index==selectIndex?(gsap.to(sprite,.25,{x:160}),gsap.to(this._actorStatusSprites[index],.25,{x:-24})):(gsap.to(sprite,.25,{x:Graphics.boxWidth+320}),gsap.to(this._actorStatusSprites[index],.25,{x:Graphics.boxWidth}))})}swapFormationActor(index){this.resetAnim();var pending=this._actorSprites[this._pendingIndex],swap=this._actorSprites[index];gsap.to(pending,.25,{x:swap.x}),gsap.to(swap,.25,{x:pending.x});var pending2=this._actorStatusSprites[this._pendingIndex],swap2=this._actorStatusSprites[index];gsap.to(pending2,.25,{x:swap2.x}),gsap.to(swap2,.25,{x:pending2.x});var list=[];this._actorSprites.forEach((sprite,idx)=>{var j=idx;this._pendingIndex==idx?j=index:index==idx&&(j=this._pendingIndex),list.push({index:j,sprite:sprite,status:this._actorStatusSprites[idx]})}),list=_.sortBy(list,l=>l.index),this._actorSprites=[],this._actorStatusSprites=[],list.forEach(element=>{this._actorSprites.push(element.sprite),this._actorStatusSprites.push(element.status)}),this.cancelFormationActor()}cancelFormationActor(){this._actorSprites.forEach(sprite=>{sprite.setSelected(!1)})}refreshStatus(){this._actorStatusSprites.forEach(sprite=>{sprite.changeHp(),sprite.changeMp()})}maxItems(){return $gameParty.allMembers().length}maxCols(){return this.maxItems()}itemHeight(){return 296}isCurrentItemEnabled(){const actor=$gameParty.allMembers()[this.index()];return actor&&actor.isFormationChangeOk()}selectLast(){this.select($gameParty.menuActor().index()||0)}pendingIndex(){return this._pendingIndex}setPendingIndex(index){const lastPendingIndex=this._pendingIndex;this._pendingIndex=index,this.redrawItem(this._pendingIndex),this.redrawItem(lastPendingIndex),index>=0&&this._actorSprites[index].setSelected(!0)}update(){super.update(),this.updateSelecting(),this.updateDraging()}updateSelecting(){this._selectionEffectCount+=1,this._actorSprites.forEach((sprite,index)=>{sprite.setSelecting(index==this.index()&&this._selectionEffectCount%60<30)})}updateDraging(){if(null==this._dragHandler)return;if(0==TouchInput.isPressed())return void this._dragHandler(null);let isDrag=!1;this._actorStatusSprites.forEach(sprite=>{sprite.isBeingTouched()&&(isDrag=!0,this._dragHandler(sprite))}),0==isDrag&&this._dragHandler(null)}changeSelecting(){this._selectionEffectCount=0,this._actorSprites.forEach((sprite,idx)=>{}),this._actorSprites&&this.index()}updateCursor(){}resetAnim(){this._animation.forEach(anim=>{anim.seek(anim.endTime())}),gsap.killTweensOf(this)}swipChara(moveX){0!=moveX&&(this._movedX=moveX,this._actorSprites.forEach((sprite,index)=>{index==$gameParty.menuActor().selectIndex()&&(sprite.x=160+moveX)}))}swipReset(){this._movedX=0}swipEndChara(){0!=this._movedX&&this._actorSprites.forEach((sprite,index)=>{index==$gameParty.menuActor().index()&&gsap.to(sprite,.25,{x:160})})}setDragHandler(handler){this._dragHandler=handler}_updateCursor(){}terminate(){for(let i=this._actorSprites.length-1;i>=0;i--)this._actorSprites[i].terminate(),this.removeChild(this._actorSprites[i]);this._actorSprites=null;for(let i=this._actorStatusSprites.length-1;i>=0;i--)gsap.killTweensOf(this._actorStatusSprites[i]),this._actorStatusSprites[i].terminate(),this.removeChild(this._actorStatusSprites[i]);this._actorStatusSprites=null,this.destroy()}}class Window_LibraryCommand extends Window_Command{constructor(x,y,libraryCommand){super(x,y,libraryCommand)}initialize(x,y,libraryCommand){this._commandData=libraryCommand,super.initialize(new Rectangle(x,y,260,48*this._commandData.length)),gsap.to(this._cursorSprite,0,{pixi:{skewX:-15}}),this._cursorSprite.opacity=0,this.opacity=0,this._lastIndex=this.index(),this.selectLast(),this.refresh(),"Library"==Window_MenuListCommand._lastCommandSymbol?(this.show(),this.activate()):(this.hide(),this.deactivate())}static initCommandPosition(){this._lastCommandSymbol=null}itemHeight(){return 40}makeCommandList(){this._commandData.forEach((data,index)=>{let flag=!0;this.addCommand(TextManager.getText(data.textId),TextManager.getText(data.textId),!0)})}drawItem(index){const rect=this.itemRect(index);this.resetTextColor(),this.setFlatMode(),this.index()==index&&(this.drawBackSkewX(rect.x+10*index,rect.y+1,rect.width-2,this.itemHeight()-2,this.cursorColor(),128),this.resetTextColor()),this.changePaintOpacity(this.isCommandEnabled(index)),this.drawText(this.commandName(index),rect.x+56,rect.y+2,rect.width,"left");const isNew=this.newDispFlag(index);isNew&&(this.contents.fontSize=12,this.changeTextColor(this.powerUpColor()),this.drawText(TextManager.getNewText(),rect.x+32,rect.y-10,rect.width),this.resetFontSettings())}newDispFlag(index){return 0==index&&($gameSwitches.value(1)&&_.find($gameParty.getHelpKeyData(),helpkey=>!helpkey.isRead))}processOk(){Window_LibraryCommand._lastCommandSymbol=this.currentSymbol(),super.processOk()}selectLast(){this.selectSymbol(Window_LibraryCommand._lastCommandSymbol)}updateHelp(){const id=this._commandData[this.index()].helpTextId;this.setHelpWindowText(TextManager.getText(id))}update(){super.update(),this._lastIndex!=this.index()&&(this._lastIndex=this.index(),this.refresh())}_updateCursor(){}terminate(){gsap.killTweensOf(this._cursorSprite),this.destroy()}}Window_LibraryCommand._lastCommandSymbol=null;class Sprite_MenuStatus extends Sprite_BattlerStatus{constructor(){super()}setup(battler){this._battler=battler,this.setAttri(),this.addChild(this._statusMpSprite),this.setHp(),this.setStateIconSprite(),this.setName()}setAttri(){let sprite2=new Sprite;this.addChild(sprite2);let bitmap2=new Bitmap(320,120);bitmap2.fillRect(0,0,200,78,"rgba(0,0,0,120)"),sprite2.bitmap=bitmap2,sprite2.x=84,sprite2.y=4,sprite2.opacity=64,gsap.to(sprite2,0,{pixi:{skewX:-15}})}setLv(){let sprite=new Sprite,bitmap=new Bitmap(160,48);bitmap.fontSize=fontSize,bitmap.drawText("Lv . ",0,0,160,48,"left",!1),sprite.bitmap=bitmap,this.addChild(sprite),sprite.x=34,sprite.y=32}setName(){let sprite=new Sprite;const name=this._battler.name();let bitmap=new Bitmap(160,48);bitmap.fontSize=21,bitmap.drawText(name,0,0,160,48,"left",!1),sprite.bitmap=bitmap,this.addChild(sprite),sprite.x=96,sprite.y=0}setLevel(){let sprite=new Sprite;const lv=this._battler._level;let bitmap=new Bitmap(160,48);bitmap.fontSize=21,bitmap.drawText(TextManager.levelA+" "+lv,0,0,160,48,"right",!1),sprite.bitmap=bitmap,this.addChild(sprite),sprite.x=96,sprite.y=0}isBeingTouched(){const touchPos=new Point(TouchInput.x,TouchInput.y),localPos=this.worldTransform.applyInverse(touchPos);return this.hitTest(localPos.x,localPos.y)&&0!=touchPos.x&&0!=touchPos.y}hitTest(x,y){let anchorX=0,width=200,height=78,rect;return $gameDefine.mobileMode,width=64,anchorX=88,height=48,rect=new Rectangle(anchorX+width+78,-this.anchor.y*height,width,height),rect.contains(x,y)}}class File_Scene extends Scene_Base{constructor(){super(),this._presenter=new Presenter_File(this)}create(){super.create(),BackGroundManager.resetup(),this._backSprite=new ScreenSprite,this._backSprite.setColor(0,0,0),this.addChild(this._backSprite),this._backSprite.opacity=168,this.createWindowLayer(),this.createHelpWindow(),this.createListWindow(),this.createMenuButton(),this.createBackButton(),this.createMenuSprite(),this.createKeyMapWindow(),$gameDefine.mobileMode&&this.createDockButton()}start(){super.start(),this.setCommand(FileCommand.Start)}commandStart(){this.showMenuPlate(.25,this.popScene.bind(this),TextManager.getBackText(),TextManager.getText(200800))}popScene(){PopupInputManager.busy()||($gameDefine.mobileMode&&SoundManager.playCancel(),super.popScene())}showListWindow(data,index){this._backSprite.opacity=168,this._helpWindow.setText(this.helpWindowText()),this._listWindow.show(),this._listWindow.activate(),this._listWindow.setData(data),this._listWindow.forceSelect(index)}savefileId(){return 0==this._listWindow.index()?DataManager.autoSaveGameId():this._listWindow.index()}createHelpWindow(){this._helpWindow=new Window_Help(1),this.addChild(this._helpWindow)}createListWindow(){this._listWindow=new Window_FileList(144,32,680,464),this._listWindow.setHandler("ok",this.onFileOk.bind(this)),this._listWindow.setHandler("cancel",this.onFileCancel.bind(this)),this.addChild(this._listWindow)}createKeyMapWindow(){}createDockButton(){}helpWindowText(){return""}onFileOk(){}onFileCancel(){}terminate(){super.terminate(),this._listWindow&&this._listWindow.terminate(),this._listWindow=null,this._helpWindow&&this._helpWindow.destroy(),this._helpWindow=null,this._backSprite&&this._backSprite.destroy(),this._keyMapWindow&&this._keyMapWindow.terminate(),this._keyMapWindow=null,this._backSprite=null}}class Save_Scene extends File_Scene{constructor(){super()}createKeyMapWindow(){this._keyMapWindow=new Window_KeyMap,$gameDefine.mobileMode||(this.addChild(this._keyMapWindow),this._keyMapWindow.refresh("save"))}helpWindowText(){return TextManager.getText(200300)}onFileOk(){if(0==this._listWindow.index())return this._listWindow.activate(),void SoundManager.playBuzzer();this._listWindow.hide(),this._helpWindow.setText(""),this._backSprite.opacity=0,CriateSpriteManager.createSaveImage(this.savefileId()),this.setCommand(FileCommand.Save)}onFileCancel(){this.popScene()}onSaveSuccess(index){CriateSpriteManager.loadSaveImageByIndex(index)}onSaveFailure(){SoundManager.playBuzzer(),this._listWindow.activate()}popScene(){if(null!=Scene_Save._nextScene){if(PopupInputManager.busy())return;if($gameDefine.mobileMode&&SoundManager.playCancel(),"Shutdown"==Scene_Save._nextScene)return Scene_Save._nextScene=null,void EventManager.shutdown();if(SceneManager.push(Scene_Save._nextScene),Scene_Save._nextScene=null,$gamePlayer.clearTransferInfo(),$gameParty.stageNo()&&$gameParty.stageNo()>0){const endEvent=DataManager.getStageInfos($gameParty.stageNo()).endEvent;EventManager.setup(endEvent)}}else super.popScene()}}Scene_Save._nextScene=null;class Load_Scene extends File_Scene{constructor(){super()}createKeyMapWindow(){this._keyMapWindow=new Window_KeyMap,$gameDefine.mobileMode||(this.addChild(this._keyMapWindow),this._keyMapWindow.refresh("load"))}createDockButton(){this._dockMenu=new Sprite_LoadDock,this._dockMenu.setClickHandler(LoadDockActionType.Upload,this.onFileUpLoad.bind(this)),this._dockMenu.setClickHandler(LoadDockActionType.DataTransport,this.onFileDownLoad.bind(this)),this.addChild(this._dockMenu)}helpWindowText(){return TextManager.getText(200400)}onFileOk(){this.setCommand(FileCommand.Load)}onFileCancel(){this.popScene()}onLoadSuccess(){SoundManager.playLoad()}onLoadFailure(){SoundManager.playBuzzer(),this._listWindow.activate()}createListWindow(){super.createListWindow(),this._listWindow.setHandler("shift",this.onFileUpLoad.bind(this)),this._listWindow.setHandler("menu",this.onFileDownLoad.bind(this))}onFileUpLoad(){this._listWindow.deactivate();const mainText=TextManager.getText(210100),text1=TextManager.getDecideText(),text2=TextManager.getCancelText(),subText=TextManager.getText(210101),_popup=PopupManager;_popup.setPopup(mainText,{select:1,subText:subText}),_popup.setHandler(text1,"ok",()=>{this.setCommand(FileCommand.UpLoad)}),_popup.setHandler(text2,"cancel",()=>{this._listWindow.activate()}),_popup.open()}commandUpLoadEnd(fileName){const mainText=TextManager.getText(210200),subText=TextManager.getText(210201),_popup=PopupManager;_popup.setPopup(mainText,{subText:subText}),_popup.setHandler(fileName,"ok",()=>{this._listWindow.activate()}),_popup.open()}failUpLoadEnd(){const mainText=TextManager.getText(210600),subText=TextManager.getText(210601),text1=TextManager.getText(840),_popup=PopupManager;_popup.setPopup(mainText,{subText:subText}),_popup.setHandler(text1,"ok",()=>{this._listWindow.activate()}),_popup.open()}onFileDownLoad(){}}const FileCommand={Load:0,Save:1,Lock:2,Start:3,UpLoad:4};class Presenter_File extends Presenter_Base{constructor(view){super(),this._lastStageNo=0,this._view=view,this._model=new Model_File,this.setEvent()}setEvent(){this._view.setEvent(this.updateCommand.bind(this))}start(){}updateCommand(){if(!PopupManager.busy()){switch(super.updateCommand(),this._view._command){case FileCommand.Load:return this.commandLoad();case FileCommand.Save:return this.commandSave();case FileCommand.Lock:return this.commandLock();case FileCommand.Start:return this.commandStart();case FileCommand.UpLoad:return this.commandUpLoad()}this._view.clearCommand()}}commandStart(){this._view.commandStart();const files=this._model.saveFiles(),index=this._model.selectLastIndex();this._view.showListWindow(files,index)}async commandLoad(){"Title_Scene"==SceneManager._previousClass.name&&BackGroundManager.changeBackGround(null,null);const index=this._view._listWindow.index(),result=this._model.loadFile(index);this._lastStageNo=this._model.lastStageNo(),result?(this._view.onLoadSuccess(),this.loadSuccess(index)):this._view.onLoadFailure()}loadSuccess(index){this.releaseResourceData(),this._model.setSelectLastIndex(index),AudioManager.purgeBgm($gameBGM.getBgm("title")),$gameParty.allMembers().forEach(actor=>{actor.exChangeslotData(),actor.clearAllPassiveState()}),$gameParty.resetBattleParameter(),BackGroundManager.resetStageMode(),Graphics.frameCount=$gameSystem._framesOnSave,AudioManager.fadeOutBgm(1);const resumeScene=this._model.resumeScene();resumeScene&&this.commandContinue(),this.checkUpdate()}releaseResourceData(){if($gameParty.stageNo()==this._lastStageNo)return;const resouces=ResourceLoadManager.getStageResource(this._lastStageNo);resouces&&(resouces.animation.forEach(anim=>{ImageManager.clearImageAnimation(anim)}),resouces.enemy.forEach(en=>{ImageManager.clearImageEnemy(en)}),resouces.sound=resouces.sound.map(s=>s.name),resouces.sound.forEach(se=>{AudioManager.purgeSe(se)}),resouces.bgm.forEach(bgm=>{AudioManager.purgeBgm(bgm)}))}commandSave(){const index=this._view._listWindow.index(),result=this._model.saveFile(index);result?this.saveSuccess(index):this._view.onSaveFailure()}async saveSuccess(index){SoundManager.playSave(),this._model.setSelectLastIndex(index),StorageManager.cleanBackup(index),DataManager.refreshSaveData(),await CriateSpriteManager.addSaveImage(index),PopupManager.openSaveSuccess(()=>{this._view.onSaveSuccess(index);const files=this._model.saveFiles();index=this._model.selectLastIndex(),this._view.showListWindow(files,index)})}commandLock(){const index=this._view._listWindow.index();if(this._view.commandLock(index),this._view.isAllLocked()){const endEvent=this._model.lockEndEvent();endEvent&&EventManager.setup(endEvent)}}}class Model_File extends Model_Base{constructor(){super()}lastStageNo(){return $gameParty.stageNo()}saveFiles(){let auto,data=[DataManager.autoSavefile()].concat(DataManager.savefiles());return SceneManager._scene instanceof Save_Scene&&data.length<100&&data.push(null),data}selectLastIndex(){return 2==this.saveFiles().length?1:$dataOption.lastAccessSaveId()-1}setSelectLastIndex(id){id<DataManager.autoSaveGameId()&&($dataOption.setUserData("lastAccessSaveId",id+1),ConfigManager.save())}loadFile(index){return 0==index&&(index=100),!!DataManager.loadGame(index)}saveFile(index){return $gameSystem.onBeforeSave(),!!DataManager.saveGame(index)}lockEndEvent(){return $gameDefine.lockFileEndEvent}upLoadData(savedataId){return StorageManager.load(savedataId)}}class Window_FileList extends Window_Selectable{constructor(x,y,width,height){super(new Rectangle(x,y,width,height)),this._data=[],this._lockIndexList=[],this.activate(),this.opacity=0,this._upArrowSprite.move(this._width-12,12),this._downArrowSprite.move(this._width-12,this._height-8)}setData(data){this._data=data,this.refresh()}maxItems(){return this._data.length}maxVisibleItems(){return 6}itemHeight(){return 88}drawItem(index){const info=this._data[index];let rect=this.itemRect(index);this.drawBack(rect.x-4,rect.y+2,rect.width+8,rect.height-4,0,128),this.resetTextColor();const isExists=StorageManager.exists(index);if(info&&isExists){let name;name=0==index?"save100":"save"+index;const locked=this._lockIndexList&&_.contains(this._lockIndexList,index);if(this.changePaintOpacity(!locked),locked)this.drawText(TextManager.getText(200500),rect.x-8,rect.y+this.lineHeight()/2+2,this.width,"center");else{let image=CriateSpriteManager.imageSrc()[name];image&&image.src&&!image.src.contains("undefined")&&this.contents._context.drawImage(image,0,0,160,90,12,rect.y+4,160,80),this.drawTimeStamp(info.timestamp,rect.x+180,rect.y+this.lineHeight()),this.drawContents(info,rect,index)}}else this.drawText(TextManager.getText(200100),rect.x-8,rect.y+this.lineHeight()/2+2,this.width,"center")}drawTimeStamp(time,x,y){const ts=Number(time),d=new Date(ts),year=d.getFullYear(),month=d.getMonth()+1<10?"0"+(d.getMonth()+1):d.getMonth()+1,day=d.getDate()<10?"0"+d.getDate():d.getDate(),hour=d.getHours()<10?"0"+d.getHours():d.getHours(),min=d.getMinutes()<10?"0"+d.getMinutes():d.getMinutes(),text=year+"  "+month+"  "+day+"  "+hour+":"+min;this.drawText(text,x,y,240),this.contents.fontSize=16,this.drawText("/",x+50,y-1,240),this.drawText("/",x+96,y-1,240),this.resetFontSettings()}drawContents(info,rect,index){if(info.title){var fileName=0!=index?"File "+index:"AutoSave";this.drawText(fileName,rect.x+180,rect.y+6,rect.width-192)}info.subTitle&&this.drawText(info.subTitle,rect.x,rect.y+6,rect.width-24,"right"),this.drawPlaytime(info,rect.x,rect.y+this.lineHeight(),rect.width)}drawPlaytime(info,x,y,width){info.playtime&&this.drawText(TextManager.getText(200700)+info.playtime,x-24,y,width,"right")}playOkSound(){}terminate(){gsap.killTweensOf(this._upArrowSprite),gsap.killTweensOf(this._downArrowSprite)}setLockIndexList(list){this._lockIndexList=list,this.refresh()}}class Scene_Option{constructor(){}static init(){this._presenter=null,this._window=null,this._busy=!1,this._endCall=null}static setPopup(endCall,sceneIndex){this._busy||(this.createControlWindow(sceneIndex),this.createOptionCategory(sceneIndex),this.createOptionWindow(sceneIndex),this.createBackSprite(sceneIndex),this._presenter=new Presenter_Option(this),this._endCall=endCall,this._busy=!0)}static createBackSprite(sceneIndex){this._backSprite=new Sprite;var bitmap=new Bitmap(960,540);bitmap.fillRect(0,0,960,540,"rgba(0,0,0,0.5)"),this._backSprite.bitmap=bitmap,SceneManager._scene.addChildAt(this._backSprite,sceneIndex)}static createOptionCategory(sceneIndex){this._categoryWindow=new Window_OptionCaterogy(64,120),this._categoryWindow.setHandler("ok",this.onCategory.bind(this)),this._categoryWindow.setHandler("cancel",this.cancelCategory.bind(this)),this._categoryWindow.setHandler("index",this.changeCategoryIndex.bind(this)),SceneManager._scene.addChildAt(this._categoryWindow,sceneIndex)}static createOptionWindow(sceneIndex){this._optionWindow=new Window_OptionList(320,120),this._optionWindow.setHandler("ok",this.onControlOption.bind(this)),this._optionWindow.setHandler("cancel",this.cancelOption.bind(this)),this._optionWindow.setHandler("index",this.changeOptionIndex.bind(this)),this._optionWindow.setHandler("right",this.onOptionGain.bind(this)),this._optionWindow.setHandler("left",this.onOptionLess.bind(this)),SceneManager._scene.addChildAt(this._optionWindow,sceneIndex)}static createControlWindow(sceneIndex){this._controlOptionWindow=new Window_OptionKeyAssign(320,120),this._controlOptionWindow.setHandler("ok",this.onKeyChange.bind(this)),this._controlOptionWindow.setHandler("cancel",this.cancelControlOption.bind(this)),SceneManager._scene.addChildAt(this._controlOptionWindow,sceneIndex)}static setOptionList(data){this._optionWindow.setData(data)}static setOptionCategory(category){this._categoryWindow.setData(category)}static windowInitilize(){this._optionWindow.deactivate(),this._categoryWindow.activate()}static onCategory(){this._optionWindow.activate(),this._optionWindow.select(0)}static cancelCategory(){this._categoryWindow._helpWindow.contents.clear(),this._backButton&&this._backButton.hide(),this._menuButton&&this._menuButton.hide(),this._keyHelpWindow&&this._keyHelpWindow.hide(),this.terminate(),this._endCall&&(this._endCall(),this._endCall=null,this._busy=!1)}static changeCategoryIndex(){this.setCommand(OptionCommand.Category)}static onOptionGain(){this.setCommand(OptionCommand.OptionGain)}static onOptionLess(){this.setCommand(OptionCommand.OptionLess)}static onControlOption(){switch(this._optionWindow.currentSymbol()){case"initialize":this._optionWindow.deactivate(),this.openPopupInitialize();break;case"messageTweet":this._optionWindow.deactivate(),this.openPopupMessageTweet();break;case"credit":this._optionWindow.deactivate(),this.openPopupCredit();break;case"support":this._optionWindow.deactivate(),this.openPopupSupport();break;case"datatransport":this._optionWindow.deactivate(),this.openPopupDataTransport();break;case"controlType":this.onKeyOption();break;default:this.onOptionGain()}}static onKeyOption(){this.setCommand(OptionCommand.KeyAssign)}static commandKeyAssign(keyAssign){$gameMessage.clear(),ConfigManager.save(),this.closeMessage(),this._optionWindow.hide(),this._optionWindow.deactivate(),this._controlOptionWindow.show(),this._controlOptionWindow.activate(),this._controlOptionWindow.setData(keyAssign),this._controlOptionWindow.selectLast()}static onKeyChange(){this.setCommand(OptionCommand.KeyChange)}static commandKeyChange(){Input.clear(),this._waitAssign=!0;const mainText=TextManager.getText(51910),_popup=PopupManager;_popup.setPopup(mainText,{select:-1}),_popup.open()}static cancelOption(){if(null!=this._creditWindow&&this._creditWindow.active)return this._creditWindow.close(),this._creditWindow.deactivate(),void this._optionWindow.activate();this._controlOptionWindow.active?this.cancelControlOption():this._categoryWindow.active?this.cancelCategory():($gameMessage.clear(),ConfigManager.save(),this._categoryWindow.activate(),this._optionWindow.deactivate(),this._optionWindow.deselect(),this.closeMessage())}static changeOptionIndex(){const symbol=this._optionWindow.currentSymbol();"messageSpeed"==symbol?(this.closeMessage(),this.startMessage()):this.closeMessage(),"controlType"==symbol?this._keyHelpWindow.refresh("menuKeyOption"):this._keyHelpWindow.refresh("menuOption")}static startMessage(){this._messageWindow.show(),this._messageIndex=0,this._waitCount=4-$dataOption.getUserData("messageSpeed"),this._messageTime=new TimelineMax;let self=this;this._messageTime.to(this._messageWindow,2.5,{repeat:-1,onRepeat:function(){self._messageIndex=0}})}static closeMessage(){this._messageTime&&(this._messageTime.kill(),this._messageTime=null),this._messageWindow&&(this._messageIndex=0,this._waitCount=0,this._messageWindow.hide(),this._messageWindow.deactivate())}static cancelControlOption(){this._keyHelpWindow.refresh("menuKeyOption"),this._controlOptionWindow.hide(),this._controlOptionWindow.deactivate(),this._optionWindow.show(),this._optionWindow.activate()}static openPopupInitialize(){const mainText=TextManager.getText(51001),text1=TextManager.getDecideText(),text2=TextManager.getCancelText(),_popup=PopupManager;_popup.setPopup(mainText),_popup.setHandler(text1,"ok",async()=>{$dataOption.initializeSettings(),ConfigManager.save(),this._presenter.setOptionList(),this._optionWindow.activate(),this._categoryWindow.deactivate()}),_popup.setHandler(text2,"cancel",()=>{this._optionWindow.activate()}),_popup.open()}static openPopupMessageTweet(){SoundManager.playOk();const mainText=TextManager.getText(50801),text1=TextManager.getDecideText(),text2=TextManager.getCancelText(),_popup=PopupManager;_popup.setPopup(mainText,{select:1}),_popup.setHandler(text1,"ok",()=>{const url="https://twitter.com/intent/tweet?screen_name=ecoddr1",platform=$gameDefine.platForm();platform==PlatForm.iOS?cordova.InAppBrowser.open(url,"_blank"):window.open(url,"_blank")||(window.location.href=url),this._optionWindow.activate()}),_popup.setHandler(text2,"cancel",()=>{this._optionWindow.activate()}),_popup.open()}static openPopupCredit(){}static openPopupSupport(){SoundManager.playOk(),PopupManager.openPopupSupport(()=>{const url="https://message.blogcms.jp/livedoor/ecoddr3/message2",platform=$gameDefine.platForm();platform==PlatForm.iOS?cordova.InAppBrowser.open(url,"_blank"):window.open(url,"_blank")||(window.location.href=url),this._optionWindow.activate()},()=>{this._optionWindow.activate()})}static openPopupDataTransport(){}static inputFileName(){PopupInputManager.inputFileName(()=>{this._fileName=PopupInputManager.getInputText(),this.setCommand(OptionCommand.DataTransport)})}static terminate(){this.closeMessage(),this._optionWindow&&(SceneManager._scene.removeChild(this._optionWindow),this._optionWindow.destroy(),this._optionWindow=null),this._messageWindow&&(SceneManager._scene.removeChild(this._messageWindow),this._messageWindow.destroy(),this._messageWindow=null),this._controlOptionWindow&&(SceneManager._scene.removeChild(this._controlOptionWindow),this._controlOptionWindow.destroy(),this._controlOptionWindow=null),this._categoryWindow&&(SceneManager._scene.removeChild(this._categoryWindow),this._categoryWindow.destroy(),this._categoryWindow=null),this._backSprite&&(this._backSprite.destroy(),this._backSprite=null),this._creditWindow&&(SceneManager._scene.removeChild(this._creditWindow),this._creditWindow.destroy(),this._creditWindow=null)}static setBackButton(backButton){this._backButton=backButton,this._backButton.setup(TextManager.getBackText()),this._backButton.setClickHandler(()=>{PopupInputManager.busy()||(SoundManager.playCancel(),this.cancelOption())})}static setMenuButton(menuButton){this._menuButton=menuButton}static setKeyHelpWindow(keyMapWindow){this._keyHelpWindow=keyMapWindow,this._controlOptionWindow.setKeyHelpWindow(keyMapWindow)}static setHelpWindow(helpWindow){this._categoryWindow.setHelpWindow(helpWindow),this._optionWindow.setHelpWindow(helpWindow)}static busy(){return this._busy}static setEvent(command){this._commandUpdate=command}static setCommand(command){this._command=command,this._commandUpdate()}static clearCommand(){this._command=null,TouchInput.clear()}static commandOptionGain(symbol){SoundManager.playCursor(),this._optionWindow.redrawItem(this._optionWindow.findSymbol(symbol)),this._optionWindow.activate(),"controlType"==symbol?this._keyHelpWindow.refresh("menuKeyOption"):this._keyHelpWindow.refresh("menuOption"),"messageSpeed"==symbol?(this.closeMessage(),this.startMessage()):this.closeMessage()}static commandKeyDecide(){Input.clear(),PopupManager.close(),this._keyHelpWindow.refresh("menuKeyOption")}static update(){this._waitAssign&&Input._latestKey&&(this._waitAssign=!1,this.setCommand(OptionCommand.KeyDecide)),this.updateWaitCount()}static updateWaitCount(){if(this._waitCount>0&&(this._waitCount-=1,0==this._waitCount)){this._messageIndex+=1,this._waitCount=4-$dataOption.getUserData("messageSpeed");let dispText="";TextManager.getText(50260).split("").forEach((element,index)=>{index<this._messageIndex&&(dispText+=element)}),this._messageWindow.createContents(),this._messageWindow.drawText(dispText,8,0,480,48)}}}const OptionCommand={Category:1,Option:2,OptionGain:11,OptionLess:12,KeyAssign:21,KeyChange:22,KeyDecide:23,DataTransport:31};class Presenter_Option extends Presenter_Base{constructor(view){super(),this._view=view,this._model=new Model_Option,this.setEvent(),this.start()}setEvent(){this._view.setEvent(this.updateCommand.bind(this))}start(){this.setOptionList()}setOptionList(){const categoryData=this._model.categoryData();this._view.setOptionCategory(categoryData);const options=this._model.optionData();this._view.setOptionList(options),this._view.windowInitilize()}updateCommand(){switch(super.updateCommand(),this._view._command){case OptionCommand.Category:return this.commandCategory();case OptionCommand.Option:return this.commandOption();case OptionCommand.OptionGain:return this.commandOptionGain();case OptionCommand.OptionLess:return this.commandOptionLess();case OptionCommand.KeyAssign:return this.commandKeyAssign();case OptionCommand.KeyChange:return this.commandKeyChange();case OptionCommand.KeyDecide:return this.commandKeyDecide();case OptionCommand.DataTransport:return this.commandDataTransport()}this._view.clearCommand()}commandCategory(){const index=this._view._categoryWindow.index();this._model.setCategoryIndex(index+1);const options=this._model.optionData();this._view.setOptionList(options)}commandOption(){}async commandOptionGain(){let option=this._view._optionWindow.option();const isEnable=!option.version||Number(option.version)<=$gameDefine.gameVersionNumber(),symbol=option.key;isEnable&&(this._model.optionGain(option,symbol),"language"==symbol&&(this.setOptionList(),this._view._optionWindow.activate(),this._view._categoryWindow.deactivate())),this._view.commandOptionGain(symbol)}async commandOptionLess(){let option=this._view._optionWindow.option();const isEnable=!option.version||Number(option.version)<=$gameDefine.gameVersionNumber(),symbol=option.key;isEnable&&(this._model.optionLess(option,symbol),"language"==symbol&&(this.setOptionList(),this._view._optionWindow.activate(),this._view._categoryWindow.deactivate())),this._view.commandOptionGain(symbol)}commandKeyAssign(){const keyAssign=this._model.keyAssaginData();this._view.commandKeyAssign(keyAssign)}commandKeyChange(){let changeKeyIndex=this._view._controlOptionWindow.index();this._model.setChangeKeyByIndex(changeKeyIndex),this._view.commandKeyChange()}commandKeyDecide(){const key=Input._latestKey;this._model.changeKeyAssign(key),this._view.commandKeyDecide();const keyAssign=this._model.keyAssaginData();this._view.commandKeyAssign(keyAssign)}async commandDataTransport(){}}class Model_Option extends Model_Base{constructor(){super(),this._category=1,this._changeKey=null}get category(){return this._category}setCategoryIndex(index){this._category=index}optionData(){return $dataOption.getOptionData(this.category)}categoryData(){return $dataOption.getCategoryData()}getConfigValue(symbol){return $dataOption.getUserData(symbol)}setConfigValue(symbol,value){$dataOption.setUserData(symbol,value)}changeValue(symbol,value){const lastValue=this.getConfigValue(symbol);lastValue!==value&&this.setConfigValue(symbol,value)}volumeOffset(){return 5}optionGain(option,symbol){let value=this.getConfigValue(symbol);switch(Number(option.type)){case OptionType.Volume:value+=this.volumeOffset(),value=value.clamp(0,100);break;case OptionType.OnOff:value=!value;break;case OptionType.Other:value+=1,value===option.otherOption.length&&(value=0),value=value.clamp(0,option.otherOption.length-1)}this.changeValue(symbol,value)}optionLess(option,symbol){let value=this.getConfigValue(symbol);switch(Number(option.type)){case OptionType.Volume:value-=this.volumeOffset(),value=value.clamp(0,100);break;case OptionType.OnOff:value=!value;break;case OptionType.Other:value-=1,-1==value&&(value=option.otherOption.length-1),value=value.clamp(0,option.otherOption.length-1)}this.changeValue(symbol,value)}keyAssaginData(){const control=this.getControlSystem();let list=[];const controlType=$dataOption.getUserData("controlType");for(let key in control)0===controlType?list.push(this.exChangeKeyAssign(control[key])):1===controlType?list.push(this.exChangeKeyAssign2(control[key])):2===controlType&&("ok"==key||"escape"==key||"menu"==key||"shift"==key?list.push(this.exChangeKeyAssign2(control[key])+16):list.push(this.exChangeKeyAssign2(control[key])));return list}setChangeKeyByIndex(changeKeyIndex){const control=this.getControlSystem();let change=null,index=0;for(let key in control)changeKeyIndex==index&&(change=key),index+=1;this._changeKey=change}changeKeyAssign(changeKey){let control=this.getControlSystem(),replace=null,replaceKey=null;for(let key in control)changeKey==control[key]&&(replace=key,replaceKey=control[this._changeKey]);$dataOption.setKeyControl(this._changeKey,changeKey),control[this._changeKey]=changeKey,replace&&($dataOption.setKeyControl(replace,replaceKey),control[replace]=replaceKey),ConfigManager.save()}getControlSystem(){const controlType=$dataOption.getUserData("controlType");return 0===controlType?(Debug.log($dataOption.keyControl()),$dataOption.keyControl()):0!==controlType?$dataOption.xpadControl():void 0}exChangeKeyAssign(data){data=data.toUpperCase();const alphabet=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];let idx=_.findIndex(alphabet,a=>data==a);if(-1==idx){const arrows=["ARROWLEFT","ARROWRIGHT","ARROWUP","ARROWDOWN"];idx=_.findIndex(arrows,a=>data==a),-1!=idx?idx+=32:("SHIFT"==data&&(idx=48,width*=2,x-=12),"CONTROL"==data&&(idx=50,width*=2,x-=12),isNaN(+data)||(idx=+data+36))}return idx}exChangeKeyAssign2(data){const keySet=["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","R","S","T","U","V","W","X","Y","Z"];let idx=_.findIndex(keySet,a=>data==a);switch(idx){case 0:case 1:case 2:case 3:case 4:idx+=64;break;case 5:idx+=65;break;case 6:idx+=66;break;case 7:idx+=67;break;case 12:idx=34;break;case 13:idx=35;break;case 14:idx=32;break;case 15:idx=33}return idx}}class Window_OptionCaterogy extends Window_Command{constructor(x,y){super(new Rectangle(x,y,240,540))}itemHeight(){return 40}setData(category){this.clearCommandList(),this.createContents(),this._data=category,category.forEach((nameId,index)=>{this.addCommand(TextManager.getText(Number(nameId)),index)}),this.updatePlacement(),this.drawAllItems()}refresh(){this.clearCommandList(),this.createContents(),super.refresh()}updatePlacement(){this.height=this._data.length*this.itemHeight()+24}updateHelp(){const helpTextId=Number(this._data[this.index()])+1;this.setHelpWindowText(TextManager.getText(helpTextId))}drawItem(index){let category=this._list[index],rect=this.itemRect(index);this.resetTextColor(),this.changePaintOpacity(this.isCommandEnabled(index)),this.drawText(category.name,rect.x+4,rect.y,rect.width,"left")}}class Window_OptionList extends Window_Command{constructor(x,y){super(x,y)}initialize(x,y){super.initialize(new Rectangle(x,y,540,7*this.itemHeight()+24)),this._lastHitX=null,this._lastScreenMode=$dataOption.getUserData("screenMode"),this.deselect()}itemHeight(){return 40}setData(data){this.clearCommandList(),this.createContents(),this._data=data,data.forEach(option=>{const isEnable=!option.version||Number(option.version)<=$gameDefine.gameVersionNumber();this.addCommand(TextManager.getText(option.textId),option.key,isEnable)}),this.drawAllItems()}refresh(){this.clearCommandList(),this.createContents(),super.refresh()}drawItem(index){const option=this._list[index];let rect=this.itemRect(index),statusWidth=this.statusWidth(),titleWidth=rect.width-statusWidth;this.resetTextColor(),this.changePaintOpacity(this.isCommandEnabled(index)),this.drawText(option.name,rect.x+12,rect.y,titleWidth,"left"),this.drawText(this.statusText(index),titleWidth,rect.y,statusWidth,"right"),this.drawVolume(rect.x,rect.y,index)}drawVolume(x,y,index){let optionData=this._data[index],symbol=optionData.key,value=this.getConfigValue(symbol);if(optionData.type==OptionType.Volume){var color1=this.hpGaugeColor1(),color2=this.hpGaugeColor2();this.drawGauge(x+240,y-4,200,.01*value,color1,color2),this.contents.fontSize=12,this.drawText("▼",220+x+2*value,y,40,"center"),this.resetFontSettings()}}statusWidth(){return 160}statusText(index){let option=this._data[index],symbol=option.key,value=this.getConfigValue(symbol);return option.type==OptionType.Volume?this.volumeStatusText(value):option.type==OptionType.OnOff?this.booleanStatusText(value):option.type==OptionType.Other?this.otherStatusText(value,option):""}booleanStatusText(value){return value?TextManager.getText(140):TextManager.getText(150)}volumeStatusText(value){return value+TextManager.getText(300)}otherStatusText(value,option){return 0==value&&(value=0),1==value&&(value=1),null==value?"":TextManager.getText(option.otherOption[value])}option(){return this._data[this.index()]}processOk(){const option=this._data[this.index()];option.type!=OptionType.Volume&&(this.isCurrentItemEnabled()?(this.updateInputData(),this.deactivate(),this.callOkHandler()):this.playBuzzerSound())}changeValue(symbol,value){const lastValue=this.getConfigValue(symbol);lastValue!==value&&(this.setConfigValue(symbol,value),this.redrawItem(this.findSymbol(symbol)),"seVolume"==symbol&&SoundManager.playCursor())}getConfigValue(symbol){return $dataOption.getUserData(symbol)}setConfigValue(symbol,volume){$dataOption.setUserData(symbol,volume)}update(){super.update(),this.updateSlider(),this.updateScreen()}updateSlider(){if(!this.active)return;if(this.index()>=0&&this._data[this.index()]){const option=this._data[this.index()],isEnable=!option.version||Number(option.version)<=$gameDefine.gameVersionNumber();if(!isEnable)return}const x=TouchInput.x;if(x>=564&&x<=776&&TouchInput.isPressed()){let option=this._data[this.index()],symbol=option.key,value=this.getConfigValue(symbol);if(1==option.type){value=Math.ceil(100-(770-x)/2);let per=value%5;this.changeValue(symbol,value-per)}}}updateScreen(){const screenMode=$dataOption.getUserData("screenMode");this._lastScreenMode!=screenMode&&(this._lastScreenMode=screenMode,this.redrawItem(this.findSymbol("screenMode")))}updateHelp(){if(this._data[this.index()]){const option=this._data[this.index()],isEnable=!option.version||Number(option.version)<=$gameDefine.gameVersionNumber();let helpTextId=5e4;isEnable&&(helpTextId=Number(this._data[this.index()].textId)+1),this.setHelpWindowText(TextManager.getText(helpTextId))}}}class Window_OptionKeyAssign extends Window_Selectable{constructor(x,y){super(new Rectangle(x,y,540,320)),this._data=[],this.hide(),this.deactivate()}setData(keyAssign){this._data=keyAssign,this.refresh()}refresh(){this.createContents(),this.drawAllItems()}itemHeight(){return 48}maxItems(){return this._data?this._data.length:1}item(){return this._data&&this.index()>=0?this._data[this.index()]:null}isCurrentItemEnabled(){return!0}selectLast(){this.select(this.index()>=0?this.index():0)}setKeyHelpWindow(window){this._keyHelpWindow=window}maxCols(){return 2}drawItem(index){const keyData=this._data[index];let rect=this.itemRect(index),statusWidth=this.statusWidth(),titleWidth=rect.width-statusWidth;this.resetTextColor(),this.drawText(TextManager.getText(10*index+800),rect.x+4,rect.y+4,titleWidth,"left"),this.statusText(keyData,rect.x+208,rect.y+12)}statusWidth(){return 80}statusText(keyData,x,y){let width=24;68!=keyData&&70!=keyData&&72!=keyData&&74!=keyData||(width=48,x-=12);const bitmap=ImageManager.loadSystem("keyMapIcons"),pw=width,ph=24,sx=keyData%16*24,sy=24*Math.floor(keyData/16);this.contents.blt(bitmap,sx,sy,pw,24,x,y)}updateHelp(){this.setHelpWindowText(TextManager.getItemDescription(24))}}Scene_Base.prototype.initialize=function(){Stage.prototype.initialize.call(this),this._active=!1,this.createColorFilter()},Scene_Base.prototype.update=function(){0==$gamePause&&(this.updateFade(),this.updateChildren(),this.updateSwip()),this.updatePause()},Scene_Base.prototype.convertRect=function(x,y,width,height){const scaleX=Graphics.width/width,scaleY=Graphics.height/height,marginX=(Graphics.width-width)/2,marginY=(Graphics.height-height)/2;return{x:Graphics.width*x,y:Graphics.height*y}},Scene_Base.prototype.setSwipEvent=function(swipEvent){this._swipEvent=swipEvent},Scene_Base.prototype.setSwipEndEvent=function(swipEndEvent){this._swipEndEvent=swipEndEvent},Scene_Base.prototype.updateSwip=function(){if(TouchInput.isReleased()){var moveX=TouchInput.x-this._lastTouchInputX,moveY=TouchInput.y-this._lastTouchInputY;this._swipEndEvent&&this._swipEndEvent(moveX,moveY,this._lastTouchInputX,this._lastTouchInputY),this._lastTouchInputX=0,this._lastTouchInputY=0}else if(TouchInput.isMoved()){var moveX=TouchInput.x-this._lastTouchInputX,moveY=TouchInput.y-this._lastTouchInputY;0==moveX&&0==moveY||!this._swipEvent||this._swipEvent(moveX,moveY,this._lastTouchInputX,this._lastTouchInputY)}else TouchInput.isTriggered()&&(this._lastTouchInputX=TouchInput.x,this._lastTouchInputY=TouchInput.y)},Scene_Base.prototype.updatePause=function(){PopupInputManager.busy()||Input.isTriggered("pause")&&(0==$gamePause?(gsap.globalTimeline.pause(),$gamePause=!0,WebAudio._onHide(),Presenter_Pause.open()):(gsap.globalTimeline.play(),$gamePause=!1,WebAudio._onShow(),Presenter_Pause.close()))},Scene_Base.prototype.isBusy=function(){return!1},Scene_Base.prototype.showMenuPlate=function(duration,backCommand,backMenu,menuSprite){gsap.to(this._backButton._iconSprite,duration,{opacity:255,x:24}),gsap.to(this._backButton._textButton,duration,{opacity:255,x:24}),this._backButton.setup(backMenu),this._backButton.setClickHandler(backCommand),gsap.to(this._menuSprite,duration,{opacity:255,y:-8}),this.setMenuSprite(menuSprite)},Scene_Base.prototype.hideMenuPlate=function(duration){gsap.to(this._backButton._iconSprite,duration,{opacity:0,x:this._backButton._iconSprite.x+24}),gsap.to(this._backButton._textButton,duration,{opacity:0,x:this._backButton._textButton.x+24}),gsap.to(this._menuSprite,duration,{opacity:0,y:this._menuSprite.y+12})},Scene_Base.prototype.terminate=function(){gsap.globalTimeline.clear(),this._windowLayer&&this._windowLayer.destroy(),this._windowLayer=null,this._touchSpriteLayer&&(this._touchSpriteLayer.destroy(),this._touchSpriteLayer=null),this._menuPlate&&this._menuPlate.destroy(),this._backButton&&this._backButton.terminate(),this._menuSprite&&this._menuSprite.destroy(),this._menuBack&&(this._menuBack.terminate(),this._menuBack=null),this._menuPlate=null,this._menuSprite=null,this._backButton=null,this._presenter&&this._presenter.terminate()},Scene_Base.prototype.startFadeIn=function(duration,white){EventManager.startFadeIn(30)},Scene_Base.prototype.startFadeOut=function(duration,white){EventManager.startFadeOut(30)},Scene_Base.prototype.createFadeSprite=function(white){},Scene_Base.prototype.updateFade=function(){},Scene_Base.prototype.createMenuButton=function(){this._menuPlate=new Sprite,this._menuPlate.bitmap=new Bitmap(960,40),this._menuPlate.bitmap.fillRect(0,0,960,40,"black"),this._menuPlate.x=120,this._menuPlate.y=0,this._menuPlate.skew.x=-.25,this._menuPlate.opacity=128,this.addChild(this._menuPlate)},Scene_Base.prototype.createBackButton=function(handler){this._backButton=new Sprite_IconButton,this.addChild(this._backButton),this._backButton.setup(TextManager.getBackText()),this._backButton.setClickHandler(()=>{handler&&handler()})},Scene_Base.prototype.setBackSprite=function(text){this._backButton.setup(text)},Scene_Base.prototype.createMenuSprite=function(){this._menuSprite=new Sprite(new Bitmap(240,64)),this.addChild(this._menuSprite),this._menuSprite.x=128,this._menuSprite.y=-8,this._menuSprite.opacity=255},Scene_Base.prototype.setMenuSprite=function(text,fontSize){void 0===fontSize&&(fontSize=26);var bitmap=new Bitmap(240,64);bitmap.fontSize=fontSize,bitmap.drawText(text,0,0,240,60,"left"),this._menuSprite.bitmap=bitmap,this._menuSprite.visible=!0},Scene_Base.prototype.showReadyAnimation=function(okAction,index){let sprite=new Sprite_Ready;sprite.setup(okAction),this.addChildAt(sprite,index)},Scene_Base.prototype.setEvent=function(command){this._commandUpdate=command},Scene_Base.prototype.setCommand=function(command){null==this._command?this._command=[command]:this._command.push(command),this._commandUpdate()},Scene_Base.prototype.clearCommand=function(){this._command=null,TouchInput.clear()},Scene_Base.prototype.createHelpWindow=function(){const rect=this.helpWindowRect();this._helpWindow=new Window_Help(rect),this.addChild(this._helpWindow)},Scene_Base.prototype.helpWindowRect=function(){const wx=0,wy=Graphics.boxHeight-40,ww=Graphics.boxWidth,wh=40;return new Rectangle(0,wy,ww,40)},Scene_Base.prototype.loading=async function(callback){return new Promise(function(res,rej){let loop=()=>new Promise((function(resolve,reject){setTimeout((function(){resolve()}),100)})).then((function(count){callback()?res():loop()}));loop()}.bind(this)).then((function(){}))},Scene_Base.prototype.createScreenSprite=function(){this._menuBack=new Sprite_MenuBack,this.addChild(this._menuBack)},Scene_Boot.prototype.loadSystemImages=function(){ColorManager.loadWindowskin(),ImageManager.loadSystem("IconSet"),ImageManager.loadSystem("Damage"),ImageManager.loadSystem("States"),ImageManager.loadSystem("keyMapIcons"),ImageManager.loadSystem("plateA"),ImageManager.loadSystem("sabwindowF")},Scene_Boot.prototype.create=function(){Scene_Base.prototype.create.call(this),DataManager.loadDatabase(),StorageManager.updateForageKeys()},Scene_Boot.prototype.start=async function(){Scene_Base.prototype.start.call(this),SoundManager.preloadImportantSounds(),DataManager.isBattleTest()?(DataManager.setupBattleTest(),SceneManager.goto(Battle_Scene)):DataManager.isEventTest()?(DataManager.setupEventTest(),SceneManager.goto(Map_Scene)):this.startNormalGame(),this.resizeScreen(),this.updateDocumentTitle(),BackGroundManager.init(),EventManager.init(),Presenter_Loading.init(),PopupInputManager.init(),$gameCommand.menuCommand().forEach(element=>{element.iconPath&&ImageManager.loadIcon(element.iconPath)}),ImageManager.loadSystem("textplateC"),ImageManager.loadBackground("nexfan_01"),ImageManager.loadPicture("Actor0001_00_s"),ImageManager.loadPicture("Actor0002_00_s"),ImageManager.loadPicture("Actor0003_00_s"),ImageManager.loadPicture("Actor0004_00_s"),ImageManager.loadPicture("Actor0005_00_s")},Scene_Boot.prototype.startNormalGame=function(){this.checkPlayerLocation(),DataManager.setupNewGame(),SceneManager.goto(Top_Scene)},Scene_Gameover.prototype.gotoTitle=function(){SceneManager.goto(Title_Scene)},PIXI.filters.DrawActorFilter=class extends PIXI.Filter{constructor(){var fragmentSrc;super(null,"\n    precision mediump float;\n    varying vec2 vTextureCoord;\n    uniform sampler2D uSampler;\n    uniform float time;\n    uniform float element;\n\n    void main(void) {\n      vec4 color = texture2D(uSampler, vTextureCoord);\n      vec2 p = (gl_FragCoord.xy * 1.0 - (1280.0,960.0)) / min(1280.0, 960.0);\n      float f = (1.0+p.x) * p.y;\n      if (color.a > 0.1 && (f > time*4.0-1.0)){\n        if (element == 1.0){\n          color.r = 1.00 * color.a;\n          color.g = 0.50 * color.a;\n          color.b = 0.50 * color.a;\n        } else if (element == 2.0 || element == 6.0){\n          color.r = 0.90 * color.a;\n          color.g = 0.90 * color.a;\n          color.b = 0.50 * color.a;\n        } else if (element == 3.0){\n          color.r = 0.50 * color.a;\n          color.g = 0.50 * color.a;\n          color.b = 1.00 * color.a;\n        } else if (element == 4.0 || element == 7.0){\n          color.r = 0.80 * color.a;\n          color.g = 0.80 * color.a;\n          color.b = 0.80 * color.a;\n        } else if (element == 5.0){\n          color.r = 0.80 * color.a;\n          color.g = 0.50 * color.a;\n          color.b = 0.80 * color.a;\n        }\n        color.a = 0.5 * color.a;\n      }\n      gl_FragColor = color;\n    }\n  ",{time:0,element:0})}},PIXI.filters.DrawMobFilter=class extends PIXI.Filter{constructor(){var fragmentSrc;super(null,"\n    precision mediump float;\n    varying vec2 vTextureCoord;\n    uniform sampler2D uSampler;\n\n    void main(void) {\n      vec4 color = texture2D(uSampler, vTextureCoord);\n      vec2 p = (gl_FragCoord.xy * 1.0 - (640.0,640.0)) / min(640.0, 640.0);\n      if (color.a > 0.01){\n        color.r = 0.4 * color.a;\n        color.g = 0.45 * color.a;\n        color.b = 0.8 * color.a;\n        color.a *= 0.75;\n      }\n      gl_FragColor = color;\n    }\n  ",{time:0,element:0})}},PIXI.filters.MenuBackFilter=class extends PIXI.Filter{constructor(){var fragmentSrc;super(null,"\n    precision mediump float;\n    varying vec2 vTextureCoord;\n    uniform sampler2D uSampler;\n    uniform float time;\n\n    void main(void) {\n      vec4 color = texture2D(uSampler, vTextureCoord);\n      vec2 p = (gl_FragCoord.xy * 1.0 - (960.0,540.0)) / min(960.0, 540.0);\n      float f = (0.5+p.x) * (0.5+p.y);\n\n      float t = 0.25;\n      float r = abs(sin(time*t)) * 0.5 * f;\n      float g = abs(sin(time*t-1.0)) * 0.5 * f;\n      float b = abs(sin(time*t-2.0)) * 0.5 * f;\n      color.r = r;\n      color.b = b;\n      color.g = g;\n      color.a = 0.1;\n      gl_FragColor = color;\n    }\n  ",{time:{type:"1f",value:0}})}},PIXI.filters.SmokeFilter=class extends PIXI.Filter{constructor(){var fragmentSrc;super(null,"\n    precision mediump float;\n    varying vec2 vTextureCoord;\n    uniform sampler2D uSampler;\n\n        \n    uniform float time;\n    uniform vec2 resolution;\n\n    #define iTime time\n    #define iResolution vTextureCoord\n\n    //vec3 bgColor = vec3(0.01, 0.45, 1.1);\n    vec3 bgColor = vec3(1.0, 1.0, 1.0);\n    vec3 rectColor = vec3(0.01, 0.3, 1.1);\n\n    const float noiseIntensity = 2.8;\n    const float noiseDefinition = 0.6;\n    const vec2 glowPos = vec2(-2., 0.);\n\n    const float total = 30.;\n    const float minSize = 0.03;\n    const float maxSize = 0.08-minSize;\n    const float yDistribution = 0.5;\n\n    float random(vec2 co){\n      return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n  }\n  \n  float noise( in vec2 p )\n  {\n      p *= noiseIntensity;\n    \n      vec2 i = floor( p );\n      vec2 f = fract( p );\n    vec2 u = f*f*(3.0-2.0*f);\n      return mix(mix(random(i + vec2(0.0,0.0)), \n                       random(i + vec2(1.0,0.0)), u.x),\n                  mix(random(i + vec2(0.0,1.0)), \n                       random(i + vec2(1.0,1.0)), u.x), u.y);\n  }\n  \n  float fbm( in vec2 uv )\n  {\t\n    uv *= 5.0;\n      mat2 m = mat2( 1.6,  1.2, -1.2,  1.6 );\n      float f  = 0.5000*noise( uv ); uv = m*uv;\n      f += 0.2500*noise( uv ); uv = m*uv;\n      f += 0.1250*noise( uv ); uv = m*uv;\n      f += 0.0625*noise( uv ); uv = m*uv;\n      \n      f = 0.5 + 0.5 * f;\n      return f;\n  }\n  \n  vec3 bg(vec2 uv ) {\n      float velocity = iTime/1.6;\n      float intensity = sin(uv.x*3.+velocity*2.)*1.1+1.75;\n      uv.y -= 2.;\n      vec2 bp = uv+glowPos;\n      uv *= noiseDefinition;\n  \n      float rb = fbm(vec2(uv.x*.5-velocity*.03, uv.y))*.1;\n      rb = sqrt(rb); \n      uv += rb;\n  \n      //coloring\n      float rz = fbm(uv*.9+vec2(velocity*.35, 0.0));\n      rz *= dot(bp*intensity,bp)+1.2;\n  \n      vec3 col = bgColor/(.1-rz);\n      return sqrt(abs(col));\n  }\n  \n  \n  float rectangle(vec2 uv, vec2 pos, float width, float height, float blur) {\n      pos = (vec2(width, height) + .01)/3. - abs(uv - pos);\n      pos = smoothstep(0., blur , pos);\n      return pos.x * pos.y; \n     \n  }\n  \n  mat2 rotate2d(float _angle){\n      return mat2(cos(_angle),-sin(_angle),\n                  sin(_angle),cos(_angle));\n  }\n  \n  void mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n    vec2 p = (fragCoord.xy * 1.0 - (960.0,540.0)) / min(960.0, 540.0);\n      \n\n    vec2 uv = fragCoord.xy / p.xy * 2. - 1.;\n    uv.x *= p.x/p.y;\n    vec3 color = bg(p)*(2.-abs(p.y*1.00));\n    \n    float velX = -time/8.;\n    float velY = time/10.;\n    for(float i=0.; i<total; i++){\n        float index = i/total;\n        float rnd = random(vec2(index));\n        vec3 pos = vec3(0, 0., 0.);\n        pos.x = fract(velX*rnd+index)*4.-2.0;\n        pos.y = sin(index*rnd*1000.+velY) * yDistribution;\n        pos.z = maxSize*rnd+minSize;\n        vec2 uvRot = uv - pos.xy + pos.z/2.;\n    \tuvRot = rotate2d( i+time/2. ) * uvRot;\n        uvRot += pos.xy+pos.z/2.;\n        float rect = rectangle(uvRot, pos.xy, pos.z, pos.z, (maxSize+minSize-pos.z)/2.);\n\t    //color += rectColor * rect * pos.z/maxSize;\n    }\n    \n\tfragColor = vec4(color, 1.0);\n}\n\n    void main(void) {\n      mainImage(gl_FragColor, gl_FragCoord.xy);\n    }\n  ",{time:{type:"1f",value:0}})}},function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@pixi/filter-kawase-blur"),require("pixi.js")):"function"==typeof define&&define.amd?define(["exports","@pixi/filter-kawase-blur","pixi.js"],r):r((t=t||self).__filters={},t.PIXI.filters,t.PIXI)}(this,(function(t,r,i){"use strict";var e="attribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n    vTextureCoord = aTextureCoord;\r\n}",n="varying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\nuniform float alpha;\r\nuniform vec3 color;\r\nvoid main(void){\r\n    vec4 sample = texture2D(uSampler, vTextureCoord);\r\n\r\n    // Un-premultiply alpha before applying the color\r\n    if (sample.a > 0.0) {\r\n        sample.rgb /= sample.a;\r\n    }\r\n\r\n    // Premultiply alpha again\r\n    sample.rgb = color.rgb * sample.a;\r\n\r\n    // alpha user alpha\r\n    sample *= alpha;\r\n\r\n    gl_FragColor = sample;\r\n}",o=function(t){function o(o){o&&o.constructor!==Object&&(console.warn("DropShadowFilter now uses options instead of (rotation, distance, blur, color, alpha)"),o={rotation:o},void 0!==arguments[1]&&(o.distance=arguments[1]),void 0!==arguments[2]&&(o.blur=arguments[2]),void 0!==arguments[3]&&(o.color=arguments[3]),void 0!==arguments[4]&&(o.alpha=arguments[4])),o=Object.assign({rotation:45,distance:5,color:0,alpha:.5,shadowOnly:!1,kernels:null,blur:2,quality:3,pixelSize:1,resolution:i.settings.RESOLUTION},o),t.call(this);var l=o.kernels,a=o.blur,s=o.quality,u=o.pixelSize,c=o.resolution;this._tintFilter=new i.Filter(e,n),this._tintFilter.uniforms.color=new Float32Array(4),this._tintFilter.resolution=c,this._blurFilter=l?new r.KawaseBlurFilter(l):new r.KawaseBlurFilter(a,s),this.pixelSize=u,this.resolution=c,this.targetTransform=new i.Matrix;var p=o.shadowOnly,h=o.rotation,f=o.distance,d=o.alpha,g=o.color;this.shadowOnly=p,this.rotation=h,this.distance=f,this.alpha=d,this.color=g,this._updatePadding()}t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o;var l={resolution:{configurable:!0},distance:{configurable:!0},rotation:{configurable:!0},alpha:{configurable:!0},color:{configurable:!0},kernels:{configurable:!0},blur:{configurable:!0},quality:{configurable:!0},pixelSize:{configurable:!0}};return o.prototype.apply=function(t,r,i,e){var n=t.getRenderTarget();n.transform=this.targetTransform,this._tintFilter.apply(t,r,n,!0),n.transform=null,this._blurFilter.apply(t,n,i,e),!0!==this.shadowOnly&&t.applyFilter(this,r,i,!1),t.returnRenderTarget(n)},o.prototype._updatePadding=function(){this.padding=this.distance+2*this.blur},o.prototype._updateTargetTransform=function(){this.targetTransform.tx=this.distance*Math.cos(this.angle),this.targetTransform.ty=this.distance*Math.sin(this.angle)},l.resolution.get=function(){return this._resolution},l.resolution.set=function(t){this._resolution=t,this._tintFilter&&(this._tintFilter.resolution=t),this._blurFilter&&(this._blurFilter.resolution=t)},l.distance.get=function(){return this._distance},l.distance.set=function(t){this._distance=t,this._updatePadding(),this._updateTargetTransform()},l.rotation.get=function(){return this.angle/i.DEG_TO_RAD},l.rotation.set=function(t){this.angle=t*i.DEG_TO_RAD,this._updateTargetTransform()},l.alpha.get=function(){return this._tintFilter.uniforms.alpha},l.alpha.set=function(t){this._tintFilter.uniforms.alpha=t},l.color.get=function(){return i.utils.rgb2hex(this._tintFilter.uniforms.color)},l.color.set=function(t){i.utils.hex2rgb(t,this._tintFilter.uniforms.color)},l.kernels.get=function(){return this._blurFilter.kernels},l.kernels.set=function(t){this._blurFilter.kernels=t},l.blur.get=function(){return this._blurFilter.blur},l.blur.set=function(t){this._blurFilter.blur=t,this._updatePadding()},l.quality.get=function(){return this._blurFilter.quality},l.quality.set=function(t){this._blurFilter.quality=t},l.pixelSize.get=function(){return this._blurFilter.pixelSize},l.pixelSize.set=function(t){this._blurFilter.pixelSize=t},Object.defineProperties(o.prototype,l),o}(i.Filter);t.DropShadowFilter=o,Object.defineProperty(t,"__esModule",{value:!0})})),Object.assign(PIXI.filters,this?this.__filters:__filters),function(r,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("pixi.js")):"function"==typeof define&&define.amd?define(["exports","pixi.js"],t):t((r=r||self).__filters={},r.PIXI)}(this,(function(r,t){"use strict";var n="attribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n    vTextureCoord = aTextureCoord;\r\n}",e="varying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\nuniform float gamma;\r\nuniform float contrast;\r\nuniform float saturation;\r\nuniform float brightness;\r\nuniform float red;\r\nuniform float green;\r\nuniform float blue;\r\nuniform float alpha;\r\n\r\nvoid main(void)\r\n{\r\n    vec4 c = texture2D(uSampler, vTextureCoord);\r\n\r\n    if (c.a > 0.0) {\r\n        c.rgb /= c.a;\r\n\r\n        vec3 rgb = pow(c.rgb, vec3(1. / gamma));\r\n        rgb = mix(vec3(.5), mix(vec3(dot(vec3(.2125, .7154, .0721), rgb)), rgb, saturation), contrast);\r\n        rgb.r *= red;\r\n        rgb.g *= green;\r\n        rgb.b *= blue;\r\n        c.rgb = rgb * brightness;\r\n\r\n        c.rgb *= c.a;\r\n    }\r\n\r\n    gl_FragColor = c * alpha;\r\n}\r\n",i=function(r){function t(t){r.call(this,n,e),Object.assign(this,{gamma:1,saturation:1,contrast:1,brightness:1,red:1,green:1,blue:1,alpha:1},t)}return r&&(t.__proto__=r),t.prototype=Object.create(r&&r.prototype),t.prototype.constructor=t,t.prototype.apply=function(r,t,n,e){this.uniforms.gamma=Math.max(this.gamma,1e-4),this.uniforms.saturation=this.saturation,this.uniforms.contrast=this.contrast,this.uniforms.brightness=this.brightness,this.uniforms.red=this.red,this.uniforms.green=this.green,this.uniforms.blue=this.blue,this.uniforms.alpha=this.alpha,r.applyFilter(this,t,n,e)},t}(t.Filter);r.AdjustmentFilter=i,Object.defineProperty(r,"__esModule",{value:!0})})),Object.assign(PIXI.filters,this?this.__filters:__filters);
/*!
 * @pixi/filter-old-film - v3.1.1
 * Compiled Fri, 07 Aug 2020 13:37:30 UTC
 *
 * @pixi/filter-old-film is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
var __filters=function(r,n){"use strict";var t="attribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n    vTextureCoord = aTextureCoord;\r\n}",i="varying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\nuniform vec4 filterArea;\r\nuniform vec2 dimensions;\r\n\r\nuniform float sepia;\r\nuniform float noise;\r\nuniform float noiseSize;\r\nuniform float scratch;\r\nuniform float scratchDensity;\r\nuniform float scratchWidth;\r\nuniform float vignetting;\r\nuniform float vignettingAlpha;\r\nuniform float vignettingBlur;\r\nuniform float seed;\r\n\r\nconst float SQRT_2 = 1.414213;\r\nconst vec3 SEPIA_RGB = vec3(112.0 / 255.0, 66.0 / 255.0, 20.0 / 255.0);\r\n\r\nfloat rand(vec2 co) {\r\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\r\n}\r\n\r\nvec3 Overlay(vec3 src, vec3 dst)\r\n{\r\n    // if (dst <= 0.5) then: 2 * src * dst\r\n    // if (dst > 0.5) then: 1 - 2 * (1 - dst) * (1 - src)\r\n    return vec3((dst.x <= 0.5) ? (2.0 * src.x * dst.x) : (1.0 - 2.0 * (1.0 - dst.x) * (1.0 - src.x)),\r\n                (dst.y <= 0.5) ? (2.0 * src.y * dst.y) : (1.0 - 2.0 * (1.0 - dst.y) * (1.0 - src.y)),\r\n                (dst.z <= 0.5) ? (2.0 * src.z * dst.z) : (1.0 - 2.0 * (1.0 - dst.z) * (1.0 - src.z)));\r\n}\r\n\r\n\r\nvoid main()\r\n{\r\n    gl_FragColor = texture2D(uSampler, vTextureCoord);\r\n    vec3 color = gl_FragColor.rgb;\r\n\r\n    if (sepia > 0.0)\r\n    {\r\n        float gray = (color.x + color.y + color.z) / 3.0;\r\n        vec3 grayscale = vec3(gray);\r\n\r\n        color = Overlay(SEPIA_RGB, grayscale);\r\n\r\n        color = grayscale + sepia * (color - grayscale);\r\n    }\r\n\r\n    vec2 coord = vTextureCoord * filterArea.xy / dimensions.xy;\r\n\r\n    if (vignetting > 0.0)\r\n    {\r\n        float outter = SQRT_2 - vignetting * SQRT_2;\r\n        vec2 dir = vec2(vec2(0.5, 0.5) - coord);\r\n        dir.y *= dimensions.y / dimensions.x;\r\n        float darker = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + vignettingBlur * SQRT_2), 0.0, 1.0);\r\n        color.rgb *= darker + (1.0 - darker) * (1.0 - vignettingAlpha);\r\n    }\r\n\r\n    if (scratchDensity > seed && scratch != 0.0)\r\n    {\r\n        float phase = seed * 256.0;\r\n        float s = mod(floor(phase), 2.0);\r\n        float dist = 1.0 / scratchDensity;\r\n        float d = distance(coord, vec2(seed * dist, abs(s - seed * dist)));\r\n        if (d < seed * 0.6 + 0.4)\r\n        {\r\n            highp float period = scratchDensity * 10.0;\r\n\r\n            float xx = coord.x * period + phase;\r\n            float aa = abs(mod(xx, 0.5) * 4.0);\r\n            float bb = mod(floor(xx / 0.5), 2.0);\r\n            float yy = (1.0 - bb) * aa + bb * (2.0 - aa);\r\n\r\n            float kk = 2.0 * period;\r\n            float dw = scratchWidth / dimensions.x * (0.75 + seed);\r\n            float dh = dw * kk;\r\n\r\n            float tine = (yy - (2.0 - dh));\r\n\r\n            if (tine > 0.0) {\r\n                float _sign = sign(scratch);\r\n\r\n                tine = s * tine / period + scratch + 0.1;\r\n                tine = clamp(tine + 1.0, 0.5 + _sign * 0.5, 1.5 + _sign * 0.5);\r\n\r\n                color.rgb *= tine;\r\n            }\r\n        }\r\n    }\r\n\r\n    if (noise > 0.0 && noiseSize > 0.0)\r\n    {\r\n        vec2 pixelCoord = vTextureCoord.xy * filterArea.xy;\r\n        pixelCoord.x = floor(pixelCoord.x / noiseSize);\r\n        pixelCoord.y = floor(pixelCoord.y / noiseSize);\r\n        // vec2 d = pixelCoord * noiseSize * vec2(1024.0 + seed * 512.0, 1024.0 - seed * 512.0);\r\n        // float _noise = snoise(d) * 0.5;\r\n        float _noise = rand(pixelCoord * noiseSize * seed) - 0.5;\r\n        color += _noise * noise;\r\n    }\r\n\r\n    gl_FragColor.rgb = color;\r\n}\r\n",e=function(r){function n(n,e){void 0===e&&(e=0),r.call(this,t,i),this.uniforms.dimensions=new Float32Array(2),"number"==typeof n?(this.seed=n,n=null):this.seed=e,Object.assign(this,{sepia:.3,noise:.3,noiseSize:1,scratch:.5,scratchDensity:.3,scratchWidth:1,vignetting:.3,vignettingAlpha:1,vignettingBlur:.3},n)}r&&(n.__proto__=r),n.prototype=Object.create(r&&r.prototype),n.prototype.constructor=n;var e={sepia:{configurable:!0},noise:{configurable:!0},noiseSize:{configurable:!0},scratch:{configurable:!0},scratchDensity:{configurable:!0},scratchWidth:{configurable:!0},vignetting:{configurable:!0},vignettingAlpha:{configurable:!0},vignettingBlur:{configurable:!0}};return n.prototype.apply=function(r,n,t,i){this.uniforms.dimensions[0]=n.filterFrame.width,this.uniforms.dimensions[1]=n.filterFrame.height,this.uniforms.seed=this.seed,r.applyFilter(this,n,t,i)},e.sepia.set=function(r){this.uniforms.sepia=r},e.sepia.get=function(){return this.uniforms.sepia},e.noise.set=function(r){this.uniforms.noise=r},e.noise.get=function(){return this.uniforms.noise},e.noiseSize.set=function(r){this.uniforms.noiseSize=r},e.noiseSize.get=function(){return this.uniforms.noiseSize},e.scratch.set=function(r){this.uniforms.scratch=r},e.scratch.get=function(){return this.uniforms.scratch},e.scratchDensity.set=function(r){this.uniforms.scratchDensity=r},e.scratchDensity.get=function(){return this.uniforms.scratchDensity},e.scratchWidth.set=function(r){this.uniforms.scratchWidth=r},e.scratchWidth.get=function(){return this.uniforms.scratchWidth},e.vignetting.set=function(r){this.uniforms.vignetting=r},e.vignetting.get=function(){return this.uniforms.vignetting},e.vignettingAlpha.set=function(r){this.uniforms.vignettingAlpha=r},e.vignettingAlpha.get=function(){return this.uniforms.vignettingAlpha},e.vignettingBlur.set=function(r){this.uniforms.vignettingBlur=r},e.vignettingBlur.get=function(){return this.uniforms.vignettingBlur},Object.defineProperties(n.prototype,e),n}(n.Filter);return r.OldFilmFilter=e,r}({},PIXI);Object.assign(PIXI.filters,__filters),function(r,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("pixi.js")):"function"==typeof define&&define.amd?define(["exports","pixi.js"],e):e((r=r||self).__filters={},r.PIXI)}(this,(function(r,e){"use strict";var n="attribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n    vTextureCoord = aTextureCoord;\r\n}",o="varying vec2 vTextureCoord;\r\n\r\nuniform vec4 filterArea;\r\nuniform float pixelSize;\r\nuniform sampler2D uSampler;\r\n\r\nvec2 mapCoord( vec2 coord )\r\n{\r\n    coord *= filterArea.xy;\r\n    coord += filterArea.zw;\r\n\r\n    return coord;\r\n}\r\n\r\nvec2 unmapCoord( vec2 coord )\r\n{\r\n    coord -= filterArea.zw;\r\n    coord /= filterArea.xy;\r\n\r\n    return coord;\r\n}\r\n\r\nvec2 pixelate(vec2 coord, vec2 size)\r\n{\r\n    return floor( coord / size ) * size;\r\n}\r\n\r\nvec2 getMod(vec2 coord, vec2 size)\r\n{\r\n    return mod( coord , size) / size;\r\n}\r\n\r\nfloat character(float n, vec2 p)\r\n{\r\n    p = floor(p*vec2(4.0, -4.0) + 2.5);\r\n    if (clamp(p.x, 0.0, 4.0) == p.x && clamp(p.y, 0.0, 4.0) == p.y)\r\n    {\r\n        if (int(mod(n/exp2(p.x + 5.0*p.y), 2.0)) == 1) return 1.0;\r\n    }\r\n    return 0.0;\r\n}\r\n\r\nvoid main()\r\n{\r\n    vec2 coord = mapCoord(vTextureCoord);\r\n\r\n    // get the rounded color..\r\n    vec2 pixCoord = pixelate(coord, vec2(pixelSize));\r\n    pixCoord = unmapCoord(pixCoord);\r\n\r\n    vec4 color = texture2D(uSampler, pixCoord);\r\n\r\n    // determine the character to use\r\n    float gray = (color.r + color.g + color.b) / 3.0;\r\n\r\n    float n =  65536.0;             // .\r\n    if (gray > 0.2) n = 65600.0;    // :\r\n    if (gray > 0.3) n = 332772.0;   // *\r\n    if (gray > 0.4) n = 15255086.0; // o\r\n    if (gray > 0.5) n = 23385164.0; // &\r\n    if (gray > 0.6) n = 15252014.0; // 8\r\n    if (gray > 0.7) n = 13199452.0; // @\r\n    if (gray > 0.8) n = 11512810.0; // #\r\n\r\n    // get the mod..\r\n    vec2 modd = getMod(coord, vec2(pixelSize));\r\n\r\n    gl_FragColor = color * character( n, vec2(-1.0) + modd * 2.0);\r\n\r\n}",t=function(r){function e(e){void 0===e&&(e=8),r.call(this,n,o),this.size=e}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={size:{configurable:!0}};return t.size.get=function(){return this.uniforms.pixelSize},t.size.set=function(r){this.uniforms.pixelSize=r},Object.defineProperties(e.prototype,t),e}(e.Filter);r.AsciiFilter=t,Object.defineProperty(r,"__esModule",{value:!0})})),Object.assign(PIXI.filters,this?this.__filters:__filters);
/*!
 * @pixi/filter-glow - v3.1.1
 * Compiled Fri, 07 Aug 2020 13:37:30 UTC
 *
 * @pixi/filter-glow is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
var __filters=function(r,n,o){"use strict";var t="attribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n    vTextureCoord = aTextureCoord;\r\n}",e="varying vec2 vTextureCoord;\r\nvarying vec4 vColor;\r\n\r\nuniform sampler2D uSampler;\r\n\r\nuniform float outerStrength;\r\nuniform float innerStrength;\r\n\r\nuniform vec4 glowColor;\r\n\r\nuniform vec4 filterArea;\r\nuniform vec4 filterClamp;\r\nuniform bool knockout;\r\n\r\nconst float PI = 3.14159265358979323846264;\r\n\r\nconst float DIST = __DIST__;\r\nconst float ANGLE_STEP_SIZE = min(__ANGLE_STEP_SIZE__, PI * 2.0);\r\nconst float ANGLE_STEP_NUM = ceil(PI * 2.0 / ANGLE_STEP_SIZE);\r\n\r\nconst float MAX_TOTAL_ALPHA = ANGLE_STEP_NUM * DIST * (DIST + 1.0) / 2.0;\r\n\r\nvoid main(void) {\r\n    vec2 px = vec2(1.0 / filterArea.x, 1.0 / filterArea.y);\r\n\r\n    float totalAlpha = 0.0;\r\n\r\n    vec2 direction;\r\n    vec2 displaced;\r\n    vec4 curColor;\r\n\r\n    for (float angle = 0.0; angle < PI * 2.0; angle += ANGLE_STEP_SIZE) {\r\n       direction = vec2(cos(angle), sin(angle)) * px;\r\n\r\n       for (float curDistance = 0.0; curDistance < DIST; curDistance++) {\r\n           displaced = clamp(vTextureCoord + direction * \r\n                   (curDistance + 1.0), filterClamp.xy, filterClamp.zw);\r\n\r\n           curColor = texture2D(uSampler, displaced);\r\n\r\n           totalAlpha += (DIST - curDistance) * curColor.a;\r\n       }\r\n    }\r\n    \r\n    curColor = texture2D(uSampler, vTextureCoord);\r\n\r\n    float alphaRatio = (totalAlpha / MAX_TOTAL_ALPHA);\r\n\r\n    float innerGlowAlpha = (1.0 - alphaRatio) * innerStrength * curColor.a;\r\n    float innerGlowStrength = min(1.0, innerGlowAlpha);\r\n    \r\n    vec4 innerColor = mix(curColor, glowColor, innerGlowStrength);\r\n\r\n    float outerGlowAlpha = alphaRatio * outerStrength * (1. - curColor.a);\r\n    float outerGlowStrength = min(1.0 - innerColor.a, outerGlowAlpha);\r\n\r\n    vec4 outerGlowColor = outerGlowStrength * glowColor.rgba;\r\n    \r\n    if (knockout) {\r\n      float resultAlpha = outerGlowAlpha + innerGlowAlpha;\r\n      gl_FragColor = vec4(glowColor.rgb * resultAlpha, resultAlpha);\r\n    }\r\n    else {\r\n      gl_FragColor = innerColor + outerGlowColor;\r\n    }\r\n}\r\n",i=function(r){function n(o){var i=Object.assign({},n.defaults,o),l=i.distance,a=i.outerStrength,u=i.innerStrength,c=i.color,s=i.knockout,f=i.quality;l=Math.round(l),r.call(this,t,e.replace(/__ANGLE_STEP_SIZE__/gi,""+(1/f/l).toFixed(7)).replace(/__DIST__/gi,l.toFixed(0)+".0")),this.uniforms.glowColor=new Float32Array([0,0,0,1]),Object.assign(this,{color:c,outerStrength:a,innerStrength:u,padding:l,knockout:s})}r&&(n.__proto__=r),n.prototype=Object.create(r&&r.prototype),n.prototype.constructor=n;var i={color:{configurable:!0},outerStrength:{configurable:!0},innerStrength:{configurable:!0},knockout:{configurable:!0}};return i.color.get=function(){return o.rgb2hex(this.uniforms.glowColor)},i.color.set=function(r){o.hex2rgb(r,this.uniforms.glowColor)},i.outerStrength.get=function(){return this.uniforms.outerStrength},i.outerStrength.set=function(r){this.uniforms.outerStrength=r},i.innerStrength.get=function(){return this.uniforms.innerStrength},i.innerStrength.set=function(r){this.uniforms.innerStrength=r},i.knockout.get=function(){return this.uniforms.knockout},i.knockout.set=function(r){this.uniforms.knockout=r},Object.defineProperties(n.prototype,i),n}(n.Filter);return i.defaults={distance:10,outerStrength:4,innerStrength:0,color:16777215,quality:.1,knockout:!1},r.GlowFilter=i,r}({},PIXI,PIXI.utils);Object.assign(PIXI.filters,__filters),function(r,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("pixi.js")):"function"==typeof define&&define.amd?define(["exports","pixi.js"],n):n((r=r||self).__filters={},r.PIXI)}(this,(function(r,n){"use strict";var e="attribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n    vTextureCoord = aTextureCoord;\r\n}",t="vec3 mod289(vec3 x)\r\n{\r\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\r\n}\r\nvec4 mod289(vec4 x)\r\n{\r\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\r\n}\r\nvec4 permute(vec4 x)\r\n{\r\n    return mod289(((x * 34.0) + 1.0) * x);\r\n}\r\nvec4 taylorInvSqrt(vec4 r)\r\n{\r\n    return 1.79284291400159 - 0.85373472095314 * r;\r\n}\r\nvec3 fade(vec3 t)\r\n{\r\n    return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);\r\n}\r\n// Classic Perlin noise, periodic variant\r\nfloat pnoise(vec3 P, vec3 rep)\r\n{\r\n    vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period\r\n    vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period\r\n    Pi0 = mod289(Pi0);\r\n    Pi1 = mod289(Pi1);\r\n    vec3 Pf0 = fract(P); // Fractional part for interpolation\r\n    vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\r\n    vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\r\n    vec4 iy = vec4(Pi0.yy, Pi1.yy);\r\n    vec4 iz0 = Pi0.zzzz;\r\n    vec4 iz1 = Pi1.zzzz;\r\n    vec4 ixy = permute(permute(ix) + iy);\r\n    vec4 ixy0 = permute(ixy + iz0);\r\n    vec4 ixy1 = permute(ixy + iz1);\r\n    vec4 gx0 = ixy0 * (1.0 / 7.0);\r\n    vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\r\n    gx0 = fract(gx0);\r\n    vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\r\n    vec4 sz0 = step(gz0, vec4(0.0));\r\n    gx0 -= sz0 * (step(0.0, gx0) - 0.5);\r\n    gy0 -= sz0 * (step(0.0, gy0) - 0.5);\r\n    vec4 gx1 = ixy1 * (1.0 / 7.0);\r\n    vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\r\n    gx1 = fract(gx1);\r\n    vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\r\n    vec4 sz1 = step(gz1, vec4(0.0));\r\n    gx1 -= sz1 * (step(0.0, gx1) - 0.5);\r\n    gy1 -= sz1 * (step(0.0, gy1) - 0.5);\r\n    vec3 g000 = vec3(gx0.x, gy0.x, gz0.x);\r\n    vec3 g100 = vec3(gx0.y, gy0.y, gz0.y);\r\n    vec3 g010 = vec3(gx0.z, gy0.z, gz0.z);\r\n    vec3 g110 = vec3(gx0.w, gy0.w, gz0.w);\r\n    vec3 g001 = vec3(gx1.x, gy1.x, gz1.x);\r\n    vec3 g101 = vec3(gx1.y, gy1.y, gz1.y);\r\n    vec3 g011 = vec3(gx1.z, gy1.z, gz1.z);\r\n    vec3 g111 = vec3(gx1.w, gy1.w, gz1.w);\r\n    vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\r\n    g000 *= norm0.x;\r\n    g010 *= norm0.y;\r\n    g100 *= norm0.z;\r\n    g110 *= norm0.w;\r\n    vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\r\n    g001 *= norm1.x;\r\n    g011 *= norm1.y;\r\n    g101 *= norm1.z;\r\n    g111 *= norm1.w;\r\n    float n000 = dot(g000, Pf0);\r\n    float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\r\n    float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\r\n    float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\r\n    float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\r\n    float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\r\n    float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\r\n    float n111 = dot(g111, Pf1);\r\n    vec3 fade_xyz = fade(Pf0);\r\n    vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\r\n    vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\r\n    float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\r\n    return 2.2 * n_xyz;\r\n}\r\nfloat turb(vec3 P, vec3 rep, float lacunarity, float gain)\r\n{\r\n    float sum = 0.0;\r\n    float sc = 1.0;\r\n    float totalgain = 1.0;\r\n    for (float i = 0.0; i < 6.0; i++)\r\n    {\r\n        sum += totalgain * pnoise(P * sc, rep);\r\n        sc *= lacunarity;\r\n        totalgain *= gain;\r\n    }\r\n    return abs(sum);\r\n}\r\n",i="varying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\nuniform vec4 filterArea;\r\nuniform vec2 dimensions;\r\n\r\nuniform vec2 light;\r\nuniform bool parallel;\r\nuniform float aspect;\r\n\r\nuniform float gain;\r\nuniform float lacunarity;\r\nuniform float time;\r\n\r\n${perlin}\r\n\r\nvoid main(void) {\r\n    vec2 coord = vTextureCoord * filterArea.xy / dimensions.xy;\r\n\r\n    float d;\r\n\r\n    if (parallel) {\r\n        float _cos = light.x;\r\n        float _sin = light.y;\r\n        d = (_cos * coord.x) + (_sin * coord.y * aspect);\r\n    } else {\r\n        float dx = coord.x - light.x / dimensions.x;\r\n        float dy = (coord.y - light.y / dimensions.y) * aspect;\r\n        float dis = sqrt(dx * dx + dy * dy) + 0.00001;\r\n        d = dy / dis;\r\n    }\r\n\r\n    vec3 dir = vec3(d, d, 0.0);\r\n\r\n    float noise = turb(dir + vec3(time, 0.0, 62.1 + time) * 0.05, vec3(480.0, 320.0, 480.0), lacunarity, gain);\r\n    noise = mix(noise, 0.0, 0.3);\r\n    //fade vertically.\r\n    vec4 mist = vec4(noise, noise, noise, 1.0) * (1.0 - coord.y);\r\n    mist.a = 1.0;\r\n\r\n    gl_FragColor = texture2D(uSampler, vTextureCoord) + mist;\r\n}\r\n",o=function(r){function o(o){r.call(this,e,i.replace("${perlin}",t)),this.uniforms.dimensions=new Float32Array(2),"number"==typeof o&&(console.warn("GodrayFilter now uses options instead of (angle, gain, lacunarity, time)"),o={angle:o},void 0!==arguments[1]&&(o.gain=arguments[1]),void 0!==arguments[2]&&(o.lacunarity=arguments[2]),void 0!==arguments[3]&&(o.time=arguments[3])),o=Object.assign({angle:30,gain:.5,lacunarity:2.5,time:0,parallel:!0,center:[0,0]},o),this._angleLight=new n.Point,this.angle=o.angle,this.gain=o.gain,this.lacunarity=o.lacunarity,this.parallel=o.parallel,this.center=o.center,this.time=o.time}r&&(o.__proto__=r),o.prototype=Object.create(r&&r.prototype),o.prototype.constructor=o;var a={angle:{configurable:!0},gain:{configurable:!0},lacunarity:{configurable:!0}};return o.prototype.apply=function(r,n,e,t){var i=n.sourceFrame,o=i.width,a=i.height;this.uniforms.light=this.parallel?this._angleLight:this.center,this.uniforms.parallel=this.parallel,this.uniforms.dimensions[0]=o,this.uniforms.dimensions[1]=a,this.uniforms.aspect=a/o,this.uniforms.time=this.time,r.applyFilter(this,n,e,t)},a.angle.get=function(){return this._angle},a.angle.set=function(r){this._angle=r;var e=r*n.DEG_TO_RAD;this._angleLight.x=Math.cos(e),this._angleLight.y=Math.sin(e)},a.gain.get=function(){return this.uniforms.gain},a.gain.set=function(r){this.uniforms.gain=r},a.lacunarity.get=function(){return this.uniforms.lacunarity},a.lacunarity.set=function(r){this.uniforms.lacunarity=r},Object.defineProperties(o.prototype,a),o}(n.Filter);r.GodrayFilter=o,Object.defineProperty(r,"__esModule",{value:!0})})),Object.assign(PIXI.filters,this?this.__filters:__filters),function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("pixi.js")):"function"==typeof define&&define.amd?define(["exports","pixi.js"],e):e(n.__filters={},n.PIXI)}(this,(function(n,e){"use strict";var t="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",r="varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\n\nuniform vec2 uCenter;\nuniform float uStrength;\nuniform float uInnerRadius;\nuniform float uRadius;\n\nconst float MAX_KERNEL_SIZE = 32.0;\n\nfloat random(vec3 scale, float seed) {\n    // use the fragment position for a different seed per-pixel\n    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n\nvoid main() {\n\n    float minGradient = uInnerRadius * 0.3;\n    float innerRadius = (uInnerRadius + minGradient * 0.5) / filterArea.x;\n\n    float gradient = uRadius * 0.3;\n    float radius = (uRadius - gradient * 0.5) / filterArea.x;\n\n    float countLimit = MAX_KERNEL_SIZE;\n\n    vec2 dir = vec2(uCenter.xy / filterArea.xy - vTextureCoord);\n    float dist = length(vec2(dir.x, dir.y * filterArea.y / filterArea.x));\n\n    float strength = uStrength;\n\n    float delta = 0.0;\n    float gap;\n    if (dist < innerRadius) {\n        delta = innerRadius - dist;\n        gap = minGradient;\n    } else if (radius >= 0.0 && dist > radius) { // radius < 0 means it's infinity\n        delta = dist - radius;\n        gap = gradient;\n    }\n\n    if (delta > 0.0) {\n        float normalCount = gap / filterArea.x;\n        delta = (normalCount - delta) / normalCount;\n        countLimit *= delta;\n        strength *= delta;\n        if (countLimit < 1.0)\n        {\n            gl_FragColor = texture2D(uSampler, vTextureCoord);\n            return;\n        }\n    }\n\n    // randomize the lookup values to hide the fixed number of samples\n    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n\n    float total = 0.0;\n    vec4 color = vec4(0.0);\n\n    dir *= strength;\n\n    for (float t = 0.0; t < MAX_KERNEL_SIZE; t++) {\n        float percent = (t + offset) / MAX_KERNEL_SIZE;\n        float weight = 4.0 * (percent - percent * percent);\n        vec2 p = vTextureCoord + dir * percent;\n        vec4 sample = texture2D(uSampler, p);\n\n        // switch to pre-multiplied alpha to correctly blur transparent images\n        // sample.rgb *= sample.a;\n\n        color += sample * weight;\n        total += weight;\n\n        if (t > countLimit){\n            break;\n        }\n    }\n\n    color /= total;\n    // switch back from pre-multiplied alpha\n    color.rgb /= color.a + 0.00001;\n\n    gl_FragColor = color;\n}\n",i=function(n){function e(e,i,o,a){void 0===e&&(e=.1),void 0===i&&(i=[0,0]),void 0===o&&(o=0),void 0===a&&(a=-1),n.call(this,t,r),this.center=i,this.strength=e,this.innerRadius=o,this.radius=a}n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e;var i={center:{configurable:!0},strength:{configurable:!0},innerRadius:{configurable:!0},radius:{configurable:!0}};return i.center.get=function(){return this.uniforms.uCenter},i.center.set=function(n){this.uniforms.uCenter=n},i.strength.get=function(){return this.uniforms.uStrength},i.strength.set=function(n){this.uniforms.uStrength=n},i.innerRadius.get=function(){return this.uniforms.uInnerRadius},i.innerRadius.set=function(n){this.uniforms.uInnerRadius=n},i.radius.get=function(){return this.uniforms.uRadius},i.radius.set=function(n){(n<0||n===1/0)&&(n=-1),this.uniforms.uRadius=n},Object.defineProperties(e.prototype,i),e}(e.Filter);n.ZoomBlurFilter=i,Object.defineProperty(n,"__esModule",{value:!0})})),Object.assign(PIXI.filters,this?this.__filters:__filters),function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("pixi.js")):"function"==typeof define&&define.amd?define(["exports","pixi.js"],r):r((e=e||self).__filters={},e.PIXI)}(this,(function(e,r){"use strict";var t="attribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n    vTextureCoord = aTextureCoord;\r\n}",i="\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\nuniform vec2 uOffset;\r\n\r\nvoid main(void)\r\n{\r\n    vec4 color = vec4(0.0);\r\n\r\n    // Sample top left pixel\r\n    color += texture2D(uSampler, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y));\r\n\r\n    // Sample top right pixel\r\n    color += texture2D(uSampler, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y));\r\n\r\n    // Sample bottom right pixel\r\n    color += texture2D(uSampler, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y));\r\n\r\n    // Sample bottom left pixel\r\n    color += texture2D(uSampler, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y));\r\n\r\n    // Average\r\n    color *= 0.25;\r\n\r\n    gl_FragColor = color;\r\n}",o="\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\nuniform vec2 uOffset;\r\nuniform vec4 filterClamp;\r\n\r\nvoid main(void)\r\n{\r\n    vec4 color = vec4(0.0);\r\n\r\n    // Sample top left pixel\r\n    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y), filterClamp.xy, filterClamp.zw));\r\n\r\n    // Sample top right pixel\r\n    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y), filterClamp.xy, filterClamp.zw));\r\n\r\n    // Sample bottom right pixel\r\n    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y), filterClamp.xy, filterClamp.zw));\r\n\r\n    // Sample bottom left pixel\r\n    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y), filterClamp.xy, filterClamp.zw));\r\n\r\n    // Average\r\n    color *= 0.25;\r\n\r\n    gl_FragColor = color;\r\n}\r\n",n=function(e){function n(n,l,u){void 0===n&&(n=4),void 0===l&&(l=3),void 0===u&&(u=!1),e.call(this,t,u?o:i),this.uniforms.uOffset=new Float32Array(2),this._pixelSize=new r.Point,this.pixelSize=1,this._clamp=u,this._kernels=null,Array.isArray(n)?this.kernels=n:(this._blur=n,this.quality=l)}e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n;var l={kernels:{configurable:!0},clamp:{configurable:!0},pixelSize:{configurable:!0},quality:{configurable:!0},blur:{configurable:!0}};return n.prototype.apply=function(e,r,t,i){var o,n=this.pixelSize.x/r.size.width,l=this.pixelSize.y/r.size.height;if(1===this._quality||0===this._blur)o=this._kernels[0]+.5,this.uniforms.uOffset[0]=o*n,this.uniforms.uOffset[1]=o*l,e.applyFilter(this,r,t,i);else{for(var u,s=e.getRenderTarget(!0),f=r,a=s,p=this._quality-1,x=0;x<p;x++)o=this._kernels[x]+.5,this.uniforms.uOffset[0]=o*n,this.uniforms.uOffset[1]=o*l,e.applyFilter(this,f,a,!0),u=f,f=a,a=u;o=this._kernels[p]+.5,this.uniforms.uOffset[0]=o*n,this.uniforms.uOffset[1]=o*l,e.applyFilter(this,f,t,i),e.returnRenderTarget(s)}},n.prototype._generateKernels=function(){var e=this._blur,r=this._quality,t=[e];if(e>0)for(var i=e,o=e/r,n=1;n<r;n++)i-=o,t.push(i);this._kernels=t},l.kernels.get=function(){return this._kernels},l.kernels.set=function(e){Array.isArray(e)&&e.length>0?(this._kernels=e,this._quality=e.length,this._blur=Math.max.apply(Math,e)):(this._kernels=[0],this._quality=1)},l.clamp.get=function(){return this._clamp},l.pixelSize.set=function(e){"number"==typeof e?(this._pixelSize.x=e,this._pixelSize.y=e):Array.isArray(e)?(this._pixelSize.x=e[0],this._pixelSize.y=e[1]):e instanceof r.Point?(this._pixelSize.x=e.x,this._pixelSize.y=e.y):(this._pixelSize.x=1,this._pixelSize.y=1)},l.pixelSize.get=function(){return this._pixelSize},l.quality.get=function(){return this._quality},l.quality.set=function(e){this._quality=Math.max(1,Math.round(e)),this._generateKernels()},l.blur.get=function(){return this._blur},l.blur.set=function(e){this._blur=e,this._generateKernels()},Object.defineProperties(n.prototype,l),n}(r.Filter);e.KawaseBlurFilter=n,Object.defineProperty(e,"__esModule",{value:!0})})),Object.assign(PIXI.filters,this?this.__filters:__filters);
/*!
 * @pixi/filter-shockwave - v3.1.1
 * Compiled Fri, 07 Aug 2020 13:37:30 UTC
 *
 * @pixi/filter-shockwave is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
var __filters=function(r,e){"use strict";var t="attribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n    vTextureCoord = aTextureCoord;\r\n}",n="varying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\nuniform vec4 filterArea;\r\nuniform vec4 filterClamp;\r\n\r\nuniform vec2 center;\r\n\r\nuniform float amplitude;\r\nuniform float wavelength;\r\n// uniform float power;\r\nuniform float brightness;\r\nuniform float speed;\r\nuniform float radius;\r\n\r\nuniform float time;\r\n\r\nconst float PI = 3.14159;\r\n\r\nvoid main()\r\n{\r\n    float halfWavelength = wavelength * 0.5 / filterArea.x;\r\n    float maxRadius = radius / filterArea.x;\r\n    float currentRadius = time * speed / filterArea.x;\r\n\r\n    float fade = 1.0;\r\n\r\n    if (maxRadius > 0.0) {\r\n        if (currentRadius > maxRadius) {\r\n            gl_FragColor = texture2D(uSampler, vTextureCoord);\r\n            return;\r\n        }\r\n        fade = 1.0 - pow(currentRadius / maxRadius, 2.0);\r\n    }\r\n\r\n    vec2 dir = vec2(vTextureCoord - center / filterArea.xy);\r\n    dir.y *= filterArea.y / filterArea.x;\r\n    float dist = length(dir);\r\n\r\n    if (dist <= 0.0 || dist < currentRadius - halfWavelength || dist > currentRadius + halfWavelength) {\r\n        gl_FragColor = texture2D(uSampler, vTextureCoord);\r\n        return;\r\n    }\r\n\r\n    vec2 diffUV = normalize(dir);\r\n\r\n    float diff = (dist - currentRadius) / halfWavelength;\r\n\r\n    float p = 1.0 - pow(abs(diff), 2.0);\r\n\r\n    // float powDiff = diff * pow(p, 2.0) * ( amplitude * fade );\r\n    float powDiff = 1.25 * sin(diff * PI) * p * ( amplitude * fade );\r\n\r\n    vec2 offset = diffUV * powDiff / filterArea.xy;\r\n\r\n    // Do clamp :\r\n    vec2 coord = vTextureCoord + offset;\r\n    vec2 clampedCoord = clamp(coord, filterClamp.xy, filterClamp.zw);\r\n    vec4 color = texture2D(uSampler, clampedCoord);\r\n    if (coord != clampedCoord) {\r\n        color *= max(0.0, 1.0 - length(coord - clampedCoord));\r\n    }\r\n\r\n    // No clamp :\r\n    // gl_FragColor = texture2D(uSampler, vTextureCoord + offset);\r\n\r\n    color.rgb *= 1.0 + (brightness - 1.0) * p * fade;\r\n\r\n    gl_FragColor = color;\r\n}\r\n",i=function(r){function e(e,i,o){void 0===e&&(e=[0,0]),void 0===i&&(i={}),void 0===o&&(o=0),r.call(this,t,n),this.center=e,Array.isArray(i)&&(console.warn("Deprecated Warning: ShockwaveFilter params Array has been changed to options Object."),i={}),i=Object.assign({amplitude:30,wavelength:160,brightness:1,speed:500,radius:-1},i),this.amplitude=i.amplitude,this.wavelength=i.wavelength,this.brightness=i.brightness,this.speed=i.speed,this.radius=i.radius,this.time=o}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var i={center:{configurable:!0},amplitude:{configurable:!0},wavelength:{configurable:!0},brightness:{configurable:!0},speed:{configurable:!0},radius:{configurable:!0}};return e.prototype.apply=function(r,e,t,n){this.uniforms.time=this.time,r.applyFilter(this,e,t,n)},i.center.get=function(){return this.uniforms.center},i.center.set=function(r){this.uniforms.center=r},i.amplitude.get=function(){return this.uniforms.amplitude},i.amplitude.set=function(r){this.uniforms.amplitude=r},i.wavelength.get=function(){return this.uniforms.wavelength},i.wavelength.set=function(r){this.uniforms.wavelength=r},i.brightness.get=function(){return this.uniforms.brightness},i.brightness.set=function(r){this.uniforms.brightness=r},i.speed.get=function(){return this.uniforms.speed},i.speed.set=function(r){this.uniforms.speed=r},i.radius.get=function(){return this.uniforms.radius},i.radius.set=function(r){this.uniforms.radius=r},Object.defineProperties(e.prototype,i),e}(e.Filter);return r.ShockwaveFilter=i,r}({},PIXI);Object.assign(PIXI.filters,__filters),function(r,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("pixi.js")):"function"==typeof define&&define.amd?define(["exports","pixi.js"],e):e((r=r||self).__filters={},r.PIXI)}(this,(function(r,e){"use strict";var t="attribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n    vTextureCoord = aTextureCoord;\r\n}",o="varying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\nuniform sampler2D uLightmap;\r\nuniform vec4 filterArea;\r\nuniform vec2 dimensions;\r\nuniform vec4 ambientColor;\r\nvoid main() {\r\n    vec4 diffuseColor = texture2D(uSampler, vTextureCoord);\r\n    vec2 lightCoord = (vTextureCoord * filterArea.xy) / dimensions;\r\n    vec4 light = texture2D(uLightmap, lightCoord);\r\n    vec3 ambient = ambientColor.rgb * ambientColor.a;\r\n    vec3 intensity = ambient + light.rgb;\r\n    vec3 finalColor = diffuseColor.rgb * intensity;\r\n    gl_FragColor = vec4(finalColor, diffuseColor.a);\r\n}\r\n",i=function(r){function i(e,i,n){void 0===i&&(i=0),void 0===n&&(n=1),r.call(this,t,o),this.uniforms.dimensions=new Float32Array(2),this.uniforms.ambientColor=new Float32Array([0,0,0,n]),this.texture=e,this.color=i}r&&(i.__proto__=r),i.prototype=Object.create(r&&r.prototype),i.prototype.constructor=i;var n={texture:{configurable:!0},color:{configurable:!0},alpha:{configurable:!0}};return i.prototype.apply=function(r,e,t,o){this.uniforms.dimensions[0]=e.sourceFrame.width,this.uniforms.dimensions[1]=e.sourceFrame.height,r.applyFilter(this,e,t,o)},n.texture.get=function(){return this.uniforms.uLightmap},n.texture.set=function(r){this.uniforms.uLightmap=r},n.color.set=function(r){var t=this.uniforms.ambientColor;"number"==typeof r?(e.utils.hex2rgb(r,t),this._color=r):(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],this._color=e.utils.rgb2hex(t))},n.color.get=function(){return this._color},n.alpha.get=function(){return this.uniforms.ambientColor[3]},n.alpha.set=function(r){this.uniforms.ambientColor[3]=r},Object.defineProperties(i.prototype,n),i}(e.Filter);r.SimpleLightmapFilter=i,Object.defineProperty(r,"__esModule",{value:!0})})),Object.assign(PIXI.filters,this?this.__filters:__filters),function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("pixi.js")):"function"==typeof define&&define.amd?define(["exports","pixi.js"],r):r((e=e||self).__filters={},e.PIXI)}(this,(function(e,r){"use strict";var i="attribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n    vTextureCoord = aTextureCoord;\r\n}",t="// precision highp float;\r\n\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\nuniform vec4 filterArea;\r\nuniform vec4 filterClamp;\r\nuniform vec2 dimensions;\r\nuniform float aspect;\r\n\r\nuniform sampler2D displacementMap;\r\nuniform float offset;\r\nuniform float sinDir;\r\nuniform float cosDir;\r\nuniform int fillMode;\r\n\r\nuniform float seed;\r\nuniform vec2 red;\r\nuniform vec2 green;\r\nuniform vec2 blue;\r\n\r\nconst int TRANSPARENT = 0;\r\nconst int ORIGINAL = 1;\r\nconst int LOOP = 2;\r\nconst int CLAMP = 3;\r\nconst int MIRROR = 4;\r\n\r\nvoid main(void)\r\n{\r\n    vec2 coord = (vTextureCoord * filterArea.xy) / dimensions;\r\n\r\n    if (coord.x > 1.0 || coord.y > 1.0) {\r\n        return;\r\n    }\r\n\r\n    float cx = coord.x - 0.5;\r\n    float cy = (coord.y - 0.5) * aspect;\r\n    float ny = (-sinDir * cx + cosDir * cy) / aspect + 0.5;\r\n\r\n    // displacementMap: repeat\r\n    // ny = ny > 1.0 ? ny - 1.0 : (ny < 0.0 ? 1.0 + ny : ny);\r\n\r\n    // displacementMap: mirror\r\n    ny = ny > 1.0 ? 2.0 - ny : (ny < 0.0 ? -ny : ny);\r\n\r\n    vec4 dc = texture2D(displacementMap, vec2(0.5, ny));\r\n\r\n    float displacement = (dc.r - dc.g) * (offset / filterArea.x);\r\n\r\n    coord = vTextureCoord + vec2(cosDir * displacement, sinDir * displacement * aspect);\r\n\r\n    if (fillMode == CLAMP) {\r\n        coord = clamp(coord, filterClamp.xy, filterClamp.zw);\r\n    } else {\r\n        if( coord.x > filterClamp.z ) {\r\n            if (fillMode == ORIGINAL) {\r\n                gl_FragColor = texture2D(uSampler, vTextureCoord);\r\n                return;\r\n            } else if (fillMode == LOOP) {\r\n                coord.x -= filterClamp.z;\r\n            } else if (fillMode == MIRROR) {\r\n                coord.x = filterClamp.z * 2.0 - coord.x;\r\n            } else {\r\n                gl_FragColor = vec4(0., 0., 0., 0.);\r\n                return;\r\n            }\r\n        } else if( coord.x < filterClamp.x ) {\r\n            if (fillMode == ORIGINAL) {\r\n                gl_FragColor = texture2D(uSampler, vTextureCoord);\r\n                return;\r\n            } else if (fillMode == LOOP) {\r\n                coord.x += filterClamp.z;\r\n            } else if (fillMode == MIRROR) {\r\n                coord.x *= -filterClamp.z;\r\n            } else {\r\n                gl_FragColor = vec4(0., 0., 0., 0.);\r\n                return;\r\n            }\r\n        }\r\n\r\n        if( coord.y > filterClamp.w ) {\r\n            if (fillMode == ORIGINAL) {\r\n                gl_FragColor = texture2D(uSampler, vTextureCoord);\r\n                return;\r\n            } else if (fillMode == LOOP) {\r\n                coord.y -= filterClamp.w;\r\n            } else if (fillMode == MIRROR) {\r\n                coord.y = filterClamp.w * 2.0 - coord.y;\r\n            } else {\r\n                gl_FragColor = vec4(0., 0., 0., 0.);\r\n                return;\r\n            }\r\n        } else if( coord.y < filterClamp.y ) {\r\n            if (fillMode == ORIGINAL) {\r\n                gl_FragColor = texture2D(uSampler, vTextureCoord);\r\n                return;\r\n            } else if (fillMode == LOOP) {\r\n                coord.y += filterClamp.w;\r\n            } else if (fillMode == MIRROR) {\r\n                coord.y *= -filterClamp.w;\r\n            } else {\r\n                gl_FragColor = vec4(0., 0., 0., 0.);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    gl_FragColor.r = texture2D(uSampler, coord + red * (1.0 - seed * 0.4) / filterArea.xy).r;\r\n    gl_FragColor.g = texture2D(uSampler, coord + green * (1.0 - seed * 0.3) / filterArea.xy).g;\r\n    gl_FragColor.b = texture2D(uSampler, coord + blue * (1.0 - seed * 0.2) / filterArea.xy).b;\r\n    gl_FragColor.a = texture2D(uSampler, coord).a;\r\n}\r\n",n=function(e){function n(n){void 0===n&&(n={}),e.call(this,i,t),this.uniforms.dimensions=new Float32Array(2),n=Object.assign({slices:5,offset:100,direction:0,fillMode:0,average:!1,seed:0,red:[0,0],green:[0,0],blue:[0,0],minSize:8,sampleSize:512},n),this.direction=n.direction,this.red=n.red,this.green=n.green,this.blue=n.blue,this.offset=n.offset,this.fillMode=n.fillMode,this.average=n.average,this.seed=n.seed,this.minSize=n.minSize,this.sampleSize=n.sampleSize,this._canvas=document.createElement("canvas"),this._canvas.width=4,this._canvas.height=this.sampleSize,this.texture=r.Texture.fromCanvas(this._canvas,r.SCALE_MODES.NEAREST),this._slices=0,this.slices=n.slices}e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n;var s={sizes:{configurable:!0},offsets:{configurable:!0},slices:{configurable:!0},direction:{configurable:!0},red:{configurable:!0},green:{configurable:!0},blue:{configurable:!0}};return n.prototype.apply=function(e,r,i,t){var n=r.sourceFrame.width,s=r.sourceFrame.height;this.uniforms.dimensions[0]=n,this.uniforms.dimensions[1]=s,this.uniforms.aspect=s/n,this.uniforms.seed=this.seed,this.uniforms.offset=this.offset,this.uniforms.fillMode=this.fillMode,e.applyFilter(this,r,i,t)},n.prototype._randomizeSizes=function(){var e=this._sizes,r=this._slices-1,i=this.sampleSize,t=Math.min(this.minSize/i,.9/this._slices);if(this.average){for(var n=this._slices,s=1,o=0;o<r;o++){var l=s/(n-o),f=Math.max(l*(1-.6*Math.random()),t);e[o]=f,s-=f}e[r]=s}else{for(var a=1,c=Math.sqrt(1/this._slices),u=0;u<r;u++){var d=Math.max(c*a*Math.random(),t);e[u]=d,a-=d}e[r]=a}this.shuffle()},n.prototype.shuffle=function(){for(var e=this._sizes,r=this._slices-1;r>0;r--){var i=Math.random()*r>>0,t=e[r];e[r]=e[i],e[i]=t}},n.prototype._randomizeOffsets=function(){for(var e=0;e<this._slices;e++)this._offsets[e]=Math.random()*(Math.random()<.5?-1:1)},n.prototype.refresh=function(){this._randomizeSizes(),this._randomizeOffsets(),this.redraw()},n.prototype.redraw=function(){var e,r=this.sampleSize,i=this.texture,t=this._canvas.getContext("2d");t.clearRect(0,0,8,r);for(var n=0,s=0;s<this._slices;s++){e=Math.floor(256*this._offsets[s]);var o=this._sizes[s]*r,l=e>0?e:0,f=e<0?-e:0;t.fillStyle="rgba("+l+", "+f+", 0, 1)",t.fillRect(0,n>>0,r,o+1>>0),n+=o}i.baseTexture.update(),this.uniforms.displacementMap=i},s.sizes.set=function(e){for(var r=Math.min(this._slices,e.length),i=0;i<r;i++)this._sizes[i]=e[i]},s.sizes.get=function(){return this._sizes},s.offsets.set=function(e){for(var r=Math.min(this._slices,e.length),i=0;i<r;i++)this._offsets[i]=e[i]},s.offsets.get=function(){return this._offsets},s.slices.get=function(){return this._slices},s.slices.set=function(e){this._slices!==e&&(this._slices=e,this.uniforms.slices=e,this._sizes=this.uniforms.slicesWidth=new Float32Array(e),this._offsets=this.uniforms.slicesOffset=new Float32Array(e),this.refresh())},s.direction.get=function(){return this._direction},s.direction.set=function(e){if(this._direction!==e){this._direction=e;var i=e*r.DEG_TO_RAD;this.uniforms.sinDir=Math.sin(i),this.uniforms.cosDir=Math.cos(i)}},s.red.get=function(){return this.uniforms.red},s.red.set=function(e){this.uniforms.red=e},s.green.get=function(){return this.uniforms.green},s.green.set=function(e){this.uniforms.green=e},s.blue.get=function(){return this.uniforms.blue},s.blue.set=function(e){this.uniforms.blue=e},n.prototype.destroy=function(){this.texture.destroy(!0),this.texture=null,this._canvas=null,this.red=null,this.green=null,this.blue=null,this._sizes=null,this._offsets=null},Object.defineProperties(n.prototype,s),n}(r.Filter);n.TRANSPARENT=0,n.ORIGINAL=1,n.LOOP=2,n.CLAMP=3,n.MIRROR=4,e.GlitchFilter=n,Object.defineProperty(e,"__esModule",{value:!0})})),Object.assign(PIXI.filters,this?this.__filters:__filters),function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("pixi.js")):"function"==typeof define&&define.amd?define(["exports","pixi.js"],r):r((e=e||self).__filters={},e.PIXI)}(this,(function(e,r){"use strict";var t="attribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n    vTextureCoord = aTextureCoord;\r\n}",n="precision mediump float;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nuniform sampler2D uSampler;\r\nuniform vec4 filterArea;\r\nuniform vec2 red;\r\nuniform vec2 green;\r\nuniform vec2 blue;\r\n\r\nvoid main(void)\r\n{\r\n   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/filterArea.xy).r;\r\n   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/filterArea.xy).g;\r\n   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/filterArea.xy).b;\r\n   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;\r\n}\r\n",o=function(e){function r(r,o,i){void 0===r&&(r=[-10,0]),void 0===o&&(o=[0,10]),void 0===i&&(i=[0,0]),e.call(this,t,n),this.red=r,this.green=o,this.blue=i}e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r;var o={red:{configurable:!0},green:{configurable:!0},blue:{configurable:!0}};return o.red.get=function(){return this.uniforms.red},o.red.set=function(e){this.uniforms.red=e},o.green.get=function(){return this.uniforms.green},o.green.set=function(e){this.uniforms.green=e},o.blue.get=function(){return this.uniforms.blue},o.blue.set=function(e){this.uniforms.blue=e},Object.defineProperties(r.prototype,o),r}(r.Filter);e.RGBSplitFilter=o,Object.defineProperty(e,"__esModule",{value:!0})})),Object.assign(PIXI.filters,this?this.__filters:__filters),function(r,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("pixi.js")):"function"==typeof define&&define.amd?define(["exports","pixi.js"],e):e((r=r||self).__filters={},r.PIXI)}(this,(function(r,e){"use strict";var o="attribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n    vTextureCoord = aTextureCoord;\r\n}",n="precision mediump float;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nuniform vec2 size;\r\nuniform sampler2D uSampler;\r\n\r\nuniform vec4 filterArea;\r\n\r\nvec2 mapCoord( vec2 coord )\r\n{\r\n    coord *= filterArea.xy;\r\n    coord += filterArea.zw;\r\n\r\n    return coord;\r\n}\r\n\r\nvec2 unmapCoord( vec2 coord )\r\n{\r\n    coord -= filterArea.zw;\r\n    coord /= filterArea.xy;\r\n\r\n    return coord;\r\n}\r\n\r\nvec2 pixelate(vec2 coord, vec2 size)\r\n{\r\n\treturn floor( coord / size ) * size;\r\n}\r\n\r\nvoid main(void)\r\n{\r\n    vec2 coord = mapCoord(vTextureCoord);\r\n\r\n    coord = pixelate(coord, size);\r\n\r\n    coord = unmapCoord(coord);\r\n\r\n    gl_FragColor = texture2D(uSampler, coord);\r\n}\r\n",t=function(r){function e(e){void 0===e&&(e=10),r.call(this,o,n),this.size=e}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={size:{configurable:!0}};return t.size.get=function(){return this.uniforms.size},t.size.set=function(r){"number"==typeof r&&(r=[r,r]),this.uniforms.size=r},Object.defineProperties(e.prototype,t),e}(e.Filter);r.PixelateFilter=t,Object.defineProperty(r,"__esModule",{value:!0})})),Object.assign(PIXI.filters,this?this.__filters:__filters);class FilterMzUtility{static initFilters(){for(let filter in this._filters)delete this._filters[filter];this._filters={},this._scene.filters=[],BackGroundManager._backGroundView._layer.filters=[]}static sceneSetting(){this._scene=SceneManager._scene,null==this._scene.filters&&(this._scene.filters=[],BackGroundManager._backGroundView._layer.filters=[]),null==this._filters&&(this._filters={})}static resetFilter(){let _lastFilter=[];for(let filter in this._filters)_lastFilter.push(filter),this.removeFilter(Number(filter));_lastFilter.forEach(addfilter=>{this.addFilter(Number(addfilter))})}static addFilter(type,option){if(this.sceneSetting(),0!=$dataOption.getUserData("displayEffect")){switch(type){case FilterType.None:this.initFilters();break;case FilterType.Godlay:this.godrayFilter();break;case FilterType.OldFilm:this.oldFilmFilter(!1);break;case FilterType.Sepia:this.sepiaFilter();break;case FilterType.Desaturate:this.desaturateFilter();break;case FilterType.Blur:this.blurFilter();break;case FilterType.BlurFade:this.blurFadeFilter();break;case FilterType.Glitch:this.glitchFilter();break;case FilterType.NormalBlur:this.normalBlurFilter(option);break;case FilterType.RGBSplit:this.rgbSplitFilter(option);break;case FilterType.Pixelate:this.pixelateFilter(option);break;case FilterType.PixelateFade:this.pixelateFadeFilter(option);break;case FilterType.OldFilmBack:this.oldFilmFilter(!0);break;case FilterType.DesaturateBack:this.desaturateBackFilter();break;case FilterType.OldFilmFade:this.oldFilmFadeFilter(!0);break;case FilterType.MenuBack:this.menuBackFilter();break;case FilterType.EndingBlur:this.endingBlurFilter();break;case FilterType.EndingBlurEnd:this.endingBlurEndFilter();break;case FilterType.EndingBlurStop:this.endingBlurStopFilter()}$gameScreen.setFilters(this._filters)}else this.resetFilter()}static godrayFilter(){let godrayFilter=new PIXI.filters.GodrayFilter;godrayFilter.center.x=0,godrayFilter.center.y=0,godrayFilter.angle=30,godrayFilter.gain=.5,godrayFilter.lacunarity=2.5,godrayFilter.parallel=!0;const layer=BackGroundManager._backGroundView._layer;this.addFilterLayer(FilterType.Godlay,godrayFilter,layer)}static oldFilmFilter(isBack){let oldFilmFilter=new PIXI.filters.OldFilmFilter,layer;oldFilmFilter.sepia=.05,oldFilmFilter.noise=.5,oldFilmFilter.scratchDensity=0,oldFilmFilter.noiseSize=1,oldFilmFilter.seed=1,oldFilmFilter.vignettingBlur=.5,isBack?(layer=BackGroundManager._backGroundView._layer,this.addFilterLayer(FilterType.OldFilmBack,oldFilmFilter,layer)):(layer=SceneManager._scene,this.addFilterLayer(FilterType.OldFilm,oldFilmFilter,layer))}static oldFilmFadeFilter(){let oldFilmFilter=new PIXI.filters.OldFilmFilter;oldFilmFilter.sepia=.05,oldFilmFilter.noise=.5,oldFilmFilter.scratchDensity=0,oldFilmFilter.noiseSize=1,oldFilmFilter.seed=1,oldFilmFilter.vignettingBlur=.5;let layer=SceneManager._scene;this.addFilterLayer(FilterType.OldFilmFade,oldFilmFilter,layer)}static menuBackFilter(){let menuBackFilter=new Sprite_MenuBack,layer;SceneManager._scene.addChild(menuBackFilter)}static sepiaFilter(){let sepiaMatrix=new PIXI.filters.ColorMatrixFilter;sepiaMatrix.sepia(!0);const layer=SceneManager._scene;this.addFilterLayer(FilterType.Sepia,sepiaMatrix,layer)}static desaturateFilter(){let desaturateMatrix=new PIXI.filters.ColorMatrixFilter;desaturateMatrix.desaturate(!0);const layer=SceneManager._scene;this.addFilterLayer(FilterType.Desaturate,desaturateMatrix,layer)}static desaturateBackFilter(){let desaturateMatrix=new PIXI.filters.ColorMatrixFilter;desaturateMatrix.desaturate(!0);const layer=BackGroundManager._backGroundView._layer;this.addFilterLayer(FilterType.DesaturateBack,desaturateMatrix,layer)}static blurFilter(){let blurFilter=new PIXI.filters.ZoomBlurFilter;blurFilter.strength=.01;const x=Math.randomInt(800)+120,y=Math.randomInt(400)+120;blurFilter.center=[x,y];const layer=SceneManager._scene;this.addFilterLayer(FilterType.Blur,blurFilter,layer)}static blurFadeFilter(){let blurFadeFilter=new PIXI.filters.ZoomBlurFilter;blurFadeFilter.strength=.4;const x=.5*Graphics.width,y=.5*Graphics.height;blurFadeFilter.center=[x,y];const layer=SceneManager._scene;this.addFilterLayer(FilterType.BlurFade,blurFadeFilter,layer)}static glitchFilter(){if($gameDefine.platForm()==PlatForm.iOS)return;let glitchFilter=new PIXI.filters.GlitchFilter;glitchFilter.fillMode=PIXI.filters.GlitchFilter.MIRROR;const layer=SceneManager._scene;this.addFilterLayer(FilterType.Glitch,glitchFilter,layer)}static normalBlurFilter(option){let normalBlurFilter=new PIXI.filters.BlurFilter;normalBlurFilter.blur=null!=option.start?Number(option.start):0;const layer=SceneManager._scene;this.addFilterLayer(FilterType.NormalBlur,normalBlurFilter,layer),null!=option.plus&&(this._filters[FilterType.NormalBlur].plus=option.plus)}static rgbSplitFilter(option){let rgbSplitFilter=new PIXI.filters.RGBSplitFilter;const layer=SceneManager._scene;this.addFilterLayer(FilterType.RGBSplit,rgbSplitFilter,layer),null!=option&&(this._filters[FilterType.RGBSplit].option=option)}static pixelateFilter(){let filter=new PIXI.filters.PixelateFilter;const layer=SceneManager._scene;this.addFilterLayer(FilterType.Pixelate,filter,layer)}static pixelateFadeFilter(option){if(this._filters&&this._filters[FilterType.PixelateFade])return;let filter=new PIXI.filters.PixelateFilter;const layer=SceneManager._scene;this.addFilterLayer(FilterType.PixelateFade,filter,layer),null!=option&&(filter.size[0]=option.x,filter.size[1]=option.y)}static endingBlurFilter(){let blurFadeFilter=new PIXI.filters.ZoomBlurFilter;blurFadeFilter.strength=0;const x=.5*Graphics.width,y=.5*Graphics.height;blurFadeFilter.center=[x,y];const layer=SceneManager._scene;this.addFilterLayer(FilterType.EndingBlur,blurFadeFilter,layer)}static endingBlurEndFilter(){if(this._filters&&this._filters[FilterType.EndingBlur]){const blurFilter=this._filters[FilterType.EndingBlur].filter;let blurFadeFilter=new PIXI.filters.ZoomBlurFilter;blurFadeFilter.strength=blurFilter.strength;const x=.5*Graphics.width,y=.5*Graphics.height;blurFadeFilter.center=[x,y];const layer=SceneManager._scene;this.addFilterLayer(FilterType.EndingBlurEnd,blurFadeFilter,layer),this.removeFilter(Number(FilterType.EndingBlur)),this._endingBlurStop=!1}}static endingBlurStopFilter(){this._endingBlurStop=!0}static addFilterLayer(type,filter,layer){this._filters[type]={filter:filter,layer:layer},layer.filters.push(filter)}static update(){this.updateScene(),this.updateGodray(),this.updateOldFilm(),this.updateBlur(),this.updateBlurFade(),this.updateGlitch(),this.updateNormalBlur(),this.updateOldFilmBack(),this.updateOldFilmFade(),this.updatePixelateFade(),this.updateEndingBlur(),this.updateEndingBlurEnd()}static updateScene(){if(this._scene!=SceneManager._scene){if(this._scene=SceneManager._scene,1==this._throuthTerminal)return;this.resetFilter()}}static changeThrouthTerminal(isThrouth){this._throuthTerminal=isThrouth}static updateGodray(){if(this._filters&&this._filters[FilterType.Godlay]){const godrayFilter=this._filters[FilterType.Godlay].filter;godrayFilter.time=.01*Graphics.frameCount}}static updateOldFilm(){if(this._filters&&this._filters[FilterType.OldFilm]){const oldFilmFilter=this._filters[FilterType.OldFilm].filter;let base=Graphics.frameCount%60;oldFilmFilter.seed=.01*(base+1)}}static updateBlur(){if(this._filters&&this._filters[FilterType.Blur]){const blurFilter=this._filters[FilterType.Blur].filter;blurFilter.strength+=.01}}static updateBlurFade(){if(this._filters&&this._filters[FilterType.BlurFade]){const blurFilter=this._filters[FilterType.BlurFade].filter;blurFilter.strength-=.02,blurFilter.strength<0&&(blurFilter.strength=0)}}static updateNormalBlur(){if(this._filters&&this._filters[FilterType.NormalBlur]){const normalBlurFilter=this._filters[FilterType.NormalBlur].filter,plus=null!=this._filters[FilterType.NormalBlur].plus?this._filters[FilterType.NormalBlur].plus:0;normalBlurFilter.blur+=plus}}static updateGlitch(){if(this._filters&&this._filters[FilterType.Glitch]){if($gameDefine.platForm()==PlatForm.iOS)return;const glitchFilter=this._filters[FilterType.Glitch].filter;Graphics.frameCount%15==0&&(glitchFilter.slices=4+Math.randomInt(6))}}static updateOldFilmBack(){if(this._filters&&this._filters[FilterType.OldFilmBack]){const oldFilmFilter=this._filters[FilterType.OldFilmBack].filter;let base=Graphics.frameCount%60;oldFilmFilter.seed=.01*(base+1)}}static updateOldFilmFade(){if(this._filters&&this._filters[FilterType.OldFilmFade]){const oldFilmFilter=this._filters[FilterType.OldFilmFade].filter;let base=Graphics.frameCount%60;oldFilmFilter.seed=.01*(base+1)}}static updatePixelateFade(){if(this._filters&&this._filters[FilterType.PixelateFade]){let filter=this._filters[FilterType.PixelateFade].filter,sizeX=filter.size[0],sizeY=filter.size[1];sizeX-=.4,sizeY-=.4,filter.size[0]=sizeX,filter.size[1]=sizeY,sizeX<0&&(filter.size[0]=0),sizeY<0&&(filter.size[1]=0,this.removeFilter(FilterType.PixelateFade))}}static updateEndingBlur(){if(this._filters&&this._filters[FilterType.EndingBlur]){const blurFilter=this._filters[FilterType.EndingBlur].filter;if(this._endingBlurStop&&1==this._endingBlurStop)return;blurFilter.strength+=.002}}static updateEndingBlurEnd(){if(this._filters&&this._filters[FilterType.EndingBlurEnd]){const blurFilter=this._filters[FilterType.EndingBlurEnd].filter;blurFilter.strength-=.1,blurFilter.strength<0&&(blurFilter.strength=0)}}static removeFilter(type){if(!this._filters)return;if(!this._filters.hasOwnProperty(type))return;const removefilter=this._filters[type].filter;if(removefilter){const layer=this._filters[type].layer;layer.filters=_.without(layer.filters,removefilter),delete this._filters[type],$gameScreen.setFilters(this._filters)}}}const FilterType={None:0,Godlay:1,OldFilm:2,Sepia:3,Desaturate:4,Blur:5,BlurFade:6,Glitch:7,NormalBlur:8,RGBSplit:9,Pixelate:10,PixelateFade:11,OldFilmBack:102,DesaturateBack:104,OldFilmFade:202,MenuBack:301,EndingBlur:400,EndingBlurEnd:401,EndingBlurStop:402};