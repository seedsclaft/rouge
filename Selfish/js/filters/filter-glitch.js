/*!
 * @pixi/filter-glitch - v2.6.1
 * Compiled Sun, 13 Jan 2019 12:59:55 UTC
 *
 * @pixi/filter-glitch is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("pixi.js")):"function"==typeof define&&define.amd?define(["exports","pixi.js"],r):r((e=e||self).__filters={},e.PIXI)}(this,function(e,r){"use strict";var i="attribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n    vTextureCoord = aTextureCoord;\r\n}",t="// precision highp float;\r\n\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\nuniform vec4 filterArea;\r\nuniform vec4 filterClamp;\r\nuniform vec2 dimensions;\r\nuniform float aspect;\r\n\r\nuniform sampler2D displacementMap;\r\nuniform float offset;\r\nuniform float sinDir;\r\nuniform float cosDir;\r\nuniform int fillMode;\r\n\r\nuniform float seed;\r\nuniform vec2 red;\r\nuniform vec2 green;\r\nuniform vec2 blue;\r\n\r\nconst int TRANSPARENT = 0;\r\nconst int ORIGINAL = 1;\r\nconst int LOOP = 2;\r\nconst int CLAMP = 3;\r\nconst int MIRROR = 4;\r\n\r\nvoid main(void)\r\n{\r\n    vec2 coord = (vTextureCoord * filterArea.xy) / dimensions;\r\n\r\n    if (coord.x > 1.0 || coord.y > 1.0) {\r\n        return;\r\n    }\r\n\r\n    float cx = coord.x - 0.5;\r\n    float cy = (coord.y - 0.5) * aspect;\r\n    float ny = (-sinDir * cx + cosDir * cy) / aspect + 0.5;\r\n\r\n    // displacementMap: repeat\r\n    // ny = ny > 1.0 ? ny - 1.0 : (ny < 0.0 ? 1.0 + ny : ny);\r\n\r\n    // displacementMap: mirror\r\n    ny = ny > 1.0 ? 2.0 - ny : (ny < 0.0 ? -ny : ny);\r\n\r\n    vec4 dc = texture2D(displacementMap, vec2(0.5, ny));\r\n\r\n    float displacement = (dc.r - dc.g) * (offset / filterArea.x);\r\n\r\n    coord = vTextureCoord + vec2(cosDir * displacement, sinDir * displacement * aspect);\r\n\r\n    if (fillMode == CLAMP) {\r\n        coord = clamp(coord, filterClamp.xy, filterClamp.zw);\r\n    } else {\r\n        if( coord.x > filterClamp.z ) {\r\n            if (fillMode == ORIGINAL) {\r\n                gl_FragColor = texture2D(uSampler, vTextureCoord);\r\n                return;\r\n            } else if (fillMode == LOOP) {\r\n                coord.x -= filterClamp.z;\r\n            } else if (fillMode == MIRROR) {\r\n                coord.x = filterClamp.z * 2.0 - coord.x;\r\n            } else {\r\n                gl_FragColor = vec4(0., 0., 0., 0.);\r\n                return;\r\n            }\r\n        } else if( coord.x < filterClamp.x ) {\r\n            if (fillMode == ORIGINAL) {\r\n                gl_FragColor = texture2D(uSampler, vTextureCoord);\r\n                return;\r\n            } else if (fillMode == LOOP) {\r\n                coord.x += filterClamp.z;\r\n            } else if (fillMode == MIRROR) {\r\n                coord.x *= -filterClamp.z;\r\n            } else {\r\n                gl_FragColor = vec4(0., 0., 0., 0.);\r\n                return;\r\n            }\r\n        }\r\n\r\n        if( coord.y > filterClamp.w ) {\r\n            if (fillMode == ORIGINAL) {\r\n                gl_FragColor = texture2D(uSampler, vTextureCoord);\r\n                return;\r\n            } else if (fillMode == LOOP) {\r\n                coord.y -= filterClamp.w;\r\n            } else if (fillMode == MIRROR) {\r\n                coord.y = filterClamp.w * 2.0 - coord.y;\r\n            } else {\r\n                gl_FragColor = vec4(0., 0., 0., 0.);\r\n                return;\r\n            }\r\n        } else if( coord.y < filterClamp.y ) {\r\n            if (fillMode == ORIGINAL) {\r\n                gl_FragColor = texture2D(uSampler, vTextureCoord);\r\n                return;\r\n            } else if (fillMode == LOOP) {\r\n                coord.y += filterClamp.w;\r\n            } else if (fillMode == MIRROR) {\r\n                coord.y *= -filterClamp.w;\r\n            } else {\r\n                gl_FragColor = vec4(0., 0., 0., 0.);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    gl_FragColor.r = texture2D(uSampler, coord + red * (1.0 - seed * 0.4) / filterArea.xy).r;\r\n    gl_FragColor.g = texture2D(uSampler, coord + green * (1.0 - seed * 0.3) / filterArea.xy).g;\r\n    gl_FragColor.b = texture2D(uSampler, coord + blue * (1.0 - seed * 0.2) / filterArea.xy).b;\r\n    gl_FragColor.a = texture2D(uSampler, coord).a;\r\n}\r\n",n=function(e){function n(n){void 0===n&&(n={}),e.call(this,i,t),this.uniforms.dimensions=new Float32Array(2),n=Object.assign({slices:5,offset:100,direction:0,fillMode:0,average:!1,seed:0,red:[0,0],green:[0,0],blue:[0,0],minSize:8,sampleSize:512},n),this.direction=n.direction,this.red=n.red,this.green=n.green,this.blue=n.blue,this.offset=n.offset,this.fillMode=n.fillMode,this.average=n.average,this.seed=n.seed,this.minSize=n.minSize,this.sampleSize=n.sampleSize,this._canvas=document.createElement("canvas"),this._canvas.width=4,this._canvas.height=this.sampleSize,this.texture=r.Texture.fromCanvas(this._canvas,r.SCALE_MODES.NEAREST),this._slices=0,this.slices=n.slices}e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n;var s={sizes:{configurable:!0},offsets:{configurable:!0},slices:{configurable:!0},direction:{configurable:!0},red:{configurable:!0},green:{configurable:!0},blue:{configurable:!0}};return n.prototype.apply=function(e,r,i,t){var n=r.sourceFrame.width,s=r.sourceFrame.height;this.uniforms.dimensions[0]=n,this.uniforms.dimensions[1]=s,this.uniforms.aspect=s/n,this.uniforms.seed=this.seed,this.uniforms.offset=this.offset,this.uniforms.fillMode=this.fillMode,e.applyFilter(this,r,i,t)},n.prototype._randomizeSizes=function(){var e=this._sizes,r=this._slices-1,i=this.sampleSize,t=Math.min(this.minSize/i,.9/this._slices);if(this.average){for(var n=this._slices,s=1,o=0;o<r;o++){var l=s/(n-o),f=Math.max(l*(1-.6*Math.random()),t);e[o]=f,s-=f}e[r]=s}else{for(var a=1,c=Math.sqrt(1/this._slices),u=0;u<r;u++){var d=Math.max(c*a*Math.random(),t);e[u]=d,a-=d}e[r]=a}this.shuffle()},n.prototype.shuffle=function(){for(var e=this._sizes,r=this._slices-1;r>0;r--){var i=Math.random()*r>>0,t=e[r];e[r]=e[i],e[i]=t}},n.prototype._randomizeOffsets=function(){for(var e=0;e<this._slices;e++)this._offsets[e]=Math.random()*(Math.random()<.5?-1:1)},n.prototype.refresh=function(){this._randomizeSizes(),this._randomizeOffsets(),this.redraw()},n.prototype.redraw=function(){var e,r=this.sampleSize,i=this.texture,t=this._canvas.getContext("2d");t.clearRect(0,0,8,r);for(var n=0,s=0;s<this._slices;s++){e=Math.floor(256*this._offsets[s]);var o=this._sizes[s]*r,l=e>0?e:0,f=e<0?-e:0;t.fillStyle="rgba("+l+", "+f+", 0, 1)",t.fillRect(0,n>>0,r,o+1>>0),n+=o}i.baseTexture.update(),this.uniforms.displacementMap=i},s.sizes.set=function(e){for(var r=Math.min(this._slices,e.length),i=0;i<r;i++)this._sizes[i]=e[i]},s.sizes.get=function(){return this._sizes},s.offsets.set=function(e){for(var r=Math.min(this._slices,e.length),i=0;i<r;i++)this._offsets[i]=e[i]},s.offsets.get=function(){return this._offsets},s.slices.get=function(){return this._slices},s.slices.set=function(e){this._slices!==e&&(this._slices=e,this.uniforms.slices=e,this._sizes=this.uniforms.slicesWidth=new Float32Array(e),this._offsets=this.uniforms.slicesOffset=new Float32Array(e),this.refresh())},s.direction.get=function(){return this._direction},s.direction.set=function(e){if(this._direction!==e){this._direction=e;var i=e*r.DEG_TO_RAD;this.uniforms.sinDir=Math.sin(i),this.uniforms.cosDir=Math.cos(i)}},s.red.get=function(){return this.uniforms.red},s.red.set=function(e){this.uniforms.red=e},s.green.get=function(){return this.uniforms.green},s.green.set=function(e){this.uniforms.green=e},s.blue.get=function(){return this.uniforms.blue},s.blue.set=function(e){this.uniforms.blue=e},n.prototype.destroy=function(){this.texture.destroy(!0),this.texture=null,this._canvas=null,this.red=null,this.green=null,this.blue=null,this._sizes=null,this._offsets=null},Object.defineProperties(n.prototype,s),n}(r.Filter);n.TRANSPARENT=0,n.ORIGINAL=1,n.LOOP=2,n.CLAMP=3,n.MIRROR=4,e.GlitchFilter=n,Object.defineProperty(e,"__esModule",{value:!0})}),Object.assign(PIXI.filters,this?this.__filters:__filters);
//# sourceMappingURL=filter-glitch.js.map
